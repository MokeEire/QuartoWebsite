<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.615">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2022-07-14">
<title>Mark Barrett - Parsing XML with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><script src="../../site_libs/core-js-2.5.3/shim.min.js"></script><script src="../../site_libs/react-17.0.0/react.min.js"></script><script src="../../site_libs/react-17.0.0/react-dom.min.js"></script><script src="../../site_libs/reactwidget-1.0.0/react-tools.js"></script><script src="../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="../../site_libs/reactable-binding-0.3.0/reactable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="../../styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mark Barrett</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">Blog</a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/Mmm_JuicyFruit"><i class="bi bi-twitter" role="img" aria-label="twitter">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MokeEire"><i class="bi bi-github" role="img" aria-label="github">
</i> 
 </a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#what-is-xml" id="toc-what-is-xml" class="nav-link active" data-scroll-target="#what-is-xml">What is XML?</a></li>
  <li><a href="#navigating-xml-with-r" id="toc-navigating-xml-with-r" class="nav-link" data-scroll-target="#navigating-xml-with-r">Navigating XML with R</a></li>
  <li><a href="#define-the-output" id="toc-define-the-output" class="nav-link" data-scroll-target="#define-the-output">Define the output</a></li>
  <li>
<a href="#from-xml-to-data-frame" id="toc-from-xml-to-data-frame" class="nav-link" data-scroll-target="#from-xml-to-data-frame">From XML to Data Frame</a>
  <ul class="collapse">
<li><a href="#convert-an-xml-nodeset-to-a-data-frame" id="toc-convert-an-xml-nodeset-to-a-data-frame" class="nav-link" data-scroll-target="#convert-an-xml-nodeset-to-a-data-frame">Convert an XML nodeset to a data frame</a></li>
  </ul>
</li>
  <li>
<a href="#dealing-with-nested-data" id="toc-dealing-with-nested-data" class="nav-link" data-scroll-target="#dealing-with-nested-data">Dealing with nested data</a>
  <ul class="collapse">
<li><a href="#transforming-nested-data-into-list-columns" id="toc-transforming-nested-data-into-list-columns" class="nav-link" data-scroll-target="#transforming-nested-data-into-list-columns">Transforming nested data into list columns</a></li>
  <li><a href="#when-they-put-xml-in-your-xml" id="toc-when-they-put-xml-in-your-xml" class="nav-link" data-scroll-target="#when-they-put-xml-in-your-xml">When they put XML in your XML</a></li>
  </ul>
</li>
  <li><a href="#tldr-main-points" id="toc-tldr-main-points" class="nav-link" data-scroll-target="#tldr-main-points">TL;DR: Main Points</a></li>
  <li><a href="#other-helpful-articles" id="toc-other-helpful-articles" class="nav-link" data-scroll-target="#other-helpful-articles">Other helpful articles</a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session Info</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Parsing XML with R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Untangling data from complex XML structures using <a href="https://www.omegahat.net/RSXML/">XML</a> and <a href="https://xml2.r-lib.org/">xml2</a></p>
  <div class="quarto-categories">
    <div class="quarto-category">data</div>
    <div class="quarto-category">governance</div>
    <div class="quarto-category">R</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 14, 2022</p>
    </div>
  </div>
    
  </div>
  

</header><div class="cell">

</div>
<p>Unlike Excel spreadsheets, CSV files, and other tabular formats, (e)Xtensible Markup Language (XML) is a storage format designed to contain any “arbitrary” structure<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> of data. XML’s flexibility is useful for storing information like financial transactions and recipes to webpage content and document formatting<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. If you have worked with XML before, you’ll know it can be a bit of a pain to transform into a tabular format typically used in data analysis. The good news is you’re not alone! This article will help you to load XML files with R, extract what you need from them, and store the results in a analysis-friendly data frame.</p>
<div class="callout-tip callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
What you’ll learn:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Load and parse XML files in R using the <a href="https://www.omegahat.net/RSXML/">XML</a> and <a href="https://xml2.r-lib.org/">xml2</a> packages</p></li>
<li><p>Explore the structure of XML documents</p></li>
<li><p>List, map, and flatten your data into a tabular format using <a href="http://purrr.tidyverse.org">purrr</a>, and making use of <a href="https://tidyr.tidyverse.org">tidyr</a>’s list columns when necessary</p></li>
</ul>
</div>
</div>
<section id="what-is-xml" class="level1"><h1>What is XML?</h1>
<p>At its core, XML is “information wrapped in tags”. Think of XML’s structure as branches of a tree, with each branch having their own leaves. Below is an example of a bookstore’s data in XML format from <a href="https://www.w3schools.com/XML/xml_usedfor.asp">w3schools</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">bookstore</span>&gt;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">book</span><span class="ot"> category=</span><span class="st">"children"</span>&gt;</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">title</span>&gt;Harry Potter&lt;/<span class="kw">title</span>&gt;</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">author</span>&gt;J K. Rowling&lt;/<span class="kw">author</span>&gt;</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">year</span>&gt;2005&lt;/<span class="kw">year</span>&gt;</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">price</span>&gt;29.99&lt;/<span class="kw">price</span>&gt;</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">book</span>&gt;</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">book</span><span class="ot"> category=</span><span class="st">"web"</span>&gt;</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">title</span>&gt;Learning XML&lt;/<span class="kw">title</span>&gt;</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">author</span>&gt;Erik T. Ray&lt;/<span class="kw">author</span>&gt;</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">year</span>&gt;2003&lt;/<span class="kw">year</span>&gt;</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">price</span>&gt;39.95&lt;/<span class="kw">price</span>&gt;</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">book</span>&gt;</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">bookstore</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>&lt;bookstore&gt;</code> is the parent, or <em>root</em> element in the example above. The two <code>&lt;book&gt;</code> elements are the bookstore’s <em>children</em>, each of which has individual data points in <em>child</em> elements (e.g.&nbsp;<code>&lt;title&gt;</code>) and <em>attributes</em> e.g.&nbsp;<code>&lt;book category="children"&gt;</code> stores the book’s category as an attribute.</p>
<div class="callout-note callout callout-style-simple no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Attributes are a useful way to store data related to a specific element for HTML, but using child elements is typically preferred in XML<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. However, you’ll still likely run into data stored in attributes so we’ll touch on extracting data from both.</p>
</div>
</div>
</section><section id="navigating-xml-with-r" class="level1 page-columns page-full"><h1>Navigating XML with R</h1>
<p>If you’ve never used R before, this will be a bit of a rough point to start learning. Instead I would recommend checking <a href="https://education.rstudio.com/learn/beginner/">RStudio’s beginners guide</a>, so for the remainder of the post I will assume some familiarity with R. Four packages I use throughout this post are listed below. If you don’t understand how a function works or want to see the function reference, click on the function in the code and it <em>should</em> bring you to the function’s help page.</p>
<ul>
<li><p><a href="https://www.omegahat.net/RSXML/">XML</a> and <a href="https://xml2.r-lib.org/">xml2</a> provide functions for reading in and parsing XML<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p></li>
<li><p><a href="http://purrr.tidyverse.org">purrr</a> and <a href="https://tidyr.tidyverse.org">tidyr</a> (loaded as part of the <a href="https://tidyverse.tidyverse.org">tidyverse</a> package) help us wrangle lists and transform XML to data frames.</p></li>
</ul>
<div class="cell">
<details open=""><summary>Load libraries</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># copy the comment below to install the packages</span></span>
<span><span class="co"># install.packages(c("tidyverse", "XML", "xml2))</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.omegahat.net/RSXML/">XML</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://xml2.r-lib.org/">xml2</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To illustrate potential complexities of XML structures I’ll be using <a href="https://www.govinfo.gov/bulkdata/BILLSTATUS">congressional bill status data</a> from the US GPO’s <a href="https://www.govinfo.gov/">GovInfo service</a>. In particular, you can download the sample bill <a href="https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml" title="HR-391: Global Health Security Act of 2021">here</a> (chosen for its examples of challenges parsing XML).</p>
<p>First we need to read in the XML file. You can pass the URL or file path of the XML file to <code><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml()</a></code> to create an <code>xml_document</code> object<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. To see the contents of the file you’ve just loaded you can use <code><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents()</a></code> or enter the object’s name (here <code>bill_xml</code>) in the console.</p>
<div class="cell">
<details open=""><summary>Load and view XML file</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Read XML file</span></span>
<span><span class="va">bill_xml</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml</a></span><span class="op">(</span><span class="st">"https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at xml_document's contents</span></span>
<span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="va">bill_xml</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (2)}
[1] &lt;bill&gt;\n  &lt;billNumber&gt;391&lt;/billNumber&gt;\n  &lt;createDate&gt;2021-01-22T08:12:10 ...
[2] &lt;dublinCore xmlns:dc="http://purl.org/dc/elements/1.1/"&gt;\n  &lt;dc:format&gt;te ...</code></pre>
</div>
</div>
<p>We have two top-level nodes - <code>&lt;bill&gt;</code> and <code>&lt;dublinCore&gt;</code><a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. The latter is actually a metadata identifier and doesn’t contain bill-related information. We can use <code><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_child()</a></code> to select only elements inside the <code>&lt;bill&gt;</code> node, returning an XML nodeset that looks like this:</p>
<div class="cell column-page-right">
<details open=""><summary>Select first matching child element</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">bill_node</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_child</a></span><span class="op">(</span><span class="va">bill_xml</span>, <span class="st">"bill"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_node}
&lt;bill&gt;
 [1] &lt;billNumber&gt;391&lt;/billNumber&gt;
 [2] &lt;createDate&gt;2021-01-22T08:12:10Z&lt;/createDate&gt;
 [3] &lt;updateDate&gt;2022-09-07T13:37:22Z&lt;/updateDate&gt;
 [4] &lt;originChamber&gt;House&lt;/originChamber&gt;
 [5] &lt;billType&gt;HR&lt;/billType&gt;
 [6] &lt;introducedDate&gt;2021-01-21&lt;/introducedDate&gt;
 [7] &lt;congress&gt;117&lt;/congress&gt;
 [8] &lt;constitutionalAuthorityStatementText&gt;&lt;![CDATA[&lt;pre&gt;[Congressional Recor ...
 [9] &lt;recordedVotes&gt;\n  &lt;recordedVote&gt;\n    &lt;rollNumber&gt;188&lt;/rollNumber&gt;\n    ...
[10] &lt;committees&gt;\n  &lt;billCommittees&gt;\n    &lt;item&gt;\n      &lt;systemCode&gt;ssfr00&lt;/ ...
[11] &lt;committeeReports/&gt;
[12] &lt;relatedBills/&gt;
[13] &lt;actions&gt;\n  &lt;item&gt;\n    &lt;actionDate&gt;2021-07-12&lt;/actionDate&gt;\n    &lt;commi ...
[14] &lt;sponsors&gt;\n  &lt;item&gt;\n    &lt;bioguideId&gt;C001078&lt;/bioguideId&gt;\n    &lt;fullNam ...
[15] &lt;cosponsors&gt;\n  &lt;item&gt;\n    &lt;bioguideId&gt;C000266&lt;/bioguideId&gt;\n    &lt;fullN ...
[16] &lt;cboCostEstimates&gt;\n  &lt;item&gt;\n    &lt;pubDate&gt;2021-05-11T15:11:11Z&lt;/pubDate ...
[17] &lt;laws/&gt;
[18] &lt;notes/&gt;
[19] &lt;policyArea&gt;\n  &lt;name&gt;International Affairs&lt;/name&gt;\n&lt;/policyArea&gt;
[20] &lt;subjects&gt;\n  &lt;billSubjects&gt;\n    &lt;legislativeSubjects&gt;\n      &lt;item&gt;\n  ...
...</code></pre>
</div>
</div>
</section><section id="define-the-output" class="level1 page-columns page-full"><h1>Define the output</h1>
<p>Now we have the bill XML loaded and we’ve already stripped away some data we don’t need but before diving deeper, it’s helpful to think about the how you want to the processed XML data to be structured. For example, in the bill status data I might want to collect party-level votes. This could take the form of one row per party per bill with a column for yeas, nays, and abstentions<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>. Perhaps I want to look at the policy areas of bills which became law. Instead of processing the entire file and then selecting the data I want, I can select only the nodes I need at the outset before transforming the data into a data frame. This will likely save you some time in cases where you have a lot of data.</p>
<div class="cell column-page">

</div>
<p>With the congressional bills data, I defined my output as a bill-level dataset, i.e.&nbsp;one bill per row, storing <em>nested</em> elements like <code>recordedVotes</code>, <code>committees</code>, and <code>actions</code> inside <a href="https://jennybc.github.io/purrr-tutorial/ls13_list-columns.html">list columns</a>. While columns in a data frame are typically <em>atomic vectors</em><a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> of equal length, list columns enable us to store data of varying length and type, including data frames themselves. Using <a href="https://tidyr.tidyverse.org">tidyr</a>’s <code><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest()</a></code> function, we can expand this nested data into regular data frame columns. Here is what this output will look like:</p>
<div class="cell page-columns page-full">
<div class="cell-output-display column-page">

<div id="htmlwidget-a1e8ddfcbed76d43fd18" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a1e8ddfcbed76d43fd18">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"bill_id":["HR-391"],"bill_number":["391"],"create_date":["2021-01-22T08:12:10Z"],"update_date":["2022-09-07T13:37:22Z"],"origin_chamber":["House"],"bill_type":["HR"],"introduced_date":["2021-01-21T00:00:00Z"],"congress":["117"],"constitutional_authority_statement_text":["<pre>[Congressional Record Volume 167, Number 17 (Thursday, January 28, 2021)][House]From the Congressional Record Online through the Government Publishing Office [<a href=\"https://www.gpo.gov\">www.gpo.gov<\/a>]By Ms. SANCHEZ:H.J. Res. 22.Congress has the power to enact this legislation pursuantto the following:Article 1 Section 8ADDITIONAL SPONSORSUnder clause 7 of rule XII, sponsors were added to public bills andresolutions, as follows:H.R. 28: Mr. Chabot, Mr. Armstrong, Mrs. Fischbach, Mr.Lucas, Mr. Mast, and Mr. Womack.H.R. 40: Mr. Kahele, Ms. Roybal-Allard, Mr. Aguilar, Ms.Waters, Mr. Vela, Mr. Sires, and Mr. Huffman.H.R. 51: Mr. Mrvan and Ms. Davids of Kansas.H.R. 55: Ms. Ross, Mr. Lynch, Mr. Larsen of Washington, Mr.Thompson of California, Ms. Manning, Ms. Jayapal, Ms. Adams,Mr. Schneider, Mr. Veasey, and Ms. Wild.H.R. 77: Mr. Grothman.H.R. 78: Mr. Smith of New Jersey, Mr. Hice of Georgia, Mr.Bucshon, Mr. Burgess, and Mr. Norman.H.R. 97: Mrs. Hayes, Mr. Welch, Mr. Torres of New York, Mr.Cicilline, and Mr. Danny K. Davis of Illinois.H.R. 147: Mr. Ryan and Mr. Brown.H.R. 197: Mr. Brendan F. Boyle of Pennsylvania and Mr.Hastings.H.R. 217: Mr. Hice of Georgia.H.R. 235: Mr. Meeks and Mr. Torres of New York.H.R. 243: Mr. Armstrong.H.R. 255: Mr. Auchincloss, Mr. DeSaulnier, Mr. Schrader,and Ms. Chu.H.R. 256: Mr. Schrader and Ms. Chu.H.R. 262: Mr. Cicilline and Mr. Torres of New York.H.R. 265: Mr. Veasey.H.R. 275: Mr. Jacobs of New York, Ms. Herrera Beutler, Mr.McCaul, Mr. Joyce of Ohio, Mrs. Bice of Oklahoma, Mr.LaMalfa, Mrs. Steel, Mr. Hill, Mr. Garbarino, Mr. Pfluger,Mr. Gimenez, and Mrs. Cammack.H.R. 279: Mr. Neguse, Mr. Crow, and Mr. DeSaulnier.H.R. 289: Mr. Perry.H.R. 295: Mr. Cloud.H.R. 302: Mr. Costa.H.R. 304: Mr. Raskin, Mr. Lynch, Mr. Carson, Ms. Norton,and Mr. Kilmer.H.R. 305: Ms. Ross, Mr. Kind, and Mr. Michael F. Doyle ofPennsylvania.H.R. 322: Mr. Wilson of South Carolina.H.R. 326: Mr. Costa.H.R. 332: Mr. Stanton and Mrs. Wagner.H.R. 349: Ms. Williams of Georgia, Ms. Brownley, Ms. BluntRochester, and Mrs. Trahan.H.R. 359: Mr. Rodney Davis of Illinois.H.R. 369: Mrs. Hayes and Ms. Schrier.H.R. 377: Mr. Rice of South Carolina and Ms. Herrell.H.R. 378: Mr. Rice of South Carolina and Ms. Herrell.H.R. 384: Mr. Cohen, Ms. Mace, Mr. Huffman, Mr. Hastings,and Ms. Eshoo.H.R. 391: Mr. DeSaulnier, Mrs. Napolitano, Ms. Chu, Mr.Harder of California, Mr. Cohen, and Mrs. Fletcher.H.R. 392: Mr. Smith of Washington, Ms. Moore of Wisconsin,Mr. Sablan, and Mr. Sires.H.R. 398: Ms. Herrell.H.R. 407: Mr. Mast.H.R. 421: Ms. Plaskett, Mr. Rush, and Mr. Correa.H.R. 426: Mr. Hagedorn, Mr. Mooney, Mr. Green of Tennessee,Mr. Norman, and Mr. Davidson.H.R. 447: Mr. DeSaulnier, Mr. Courtney, Ms. Adams, Mrs.McBath, Mr. Kinzinger, Mr. Castro of Texas, Mr. Stivers, Mr.Morelle, Mr. Smith of Washington, Mr. Khanna, Mr. Sarbanes,Ms. Norton, Ms. Stevens, Mr. Grijalva, Ms. Blunt Rochester,Mr. Cardenas, Ms. Schakowsky, Ms. Jackson Lee, Mr.Krishnamoorthi, Mr. Danny K. Davis of Illinois, Mrs. Demings,Mr. Foster, Ms. Houlahan, Mr. Moulton, Mr. Kilmer, Ms. Meng,Mr. Gallego, Mr. Brown, Mr. Suozzi, Mr. Garamendi, Mr.Neguse, Ms. McCollum, Mr. Kildee, Mrs. Beatty, Mr. Carbajal,Ms. Craig, Mr. Trone, Ms. Waters, Mr. Casten, Mrs. Bustos,Mr. Langevin, Mr. Sires, Mr. Kahele, Mr. Ryan, Ms. Underwood,Mr. Stanton, Mr. Carson, Mr. David Scott of Georgia, Ms. Leeof California, Mrs. Dingell, Mrs. Axne, Mr. Horsford, and Mr.Lamb.H.R. 448: Mr. Jones.H.R. 449: Mrs. Miller of Illinois.H.R. 450: Mrs. Miller of Illinois.H.R. 452: Mr. Nunes and Mr. Joyce of Ohio.H.R. 465: Mr. Costa and Mr. Valadao.H.R. 471: Mr. Buck, Ms. Mace, Mr. Perry, Mr. Wright, Mr.Babin, Mr. Norman, and Mr. Gibbs.H.R. 472: Mr. Feenstra.H.R. 485: Mrs. Hayes, Mr. Castro of Texas, Ms. Wild, Mr.Takano, Mr. Morelle, Mrs. Trahan, Mr. Levin of Michigan, andMs. Adams.H.R. 488: Mr. Newhouse, Mr. Stewart,[...][Page H254]<\/pre>"],"title":["Global Health Security Act of 2021"],"version":["1.0.0"],"policy_areas":["International Affairs"],"legislative_subjects":[["Advisory bodies","Animal and plant health","Congressional oversight","Emergency medical services and trauma care","Executive Office of the President","Executive agency funding and structure","Federal officials","Foreign aid and international relief","Government ethics and transparency, public corruption","Government information and archives","Health promotion and preventive care","Infectious and parasitic diseases","International organizations and cooperation","Performance measurement","Public-private cooperation","World health"]],"bill_summaries":[{"versionCode":["00","53"],"actionDate":["2021-01-21","2021-06-28"],"actionDesc":["Introduced in House","Passed House"],"lastSummaryUpdateDate":["2021-02-23T16:30:59Z","2021-10-28T16:45:09Z"],"text":[" <p><b>Global Health Security Act of 2021<\/b><\/p> <p>This bill directs the President to create the Global Health Security Agenda Interagency Review Council to implement the Global Health Security Agenda, an initiative launched by nearly 30 nations to address global infectious disease threats. <\/p> <p>The council's responsibilities include (1) providing policy recommendations on agenda-related goals, objectives, and implementation; (2) helping federal agencies with implementation; and (3) reviewing the progress and challenges in achieving U.S. commitments, including assistance to help other countries meet agenda&nbsp;targets. The bill also directs the federal agencies involved&nbsp;with the agenda&nbsp;to prioritize its implementation and to take certain steps to achieve that goal.<\/p> <p>The President shall also appoint a U.S. Coordinator for Global Health Security to coordinate and report on the interagency process for responding to global health security emergencies.<\/p>"," <p><b>Global Health Security Act of 2021<\/b><\/p> <p>This bill directs the United States to implement a strategy to strengthen global health security, including by requiring the President to create the Global Health Security Agenda Interagency Review Council to implement the Global Health Security Agenda. The agenda is an initiative launched by nearly 30 nations to address global infectious disease threats. <\/p> <p>The council's responsibilities include (1) providing policy recommendations on agenda-related goals, objectives, implementation, and other international efforts to strengthen pandemic preparedness and response; (2) helping federal agencies with implementation; and (3) reviewing the progress and challenges in achieving U.S. commitments, including assistance to help other countries meet agenda&nbsp;targets. The bill also directs the federal agencies involved&nbsp;with the agenda&nbsp;to prioritize its implementation and to take certain steps to achieve that goal.<\/p> <p>The President shall coordinate a strategy for responding to global health security emergencies and submit a report on the implementation of this strategy.<\/p> <p>Additionally, the Department of State should seek to enter into negotiations with donors, relevant United Nations agencies, and other multilateral stakeholders to establish a Fund for Global Health Security and Pandemic Preparedness that (1) closes gaps in global health security and pandemic preparedness; and (2) builds capacity in eligible partner countries related to global health security, infectious disease control, and pandemic preparedness. The fund should provide grants, technical assistance, and innovative funding mechanisms to achieve its purposes.<\/p>"],"updateDate":["2021-01-21T05:00:00Z","2021-06-28T13:24:07Z"],"name":["Introduced in House","Passed House"]}],"bill_titles":[{"titleType":["Display Title","Official Title as Introduced","Short Title(s) as Passed House","Short Title(s) as Introduced","Short Titles as Passed House"],"title":["Global Health Security Act of 2021","To authorize a comprehensive, strategic approach for United States foreign assistance to developing countries to strengthen global health security, and for other purposes.","Global Health Security Act of 2021","Global Health Security Act of 2021","Global Health Security Act of 2021"],"parentTitleType":[null,null,"Short Title","Short Title","Short Titles House of Representatives"],"chamberCode":[null,null,"H",null,"H"],"chamberName":[null,null,"House",null,"House"]}],"bill_text_versions":[{"type":["Referred in Senate","Engrossed in House","Introduced in House"],"date":["2021-07-12T04:00:00Z","2021-06-28T04:00:00Z","2021-01-21T05:00:00Z"],"url":["https://www.govinfo.gov/content/pkg/BILLS-117hr391rfs/xml/BILLS-117hr391rfs.xml","https://www.govinfo.gov/content/pkg/BILLS-117hr391eh/xml/BILLS-117hr391eh.xml","https://www.govinfo.gov/content/pkg/BILLS-117hr391ih/xml/BILLS-117hr391ih.xml"]}],"latest_action_action_date":["2021-07-12T00:00:00Z"],"latest_action_text":["Received in the Senate and Read twice and referred to the Committee on Foreign Relations."],"committees":[{"committee_system_code":["ssfr00","hsfa00"],"committee_name":["Foreign Relations Committee","Foreign Affairs Committee"],"committee_chamber":["Senate","House"],"committee_type":["Standing","Standing"],"committee_activities":[{"committee_activity_name":["Referred to"],"committee_activity_date":["2021-07-12T20:09:26Z"]},{"committee_activity_name":["Markup by","Referred to"],"committee_activity_date":["2021-03-25T13:10:28Z","2021-01-21T19:07:20Z"]}],"subcommittee_activities":[{},{}]}],"house_votes":[{"roll_number":["188"],"url":["https://clerk.house.gov/evs/2021/roll188.xml"],"full_action_name":["Final Passage Under Suspension of the Rules Results"],"chamber":["House"],"date":["2021-06-28T23:46:02Z"],"session_number":["1"],"vote_roll":[{"majority":["D"],"rollcall_num":["188"],"vote_question":["On Motion to Suspend the Rules and Pass, as Amended"],"vote_type":["2/3 YEA-AND-NAY"],"vote_result":["Passed"],"action_date":["28-Jun-2021"],"action_time":["7:42 PM"],"vote_desc":["Global Health Security Act"],"legislator_votes":[{"name_id":["A000370","A000055","A000371","A000372","A000376","A000369","A000377","A000375","A000148","A000378","B001291","B001298","B001307","B001306","B001299","B001282","B001300","B001270","B001281","B000668","B001287","B001301","B001292","B000740","B001302","B001257","B000490","B001311","B000574","B001303","B000825","B001278","B001295","B001312","B001223","B001296","B000755","B001274","B001304","B001285","B001260","B001297","B001275","B001305","B001309","B001248","B001224","B001286","B001251","C000059","C001039","C001112","C001097","C001054","C001072","C001103","C001125","C001051","C001090","C001055","C001117","C001066","C001091","C001104","C000266","C001109","C001080","C001084","C001101","C001067","C001061","C001118","C001115","C000537","C001116","C001068","C001053","C001108","C001078","C000754","C001110","C001059","C001069","C001119","C001087","C001120","C001111","C001121","C001063","C001114","D000629","D000626","D000096","D000619","D000631","D000191","D000197","D000216","D000617","D000630","D000627","D000623","D000616","D000610","D000600","D000624","D000399","D000032","D000482","D000615","D000628","E000294","E000299","E000215","E000297","E000298","E000296","F000246","F000446","F000465","F000470","F000471","F000466","F000459","F000468","F000449","F000454","F000450","F000462","F000472","F000469","G000578","G000579","G000574","G000559","G000597","G000061","G000586","G000587","G000563","G000593","G000552","G000592","G000585","G000594","G000588","G000581","G000595","G000589","G000565","G000583","G000377","G000577","G000546","G000590","G000553","G000596","G000568","G000551","G000576","G000591","G000558","H001088","H001090","H001052","H001086","H001053","H001081","H001082","H001084","H001056","H001071","H001077","H001038","H001072","H001047","H001091","H001074","H001066","H001085","H000874","H001067","H001068","H001058","I000056","J000304","J000032","J000305","J000020","J000298","J000294","J000288","J000299","J000292","J000301","J000126","J000306","J000289","J000295","J000302","K000396","K000009","K000386","K000375","K000395","K000385","K000388","K000376","K000389","K000380","K000381","K000397","K000394","K000188","K000378","K000368","K000391","K000382","K000392","L000585","L000578","L000588","L000564","L000559","L000560","L000557","L000566","L000266","L000581","L000586","L000551","L000590","L000273","L000589","L000595","L000593","L000592","L000582","L000397","L000576","L000583","L000579","L000491","L000569","L000591","L000562","M000194","M001203","M000317","M000087","M001185","M000871","M001135","M001184","M001199","M001163","M001208","M001165","M001157","M001136","M001177","M001143","M001200","M000312","M001156","M001180","M001166","M001137","M001186","M001188","M001204","M000687","M001211","M001205","M001215","M001194","M001195","M001212","M001213","M001160","M001206","M001196","M001214","M001190","M001202","M001210","N000002","N000179","N000015","N000191","N000026","N000189","N000192","N000188","N000190","N000181","O000171","O000019","O000172","O000173","O000086","P000601","P000034","P000609","P000613","P000614","P000096","P000604","P000615","P000593","P000605","P000608","P000048","P000616","P000597","P000607","P000618","P000599","P000617","P000523","Q000023","R000606","R000585","R000610","R000602","R000597","M001159","R000575","R000395","R000612","R000103","R000305","R000603","R000614","R000486","R000599","R000576","R000515","R000609","R000577","S000168","S001156","S001168","S001176","S001205","S001145","S001150","S001190","S001180","S001216","S001183","S000185","S001189","S001157","S000250","S001185","S000344","S001207","S001148","S001165","S001208","S001195","S001172","S000522","S000510","S001199","S001200","S001209","S000929","S001175","S001218","S001211","S001212","S001135","S001196","S001213","S001214","S001215","S001192","S001159","S001201","S001193","T000472","T000479","T000478","T000460","T000193","T000467","T000165","T000480","T000468","T000481","T000469","T000474","T000486","T000482","T000483","T000463","U000040","U000031","V000129","V000133","V000134","V000130","V000131","V000132","V000081","W000812","W000798","W000813","W000823","W000797","W000187","W000822","W000814","W000806","W000800","W000815","W000821","W000825","W000826","W000788","W000816","W000808","W000795","W000804","W000809","Y000062","Y000033","Z000017"],"sort_field":["Adams","Aderholt","Aguilar","Allen","Allred","Amodei","Armstrong","Arrington","Auchincloss","Axne","Babin","Bacon","Baird","Balderson","Banks","Barr","Barragan","Bass","Beatty","Bentz","Bera","Bergman","Beyer","Bice (OK)","Biggs","Bilirakis","Bishop (GA)","Bishop (NC)","Blumenauer","Blunt Rochester","Boebert","Bonamici","Bost","Bourdeaux","Bowman","Boyle, Brendan F.","Brady","Brooks","Brown","Brownley","Buchanan","Buck","Bucshon","Budd","Burchett","Burgess","Bush","Bustos","Butterfield","Calvert","Cammack","Carbajal","Cardenas","Carl","Carson","Carter (GA)","Carter (LA)","Carter (TX)","Cartwright","Case","Casten","Castor (FL)","Castro (TX)","Cawthorn","Chabot","Cheney","Chu","Cicilline","Clark (MA)","Clarke (NY)","Cleaver","Cline","Cloud","Clyburn","Clyde","Cohen","Cole","Comer","Connolly","Cooper","Correa","Costa","Courtney","Craig","Crawford","Crenshaw","Crist","Crow","Cuellar","Curtis","Davids (KS)","Davidson","Davis, Danny K.","Davis, Rodney","Dean","DeFazio","DeGette","DeLauro","DelBene","Delgado","Demings","DeSaulnier","DesJarlais","Deutch","Diaz-Balart","Dingell","Doggett","Donalds","Doyle, Michael F.","Duncan","Dunn","Emmer","Escobar","Eshoo","Espaillat","Estes","Evans","Fallon","Feenstra","Ferguson","Fischbach","Fitzgerald","Fitzpatrick","Fleischmann","Fletcher","Fortenberry","Foster","Foxx","Frankel, Lois","Franklin, C. Scott","Fulcher","Gaetz","Gallagher","Gallego","Garamendi","Garbarino","Garcia (CA)","Garcia (IL)","Garcia (TX)","Gibbs","Gimenez","Gohmert","Golden","Gomez","Gonzales, Tony","Gonzalez (OH)","Gonzalez, Vicente","Good (VA)","Gooden (TX)","Gosar","Gottheimer","Granger","Graves (LA)","Graves (MO)","Green (TN)","Green, Al (TX)","Greene (GA)","Griffith","Grijalva","Grothman","Guest","Guthrie","Hagedorn","Harder (CA)","Harris","Harshbarger","Hartzler","Hayes","Hern","Herrell","Herrera Beutler","Hice (GA)","Higgins (LA)","Higgins (NY)","Hill","Himes","Hinson","Hollingsworth","Horsford","Houlahan","Hoyer","Hudson","Huffman","Huizenga","Issa","Jackson","Jackson Lee","Jacobs (CA)","Jacobs (NY)","Jayapal","Jeffries","Johnson (GA)","Johnson (LA)","Johnson (OH)","Johnson (SD)","Johnson (TX)","Jones","Jordan","Joyce (OH)","Joyce (PA)","Kahele","Kaptur","Katko","Keating","Keller","Kelly (IL)","Kelly (MS)","Kelly (PA)","Khanna","Kildee","Kilmer","Kim (CA)","Kim (NJ)","Kind","Kinzinger","Kirkpatrick","Krishnamoorthi","Kuster","Kustoff","LaHood","LaMalfa","Lamb","Lamborn","Langevin","Larsen (WA)","Larson (CT)","Latta","LaTurner","Lawrence","Lawson (FL)","Lee (CA)","Lee (NV)","Leger Fernandez","Lesko","Letlow","Levin (CA)","Levin (MI)","Lieu","Lofgren","Long","Loudermilk","Lowenthal","Lucas","Luetkemeyer","Luria","Lynch","Mace","Malinowski","Malliotakis","Maloney, Carolyn B.","Maloney, Sean","Mann","Manning","Massie","Mast","Matsui","McBath","McCarthy","McCaul","McClain","McClintock","McCollum","McEachin","McGovern","McHenry","McKinley","McNerney","Meeks","Meijer","Meng","Meuser","Mfume","Miller (IL)","Miller (WV)","Miller-Meeks","Moolenaar","Mooney","Moore (AL)","Moore (UT)","Moore (WI)","Morelle","Moulton","Mrvan","Mullin","Murphy (FL)","Murphy (NC)","Nadler","Napolitano","Neal","Neguse","Nehls","Newhouse","Newman","Norcross","Norman","Nunes","O'Halleran","Obernolte","Ocasio-Cortez","Omar","Owens","Palazzo","Pallone","Palmer","Panetta","Pappas","Pascrell","Payne","Pence","Perlmutter","Perry","Peters","Pfluger","Phillips","Pingree","Pocan","Porter","Posey","Pressley","Price (NC)","Quigley","Raskin","Reed","Reschenthaler","Rice (NY)","Rice (SC)","Rodgers (WA)","Rogers (AL)","Rogers (KY)","Rose","Rosendale","Ross","Rouzer","Roy","Roybal-Allard","Ruiz","Ruppersberger","Rush","Rutherford","Ryan","Salazar","Sanchez","Sarbanes","Scalise","Scanlon","Schakowsky","Schiff","Schneider","Schrader","Schrier","Schweikert","Scott (VA)","Scott, Austin","Scott, David","Sessions","Sewell","Sherman","Sherrill","Simpson","Sires","Slotkin","Smith (MO)","Smith (NE)","Smith (NJ)","Smith (WA)","Smucker","Soto","Spanberger","Spartz","Speier","Stansbury","Stanton","Stauber","Steel","Stefanik","Steil","Steube","Stevens","Stewart","Strickland","Suozzi","Swalwell","Takano","Taylor","Tenney","Thompson (CA)","Thompson (MS)","Thompson (PA)","Tiffany","Timmons","Titus","Tlaib","Tonko","Torres (CA)","Torres (NY)","Trahan","Trone","Turner","Underwood","Upton","Valadao","Van Drew","Van Duyne","Vargas","Veasey","Vela","Velazquez","Wagner","Walberg","Walorski","Waltz","Wasserman Schultz","Waters","Watson Coleman","Weber (TX)","Webster (FL)","Welch","Wenstrup","Westerman","Wexton","Wild","Williams (GA)","Williams (TX)","Wilson (FL)","Wilson (SC)","Wittman","Womack","Yarmuth","Young","Zeldin"],"unaccented_name":["Adams","Aderholt","Aguilar","Allen","Allred","Amodei","Armstrong","Arrington","Auchincloss","Axne","Babin","Bacon","Baird","Balderson","Banks","Barr","Barragan","Bass","Beatty","Bentz","Bera","Bergman","Beyer","Bice (OK)","Biggs","Bilirakis","Bishop (GA)","Bishop (NC)","Blumenauer","Blunt Rochester","Boebert","Bonamici","Bost","Bourdeaux","Bowman","Boyle, Brendan F.","Brady","Brooks","Brown","Brownley","Buchanan","Buck","Bucshon","Budd","Burchett","Burgess","Bush","Bustos","Butterfield","Calvert","Cammack","Carbajal","Cardenas","Carl","Carson","Carter (GA)","Carter (LA)","Carter (TX)","Cartwright","Case","Casten","Castor (FL)","Castro (TX)","Cawthorn","Chabot","Cheney","Chu","Cicilline","Clark (MA)","Clarke (NY)","Cleaver","Cline","Cloud","Clyburn","Clyde","Cohen","Cole","Comer","Connolly","Cooper","Correa","Costa","Courtney","Craig","Crawford","Crenshaw","Crist","Crow","Cuellar","Curtis","Davids (KS)","Davidson","Davis, Danny K.","Davis, Rodney","Dean","DeFazio","DeGette","DeLauro","DelBene","Delgado","Demings","DeSaulnier","DesJarlais","Deutch","Diaz-Balart","Dingell","Doggett","Donalds","Doyle, Michael F.","Duncan","Dunn","Emmer","Escobar","Eshoo","Espaillat","Estes","Evans","Fallon","Feenstra","Ferguson","Fischbach","Fitzgerald","Fitzpatrick","Fleischmann","Fletcher","Fortenberry","Foster","Foxx","Frankel, Lois","Franklin, C. Scott","Fulcher","Gaetz","Gallagher","Gallego","Garamendi","Garbarino","Garcia (CA)","Garcia (IL)","Garcia (TX)","Gibbs","Gimenez","Gohmert","Golden","Gomez","Gonzales, Tony","Gonzalez (OH)","Gonzalez, Vicente","Good (VA)","Gooden (TX)","Gosar","Gottheimer","Granger","Graves (LA)","Graves (MO)","Green (TN)","Green, Al (TX)","Greene (GA)","Griffith","Grijalva","Grothman","Guest","Guthrie","Hagedorn","Harder (CA)","Harris","Harshbarger","Hartzler","Hayes","Hern","Herrell","Herrera Beutler","Hice (GA)","Higgins (LA)","Higgins (NY)","Hill","Himes","Hinson","Hollingsworth","Horsford","Houlahan","Hoyer","Hudson","Huffman","Huizenga","Issa","Jackson","Jackson Lee","Jacobs (CA)","Jacobs (NY)","Jayapal","Jeffries","Johnson (GA)","Johnson (LA)","Johnson (OH)","Johnson (SD)","Johnson (TX)","Jones","Jordan","Joyce (OH)","Joyce (PA)","Kahele","Kaptur","Katko","Keating","Keller","Kelly (IL)","Kelly (MS)","Kelly (PA)","Khanna","Kildee","Kilmer","Kim (CA)","Kim (NJ)","Kind","Kinzinger","Kirkpatrick","Krishnamoorthi","Kuster","Kustoff","LaHood","LaMalfa","Lamb","Lamborn","Langevin","Larsen (WA)","Larson (CT)","Latta","LaTurner","Lawrence","Lawson (FL)","Lee (CA)","Lee (NV)","Leger Fernandez","Lesko","Letlow","Levin (CA)","Levin (MI)","Lieu","Lofgren","Long","Loudermilk","Lowenthal","Lucas","Luetkemeyer","Luria","Lynch","Mace","Malinowski","Malliotakis","Maloney, Carolyn B.","Maloney, Sean","Mann","Manning","Massie","Mast","Matsui","McBath","McCarthy","McCaul","McClain","McClintock","McCollum","McEachin","McGovern","McHenry","McKinley","McNerney","Meeks","Meijer","Meng","Meuser","Mfume","Miller (IL)","Miller (WV)","Miller-Meeks","Moolenaar","Mooney","Moore (AL)","Moore (UT)","Moore (WI)","Morelle","Moulton","Mrvan","Mullin","Murphy (FL)","Murphy (NC)","Nadler","Napolitano","Neal","Neguse","Nehls","Newhouse","Newman","Norcross","Norman","Nunes","O'Halleran","Obernolte","Ocasio-Cortez","Omar","Owens","Palazzo","Pallone","Palmer","Panetta","Pappas","Pascrell","Payne","Pence","Perlmutter","Perry","Peters","Pfluger","Phillips","Pingree","Pocan","Porter","Posey","Pressley","Price (NC)","Quigley","Raskin","Reed","Reschenthaler","Rice (NY)","Rice (SC)","Rodgers (WA)","Rogers (AL)","Rogers (KY)","Rose","Rosendale","Ross","Rouzer","Roy","Roybal-Allard","Ruiz","Ruppersberger","Rush","Rutherford","Ryan","Salazar","Sanchez","Sarbanes","Scalise","Scanlon","Schakowsky","Schiff","Schneider","Schrader","Schrier","Schweikert","Scott (VA)","Scott, Austin","Scott, David","Sessions","Sewell","Sherman","Sherrill","Simpson","Sires","Slotkin","Smith (MO)","Smith (NE)","Smith (NJ)","Smith (WA)","Smucker","Soto","Spanberger","Spartz","Speier","Stansbury","Stanton","Stauber","Steel","Stefanik","Steil","Steube","Stevens","Stewart","Strickland","Suozzi","Swalwell","Takano","Taylor","Tenney","Thompson (CA)","Thompson (MS)","Thompson (PA)","Tiffany","Timmons","Titus","Tlaib","Tonko","Torres (CA)","Torres (NY)","Trahan","Trone","Turner","Underwood","Upton","Valadao","Van Drew","Van Duyne","Vargas","Veasey","Vela","Velazquez","Wagner","Walberg","Walorski","Waltz","Wasserman Schultz","Waters","Watson Coleman","Weber (TX)","Webster (FL)","Welch","Wenstrup","Westerman","Wexton","Wild","Williams (GA)","Williams (TX)","Wilson (FL)","Wilson (SC)","Wittman","Womack","Yarmuth","Young","Zeldin"],"party":["D","R","D","R","D","R","R","R","D","D","R","R","R","R","R","R","D","D","D","R","D","R","D","R","R","R","D","R","D","D","R","D","R","D","D","D","R","R","D","D","R","R","R","R","R","R","D","D","D","R","R","D","D","R","D","R","D","R","D","D","D","D","D","R","R","R","D","D","D","D","D","R","R","D","R","D","R","R","D","D","D","D","D","D","R","R","D","D","D","R","D","R","D","R","D","D","D","D","D","D","D","D","R","D","R","D","D","R","D","R","R","R","D","D","D","R","D","R","R","R","R","R","R","R","D","R","D","R","D","R","R","R","R","D","D","R","R","D","D","R","R","R","D","D","R","R","D","R","R","R","D","R","R","R","R","D","R","R","D","R","R","R","R","D","R","R","R","D","R","R","R","R","R","D","R","D","R","R","D","D","D","R","D","R","R","R","D","D","R","D","D","D","R","R","R","D","D","R","R","R","D","D","R","D","R","D","R","R","D","D","D","R","D","D","R","D","D","D","R","R","R","D","R","D","D","D","R","R","D","D","D","D","D","R","R","D","D","D","D","R","R","D","R","R","D","D","R","D","R","D","D","R","D","R","R","D","D","R","R","R","R","D","D","D","R","R","D","D","R","D","R","D","R","R","R","R","R","R","R","D","D","D","D","R","D","R","D","D","D","D","R","R","D","D","R","R","D","R","D","D","R","R","D","R","D","D","D","D","R","D","R","D","R","D","D","D","D","R","D","D","D","D","R","R","D","R","R","R","R","R","R","D","R","R","D","D","D","D","R","D","R","D","D","R","D","D","D","D","D","D","R","D","R","D","R","D","D","D","R","D","D","R","R","R","D","R","D","D","R","D","D","D","R","R","R","R","R","D","R","D","D","D","D","R","R","D","D","R","R","R","D","D","D","D","D","D","D","R","D","R","R","R","R","D","D","D","D","R","R","R","R","D","D","D","R","R","D","R","R","D","D","D","R","D","R","R","R","D","R","R"],"state":["NC","AL","CA","GA","TX","NV","ND","TX","MA","IA","TX","NE","IN","OH","IN","KY","CA","CA","OH","OR","CA","MI","VA","OK","AZ","FL","GA","NC","OR","DE","CO","OR","IL","GA","NY","PA","TX","AL","MD","CA","FL","CO","IN","NC","TN","TX","MO","IL","NC","CA","FL","CA","CA","AL","IN","GA","LA","TX","PA","HI","IL","FL","TX","NC","OH","WY","CA","RI","MA","NY","MO","VA","TX","SC","GA","TN","OK","KY","VA","TN","CA","CA","CT","MN","AR","TX","FL","CO","TX","UT","KS","OH","IL","IL","PA","OR","CO","CT","WA","NY","FL","CA","TN","FL","FL","MI","TX","FL","PA","SC","FL","MN","TX","CA","NY","KS","PA","TX","IA","GA","MN","WI","PA","TN","TX","NE","IL","NC","FL","FL","ID","FL","WI","AZ","CA","NY","CA","IL","TX","OH","FL","TX","ME","CA","TX","OH","TX","VA","TX","AZ","NJ","TX","LA","MO","TN","TX","GA","VA","AZ","WI","MS","KY","MN","CA","MD","TN","MO","CT","OK","NM","WA","GA","LA","NY","AR","CT","IA","IN","NV","PA","MD","NC","CA","MI","CA","TX","TX","CA","NY","WA","NY","GA","LA","OH","SD","TX","NY","OH","OH","PA","HI","OH","NY","MA","PA","IL","MS","PA","CA","MI","WA","CA","NJ","WI","IL","AZ","IL","NH","TN","IL","CA","PA","CO","RI","WA","CT","OH","KS","MI","FL","CA","NV","NM","AZ","LA","CA","MI","CA","CA","MO","GA","CA","OK","MO","VA","MA","SC","NJ","NY","NY","NY","KS","NC","KY","FL","CA","GA","CA","TX","MI","CA","MN","VA","MA","NC","WV","CA","NY","MI","NY","PA","MD","IL","WV","IA","MI","WV","AL","UT","WI","NY","MA","IN","OK","FL","NC","NY","CA","MA","CO","TX","WA","IL","NJ","SC","CA","AZ","CA","NY","MN","UT","MS","NJ","AL","CA","NH","NJ","NJ","IN","CO","PA","CA","TX","MN","ME","WI","CA","FL","MA","NC","IL","MD","NY","PA","NY","SC","WA","AL","KY","TN","MT","NC","NC","TX","CA","CA","MD","IL","FL","OH","FL","CA","MD","LA","PA","IL","CA","IL","OR","WA","AZ","VA","GA","GA","TX","AL","CA","NJ","ID","NJ","MI","MO","NE","NJ","WA","PA","FL","VA","IN","CA","NM","AZ","MN","CA","NY","WI","FL","MI","UT","WA","NY","CA","CA","TX","NY","CA","MS","PA","WI","SC","NV","MI","NY","CA","NY","MA","MD","OH","IL","MI","CA","NJ","TX","CA","TX","TX","NY","MO","MI","IN","FL","FL","CA","NJ","TX","FL","VT","OH","AR","VA","PA","GA","TX","FL","SC","VA","AR","KY","AK","NY"],"role":["legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator","legislator"],"vote":["Yea","Nay","Yea","Nay","Yea","Yea","Yea","Nay","Yea","Yea","Nay","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Nay","Nay","Yea","Yea","Nay","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Nay","Nay","Yea","Yea","Yea","Nay","Yea","Nay","Nay","Nay","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Nay","Yea","Nay","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Not Voting","Not Voting","Nay","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Nay","Yea","Nay","Nay","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Nay","Nay","Nay","Yea","Nay","Yea","Yea","Yea","Nay","Yea","Nay","Not Voting","Nay","Nay","Yea","Yea","Yea","Nay","Yea","Yea","Nay","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Nay","Nay","Nay","Yea","Yea","Nay","Nay","Nay","Yea","Nay","Nay","Yea","Nay","Not Voting","Yea","Nay","Yea","Nay","Nay","Not Voting","Yea","Nay","Nay","Yea","Not Voting","Not Voting","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Nay","Yea","Nay","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Nay","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Nay","Yea","Nay","Yea","Yea","Yea","Nay","Nay","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Nay","Yea","Nay","Nay","Yea","Yea","Yea","Yea","Nay","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Not Voting","Nay","Nay","Yea","Yea","Nay","Nay","Not Voting","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Nay","Yea","Yea","Yea","Yea","Nay","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Nay","Yea","Nay","Yea","Not Voting","Nay","Yea","Nay","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Nay","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Nay","Not Voting","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Nay","Yea","Yea","Yea","Nay","Yea","Nay","Nay","Yea","Yea","Yea","Nay"]}],"party_votes":[{"party":["Republican","Democratic","Independent"],"yea_total":[90,217,0],"nay_total":[112,0,0],"present_total":[0,0,0],"not_voting_total":[9,2,0]}]}],"roll_found":[true]}],"senate_votes":[{"roll_number":[],"url":[],"full_action_name":[],"chamber":[],"date":[],"session_number":[],"vote_roll":[],"roll_found":[]}],"actions":[{"action_date":["2021-07-12","2021-06-28","2021-06-28","2021-06-28","2021-06-28","2021-06-28","2021-06-28","2021-06-28","2021-06-28","2021-03-25","2021-03-25","2021-01-21","2021-01-21","2021-01-21"],"action_committee_system_code":["ssfr00",null,null,null,null,null,null,null,null,"hsfa00","hsfa00","hsfa00",null,null],"action_committee_name":["Foreign Relations Committee",null,null,null,null,null,null,null,null,"Foreign Affairs Committee","Foreign Affairs Committee","Foreign Affairs Committee",null,null],"action_source_code":["0","2","2","9","2","2","2","2","2","1","1","2","9","9"],"action_source_name":["Senate","House floor actions","House floor actions","Library of Congress","House floor actions","House floor actions","House floor actions","House floor actions","House floor actions","House committee actions","House committee actions","House floor actions","Library of Congress","Library of Congress"],"action_text":["Received in the Senate and Read twice and referred to the Committee on Foreign Relations.","Motion to reconsider laid on the table Agreed to without objection.","On motion to suspend the rules and pass the bill, as amended Agreed to by the Yeas and Nays: (2/3 required): 307 - 112 (Roll no. 188). (text: CR H3165-3169)","Passed/agreed to in House: On motion to suspend the rules and pass the bill, as amended Agreed to by the Yeas and Nays: (2/3 required): 307 - 112 (Roll no. 188).(text: CR H3165-3169)","Considered as unfinished business. (consideration: CR H3224-3225)","At the conclusion of debate, the Yeas and Nays were demanded and ordered. Pursuant to the provisions of clause 8, rule XX, the Chair announced that further proceedings on the motion would be postponed.","DEBATE - The House proceeded with forty minutes of debate on H.R. 391.","Considered under suspension of the rules. (consideration: CR H3165-3171)","Mr. Meeks moved to suspend the rules and pass the bill, as amended.","Ordered to be Reported (Amended) by Voice Vote.","Committee Consideration and Mark-up Session Held.","Referred to the House Committee on Foreign Affairs.","Introduced in House","Introduced in House"],"action_type":["IntroReferral","Floor","Floor","Floor","Floor","Floor","Floor","Floor","Floor","Committee","Committee","IntroReferral","IntroReferral","IntroReferral"],"action_time":[null,"19:46:03","19:46:02","19:46:02","19:24:39","15:20:02","15:05:31","15:05:26","15:05:13",null,null,null,null,null],"action_code":[null,"H38310","H37300","8000","H30000","H37220","H8D000","H30000","H30300",null,null,"H11100","Intro-H","1000"]}],"action_counts":[{"action":["referredToCommittee","motionToReconsiderResults","finalPassageUnderSuspensionOfTheRulesResults","passedAgreedToInHouse","considerationByHouse","placeholderTextForH","generalDebate","motionMadeToSuspendTheRules","orderedToBeReported","committeeConsiderationMarkUp","billReferrals","introducedInTheHouse","introducedInHouse","senate","houseOfRepresentatives"],"count":[1,1,1,1,2,1,1,1,1,1,1,1,1,1,13]}],"sponsors":[{"sponsor_bioguide_id":["C001078"],"sponsor_full_name":["Rep. Connolly, Gerald E. [D-VA-11]"],"sponsor_first_name":["Gerald"],"sponsor_middle_name":["E."],"sponsor_last_name":["Connolly"],"sponsor_party":["D"],"sponsor_state":["VA"],"sponsor_identifiers_lis_id":["1959"],"sponsor_identifiers_bioguide_id":["C001078"],"sponsor_identifiers_gpo_id":["8202"],"sponsor_district":["11"]}],"cosponsors":[{"cosponsor_bioguide_id":["C000266","W000812","B001287","F000466","L000560","B001270","B001281","B001292","B001303","B001285","C001090","C001055","C001117","C001084","C001061","C001053","C000754","C001059","D000631","D000191","D000610","E000297","F000462","G000581","H000324","H001081","H001085","J000032","K000375","K000389","K000381","L000559","L000592","L000582","L000562","M001203","M000312","M001188","N000147","P000616","R000515","M001185","S001185","S000344","S001165","S001200","S001209","S001201","T000468","T000469","T000482","T000483","W000822","W000825","W000795","S001156","D000623","N000179","C001080","H001090","C001068","F000468","O000173","S001204","A000148","G000551","C001072","R000576","S001190","A000376","R000606","P000617","K000396","K000397","J000305","L000397","W000788"],"cosponsor_full_name":["Rep. Chabot, Steve [R-OH-1]","Rep. Wagner, Ann [R-MO-2]","Rep. Bera, Ami [D-CA-7]","Rep. Fitzpatrick, Brian K. [R-PA-1]","Rep. Larsen, Rick [D-WA-2]","Rep. Bass, Karen [D-CA-37]","Rep. Beatty, Joyce [D-OH-3]","Rep. Beyer, Donald S., Jr. [D-VA-8]","Rep. Blunt Rochester, Lisa [D-DE-At Large]","Rep. Brownley, Julia [D-CA-26]","Rep. Cartwright, Matt [D-PA-8]","Rep. Case, Ed [D-HI-1]","Rep. Casten, Sean [D-IL-6]","Rep. Cicilline, David N. [D-RI-1]","Rep. Cleaver, Emanuel [D-MO-5]","Rep. Cole, Tom [R-OK-4]","Rep. Cooper, Jim [D-TN-5]","Rep. Costa, Jim [D-CA-16]","Rep. Dean, Madeleine [D-PA-4]","Rep. DeFazio, Peter A. [D-OR-4]","Rep. Deutch, Theodore E. [D-FL-22]","Rep. Espaillat, Adriano [D-NY-13]","Rep. Frankel, Lois [D-FL-21]","Rep. Gonzalez, Vicente [D-TX-15]","Rep. Hastings, Alcee L. [D-FL-20]","Rep. Hayes, Jahana [D-CT-5]","Rep. Houlahan, Chrissy [D-PA-6]","Rep. Jackson Lee, Sheila [D-TX-18]","Rep. Keating, William R. [D-MA-9]","Rep. Khanna, Ro [D-CA-17]","Rep. Kilmer, Derek [D-WA-6]","Rep. Langevin, James R. [D-RI-2]","Rep. Levin, Andy [D-MI-9]","Rep. Lieu, Ted [D-CA-33]","Rep. Lynch, Stephen F. [D-MA-8]","Rep. Malinowski, Tom [D-NJ-7]","Rep. McGovern, James P. [D-MA-2]","Rep. Meng, Grace [D-NY-6]","Del. Norton, Eleanor Holmes [D-DC-At Large]","Rep. Phillips, Dean [D-MN-3]","Rep. Rush, Bobby L. [D-IL-1]","Rep. Maloney, Sean Patrick [D-NY-18]","Rep. Sewell, Terri A. [D-AL-7]","Rep. Sherman, Brad [D-CA-30]","Rep. Sires, Albio [D-NJ-8]","Rep. Soto, Darren [D-FL-9]","Rep. Spanberger, Abigail Davis [D-VA-7]","Rep. Suozzi, Thomas R. [D-NY-3]","Rep. Titus, Dina [D-NV-1]","Rep. Tonko, Paul [D-NY-20]","Rep. Trahan, Lori [D-MA-3]","Rep. Trone, David J. [D-MD-6]","Rep. Watson Coleman, Bonnie [D-NJ-12]","Rep. Wexton, Jennifer [D-VA-10]","Rep. Wilson, Joe [R-SC-2]","Rep. Sánchez, Linda T. [D-CA-38]","Rep. DeSaulnier, Mark [D-CA-11]","Rep. Napolitano, Grace F. [D-CA-32]","Rep. Chu, Judy [D-CA-27]","Rep. Harder, Josh [D-CA-10]","Rep. Cohen, Steve [D-TN-9]","Rep. Fletcher, Lizzie [D-TX-7]","Rep. Omar, Ilhan [D-MN-5]","Del. San Nicolas, Michael F. Q. [D-GU-At Large]","Rep. Auchincloss, Jake [D-MA-4]","Rep. Grijalva, Raúl M. [D-AZ-3]","Rep. Carson, Andre [D-IN-7]","Rep. Ruppersberger, C. A. Dutch [D-MD-2]","Rep. Schneider, Bradley Scott [D-IL-10]","Rep. Allred, Colin Z. [D-TX-32]","Rep. Raskin, Jamie [D-MD-8]","Rep. Pressley, Ayanna [D-MA-7]","Rep. Kahele, Kaiali'i [D-HI-2]","Rep. Kim, Young [R-CA-39]","Rep. Jacobs, Sara [D-CA-53]","Rep. Lofgren, Zoe [D-CA-19]","Rep. Williams, Nikema [D-GA-5]"],"cosponsor_first_name":["STEVE","Ann","Ami","Brian","RICK","Karen","Joyce","Donald","Lisa","Julia","Matt","Ed","Sean","David","Emanuel","Tom","JAMES","Jim","Madeleine","PETER","Theodore","Adriano","Lois","Vicente","ALCEE","Jahana","Chrissy","SHEILA","William","Ro","Derek","JAMES","Andy","Ted","Stephen","Tom","JAMES","Grace","ELEANOR","Dean","BOBBY","Sean","Terri","BRAD","Albio","Darren","Abigail","Thomas","Dina","Paul","Lori","David","Bonnie","Jennifer","Joe","Linda","Mark","GRACE","Judy","Josh","Steve","Lizzie","Ilhan","Michael","Jake","Raúl","Andre","C. A.","Bradley","Colin","Jamie","Ayanna","Kaiali'i","Young","Sara","ZOE","Nikema"],"cosponsor_last_name":["CHABOT","Wagner","Bera","Fitzpatrick","LARSEN","Bass","Beatty","Beyer","Blunt Rochester","Brownley","Cartwright","Case","Casten","Cicilline","Cleaver","Cole","COOPER","Costa","Dean","DEFAZIO","Deutch","Espaillat","Frankel","Gonzalez","HASTINGS","Hayes","Houlahan","JACKSON LEE","Keating","Khanna","Kilmer","LANGEVIN","Levin","Lieu","Lynch","Malinowski","MCGOVERN","Meng","NORTON","Phillips","RUSH","Maloney","Sewell","SHERMAN","Sires","Soto","Spanberger","Suozzi","Titus","Tonko","Trahan","Trone","Watson Coleman","Wexton","Wilson","Sánchez","DeSaulnier","NAPOLITANO","Chu","Harder","Cohen","Fletcher","Omar","San Nicolas","Auchincloss","Grijalva","Carson","Ruppersberger","Schneider","Allred","Raskin","Pressley","Kahele","Kim","Jacobs","LOFGREN","Williams"],"cosponsor_party":["R","R","D","R","D","D","D","D","D","D","D","D","D","D","D","R","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","R","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","D","R","D","D","D"],"cosponsor_state":["OH","MO","CA","PA","WA","CA","OH","VA","DE","CA","PA","HI","IL","RI","MO","OK","TN","CA","PA","OR","FL","NY","FL","TX","FL","CT","PA","TX","MA","CA","WA","RI","MI","CA","MA","NJ","MA","NY","DC","MN","IL","NY","AL","CA","NJ","FL","VA","NY","NV","NY","MA","MD","NJ","VA","SC","CA","CA","CA","CA","CA","TN","TX","MN","GU","MA","AZ","IN","MD","IL","TX","MD","MA","HI","CA","CA","CA","GA"],"cosponsor_identifiers_lis_id":[186,2137,2102,2345,1675,1996,2153,2272,2313,2106,2159,1693,2398,2055,1790,1742,231,1774,2432,279,1976,2342,2119,2349,511,2386,2433,588,2025,2308,2169,1668,2408,2230,1686,2421,1504,2148,868,2413,1003,2150,1988,1526,1818,2319,2456,2341,1940,1942,2404,2406,2259,2457,1688,1757,2227,1602,1970,2377,1878,2447,2414,2393,2510,1708,1889,1728,2124,2451,2332,2405,2500,2543,2489,701,2496],"cosponsor_identifiers_bioguide_id":["C000266","W000812","B001287","F000466","L000560","B001270","B001281","B001292","B001303","B001285","C001090","C001055","C001117","C001084","C001061","C001053","C000754","C001059","D000631","D000191","D000610","E000297","F000462","G000581","H000324","H001081","H001085","J000032","K000375","K000389","K000381","L000559","L000592","L000582","L000562","M001203","M000312","M001188","N000147","P000616","R000515","M001185","S001185","S000344","S001165","S001200","S001209","S001201","T000468","T000469","T000482","T000483","W000822","W000825","W000795","S001156","D000623","N000179","C001080","H001090","C001068","F000468","O000173","S001204","A000148","G000551","C001072","R000576","S001190","A000376","R000606","P000617","K000396","K000397","J000305","L000397","W000788"],"cosponsor_identifiers_gpo_id":[8091,"NA","NA","NA",8206,7838,"NA","NA","NA","NA","NA","NA","NA",8139,8013,8112,8152,7825,"NA",8117,7891,"NA","NA","NA",7895,"NA","NA",8174,7975,"NA","NA",8140,"NA","NA",7974,"NA",7968,"NA",7871,"NA",7921,"NA",7792,7832,8055,"NA","NA","NA",7493,8082,"NA","NA","NA","NA",8142,7844,"NA",7843,7837,"NA",8156,"NA","NA","NA","NA",7804,7946,7977,"NA","NA","NA","NA","NA","NA","NA",7821,"NA"],"cosponsor_district":["1","2","7","1","2","37","3","8","0","26","8","1","6","1","5","4","5","16","4","4","22","13","21","15","20","5","6","18","9","17","6","2","9","33","8","7","2","6","0","3","1","18","7","30","8","9","7","3","1","20","3","6","12","10","2","38","11","32","27","10","9","7","5","0","4","3","7","2","10","32","8","7","2","39","53","19","5"],"cosponsor_sponsorship_date":["2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-21","2021-01-28","2021-01-28","2021-01-28","2021-01-28","2021-01-28","2021-01-28","2021-02-18","2021-02-18","2021-03-08","2021-03-08","2021-03-23","2021-03-29","2021-03-29","2021-03-29","2021-04-01","2021-04-01","2021-04-01","2021-04-15","2021-04-15","2021-05-04","2021-06-28"],"cosponsor_is_original_cosponsor":[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"cosponsor_middle_name":[null,null,null,"K.",null,null,null,"S.",null,null,null,null,null,"N.",null,null,"H.",null,null,"A.","E.",null,null,null,"L.",null,null,null,"R.",null,null,"R.",null,null,"F.",null,"P.",null,"HOLMES",null,"L.","Patrick","A.",null,null,null,"Davis","R.",null,null,null,"J.",null,null,null,"T.",null,"F.",null,null,null,null,null,"F. Q.",null,"M.",null,"Dutch","Scott","Z.",null,null,null,null,null,null,null]}]},"columns":[{"accessor":"bill_id","name":"bill_id","type":"character","show":false},{"accessor":"bill_number","name":"Bill No.","type":"character","width":80},{"accessor":"create_date","name":"create_date","type":"Date","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":100},{"accessor":"update_date","name":"update_date","type":"Date","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":100},{"accessor":"origin_chamber","name":"origin_chamber","type":"character","show":false},{"accessor":"bill_type","name":"Bill type","type":"character","width":60},{"accessor":"introduced_date","name":"introduced_date","type":"Date","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":130},{"accessor":"congress","name":"congress","type":"character","width":80},{"accessor":"constitutional_authority_statement_text","name":"constitutional_authority_statement_text","type":"character","show":false},{"accessor":"title","name":"title","type":"character","minWidth":180},{"accessor":"version","name":"version","type":"character","show":false,"width":80},{"accessor":"policy_areas","name":"policy_areas","type":"list","width":120},{"accessor":"legislative_subjects","name":"legislative_subjects","type":"list","width":200},{"accessor":"bill_summaries","name":"bill_summaries","type":"list","show":false},{"accessor":"bill_titles","name":"bill_titles","type":"list","show":false},{"accessor":"bill_text_versions","name":"bill_text_versions","type":"list","show":false},{"accessor":"latest_action_action_date","name":"action_date","type":"Date","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":110},{"accessor":"latest_action_text","name":"action_text","type":"character","minWidth":200},{"accessor":"committees","name":"committees","type":"list","minWidth":80},{"accessor":"house_votes","name":"house_votes","type":"list","width":80},{"accessor":"senate_votes","name":"senate_votes","type":"list","width":80},{"accessor":"actions","name":"actions","type":"list","width":80},{"accessor":"action_counts","name":"action_counts","type":"list","show":false},{"accessor":"sponsors","name":"sponsors","type":"list","width":80},{"accessor":"cosponsors","name":"cosponsors","type":"list","width":80}],"columnGroups":[{"name":"Latest Action","columns":["latest_action_action_date","latest_action_text"]},{"name":"Nested Data","columns":["committees","house_votes","senate_votes","actions","sponsors","cosponsors"]}],"resizable":true,"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"compact":true,"nowrap":true,"theme":{"color":"#474d4d","backgroundColor":"#FFFFFF","borderColor":"#dddddd","borderWidth":"1px","stripedColor":"#dddddd","highlightColor":"#f0f0f0","cellPadding":"8px 12px","style":{"padding":"16px 8px"},"tableStyle":{"fontSize":14,"borderBottom":"3px solid #222222","fontFamily":"Noto Sans, sans-serif"},"headerStyle":{"borderWidth":"3px","paddingTop":"12px","verticalAlign":"bottom","textAlign":"bottom","background":"#FFFFFF","textTransform":"uppercase","borderColor":"#474d4d","color":"#051414","&:hover":{"background":"#dddddd"},"&[aria-sort='ascending'], &[aria-sort='descending']":{"background":"#5b5e5f","color":"#FFFFFF"},"borderColor.1":"#333","fontSize":12,"fontFamily":"Heebo Light, sans-serif"},"groupHeaderStyle":{"&:not(:empty)":{"paddingBottom":"3px","verticalAlign":"bottom","textAlign":"bottom","backgroundColor":"#FFFFFF","textTransform":"uppercase","fontSize":12,"color":"#474d4d"}},"rowSelectedStyle":{"backgroundColor":"#dddddd"},"inputStyle":{"backgroundColor":"#FFFFFF","color":"#474d4d"},"searchInputStyle":{"textTransform":"uppercase","color":"#474d4d","fontSize":"14px"},"paginationStyle":{"textTransform":"uppercase","fontSize":"14px"},"pageButtonStyle":{"textTransform":"uppercase","fontSize":"14px"}},"dataKey":"76d5b3d87bc5c90184b67b18f557b93f"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Here’s a <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> of some of the nested data:</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Committees</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Votes</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Actions</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Sponsors</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [2 × 6] (S3: tbl_df/tbl/data.frame)
  ..$ committee_system_code  : chr [1:2] "ssfr00" "hsfa00"
  ..$ committee_name         : chr [1:2] "Foreign Relations Committee" "Foreign Affairs Committee"
  ..$ committee_chamber      : chr [1:2] "Senate" "House"
  ..$ committee_type         : chr [1:2] "Standing" "Standing"
  ..$ committee_activities   :List of 2
  ..$ subcommittee_activities:List of 2</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [1 × 8] (S3: tbl_df/tbl/data.frame)
  ..$ roll_number     : chr "188"
  ..$ url             : chr "https://clerk.house.gov/evs/2021/roll188.xml"
  ..$ full_action_name: chr "Final Passage Under Suspension of the Rules Results"
  ..$ chamber         : chr "House"
  ..$ date            : chr "2021-06-28T23:46:02Z"
  ..$ session_number  : chr "1"
  ..$ vote_roll       :List of 1
  ..$ roll_found      : logi TRUE</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [14 × 9] (S3: tbl_df/tbl/data.frame)
  ..$ action_date                 : Date[1:14], format: "2021-07-12" "2021-06-28" ...
  ..$ action_committee_system_code: chr [1:14] "ssfr00" NA NA NA ...
  ..$ action_committee_name       : chr [1:14] "Foreign Relations Committee" NA NA NA ...
  ..$ action_source_code          : chr [1:14] "0" "2" "2" "9" ...
  ..$ action_source_name          : chr [1:14] "Senate" "House floor actions" "House floor actions" "Library of Congress" ...
  ..$ action_text                 : chr [1:14] "Received in the Senate and Read twice and referred to the Committee on Foreign Relations." "Motion to reconsider laid on the table Agreed to without objection." "On motion to suspend the rules and pass the bill, as amended Agreed to by the Yeas and Nays: (2/3 required): 30"| __truncated__ "Passed/agreed to in House: On motion to suspend the rules and pass the bill, as amended Agreed to by the Yeas a"| __truncated__ ...
  ..$ action_type                 : Ord.factor w/ 6 levels "IntroReferral"&lt;..: 1 3 3 3 3 3 3 3 3 2 ...
  ..$ action_time                 : 'hms' num [1:14] NA 19:46:03 19:46:02 19:46:02 ...
  .. ..- attr(*, "units")= chr "secs"
  ..$ action_code                 : chr [1:14] NA "H38310" "H37300" "8000" ...</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [1 × 11] (S3: tbl_df/tbl/data.frame)
  ..$ sponsor_bioguide_id            : chr "C001078"
  ..$ sponsor_full_name              : chr "Rep. Connolly, Gerald E. [D-VA-11]"
  ..$ sponsor_first_name             : chr "Gerald"
  ..$ sponsor_middle_name            : chr "E."
  ..$ sponsor_last_name              : chr "Connolly"
  ..$ sponsor_party                  : chr "D"
  ..$ sponsor_state                  : chr "VA"
  ..$ sponsor_identifiers_lis_id     : chr "1959"
  ..$ sponsor_identifiers_bioguide_id: chr "C001078"
  ..$ sponsor_identifiers_gpo_id     : chr "8202"
  ..$ sponsor_district               : chr "11"</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="from-xml-to-data-frame" class="level1 page-columns page-full"><h1>From XML to Data Frame</h1>
<p>How your XML is structured, and how you want to structure your tabular output will determine how you need to process the XML file. In general, this will involve the following steps:</p>
<ol type="1">
<li>Select the XML nodes you want to include in your dataset.</li>
<li>Convert the XML to a list.</li>
<li>
<code>flatten()</code> the list into a data frame.</li>
</ol>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Write Functions
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you find yourself doing similar transformations in multiple cases or copy-pasting some piece of code more than once, I would implore you to write functions because they:</p>
<ol type="1">
<li>make your code more reliable</li>
<li>make you think critically about how you’re modifying the data</li>
<li>are easier to debug</li>
</ol>
<p>A good resource to start learning about writing functions is <a href="https://www.earthdatascience.org/courses/earth-analytics/automate-science-workflows/write-function-r-programming/">How to Write a Function in R</a>.</p>
</div>
</div>
<section id="convert-an-xml-nodeset-to-a-data-frame" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="convert-an-xml-nodeset-to-a-data-frame">Convert an XML nodeset to a data frame</h2>
<p>When converting XML into a data frame, one of the simplest cases to deal with is a set of nodes which each have a single value. You can think of singular nodes as the contents of a single cell in a data frame. When your data are entirely made up of nodes like this, you can convert XML to a data frame using two functions from <a href="https://www.omegahat.net/RSXML/">XML</a>:</p>
<ul>
<li><p><code><a href="https://rdrr.io/pkg/XML/man/xmlTreeParse.html">xmlParse()</a></code> parses an XML file into an R structure<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a> representing the XML tree</p></li>
<li><p><code><a href="https://rdrr.io/pkg/XML/man/xmlToDataFrame.html">xmlToDataFrame()</a></code> extracts data from an XML document directly into a data frame, but with limited flexibility</p></li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the example below, we need to use <code>getNodeSet(., [path =] "//bill")</code> to select only nodes in <code>&lt;bill&gt;</code>. If we just passed <code>bill_xml_parse</code>, we would get a dataframe with two rows because the top-level nodes are bill and the metadata identifier node <code>&lt;dublinCore&gt;</code>.</p>
</div>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First we need to use xmlParse function to create XMLDocument object</span></span>
<span><span class="va">bill_xml_parse</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/XML/man/xmlTreeParse.html">xmlParse</a></span><span class="op">(</span><span class="va">bill_xml</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/XML/man/xmlToDataFrame.html">xmlToDataFrame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/XML/man/getNodeSet.html">getNodeSet</a></span><span class="op">(</span><span class="va">bill_xml_parse</span>, <span class="st">"//bill"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 28
$ billNumber                           &lt;chr&gt; "391"
$ createDate                           &lt;chr&gt; "2021-01-22T08:12:10Z"
$ updateDate                           &lt;chr&gt; "2022-09-07T13:37:22Z"
$ originChamber                        &lt;chr&gt; "House"
$ billType                             &lt;chr&gt; "HR"
$ introducedDate                       &lt;chr&gt; "2021-01-21"
$ congress                             &lt;chr&gt; "117"
$ constitutionalAuthorityStatementText &lt;chr&gt; "&lt;pre&gt;[Congressional Record Volum…
$ recordedVotes                        &lt;chr&gt; "188https://clerk.house.gov/evs/2…
$ committees                           &lt;chr&gt; "ssfr00Foreign Relations Committe…
$ committeeReports                     &lt;chr&gt; ""
$ relatedBills                         &lt;chr&gt; ""
$ actions                              &lt;chr&gt; "2021-07-12ssfr00Foreign Relation…
$ sponsors                             &lt;chr&gt; "C001078Rep. Connolly, Gerald E. …
$ cosponsors                           &lt;chr&gt; "C000266Rep. Chabot, Steve [R-OH-…
$ cboCostEstimates                     &lt;chr&gt; "2021-05-11T15:11:11ZH.R. 391, Gl…
$ laws                                 &lt;chr&gt; ""
$ notes                                &lt;chr&gt; ""
$ policyArea                           &lt;chr&gt; "International Affairs"
$ subjects                             &lt;chr&gt; "Advisory bodiesAnimal and plant …
$ summaries                            &lt;chr&gt; "002021-01-21Introduced in House2…
$ title                                &lt;chr&gt; "Global Health Security Act of 20…
$ titles                               &lt;chr&gt; "Display TitleGlobal Health Secur…
$ amendments                           &lt;chr&gt; ""
$ textVersions                         &lt;chr&gt; "Referred in Senate2021-07-12T04:…
$ latestAction                         &lt;chr&gt; "2021-07-12Received in the Senate…
$ calendarNumbers                      &lt;chr&gt; ""
$ version                              &lt;chr&gt; "1.0.0"</code></pre>
</div>
</div>
<p>Because the congressional data has elements like <code>committees</code>, <code>actions</code>, and <code>sponsors</code> which contain multiple sub-elements, the contents are combined into single columns. When parsing nested XML like this, it might require multiple steps to get the data into a <a href="https://vita.had.co.nz/papers/tidy-data.html">tidy data</a> frame.</p>
<p>In this case, the first step is to isolate singular elements like <code>billNumber</code> and <code>billType</code>, and deal with nested elements individually afterwards.</p>
<p>Singular elements are nodes which meet two criteria:</p>
<ol type="1">
<li>the node does not have any child nodes of its own, and</li>
<li>the node is not an empty string.</li>
</ol>
<p>We can use <code><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all()</a></code> to filter an XML document with <a href="https://www.w3schools.com/xml/xml_parser.asp">XPath</a> (XML Path Language). The XPATH expression selects the nodes which match the given path or pattern<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a> in a similar way as regular expressions. As the function’s help file says, “XPath is like regular expressions for trees”.</p>
<p>In the code below the <code>[</code> expressions within the square brackets <code>]</code> are called predicates which I use to find nodes which have no children with the XPath <code>count</code> function and nodes which are not empty strings<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>. This returns an <code>{xml_nodeset}</code> which can be coerced to a list using <code><a href="http://xml2.r-lib.org/reference/as_list.html">as_list()</a></code>.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">singular_nodes</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">bill_xml</span>, </span>
<span>                              <span class="co"># //bill/* selects the child nodes in a bill</span></span>
<span>                              <span class="st">"//bill/*[count(./*) = 0 and not(string-length(.) = 0)]"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">singular_list</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">singular_nodes</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>List of 10
 $ :List of 1
  ..$ : chr "391"
 $ :List of 1
  ..$ : chr "2021-01-22T08:12:10Z"
 $ :List of 1
  ..$ : chr "2022-09-07T13:37:22Z"
 $ :List of 1
  ..$ : chr "House"
 $ :List of 1
  ..$ : chr "HR"
 $ :List of 1
  ..$ : chr "2021-01-21"
 $ :List of 1
  ..$ : chr "117"
 $ :List of 1
  ..$ : chr "&lt;pre&gt;[Congressional Record Volume 167, Number 17 (Thursday, January 28, 2021)][House]From the Congressional Rec"| __truncated__
 $ :List of 1
  ..$ : chr "Global Health Security Act of 2021"
 $ :List of 1
  ..$ : chr "1.0.0"</code></pre>
</div>
</div>
<p>Now that we have the data we want in a list, we can flatten each element in the list into a <strong>d</strong>ata <strong>f</strong>rame <strong>c</strong>olumn using purrr’s <code><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc()</a></code>. However, notice the elements in a <code>singular_list</code> are not named. If we flatten this list to a data frame, our columns also won’t have any column names. We can use <code><a href="http://xml2.r-lib.org/reference/xml_name.html">xml_name()</a></code> to create a character vector of the nodes’ names in combination with <code><a href="https://rdrr.io/r/stats/setNames.html">setNames()</a></code> to create a named list. Just make sure <code>singular_list</code> and <code>singular_nodes</code> are the same length and in the same order.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">singular_list_named</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">singular_list</span>, </span>
<span>                                <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_name.html">xml_name</a></span><span class="op">(</span><span class="va">singular_nodes</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>When flattened, a named list becomes a data frame with column names in tow.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">bill_df</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc</a></span><span class="op">(</span><span class="va">singular_list_named</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 10
$ billNumber                           &lt;chr&gt; "391"
$ createDate                           &lt;chr&gt; "2021-01-22T08:12:10Z"
$ updateDate                           &lt;chr&gt; "2022-09-07T13:37:22Z"
$ originChamber                        &lt;chr&gt; "House"
$ billType                             &lt;chr&gt; "HR"
$ introducedDate                       &lt;chr&gt; "2021-01-21"
$ congress                             &lt;chr&gt; "117"
$ constitutionalAuthorityStatementText &lt;chr&gt; "&lt;pre&gt;[Congressional Record Volum…
$ title                                &lt;chr&gt; "Global Health Security Act of 20…
$ version                              &lt;chr&gt; "1.0.0"</code></pre>
</div>
</div>
<p>With the singular nodes transformed, we have the base of our data frame. The next step is to choose a nested element, define its structure in the output, and transform the XML accordingly.</p>
<div class="cell column-page">

</div>
</section></section><section id="dealing-with-nested-data" class="level1"><h1>Dealing with nested data</h1>
<p>In congressional XML data, the actions and votes on a bill are stored in containers. To collect this information and keep our dataset at the bill-level, we can transform each container into data frames using the same steps as before and then assign them as a list columns in our <code>bill_df</code> data frame.</p>
<section id="transforming-nested-data-into-list-columns" class="level2"><h2 class="anchored" data-anchor-id="transforming-nested-data-into-list-columns">Transforming nested data into list columns</h2>
<p>Actions are stored in a container node where each <code>&lt;item&gt;</code> represents a congressional action taken for a bill, such as being introduced, sent to a committee, debated on the floor, etc. Just as before, we use <code><a href="http://xml2.r-lib.org/reference/as_list.html">as_list()</a></code> to convert the <code>{xml_nodeset}</code> to a list.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">actions_xml</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">bill_node</span>, <span class="st">"actions/item"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">actions_list</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">actions_xml</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at first action</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">actions_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, width <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ actionDate  :List of 1
  ..$ : chr "2021-07-12"
 $ committees  :List of 1
  ..$ item:List of 2
  .. ..$ systemCode:List of 1
  .. ..$ name      :List of 1
 $ links       : list()
 $ sourceSystem:List of 2
  ..$ code:List of 1
  .. ..$ : chr "0"
  ..$ name:List of 1
  .. ..$ : chr "Senate"
 $ text        :List of 1
  ..$ : chr "Received in the Senate and Read twice and referred to the Committee on Foreign Relations."
 $ type        :List of 1
  ..$ : chr "IntroReferral"</code></pre>
</div>
</div>
<p>For an individual action, we have the date, a list of committees related to the action, some administrative information, the text and type of action. To deal with this, we can write a function (or set of functions) like the ones below to transform actions from a list to a data frame with their own nested elements.</p>
<div class="cell">
<details><summary>View Functions</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Helper function: flatten_dfc_rename</span></span>
<span><span class="co"># flatten a list to data frame and </span></span>
<span><span class="co"># rename the columns with a given prefix</span></span>
<span><span class="va">flatten_dfc_rename</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">list_to_flatten</span>, </span>
<span>                          <span class="va">name_prefix</span> <span class="op">=</span> <span class="st">"prefix"</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span></span>
<span>    .data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc</a></span><span class="op">(</span><span class="va">list_to_flatten</span><span class="op">)</span>, </span>
<span>    .fn <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">name_prefix</span>, <span class="st">"_"</span>, <span class="va">.</span><span class="op">)</span>,</span>
<span>    <span class="co"># Exclude columns which already start with the prefix</span></span>
<span>    .cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="va">name_prefix</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function: parse_action</span></span>
<span><span class="co"># Parse actions from list to data frame</span></span>
<span><span class="va">parse_action</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">action</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">action</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="co"># Flatten + rename sourceSystem elements</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_if.html">map_at</a></span><span class="op">(</span><span class="st">"sourceSystem"</span>, <span class="op">~</span><span class="fu">flatten_dfc_rename</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"source"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="co"># Flatten + rename committees</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_if.html">map_at</a></span><span class="op">(</span><span class="st">"committees"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">committee</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="co"># using map_at and map_dfr to create a data frame row for each committee</span></span>
<span>      <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">committee</span>, <span class="op">~</span><span class="fu">flatten_dfc_rename</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"committee"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="co"># Flatten object to data frame</span></span>
<span>    <span class="fu">flatten_dfc_rename</span><span class="op">(</span><span class="va">.</span>, <span class="st">"action"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="co"># Lastly, clean the names</span></span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Using the <a href="http://purrr.tidyverse.org">purrr</a> library’s <code><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr()</a></code>, we apply this function to each action and combine the results into <strong>d</strong>ata <strong>f</strong>rame <strong>r</strong>ows. Here’s the output of this process:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Parse the first action</span></span>
<span><span class="op">(</span><span class="va">actions_df</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">actions_list</span>, <span class="va">parse_action</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 14
Columns: 9
$ action_date                  &lt;chr&gt; "2021-07-12", "2021-06-28", "2021-06-28",…
$ action_committee_system_code &lt;chr&gt; "ssfr00", NA, NA, NA, NA, NA, NA, NA, NA,…
$ action_committee_name        &lt;chr&gt; "Foreign Relations Committee", NA, NA, NA…
$ action_source_code           &lt;chr&gt; "0", "2", "2", "9", "2", "2", "2", "2", "…
$ action_source_name           &lt;chr&gt; "Senate", "House floor actions", "House f…
$ action_text                  &lt;chr&gt; "Received in the Senate and Read twice an…
$ action_type                  &lt;chr&gt; "IntroReferral", "Floor", "Floor", "Floor…
$ action_time                  &lt;chr&gt; NA, "19:46:03", "19:46:02", "19:46:02", "…
$ action_code                  &lt;chr&gt; NA, "H38310", "H37300", "8000", "H30000",…</code></pre>
</div>
</div>
<p>When you plan to combine rows into a data frame or <code><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest()</a></code> the data in the future, it is useful to be explicit about the expected data types of each column. This can be done using <code><a href="https://readr.tidyverse.org/reference/type_convert.html">type_convert()</a></code>. Because we are only adding a single row of data to <code>bill_df</code> we can encase the actions in a list and use dollar assignment. If you were adding multiple rows of data, you would need to make sure that you are adding a column of the same length as <code>bill_df</code>.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Specify column data types</span></span>
<span><span class="va">actions_col_types</span> <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span></span>
<span>  action_date <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_date</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  action_time <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_time</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  action_committee_systemCode <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>  action_committee_name <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>  action_source_code <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  action_source_name <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  action_text <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>  action_type <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>  action_code <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert column types</span></span>
<span><span class="va">actions_df</span> <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/type_convert.html">type_convert</a></span><span class="op">(</span><span class="va">actions_df</span>,</span>
<span>                          col_types <span class="op">=</span> <span class="va">actions_col_types</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign actions as data frame within a list</span></span>
<span><span class="va">bill_df</span><span class="op">$</span><span class="va">actions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">actions_df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="when-they-put-xml-in-your-xml" class="level2"><h2 class="anchored" data-anchor-id="when-they-put-xml-in-your-xml">When they put XML in your XML</h2>
<p>So we’ve dealt with cases with multiple child elements, but you can also have links to XML files within those child elements as you can see in the <code>&lt;url&gt;</code> element below.<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a></p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find recordedVote nodes inside recordedVote container</span></span>
<span><span class="va">bill_recorded_vote_nodes</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span></span>
<span>  <span class="va">bill_node</span>, </span>
<span>  <span class="st">"recordedVotes/recordedVote"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at the nodeset contents</span></span>
<span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="va">bill_recorded_vote_nodes</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (7)}
[1] &lt;rollNumber&gt;188&lt;/rollNumber&gt;
[2] &lt;url&gt;https://clerk.house.gov/evs/2021/roll188.xml&lt;/url&gt;
[3] &lt;fullActionName&gt;Final Passage Under Suspension of the Rules Results&lt;/full ...
[4] &lt;chamber&gt;House&lt;/chamber&gt;
[5] &lt;congress&gt;117&lt;/congress&gt;
[6] &lt;date&gt;2021-06-28T23:46:02Z&lt;/date&gt;
[7] &lt;sessionNumber&gt;1&lt;/sessionNumber&gt;</code></pre>
</div>
</div>
<p>Before we dive one level deeper, to start building our vote-level data frame, we can convert the top-level nodes to a list and flatten it into columns.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Coerce nodes to list</span></span>
<span><span class="va">recorded_votes_list</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">bill_recorded_vote_nodes</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">recorded_votes_df</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">recorded_votes_list</span>, <span class="va">flatten_dfc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 7
$ rollNumber     &lt;chr&gt; "188"
$ url            &lt;chr&gt; "https://clerk.house.gov/evs/2021/roll188.xml"
$ fullActionName &lt;chr&gt; "Final Passage Under Suspension of the Rules Results"
$ chamber        &lt;chr&gt; "House"
$ congress       &lt;chr&gt; "117"
$ date           &lt;chr&gt; "2021-06-28T23:46:02Z"
$ sessionNumber  &lt;chr&gt; "1"</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We use <code><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc()</a></code> to flatten each vote element into a data frame as columns and then <code><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr()</a></code> rolls them all up as rows into a single data frame.</p>
</div>
</div>
<p>Now we want to get the vote roll XML file, so we’ll need to use <code><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml()</a></code> . There are two main nodes - <code>&lt;vote-metadata&gt;</code> and <code>&lt;vote-data&gt;</code>. One node contains the aggregated vote information, while <code>&lt;vote-data&gt;</code> contains the legislator-level vote data. Let’s parse the legislator-level data first. Here is the XML for a single legislator’s vote:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vote_roll_xml</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml</a></span><span class="op">(</span><span class="va">recorded_votes_df</span><span class="op">$</span><span class="va">url</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vote_data</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_roll_xml</span>, <span class="st">"vote-data"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vote_legislators</span> <span class="op">=</span> <span class="va">vote_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"recorded-vote"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">legislators_list</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">vote_legislators</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ :List of 2
  ..$ legislator:List of 1
  .. ..$ : chr "Adams"
  .. ..- attr(*, "name-id")= chr "A000370"
  .. ..- attr(*, "sort-field")= chr "Adams"
  .. ..- attr(*, "unaccented-name")= chr "Adams"
  .. ..- attr(*, "party")= chr "D"
  .. ..- attr(*, "state")= chr "NC"
  .. ..- attr(*, "role")= chr "legislator"
  ..$ vote      :List of 1
  .. ..$ : chr "Yea"</code></pre>
</div>
</div>
<p>With a similar combination of <code><a href="http://xml2.r-lib.org/reference/as_list.html">as_list()</a></code> , <code><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfr()</a></code>, and <code><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest()</a></code> we can flatten the XML into one row per legislator but we lose all the attributes.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_roll_flattened</span> <span class="op">=</span> <span class="va">vote_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfr</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 430 × 2
   legislator  vote 
   &lt;chr&gt;       &lt;chr&gt;
 1 Adams       Yea  
 2 Aderholt    Nay  
 3 Aguilar     Yea  
 4 Allen       Nay  
 5 Allred      Yea  
 6 Amodei      Yea  
 7 Armstrong   Yea  
 8 Arrington   Nay  
 9 Auchincloss Yea  
10 Axne        Yea  
# … with 420 more rows</code></pre>
</div>
</div>
<p>Instead we’ll need to extract the attributes before we flatten the data. We want to extract the attributes only for legislator using <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> to apply <code><a href="https://purrr.tidyverse.org/reference/map_if.html">map_at()</a></code> on each legislator element and extract the attributes from each while retaining the value in <code>vote</code>. It can often feel like you’re getting lost in a list of lists, but with some experimentation you’ll be able to find your way back to the surface.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">legislator_vote_df</span> <span class="op">=</span> <span class="va">legislators_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="co"># Modify one level deeper using map_at to target legislator elements</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">map_at</span>, <span class="st">"legislator"</span>, <span class="va">attributes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">flatten_dfc</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 430 × 7
   `name-id` `sort-field` `unaccented-name` party state role       vote 
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;
 1 A000370   Adams        Adams             D     NC    legislator Yea  
 2 A000055   Aderholt     Aderholt          R     AL    legislator Nay  
 3 A000371   Aguilar      Aguilar           D     CA    legislator Yea  
 4 A000372   Allen        Allen             R     GA    legislator Nay  
 5 A000376   Allred       Allred            D     TX    legislator Yea  
 6 A000369   Amodei       Amodei            R     NV    legislator Yea  
 7 A000377   Armstrong    Armstrong         R     ND    legislator Yea  
 8 A000375   Arrington    Arrington         R     TX    legislator Nay  
 9 A000148   Auchincloss  Auchincloss       D     MA    legislator Yea  
10 A000378   Axne         Axne              D     IA    legislator Yea  
# … with 420 more rows</code></pre>
</div>
</div>
<p>Now we have a table of legislator voting data! But what about the <code>&lt;vote-metadata&gt;</code>? Everything other than the <code>&lt;vote-totals&gt;</code> element is singular so we can get that out of the way the same way as before:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vote_metadata</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_roll_xml</span>, <span class="st">"vote-metadata"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vote_singular_nodes</span> <span class="op">=</span> <span class="fu">xml_singular_nodes</span><span class="op">(</span><span class="va">vote_metadata</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">vote_df</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">vote_singular_nodes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># as_list() doesn't retain element names so we set names ourselves</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_name.html">xml_name</a></span><span class="op">(</span><span class="va">vote_singular_nodes</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 12
$ majority        &lt;chr&gt; "D"
$ congress        &lt;chr&gt; "117"
$ session         &lt;chr&gt; "1st"
$ chamber         &lt;chr&gt; "U.S. House of Representatives"
$ `rollcall-num`  &lt;chr&gt; "188"
$ `legis-num`     &lt;chr&gt; "H R 391"
$ `vote-question` &lt;chr&gt; "On Motion to Suspend the Rules and Pass, as Amended"
$ `vote-type`     &lt;chr&gt; "2/3 YEA-AND-NAY"
$ `vote-result`   &lt;chr&gt; "Passed"
$ `action-date`   &lt;chr&gt; "28-Jun-2021"
$ `action-time`   &lt;chr&gt; "7:42 PM"
$ `vote-desc`     &lt;chr&gt; "Global Health Security Act"</code></pre>
</div>
</div>
<p>The <code>&lt;vote-totals&gt;</code> are a bit of a unique little element, with 3 different types of nodes. This is another opportunity for us to be choosy with our data. The first node is table headers, which we don’t need because the elements are tagged anyway. From these, we really only need the <code>&lt;totals-by-party&gt;</code> nodes as long as the totals of which agree with <code>&lt;totals-by-vote&gt;</code> , which is worth checking.</p>
<div>
<details open=""><summary>Code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_totals</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_metadata</span>, <span class="st">"vote-totals"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">vote_totals_by_party</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_totals</span>, <span class="st">"totals-by-party"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">party_vote_totals_df</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">vote_totals_by_party</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">flatten_dfc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://readr.tidyverse.org/reference/type_convert.html">type_convert</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">totals_by_vote</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_totals</span>, <span class="st">"totals-by-vote"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>{xml_nodeset (5)}
[1] &lt;totals-by-party-header&gt;\n  &lt;party-header&gt;Party&lt;/party-header&gt;\n  &lt;yea-he ...
[2] &lt;totals-by-party&gt;\n  &lt;party&gt;Republican&lt;/party&gt;\n  &lt;yea-total&gt;90&lt;/yea-tota ...
[3] &lt;totals-by-party&gt;\n  &lt;party&gt;Democratic&lt;/party&gt;\n  &lt;yea-total&gt;217&lt;/yea-tot ...
[4] &lt;totals-by-party&gt;\n  &lt;party&gt;Independent&lt;/party&gt;\n  &lt;yea-total&gt;0&lt;/yea-tota ...
[5] &lt;totals-by-vote&gt;\n  &lt;total-stub&gt;Totals&lt;/total-stub&gt;\n  &lt;yea-total&gt;307&lt;/ye ...</code></pre>
</div>
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>{xml_nodeset (5)}
[1] &lt;total-stub&gt;Totals&lt;/total-stub&gt;
[2] &lt;yea-total&gt;307&lt;/yea-total&gt;
[3] &lt;nay-total&gt;112&lt;/nay-total&gt;
[4] &lt;present-total&gt;0&lt;/present-total&gt;
[5] &lt;not-voting-total&gt;11&lt;/not-voting-total&gt;</code></pre>
</div>
</div>
</div>
</div>
<p>Once we have our nodeset (which at last are all singular), we use the same listing, mapping, and flattening…or <em>lappening</em> as absolutely no one calls it.</p>
<p>Now that we have all of our vote data wrangled from the thorny grasp of XML, we can put it all together and nest it until we’ve gotten back to the bill-level i.e.&nbsp;the vote roll data frame goes in the votes data frame, which goes in the bill data frame.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vote_roll_df</span> <span class="op">=</span> <span class="va">vote_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>legislator_votes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">legislator_vote_df</span><span class="op">)</span>,</span>
<span>         party_votes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">party_vote_totals_df</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">recorded_votes_df</span> <span class="op">=</span> <span class="va">recorded_votes_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>vote_roll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">vote_roll_df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 8
$ rollNumber     &lt;chr&gt; "188"
$ url            &lt;chr&gt; "https://clerk.house.gov/evs/2021/roll188.xml"
$ fullActionName &lt;chr&gt; "Final Passage Under Suspension of the Rules Results"
$ chamber        &lt;chr&gt; "House"
$ congress       &lt;chr&gt; "117"
$ date           &lt;chr&gt; "2021-06-28T23:46:02Z"
$ sessionNumber  &lt;chr&gt; "1"
$ vote_roll      &lt;list&gt; [&lt;tbl_df[1 x 14]&gt;]</code></pre>
</div>
<details open=""><summary>Code</summary><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bill_df</span><span class="op">$</span><span class="va">votes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">recorded_votes_df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we have the bill-level characteristics with action and vote information nested in list columns. If we want to analyze the actions data, we simply have to <code><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest()</a></code> it.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">bill_df</span>, <span class="va">actions</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 14
Columns: 20
$ billNumber                           &lt;chr&gt; "391", "391", "391", "391", "391"…
$ createDate                           &lt;chr&gt; "2021-01-22T08:12:10Z", "2021-01-…
$ updateDate                           &lt;chr&gt; "2022-09-07T13:37:22Z", "2022-09-…
$ originChamber                        &lt;chr&gt; "House", "House", "House", "House…
$ billType                             &lt;chr&gt; "HR", "HR", "HR", "HR", "HR", "HR…
$ introducedDate                       &lt;chr&gt; "2021-01-21", "2021-01-21", "2021…
$ congress                             &lt;chr&gt; "117", "117", "117", "117", "117"…
$ constitutionalAuthorityStatementText &lt;chr&gt; "&lt;pre&gt;[Congressional Record Volum…
$ title                                &lt;chr&gt; "Global Health Security Act of 20…
$ version                              &lt;chr&gt; "1.0.0", "1.0.0", "1.0.0", "1.0.0…
$ action_date                          &lt;date&gt; 2021-07-12, 2021-06-28, 2021-06-…
$ action_committee_system_code         &lt;chr&gt; "ssfr00", NA, NA, NA, NA, NA, NA,…
$ action_committee_name                &lt;chr&gt; "Foreign Relations Committee", NA…
$ action_source_code                   &lt;chr&gt; "0", "2", "2", "9", "2", "2", "2"…
$ action_source_name                   &lt;chr&gt; "Senate", "House floor actions", …
$ action_text                          &lt;chr&gt; "Received in the Senate and Read …
$ action_type                          &lt;chr&gt; "IntroReferral", "Floor", "Floor"…
$ action_time                          &lt;time&gt;       NA, 19:46:03, 19:46:02, 19…
$ action_code                          &lt;chr&gt; NA, "H38310", "H37300", "8000", "…
$ votes                                &lt;list&gt; [&lt;tbl_df[1 x 8]&gt;], [&lt;tbl_df[1 x …</code></pre>
</div>
</div>
<p>I’ll stop there for brevity’s sake, but you can find the code for extracting the full XML file <a href="https://github.com/MokeEire/my-reps/blob/master/R/parsing_functions.R">here</a><a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a>.</p>
</section></section><section id="tldr-main-points" class="level1"><h1>TL;DR: Main Points</h1>
<p>Transforming XML into a tabular format can be tricky depending on the structure. Start by understanding how the data is organized, what you want it to look like, and what level of detail you are looking at.</p>
<ol type="1">
<li><strong>Explore the structure</strong></li>
</ol>
<blockquote class="blockquote">
<p>Look through any available documentation, always. When you read in the XML file, functions like <code><a href="https://rdrr.io/pkg/XML/man/xmlTreeParse.html">xmlParse()</a></code>, <code><a href="http://xml2.r-lib.org/reference/xml_structure.html">xml_structure()</a></code>, and <code><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents()</a></code> will show you the structure you’re dealing with.</p>
</blockquote>
<ol start="2" type="1">
<li><strong>Define the output</strong></li>
</ol>
<blockquote class="blockquote">
<p>Consider what you want the output to look like and think about how the data needs to be transformed to match this.</p>
</blockquote>
<ol start="3" type="1">
<li>
<strong>Process a single element</strong> (write a function if it gets too complicated)</li>
</ol>
<blockquote class="blockquote">
<p>Get one element into the form you want. Writing functions can help you think through the data transformations being applied and make your code easier to read.</p>
</blockquote>
<ol start="4" type="1">
<li><strong>Apply to all elements</strong></li>
</ol>
<blockquote class="blockquote">
<p>Focus on processing the entire file (or the subset of the file you’re interested in). You might want an XML file to return a single row, a single column, or a data frame of size <span class="math inline">\(n\times k\)</span>. Once you have a single file returned in the format you want, you can combine the outputs of all the files in your dataset.</p>
</blockquote>
<p>Please reach out with any questions or feedback! All is welcome, and there may even be a reward for anyone who finds a mistake in the code.</p>
</section><section id="other-helpful-articles" class="level1"><h1>Other helpful articles</h1>
<p>Here are some of the helpful articles I came across in the course of writing this:</p>
<ul>
<li><a href="https://towardsdatascience.com/from-xml-to-excel-for-data-analysis-ac0c0c765b7d" title="Introduction to Processing XML In Python">From XML to Excel for Data Analysis</a></li>
<li><a href="https://medium.com/geekculture/reading-xml-files-in-r-3122c3a2a8d9">Reading XML files in R</a></li>
<li><a href="https://urbandatapalette.com/post/2021-03-xml-dataframe-r/">Converting nested XML to dataframe in R</a></li>
<li><a href="https://www.rstudio.com/blog/xml2/">Parse and process XML (and HTML) with xml2</a></li>
</ul></section><section id="session-info" class="level1"><h1>Session Info</h1>
<p>Version information about R, OS, and loaded packages.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.2.1 (2022-06-23 ucrt)
 os       Windows 10 x64 (build 19043)
 system   x86_64, mingw32
 ui       RTerm
 language (EN)
 collate  English_United States.utf8
 ctype    English_United States.utf8
 tz       America/Los_Angeles
 date     2022-10-03
 pandoc   2.18 @ C:/Program Files/RStudio/bin/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 ! package        * version   date (UTC) lib source
 P assertthat       0.2.1     2019-03-21 [?] CRAN (R 4.2.0)
 P backports        1.4.1     2021-12-13 [?] CRAN (R 4.2.0)
 P bit              4.0.4     2020-08-04 [?] CRAN (R 4.2.0)
 P bit64            4.0.5     2020-08-30 [?] CRAN (R 4.2.0)
 P bitops           1.0-7     2021-04-24 [?] CRAN (R 4.2.0)
 P broom            1.0.0     2022-07-01 [?] CRAN (R 4.2.1)
 P cellranger       1.1.0     2016-07-27 [?] CRAN (R 4.2.0)
 P cli              3.4.0     2022-09-08 [?] CRAN (R 4.2.1)
 P colorspace       2.0-3     2022-02-21 [?] CRAN (R 4.2.0)
 P crayon           1.5.1     2022-03-26 [?] CRAN (R 4.2.0)
 P curl             4.3.2     2021-06-23 [?] CRAN (R 4.2.0)
 P DBI              1.1.3     2022-06-18 [?] CRAN (R 4.2.0)
 P dbplyr           2.2.1     2022-06-27 [?] CRAN (R 4.2.1)
 P digest           0.6.29    2021-12-01 [?] CRAN (R 4.2.0)
 P dplyr          * 1.0.10    2022-09-01 [?] CRAN (R 4.2.1)
 P ellipsis         0.3.2     2021-04-29 [?] CRAN (R 4.2.0)
 P evaluate         0.15      2022-02-18 [?] CRAN (R 4.2.0)
 P extrafont      * 0.18      2022-04-12 [?] CRAN (R 4.2.0)
 P extrafontdb      1.0       2012-06-11 [?] CRAN (R 4.2.0)
 P fansi            1.0.3     2022-03-24 [?] CRAN (R 4.2.0)
 P fastmap          1.1.0     2021-01-25 [?] CRAN (R 4.2.0)
 P forcats        * 0.5.1     2021-01-27 [?] CRAN (R 4.2.0)
 P fs               1.5.2     2021-12-08 [?] CRAN (R 4.2.0)
 P gargle           1.2.0     2021-07-02 [?] CRAN (R 4.2.0)
 P generics         0.1.3     2022-07-05 [?] CRAN (R 4.2.1)
 P ggplot2        * 3.3.6     2022-05-03 [?] CRAN (R 4.2.0)
 P glue             1.6.2     2022-02-24 [?] CRAN (R 4.2.0)
 P googledrive      2.0.0     2021-07-08 [?] CRAN (R 4.2.0)
 P googlesheets4    1.0.0     2021-07-21 [?] CRAN (R 4.2.0)
 P gtable           0.3.1     2022-09-01 [?] CRAN (R 4.2.1)
 P haven            2.5.0     2022-04-15 [?] CRAN (R 4.2.0)
 P hms              1.1.1     2021-09-26 [?] CRAN (R 4.2.0)
 P htmltools        0.5.3     2022-07-18 [?] CRAN (R 4.2.1)
 P htmlwidgets      1.5.4     2021-09-08 [?] CRAN (R 4.2.0)
 P httr             1.4.3     2022-05-04 [?] CRAN (R 4.2.0)
 P janitor          2.1.0     2021-01-05 [?] CRAN (R 4.2.1)
 P jsonlite       * 1.8.0     2022-02-22 [?] CRAN (R 4.2.0)
 P knitr            1.40      2022-08-24 [?] CRAN (R 4.2.1)
 P lifecycle        1.0.1     2021-09-24 [?] CRAN (R 4.2.0)
 P log4r          * 0.4.2     2021-11-04 [?] CRAN (R 4.2.0)
 P lubridate      * 1.8.0     2021-10-07 [?] CRAN (R 4.2.0)
 P magrittr         2.0.3     2022-03-30 [?] CRAN (R 4.2.0)
 P microbenchmark   1.4.9     2021-11-09 [?] CRAN (R 4.2.0)
 P modelr           0.1.8     2020-05-19 [?] CRAN (R 4.2.0)
   mokeR          * 0.1.0     2022-10-03 [1] local (C:/Users/Mark/Documents/Projects/mokeR_0.1.0.tar.gz)
 P munsell          0.5.0     2018-06-12 [?] CRAN (R 4.2.0)
 P pillar           1.8.1     2022-08-19 [?] CRAN (R 4.2.1)
 P pkgconfig        2.0.3     2019-09-22 [?] CRAN (R 4.2.0)
 P purrr          * 0.3.4     2020-04-17 [?] CRAN (R 4.2.0)
 P R6               2.5.1     2021-08-19 [?] CRAN (R 4.2.0)
 P RCurl          * 1.98-1.9  2022-10-03 [?] CRAN (R 4.2.1)
 P reactable      * 0.3.0     2022-05-26 [?] CRAN (R 4.2.0)
 P reactR           0.4.4     2021-02-22 [?] CRAN (R 4.2.0)
 P readr          * 2.1.2     2022-01-30 [?] CRAN (R 4.2.0)
 P readxl           1.4.0     2022-03-28 [?] CRAN (R 4.2.0)
   renv             0.15.5    2022-05-26 [1] CRAN (R 4.2.1)
 P reprex           2.0.1     2021-08-05 [?] CRAN (R 4.2.0)
 P rjson          * 0.2.21    2022-01-09 [?] CRAN (R 4.2.0)
 P rlang            1.0.5     2022-08-31 [?] CRAN (R 4.2.1)
 P rmarkdown        2.16      2022-08-24 [?] CRAN (R 4.2.1)
 P rstudioapi       0.13      2020-11-12 [?] CRAN (R 4.2.0)
   Rttf2pt1         1.3.8     2020-01-10 [1] CRAN (R 4.2.1)
 P rvest            1.0.2     2021-10-16 [?] CRAN (R 4.2.0)
 P scales           1.2.1     2022-08-20 [?] CRAN (R 4.2.1)
 P sessioninfo      1.2.2     2021-12-06 [?] CRAN (R 4.2.0)
 P snakecase        0.11.0    2019-05-25 [?] CRAN (R 4.2.1)
 P stringi          1.7.8     2022-07-11 [?] CRAN (R 4.2.1)
 P stringr        * 1.4.1     2022-08-20 [?] CRAN (R 4.2.1)
 P tibble         * 3.1.8     2022-07-22 [?] CRAN (R 4.2.1)
 P tidyjson       * 0.3.1     2020-05-31 [?] CRAN (R 4.2.0)
 P tidyr          * 1.2.1     2022-09-08 [?] CRAN (R 4.2.1)
 P tidyselect       1.1.2     2022-02-21 [?] CRAN (R 4.2.0)
 P tidyverse      * 1.3.2     2022-07-18 [?] CRAN (R 4.2.1)
 P tzdb             0.3.0     2022-03-28 [?] CRAN (R 4.2.0)
 P utf8             1.2.2     2021-07-24 [?] CRAN (R 4.2.0)
 P vctrs            0.4.1     2022-04-13 [?] CRAN (R 4.2.0)
 P vroom            1.5.7     2021-11-30 [?] CRAN (R 4.2.0)
 P withr            2.5.0     2022-03-03 [?] CRAN (R 4.2.0)
 P xfun             0.32      2022-08-10 [?] CRAN (R 4.2.1)
 P XML            * 3.99-0.11 2022-10-03 [?] CRAN (R 4.2.1)
 P xml2           * 1.3.3     2021-11-30 [?] CRAN (R 4.2.0)
 P yaml             2.3.5     2022-02-21 [?] CRAN (R 4.2.0)

 [1] C:/Users/Mark/Documents/Projects/Blog/renv/library/R-4.2/x86_64-w64-mingw32
 [2] C:/Program Files/R/R-4.2.1/library

 P ── Loaded and on-disk path mismatch.

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>


<!-- -->

</section><div id="quarto-appendix" class="default"><section class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1" role="doc-endnote"><p><a href="https://en.wikipedia.org/wiki/XML">Wikipedia</a> for the curious. Don’t miss the drama about Microsoft’s “vociferous protests” as one of the co-editors started working with Netscape.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>The <em>x</em> at the end of Microsoft file types (e.g.&nbsp;.docx, .xlsx, .pptx) stands for XML.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>To learn more about what XML is and how to use it, I recommend going through <a href="https://www.w3schools.com/XML/default.asp">w3school’s XML tutorial</a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>Between <a href="https://www.omegahat.net/RSXML/">XML</a> and <a href="https://xml2.r-lib.org/">xml2</a> there are numerous ways to load XML data with R. I generally prefer <a href="https://xml2.r-lib.org/">xml2</a> but I suggest looking through the packages’ documentation to find the right function for your task<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p><code>xml_document</code> is one of the “key classes” used in the <a href="https://xml2.r-lib.org/">xml2</a> library, the others being <code>xml_node</code> (a single node), and <code>xml_nodeset</code> (a set of nodes).<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote"><p>Which is a document metadata identifier, not an Irish metal music genre. While very useful in its own right, it isn’t relevant for our task here.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7" role="doc-endnote">
<p>For example</p>
<table class="table">
<caption>Potential structure for party-level votes</caption>
<thead><tr class="header">
<th>Bill</th>
<th>Party</th>
<th><span class="math inline">\(\cdots\)</span></th>
<th>Yeas</th>
<th>Nays</th>
<th>Abstentions</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>HR-1</td>
<td>R</td>
<td><span class="math inline">\(\cdots\)</span></td>
<td>221</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>HR-1</td>
<td>D</td>
<td><span class="math inline">\(\cdots\)</span></td>
<td>0</td>
<td>212</td>
<td>1</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
</tr>
</tbody>
</table>
<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a>
</li>
<li id="fn8" role="doc-endnote"><p>Atomic vectors are vectors with elements of the same type (e.g.&nbsp;numeric, character, etc.) as opposed to <em>general vectors</em>, or lists, which can contain a variety of types.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9" role="doc-endnote">
<p>When you’re working with both the <a href="https://www.omegahat.net/RSXML/">XML</a> and <a href="https://xml2.r-lib.org/">xml2</a> libraries, it is important to note that their functions often rely on different object types. In the case of <code><a href="https://rdrr.io/pkg/XML/man/xmlToDataFrame.html">xmlToDataFrame()</a></code>, it does not take <code>{xml_document}</code> or <code>{xml_node}</code> objects. If you try to use them, you’ll see an error like this:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/XML/man/xmlToDataFrame.html">xmlToDataFrame</a></span><span class="op">(</span><span class="va">bill_xml</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>Error in (function (classes, fdef, mtable) : unable to find an inherited method for function 'xmlToDataFrame' for signature '"xml_document", "missing", "missing", "missing", "missing"'</code></pre>
</div>
</div>
<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a>
</li>
<li id="fn10" role="doc-endnote"><p><a href="https://www.w3schools.com/XML/xpath_syntax.asp" target="_blank">A very useful table of XPath syntax</a><a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11" role="doc-endnote">
<p>In the process of writing this, I discovered that using XPath made this ~5x faster than an equivalent function in R.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to select singular child nodes from XML node</span></span>
<span><span class="va">xml_singular_nodes</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xml_node</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Return child nodes of current node</span></span>
<span>  <span class="va">child_nodes</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_children</a></span><span class="op">(</span><span class="va">xml_node</span><span class="op">)</span></span>
<span>  <span class="co"># Select child nodes with 0 children</span></span>
<span>  <span class="va">zero_length_child_nodes</span> <span class="op">=</span> <span class="va">child_nodes</span><span class="op">[</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_length</a></span><span class="op">(</span><span class="va">child_nodes</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># Keep the nodes which are not empty strings</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">keep</a></span><span class="op">(</span><span class="va">zero_length_child_nodes</span>, <span class="op">~</span><span class="op">(</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Using XPath:</span></span>
<span><span class="co"># singular_nodes1 = xml_find_all(bill_xml, </span></span>
<span><span class="co">#                                 "//bill/*[count(./*) = 0 and not(string-length(.) = 0)]")</span></span>
<span></span>
<span><span class="co"># Using R function:</span></span>
<span><span class="co"># singular_nodes2 = xml_singular_nodes(bill_node)</span></span>
<span></span>
<span><span class="co"># Check they are the same</span></span>
<span><span class="co"># all.equal(singular_nodes1, singular_nodes2)</span></span>
<span></span>
<span><span class="co"># benchmark the two different ways of selecting nodes</span></span>
<span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op">(</span></span>
<span>  xml_singular_nodes <span class="op">=</span> <span class="fu">xml_singular_nodes</span><span class="op">(</span><span class="va">bill_node</span><span class="op">)</span>,</span>
<span>  xml_find_all <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">bill_xml</span>, <span class="st">"//bill/*[count(./*) = 0 and not(string-length(.) = 0)]"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Unit: microseconds
               expr    min      lq     mean median      uq    max neval
 xml_singular_nodes 1085.6 1133.40 1229.660 1148.5 1171.20 6893.6   100
       xml_find_all  204.9  212.45  242.895  226.5  247.75  620.1   100</code></pre>
</div>
</div>
<a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a>
</li>
<li id="fn12" role="doc-endnote">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://c.tenor.com/um2EhyMQyR8AAAAC/xzibit-meme.gif" class="img-fluid figure-img" width="267"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">They heard you like XML so they put XML in your XML</figcaption><p></p>
</figure>
</div>
<a href="#fnref12" class="footnote-back" role="doc-backlink">↩︎</a>
</li>
<li id="fn13" role="doc-endnote"><p>Ctrl/Cmd+F: <code>extract_bill_status</code><a href="#fnref13" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb50" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Parsing XML with R"</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Untangling data from complex XML structures using `{XML}` and `{xml2}`"</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2022-07-14"</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> </span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - data</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - governance</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - R</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co">    comments:</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co">      hypothesis: true</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extrafont)</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reactable)</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://github.com/MokeEire/my-reps/raw/master/R/parsing_functions.R"</span>)</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>bill_xml_url <span class="ot">=</span> <span class="st">"https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml"</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>bill_xml_file <span class="ot">=</span> <span class="fu">read_xml</span>(bill_xml_url)</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>Unlike Excel spreadsheets, CSV files, and other tabular formats, (e)Xtensible Markup Language (XML) is a storage format designed to contain any "arbitrary" structure<span class="ot">[^1]</span> of data. XML's flexibility is useful for storing information like financial transactions and recipes to webpage content and document formatting<span class="ot">[^2]</span>. If you have worked with XML before, you'll know it can be a bit of a pain to transform into a tabular format typically used in data analysis. The good news is you're not alone! This article will help you to load XML files with R, extract what you need from them, and store the results in a analysis-friendly data frame.</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span><span class="co">[</span><span class="ot">Wikipedia</span><span class="co">](https://en.wikipedia.org/wiki/XML)</span> for the curious. Don't miss the drama about Microsoft's "vociferous protests" as one of the co-editors started working with Netscape.</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a><span class="ot">[^2]: </span>The *x* at the end of Microsoft file types (e.g. .docx, .xlsx, .pptx) stands for XML.</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip appearance="simple"}</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="fu">## What you'll learn:</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Load and parse XML files in R using the <span class="in">`{XML}`</span> and <span class="in">`{xml2}`</span> packages</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explore the structure of XML documents</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>List, map, and flatten your data into a tabular format using <span class="in">`{purrr}`</span>, and making use of <span class="in">`{tidyr}`</span>'s list columns when necessary</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a><span class="fu"># What is XML?</span></span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a>At its core, XML is "information wrapped in tags". Think of XML's structure as branches of a tree, with each branch having their own leaves. Below is an example of a bookstore's data in XML format from <span class="co">[</span><span class="ot">w3schools</span><span class="co">](https://www.w3schools.com/XML/xml_usedfor.asp)</span>.</span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a><span class="in">``` xml</span></span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">bookstore</span>&gt;</span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">book</span><span class="ot"> category=</span><span class="st">"children"</span>&gt;</span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">title</span>&gt;Harry Potter&lt;/<span class="kw">title</span>&gt;</span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">author</span>&gt;J K. Rowling&lt;/<span class="kw">author</span>&gt;</span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">year</span>&gt;2005&lt;/<span class="kw">year</span>&gt;</span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">price</span>&gt;29.99&lt;/<span class="kw">price</span>&gt;</span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">book</span>&gt;</span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">book</span><span class="ot"> category=</span><span class="st">"web"</span>&gt;</span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">title</span>&gt;Learning XML&lt;/<span class="kw">title</span>&gt;</span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">author</span>&gt;Erik T. Ray&lt;/<span class="kw">author</span>&gt;</span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">year</span>&gt;2003&lt;/<span class="kw">year</span>&gt;</span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">price</span>&gt;39.95&lt;/<span class="kw">price</span>&gt;</span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">book</span>&gt;</span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">bookstore</span>&gt;</span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true" tabindex="-1"></a>`&lt;<span class="kw">bookstore</span>&gt;` is the parent, or *root* element in the example above. The two `&lt;<span class="kw">book</span>&gt;` elements are the bookstore's *children*, each of which has individual data points in *child* elements (e.g. `&lt;<span class="kw">title</span>&gt;`) and *attributes* e.g. `&lt;<span class="kw">book</span><span class="ot"> category=</span><span class="st">"children"</span>&gt;` stores the book's category as an attribute.</span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="minimal"}</span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true" tabindex="-1"></a>## Note</span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-77"><a href="#cb50-77" aria-hidden="true" tabindex="-1"></a>Attributes are a useful way to store data related to a specific element for HTML, but using child elements is typically preferred in XML[^3]. However, you'll still likely run into data stored in attributes so we'll touch on extracting data from both.</span>
<span id="cb50-78"><a href="#cb50-78" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb50-79"><a href="#cb50-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-80"><a href="#cb50-80" aria-hidden="true" tabindex="-1"></a>[^3]: To learn more about what XML is and how to use it, I recommend going through [w3school's XML tutorial](https://www.w3schools.com/XML/default.asp).</span>
<span id="cb50-81"><a href="#cb50-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-82"><a href="#cb50-82" aria-hidden="true" tabindex="-1"></a># Navigating XML with R</span>
<span id="cb50-83"><a href="#cb50-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-84"><a href="#cb50-84" aria-hidden="true" tabindex="-1"></a>If you've never used R before, this will be a bit of a rough point to start learning. Instead I would recommend checking [RStudio's beginners guide](https://education.rstudio.com/learn/beginner/), so for the remainder of the post I will assume some familiarity with R. Four packages I use throughout this post are listed below. If you don't understand how a function works or want to see the function reference, click on the function in the code and it *should* bring you to the function's help page.</span>
<span id="cb50-85"><a href="#cb50-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-86"><a href="#cb50-86" aria-hidden="true" tabindex="-1"></a>-   `{XML}` and `{xml2}` provide functions for reading in and parsing XML[^4]</span>
<span id="cb50-87"><a href="#cb50-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-88"><a href="#cb50-88" aria-hidden="true" tabindex="-1"></a>-   `{purrr}` and `{tidyr}` (loaded as part of the `{tidyverse}` package) help us wrangle lists and transform XML to data frames.</span>
<span id="cb50-89"><a href="#cb50-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-90"><a href="#cb50-90" aria-hidden="true" tabindex="-1"></a>[^4]: Between `{XML}` and `{xml2}` there are numerous ways to load XML data with R. I generally prefer `{xml2}` but I suggest looking through the packages' documentation to find the right function for your task</span>
<span id="cb50-91"><a href="#cb50-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-94"><a href="#cb50-94" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-95"><a href="#cb50-95" aria-hidden="true" tabindex="-1"></a>#| label: load-libs</span>
<span id="cb50-96"><a href="#cb50-96" aria-hidden="true" tabindex="-1"></a>#| code-fold: show</span>
<span id="cb50-97"><a href="#cb50-97" aria-hidden="true" tabindex="-1"></a>#| code-summary: "Load libraries"</span>
<span id="cb50-98"><a href="#cb50-98" aria-hidden="true" tabindex="-1"></a># copy the comment below to install the packages</span>
<span id="cb50-99"><a href="#cb50-99" aria-hidden="true" tabindex="-1"></a># install.packages(c("tidyverse", "XML", "xml2))</span>
<span id="cb50-100"><a href="#cb50-100" aria-hidden="true" tabindex="-1"></a>library(tidyverse)</span>
<span id="cb50-101"><a href="#cb50-101" aria-hidden="true" tabindex="-1"></a>library(XML)</span>
<span id="cb50-102"><a href="#cb50-102" aria-hidden="true" tabindex="-1"></a>library(xml2)</span>
<span id="cb50-103"><a href="#cb50-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-104"><a href="#cb50-104" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-105"><a href="#cb50-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-106"><a href="#cb50-106" aria-hidden="true" tabindex="-1"></a>To illustrate potential complexities of XML structures I'll be using [congressional bill status data](https://www.govinfo.gov/bulkdata/BILLSTATUS) from the US GPO's [GovInfo service](https://www.govinfo.gov/). In particular, you can download the sample bill [here](https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml "HR-391: Global Health Security Act of 2021") (chosen for its examples of challenges parsing XML).</span>
<span id="cb50-107"><a href="#cb50-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-108"><a href="#cb50-108" aria-hidden="true" tabindex="-1"></a>First we need to read in the XML file. You can pass the URL or file path of the XML file to `read_xml()` to create an `xml_document` object[^5]. To see the contents of the file you've just loaded you can use `xml_contents()` or enter the object's name (here `bill_xml`) in the console.</span>
<span id="cb50-109"><a href="#cb50-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-110"><a href="#cb50-110" aria-hidden="true" tabindex="-1"></a>[^5]: `xml_document` is one of the "key classes" used in the `{xml2}` library, the others being `xml_node` (a single node), and `xml_nodeset` (a set of nodes).</span>
<span id="cb50-111"><a href="#cb50-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-114"><a href="#cb50-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-115"><a href="#cb50-115" aria-hidden="true" tabindex="-1"></a>#| label: read-xml</span>
<span id="cb50-116"><a href="#cb50-116" aria-hidden="true" tabindex="-1"></a>#| code-fold: show</span>
<span id="cb50-117"><a href="#cb50-117" aria-hidden="true" tabindex="-1"></a>#| code-summary: "Load and view XML file"</span>
<span id="cb50-118"><a href="#cb50-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-119"><a href="#cb50-119" aria-hidden="true" tabindex="-1"></a># Read XML file</span>
<span id="cb50-120"><a href="#cb50-120" aria-hidden="true" tabindex="-1"></a>bill_xml = read_xml("https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml")</span>
<span id="cb50-121"><a href="#cb50-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-122"><a href="#cb50-122" aria-hidden="true" tabindex="-1"></a># Look at xml_document's contents</span>
<span id="cb50-123"><a href="#cb50-123" aria-hidden="true" tabindex="-1"></a>xml_contents(bill_xml)</span>
<span id="cb50-124"><a href="#cb50-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-125"><a href="#cb50-125" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-126"><a href="#cb50-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-127"><a href="#cb50-127" aria-hidden="true" tabindex="-1"></a>We have two top-level nodes - `&lt;<span class="kw">bill</span>&gt;` and `&lt;<span class="kw">dublinCore</span>&gt;`[^6]. The latter is actually a metadata identifier and doesn't contain bill-related information. We can use `xml_child()` to select only elements inside the `&lt;<span class="kw">bill</span>&gt;` node, returning an XML nodeset that looks like this:</span>
<span id="cb50-128"><a href="#cb50-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-129"><a href="#cb50-129" aria-hidden="true" tabindex="-1"></a>[^6]: Which is a document metadata identifier, not an Irish metal music genre. While very useful in its own right, it isn't relevant for our task here.</span>
<span id="cb50-130"><a href="#cb50-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-133"><a href="#cb50-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-134"><a href="#cb50-134" aria-hidden="true" tabindex="-1"></a>#| label: xml-bill-child</span>
<span id="cb50-135"><a href="#cb50-135" aria-hidden="true" tabindex="-1"></a>#| code-fold: show</span>
<span id="cb50-136"><a href="#cb50-136" aria-hidden="true" tabindex="-1"></a>#| column: page-right</span>
<span id="cb50-137"><a href="#cb50-137" aria-hidden="true" tabindex="-1"></a>#| code-summary: "Select first matching child element"</span>
<span id="cb50-138"><a href="#cb50-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-139"><a href="#cb50-139" aria-hidden="true" tabindex="-1"></a>(bill_node = xml_child(bill_xml, "bill"))</span>
<span id="cb50-140"><a href="#cb50-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-141"><a href="#cb50-141" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-142"><a href="#cb50-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-143"><a href="#cb50-143" aria-hidden="true" tabindex="-1"></a># Define the output</span>
<span id="cb50-144"><a href="#cb50-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-145"><a href="#cb50-145" aria-hidden="true" tabindex="-1"></a>Now we have the bill XML loaded and we've already stripped away some data we don't need but before diving deeper, it's helpful to think about the how you want to the processed XML data to be structured. For example, in the bill status data I might want to collect party-level votes. This could take the form of one row per party per bill with a column for yeas, nays, and abstentions[^7]. Perhaps I want to look at the policy areas of bills which became law. Instead of processing the entire file and then selecting the data I want, I can select only the nodes I need at the outset before transforming the data into a data frame. This will likely save you some time in cases where you have a lot of data.</span>
<span id="cb50-146"><a href="#cb50-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-147"><a href="#cb50-147" aria-hidden="true" tabindex="-1"></a>[^7]: For example</span>
<span id="cb50-148"><a href="#cb50-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-149"><a href="#cb50-149" aria-hidden="true" tabindex="-1"></a>    | Bill     | Party    | $\cdots$ | Yeas     | Nays     | Abstentions |</span>
<span id="cb50-150"><a href="#cb50-150" aria-hidden="true" tabindex="-1"></a>    |----------|----------|----------|----------|----------|-------------|</span>
<span id="cb50-151"><a href="#cb50-151" aria-hidden="true" tabindex="-1"></a>    | HR-1     | R        | $\cdots$ | 221      | 0        | 1           |</span>
<span id="cb50-152"><a href="#cb50-152" aria-hidden="true" tabindex="-1"></a>    | HR-1     | D        | $\cdots$ | 0        | 212      | 1           |</span>
<span id="cb50-153"><a href="#cb50-153" aria-hidden="true" tabindex="-1"></a>    | $\vdots$ | $\vdots$ | $\vdots$ | $\vdots$ | $\vdots$ | $\vdots$    |</span>
<span id="cb50-154"><a href="#cb50-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-155"><a href="#cb50-155" aria-hidden="true" tabindex="-1"></a>    : Potential structure for party-level votes</span>
<span id="cb50-156"><a href="#cb50-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-159"><a href="#cb50-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-160"><a href="#cb50-160" aria-hidden="true" tabindex="-1"></a>#| label: example-bill</span>
<span id="cb50-161"><a href="#cb50-161" aria-hidden="true" tabindex="-1"></a>#| echo: false</span>
<span id="cb50-162"><a href="#cb50-162" aria-hidden="true" tabindex="-1"></a>#| message: false</span>
<span id="cb50-163"><a href="#cb50-163" aria-hidden="true" tabindex="-1"></a>#| column: page</span>
<span id="cb50-164"><a href="#cb50-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-165"><a href="#cb50-165" aria-hidden="true" tabindex="-1"></a>example_bill_df = extract_bill_status(bill_xml_url, log_types = NULL)</span>
<span id="cb50-166"><a href="#cb50-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-167"><a href="#cb50-167" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-168"><a href="#cb50-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-169"><a href="#cb50-169" aria-hidden="true" tabindex="-1"></a>With the congressional bills data, I defined my output as a bill-level dataset, i.e. one bill per row, storing *nested* elements like `recordedVotes`, `committees`, and `actions` inside [list columns](https://jennybc.github.io/purrr-tutorial/ls13_list-columns.html). While columns in a data frame are typically *atomic vectors*[^8] of equal length, list columns enable us to store data of varying length and type, including data frames themselves. Using `{tidyr}`'s `unnest()` function, we can expand this nested data into regular data frame columns. Here is what this output will look like:</span>
<span id="cb50-170"><a href="#cb50-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-171"><a href="#cb50-171" aria-hidden="true" tabindex="-1"></a>[^8]: Atomic vectors are vectors with elements of the same type (e.g. numeric, character, etc.) as opposed to *general vectors*, or lists, which can contain a variety of types.</span>
<span id="cb50-172"><a href="#cb50-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-175"><a href="#cb50-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-176"><a href="#cb50-176" aria-hidden="true" tabindex="-1"></a>#| label: example-bill-rt</span>
<span id="cb50-177"><a href="#cb50-177" aria-hidden="true" tabindex="-1"></a>#| echo: false</span>
<span id="cb50-178"><a href="#cb50-178" aria-hidden="true" tabindex="-1"></a>#| eval: true</span>
<span id="cb50-179"><a href="#cb50-179" aria-hidden="true" tabindex="-1"></a>#| column: page</span>
<span id="cb50-180"><a href="#cb50-180" aria-hidden="true" tabindex="-1"></a>example_bill_df %&gt;% #glimpse() # here to check the data</span>
<span id="cb50-181"><a href="#cb50-181" aria-hidden="true" tabindex="-1"></a>  reactable::reactable(</span>
<span id="cb50-182"><a href="#cb50-182" aria-hidden="true" tabindex="-1"></a>    theme = moke_rt(),</span>
<span id="cb50-183"><a href="#cb50-183" aria-hidden="true" tabindex="-1"></a>    compact = T,</span>
<span id="cb50-184"><a href="#cb50-184" aria-hidden="true" tabindex="-1"></a>    resizable = T,</span>
<span id="cb50-185"><a href="#cb50-185" aria-hidden="true" tabindex="-1"></a>    wrap = F,</span>
<span id="cb50-186"><a href="#cb50-186" aria-hidden="true" tabindex="-1"></a>    columns = list(</span>
<span id="cb50-187"><a href="#cb50-187" aria-hidden="true" tabindex="-1"></a>      "bill_id" = colDef(show=F),</span>
<span id="cb50-188"><a href="#cb50-188" aria-hidden="true" tabindex="-1"></a>      "bill_number" = colDef(name = "Bill No.", width = 80),</span>
<span id="cb50-189"><a href="#cb50-189" aria-hidden="true" tabindex="-1"></a>      "create_date" = colDef(format = colFormat(date = T), width = 100),</span>
<span id="cb50-190"><a href="#cb50-190" aria-hidden="true" tabindex="-1"></a>      "update_date" = colDef(format = colFormat(date = T), width = 100),</span>
<span id="cb50-191"><a href="#cb50-191" aria-hidden="true" tabindex="-1"></a>      "origin_chamber" = colDef(show=F),</span>
<span id="cb50-192"><a href="#cb50-192" aria-hidden="true" tabindex="-1"></a>      "bill_type" = colDef(name = "Bill type", width = 60),</span>
<span id="cb50-193"><a href="#cb50-193" aria-hidden="true" tabindex="-1"></a>      "introduced_date" = colDef(format = colFormat(date = T), width = 130),</span>
<span id="cb50-194"><a href="#cb50-194" aria-hidden="true" tabindex="-1"></a>      "congress" = colDef(width = 80),</span>
<span id="cb50-195"><a href="#cb50-195" aria-hidden="true" tabindex="-1"></a>      "constitutional_authority_statement_text" = colDef(show=F),</span>
<span id="cb50-196"><a href="#cb50-196" aria-hidden="true" tabindex="-1"></a>      "title" = colDef(minWidth = 180),</span>
<span id="cb50-197"><a href="#cb50-197" aria-hidden="true" tabindex="-1"></a>      "version" = colDef(show = F, width = 80),</span>
<span id="cb50-198"><a href="#cb50-198" aria-hidden="true" tabindex="-1"></a>      "policy_areas" = colDef(width = 120),</span>
<span id="cb50-199"><a href="#cb50-199" aria-hidden="true" tabindex="-1"></a>      "legislative_subjects" = colDef(width = 200),</span>
<span id="cb50-200"><a href="#cb50-200" aria-hidden="true" tabindex="-1"></a>      "bill_summaries" = colDef(show=F),</span>
<span id="cb50-201"><a href="#cb50-201" aria-hidden="true" tabindex="-1"></a>      "bill_titles" = colDef(show=F),</span>
<span id="cb50-202"><a href="#cb50-202" aria-hidden="true" tabindex="-1"></a>      "bill_text_versions" = colDef(show=F),</span>
<span id="cb50-203"><a href="#cb50-203" aria-hidden="true" tabindex="-1"></a>      "latest_action_action_date" = colDef(name = "action_date", </span>
<span id="cb50-204"><a href="#cb50-204" aria-hidden="true" tabindex="-1"></a>                                           width = 110,</span>
<span id="cb50-205"><a href="#cb50-205" aria-hidden="true" tabindex="-1"></a>                                           format = colFormat(date = T)),</span>
<span id="cb50-206"><a href="#cb50-206" aria-hidden="true" tabindex="-1"></a>      "latest_action_text" = colDef(name = "action_text",</span>
<span id="cb50-207"><a href="#cb50-207" aria-hidden="true" tabindex="-1"></a>                                    minWidth = 200),</span>
<span id="cb50-208"><a href="#cb50-208" aria-hidden="true" tabindex="-1"></a>      "committees" = colDef(minWidth = 80),</span>
<span id="cb50-209"><a href="#cb50-209" aria-hidden="true" tabindex="-1"></a>      "house_votes" = colDef(width = 80),</span>
<span id="cb50-210"><a href="#cb50-210" aria-hidden="true" tabindex="-1"></a>      "senate_votes" = colDef(width = 80),</span>
<span id="cb50-211"><a href="#cb50-211" aria-hidden="true" tabindex="-1"></a>      "actions" = colDef(width = 80),</span>
<span id="cb50-212"><a href="#cb50-212" aria-hidden="true" tabindex="-1"></a>      "action_counts" = colDef(show=F),</span>
<span id="cb50-213"><a href="#cb50-213" aria-hidden="true" tabindex="-1"></a>      "sponsors" = colDef(width = 80),</span>
<span id="cb50-214"><a href="#cb50-214" aria-hidden="true" tabindex="-1"></a>      "cosponsors" = colDef(width = 80)</span>
<span id="cb50-215"><a href="#cb50-215" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb50-216"><a href="#cb50-216" aria-hidden="true" tabindex="-1"></a>    columnGroups = list(</span>
<span id="cb50-217"><a href="#cb50-217" aria-hidden="true" tabindex="-1"></a>      colGroup(name = "Latest Action",</span>
<span id="cb50-218"><a href="#cb50-218" aria-hidden="true" tabindex="-1"></a>                            columns = c("latest_action_action_date",</span>
<span id="cb50-219"><a href="#cb50-219" aria-hidden="true" tabindex="-1"></a>                                        "latest_action_text")),</span>
<span id="cb50-220"><a href="#cb50-220" aria-hidden="true" tabindex="-1"></a>      colGroup(name = "Nested Data",</span>
<span id="cb50-221"><a href="#cb50-221" aria-hidden="true" tabindex="-1"></a>                            columns = c("committees", "house_votes", </span>
<span id="cb50-222"><a href="#cb50-222" aria-hidden="true" tabindex="-1"></a>                                        "senate_votes", "actions", </span>
<span id="cb50-223"><a href="#cb50-223" aria-hidden="true" tabindex="-1"></a>                                        "sponsors", "cosponsors"))</span>
<span id="cb50-224"><a href="#cb50-224" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-225"><a href="#cb50-225" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-226"><a href="#cb50-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-227"><a href="#cb50-227" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-228"><a href="#cb50-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-229"><a href="#cb50-229" aria-hidden="true" tabindex="-1"></a>Here's a `glimpse()` of some of the nested data:</span>
<span id="cb50-230"><a href="#cb50-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-231"><a href="#cb50-231" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb50-232"><a href="#cb50-232" aria-hidden="true" tabindex="-1"></a>## Committees</span>
<span id="cb50-233"><a href="#cb50-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-236"><a href="#cb50-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-237"><a href="#cb50-237" aria-hidden="true" tabindex="-1"></a>#| label: glimpse-committees</span>
<span id="cb50-238"><a href="#cb50-238" aria-hidden="true" tabindex="-1"></a>#| echo: false</span>
<span id="cb50-239"><a href="#cb50-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-240"><a href="#cb50-240" aria-hidden="true" tabindex="-1"></a>glimpse(example_bill_df[["committees"]], width = 100)</span>
<span id="cb50-241"><a href="#cb50-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-242"><a href="#cb50-242" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-243"><a href="#cb50-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-244"><a href="#cb50-244" aria-hidden="true" tabindex="-1"></a>## Votes</span>
<span id="cb50-245"><a href="#cb50-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-248"><a href="#cb50-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-249"><a href="#cb50-249" aria-hidden="true" tabindex="-1"></a>#| label: glimpse-votes</span>
<span id="cb50-250"><a href="#cb50-250" aria-hidden="true" tabindex="-1"></a>#| echo: false</span>
<span id="cb50-251"><a href="#cb50-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-252"><a href="#cb50-252" aria-hidden="true" tabindex="-1"></a>glimpse(example_bill_df[["house_votes"]], width = 90)</span>
<span id="cb50-253"><a href="#cb50-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-254"><a href="#cb50-254" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-255"><a href="#cb50-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-256"><a href="#cb50-256" aria-hidden="true" tabindex="-1"></a>## Actions</span>
<span id="cb50-257"><a href="#cb50-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-260"><a href="#cb50-260" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-261"><a href="#cb50-261" aria-hidden="true" tabindex="-1"></a>#| label: glimpse-actio</span>
<span id="cb50-262"><a href="#cb50-262" aria-hidden="true" tabindex="-1"></a>#| echo: false</span>
<span id="cb50-263"><a href="#cb50-263" aria-hidden="true" tabindex="-1"></a>glimpse(example_bill_df[["actions"]], width = 80)</span>
<span id="cb50-264"><a href="#cb50-264" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-265"><a href="#cb50-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-266"><a href="#cb50-266" aria-hidden="true" tabindex="-1"></a>## Sponsors</span>
<span id="cb50-267"><a href="#cb50-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-270"><a href="#cb50-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-271"><a href="#cb50-271" aria-hidden="true" tabindex="-1"></a>#| label: glimpse-sponsors</span>
<span id="cb50-272"><a href="#cb50-272" aria-hidden="true" tabindex="-1"></a>#| echo: false</span>
<span id="cb50-273"><a href="#cb50-273" aria-hidden="true" tabindex="-1"></a>glimpse(example_bill_df[["sponsors"]], width = 70)</span>
<span id="cb50-274"><a href="#cb50-274" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-275"><a href="#cb50-275" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb50-276"><a href="#cb50-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-277"><a href="#cb50-277" aria-hidden="true" tabindex="-1"></a># From XML to Data Frame</span>
<span id="cb50-278"><a href="#cb50-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-279"><a href="#cb50-279" aria-hidden="true" tabindex="-1"></a>How your XML is structured, and how you want to structure your tabular output will determine how you need to process the XML file. In general, this will involve the following steps:</span>
<span id="cb50-280"><a href="#cb50-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-281"><a href="#cb50-281" aria-hidden="true" tabindex="-1"></a>1.  Select the XML nodes you want to include in your dataset.</span>
<span id="cb50-282"><a href="#cb50-282" aria-hidden="true" tabindex="-1"></a>2.  Convert the XML to a list.</span>
<span id="cb50-283"><a href="#cb50-283" aria-hidden="true" tabindex="-1"></a>3.  `flatten()` the list into a data frame.</span>
<span id="cb50-284"><a href="#cb50-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-285"><a href="#cb50-285" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb50-286"><a href="#cb50-286" aria-hidden="true" tabindex="-1"></a>## Write Functions</span>
<span id="cb50-287"><a href="#cb50-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-288"><a href="#cb50-288" aria-hidden="true" tabindex="-1"></a>If you find yourself doing similar transformations in multiple cases or copy-pasting some piece of code more than once, I would implore you to write functions because they:</span>
<span id="cb50-289"><a href="#cb50-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-290"><a href="#cb50-290" aria-hidden="true" tabindex="-1"></a>1.  make your code more reliable</span>
<span id="cb50-291"><a href="#cb50-291" aria-hidden="true" tabindex="-1"></a>2.  make you think critically about how you're modifying the data</span>
<span id="cb50-292"><a href="#cb50-292" aria-hidden="true" tabindex="-1"></a>3.  are easier to debug</span>
<span id="cb50-293"><a href="#cb50-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-294"><a href="#cb50-294" aria-hidden="true" tabindex="-1"></a>A good resource to start learning about writing functions is [How to Write a Function in R](https://www.earthdatascience.org/courses/earth-analytics/automate-science-workflows/write-function-r-programming/).</span>
<span id="cb50-295"><a href="#cb50-295" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb50-296"><a href="#cb50-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-297"><a href="#cb50-297" aria-hidden="true" tabindex="-1"></a>## Convert an XML nodeset to a data frame</span>
<span id="cb50-298"><a href="#cb50-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-299"><a href="#cb50-299" aria-hidden="true" tabindex="-1"></a>When converting XML into a data frame, one of the simplest cases to deal with is a set of nodes which each have a single value. You can think of singular nodes as the contents of a single cell in a data frame. When your data are entirely made up of nodes like this, you can convert XML to a data frame using two functions from `{XML}`:</span>
<span id="cb50-300"><a href="#cb50-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-301"><a href="#cb50-301" aria-hidden="true" tabindex="-1"></a>-   `xmlParse()` parses an XML file into an R structure[^9] representing the XML tree</span>
<span id="cb50-302"><a href="#cb50-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-303"><a href="#cb50-303" aria-hidden="true" tabindex="-1"></a>-   `xmlToDataFrame()` extracts data from an XML document directly into a data frame, but with limited flexibility</span>
<span id="cb50-304"><a href="#cb50-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-305"><a href="#cb50-305" aria-hidden="true" tabindex="-1"></a>[^9]: When you're working with both the `{XML}` and `{xml2}` libraries, it is important to note that their functions often rely on different object types. In the case of `xmlToDataFrame()`, it does not take `{xml_document}` or `{xml_node}` objects. If you try to use them, you'll see an error like this:</span>
<span id="cb50-306"><a href="#cb50-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-307"><a href="#cb50-307" aria-hidden="true" tabindex="-1"></a>    ```{r}</span>
<span id="cb50-308"><a href="#cb50-308" aria-hidden="true" tabindex="-1"></a>    #| label: xml-df-error</span>
<span id="cb50-309"><a href="#cb50-309" aria-hidden="true" tabindex="-1"></a>    #| error: true</span>
<span id="cb50-310"><a href="#cb50-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-311"><a href="#cb50-311" aria-hidden="true" tabindex="-1"></a>    xmlToDataFrame(bill_xml)</span>
<span id="cb50-312"><a href="#cb50-312" aria-hidden="true" tabindex="-1"></a>    ```</span>
<span id="cb50-313"><a href="#cb50-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-314"><a href="#cb50-314" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb50-315"><a href="#cb50-315" aria-hidden="true" tabindex="-1"></a>## Note</span>
<span id="cb50-316"><a href="#cb50-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-317"><a href="#cb50-317" aria-hidden="true" tabindex="-1"></a>In the example below, we need to use `getNodeSet(., [path =] "//bill")` to select only nodes in `&lt;<span class="kw">bill</span>&gt;`. If we just passed `bill_xml_parse`, we would get a dataframe with two rows because the top-level nodes are bill and the metadata identifier node `&lt;<span class="kw">dublinCore</span>&gt;`.</span>
<span id="cb50-318"><a href="#cb50-318" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb50-319"><a href="#cb50-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-322"><a href="#cb50-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-323"><a href="#cb50-323" aria-hidden="true" tabindex="-1"></a>#| label: xml-to-df</span>
<span id="cb50-324"><a href="#cb50-324" aria-hidden="true" tabindex="-1"></a># First we need to use xmlParse function to create XMLDocument object</span>
<span id="cb50-325"><a href="#cb50-325" aria-hidden="true" tabindex="-1"></a>bill_xml_parse = xmlParse(bill_xml)</span>
<span id="cb50-326"><a href="#cb50-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-327"><a href="#cb50-327" aria-hidden="true" tabindex="-1"></a>xmlToDataFrame(getNodeSet(bill_xml_parse, "//bill")) %&gt;% </span>
<span id="cb50-328"><a href="#cb50-328" aria-hidden="true" tabindex="-1"></a>  glimpse()</span>
<span id="cb50-329"><a href="#cb50-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-330"><a href="#cb50-330" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-331"><a href="#cb50-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-332"><a href="#cb50-332" aria-hidden="true" tabindex="-1"></a>Because the congressional data has elements like `committees`, `actions`, and `sponsors` which contain multiple sub-elements, the contents are combined into single columns. When parsing nested XML like this, it might require multiple steps to get the data into a [tidy data](https://vita.had.co.nz/papers/tidy-data.html) frame.</span>
<span id="cb50-333"><a href="#cb50-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-334"><a href="#cb50-334" aria-hidden="true" tabindex="-1"></a>In this case, the first step is to isolate singular elements like `billNumber` and `billType`, and deal with nested elements individually afterwards.</span>
<span id="cb50-335"><a href="#cb50-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-336"><a href="#cb50-336" aria-hidden="true" tabindex="-1"></a>Singular elements are nodes which meet two criteria:</span>
<span id="cb50-337"><a href="#cb50-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-338"><a href="#cb50-338" aria-hidden="true" tabindex="-1"></a>1.  the node does not have any child nodes of its own, and</span>
<span id="cb50-339"><a href="#cb50-339" aria-hidden="true" tabindex="-1"></a>2.  the node is not an empty string.</span>
<span id="cb50-340"><a href="#cb50-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-341"><a href="#cb50-341" aria-hidden="true" tabindex="-1"></a>We can use `xml_find_all()` to filter an XML document with [XPath](https://www.w3schools.com/xml/xml_parser.asp) (XML Path Language). The XPATH expression selects the nodes which match the given path or pattern[^10] in a similar way as regular expressions. As the function's help file says, "XPath is like regular expressions for trees".</span>
<span id="cb50-342"><a href="#cb50-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-343"><a href="#cb50-343" aria-hidden="true" tabindex="-1"></a>[^10]: [A very useful table of XPath syntax](https://www.w3schools.com/XML/xpath_syntax.asp){target="_blank"}</span>
<span id="cb50-344"><a href="#cb50-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-345"><a href="#cb50-345" aria-hidden="true" tabindex="-1"></a>In the code below the `[` expressions within the square brackets `]` are called predicates which I use to find nodes which have no children with the XPath `count` function and nodes which are not empty strings[^11]. This returns an `{xml_nodeset}` which can be coerced to a list using `as_list()`.</span>
<span id="cb50-346"><a href="#cb50-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-347"><a href="#cb50-347" aria-hidden="true" tabindex="-1"></a>[^11]: In the process of writing this, I discovered that using XPath made this \~5x faster than an equivalent function in R.</span>
<span id="cb50-348"><a href="#cb50-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-349"><a href="#cb50-349" aria-hidden="true" tabindex="-1"></a>    ```{r}</span>
<span id="cb50-350"><a href="#cb50-350" aria-hidden="true" tabindex="-1"></a>    #| label: singular-nodes</span>
<span id="cb50-351"><a href="#cb50-351" aria-hidden="true" tabindex="-1"></a>    #| code-fold: show</span>
<span id="cb50-352"><a href="#cb50-352" aria-hidden="true" tabindex="-1"></a>    # Function to select singular child nodes from XML node</span>
<span id="cb50-353"><a href="#cb50-353" aria-hidden="true" tabindex="-1"></a>    xml_singular_nodes = function(xml_node){</span>
<span id="cb50-354"><a href="#cb50-354" aria-hidden="true" tabindex="-1"></a>      # Return child nodes of current node</span>
<span id="cb50-355"><a href="#cb50-355" aria-hidden="true" tabindex="-1"></a>      child_nodes = xml_children(xml_node)</span>
<span id="cb50-356"><a href="#cb50-356" aria-hidden="true" tabindex="-1"></a>      # Select child nodes with 0 children</span>
<span id="cb50-357"><a href="#cb50-357" aria-hidden="true" tabindex="-1"></a>      zero_length_child_nodes = child_nodes[xml_length(child_nodes) == 0]</span>
<span id="cb50-358"><a href="#cb50-358" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb50-359"><a href="#cb50-359" aria-hidden="true" tabindex="-1"></a>      # Keep the nodes which are not empty strings</span>
<span id="cb50-360"><a href="#cb50-360" aria-hidden="true" tabindex="-1"></a>      keep(zero_length_child_nodes, ~(xml_text(.) != ""))</span>
<span id="cb50-361"><a href="#cb50-361" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb50-362"><a href="#cb50-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-363"><a href="#cb50-363" aria-hidden="true" tabindex="-1"></a>    ```</span>
<span id="cb50-364"><a href="#cb50-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-365"><a href="#cb50-365" aria-hidden="true" tabindex="-1"></a>    ```{r}</span>
<span id="cb50-366"><a href="#cb50-366" aria-hidden="true" tabindex="-1"></a>    #| label: bench-node-selection</span>
<span id="cb50-367"><a href="#cb50-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-368"><a href="#cb50-368" aria-hidden="true" tabindex="-1"></a>    # Using XPath:</span>
<span id="cb50-369"><a href="#cb50-369" aria-hidden="true" tabindex="-1"></a>    # singular_nodes1 = xml_find_all(bill_xml, </span>
<span id="cb50-370"><a href="#cb50-370" aria-hidden="true" tabindex="-1"></a>    #                                 "//bill/*[count(./*) = 0 and not(string-length(.) = 0)]")</span>
<span id="cb50-371"><a href="#cb50-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-372"><a href="#cb50-372" aria-hidden="true" tabindex="-1"></a>    # Using R function:</span>
<span id="cb50-373"><a href="#cb50-373" aria-hidden="true" tabindex="-1"></a>    # singular_nodes2 = xml_singular_nodes(bill_node)</span>
<span id="cb50-374"><a href="#cb50-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-375"><a href="#cb50-375" aria-hidden="true" tabindex="-1"></a>    # Check they are the same</span>
<span id="cb50-376"><a href="#cb50-376" aria-hidden="true" tabindex="-1"></a>    # all.equal(singular_nodes1, singular_nodes2)</span>
<span id="cb50-377"><a href="#cb50-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-378"><a href="#cb50-378" aria-hidden="true" tabindex="-1"></a>    # benchmark the two different ways of selecting nodes</span>
<span id="cb50-379"><a href="#cb50-379" aria-hidden="true" tabindex="-1"></a>    microbenchmark::microbenchmark(</span>
<span id="cb50-380"><a href="#cb50-380" aria-hidden="true" tabindex="-1"></a>      xml_singular_nodes = xml_singular_nodes(bill_node),</span>
<span id="cb50-381"><a href="#cb50-381" aria-hidden="true" tabindex="-1"></a>      xml_find_all = xml_find_all(bill_xml, "//bill/*[count(./*) = 0 and not(string-length(.) = 0)]")</span>
<span id="cb50-382"><a href="#cb50-382" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-383"><a href="#cb50-383" aria-hidden="true" tabindex="-1"></a>    ```</span>
<span id="cb50-384"><a href="#cb50-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-387"><a href="#cb50-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-388"><a href="#cb50-388" aria-hidden="true" tabindex="-1"></a>#| label: singular-nodes-list</span>
<span id="cb50-389"><a href="#cb50-389" aria-hidden="true" tabindex="-1"></a>#| code-fold: show</span>
<span id="cb50-390"><a href="#cb50-390" aria-hidden="true" tabindex="-1"></a>singular_nodes = xml_find_all(bill_xml, </span>
<span id="cb50-391"><a href="#cb50-391" aria-hidden="true" tabindex="-1"></a>                              # //bill/* selects the child nodes in a bill</span>
<span id="cb50-392"><a href="#cb50-392" aria-hidden="true" tabindex="-1"></a>                              "//bill/*[count(./*) = 0 and not(string-length(.) = 0)]")</span>
<span id="cb50-393"><a href="#cb50-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-394"><a href="#cb50-394" aria-hidden="true" tabindex="-1"></a>(singular_list = as_list(singular_nodes)) %&gt;% </span>
<span id="cb50-395"><a href="#cb50-395" aria-hidden="true" tabindex="-1"></a>  glimpse()</span>
<span id="cb50-396"><a href="#cb50-396" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-397"><a href="#cb50-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-398"><a href="#cb50-398" aria-hidden="true" tabindex="-1"></a>Now that we have the data we want in a list, we can flatten each element in the list into a **d**ata **f**rame **c**olumn using purrr's `flatten_dfc()`. However, notice the elements in a `singular_list` are not named. If we flatten this list to a data frame, our columns also won't have any column names. We can use `xml_name()` to create a character vector of the nodes' names in combination with `setNames()` to create a named list. Just make sure `singular_list` and `singular_nodes` are the same length and in the same order.</span>
<span id="cb50-399"><a href="#cb50-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-402"><a href="#cb50-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-403"><a href="#cb50-403" aria-hidden="true" tabindex="-1"></a>#| label: singular-nodes-list-named</span>
<span id="cb50-404"><a href="#cb50-404" aria-hidden="true" tabindex="-1"></a>#| code-fold: show</span>
<span id="cb50-405"><a href="#cb50-405" aria-hidden="true" tabindex="-1"></a>singular_list_named = setNames(singular_list, </span>
<span id="cb50-406"><a href="#cb50-406" aria-hidden="true" tabindex="-1"></a>                                xml_name(singular_nodes))</span>
<span id="cb50-407"><a href="#cb50-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-408"><a href="#cb50-408" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-409"><a href="#cb50-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-410"><a href="#cb50-410" aria-hidden="true" tabindex="-1"></a>When flattened, a named list becomes a data frame with column names in tow.</span>
<span id="cb50-411"><a href="#cb50-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-414"><a href="#cb50-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-415"><a href="#cb50-415" aria-hidden="true" tabindex="-1"></a>(bill_df = flatten_dfc(singular_list_named)) %&gt;% </span>
<span id="cb50-416"><a href="#cb50-416" aria-hidden="true" tabindex="-1"></a>  glimpse()</span>
<span id="cb50-417"><a href="#cb50-417" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-418"><a href="#cb50-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-419"><a href="#cb50-419" aria-hidden="true" tabindex="-1"></a>With the singular nodes transformed, we have the base of our data frame. The next step is to choose a nested element, define its structure in the output, and transform the XML accordingly.</span>
<span id="cb50-420"><a href="#cb50-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-423"><a href="#cb50-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-424"><a href="#cb50-424" aria-hidden="true" tabindex="-1"></a>#| label: singular-nodes-rt</span>
<span id="cb50-425"><a href="#cb50-425" aria-hidden="true" tabindex="-1"></a>#| column: page</span>
<span id="cb50-426"><a href="#cb50-426" aria-hidden="true" tabindex="-1"></a>#| echo: false</span>
<span id="cb50-427"><a href="#cb50-427" aria-hidden="true" tabindex="-1"></a>#| eval: false</span>
<span id="cb50-428"><a href="#cb50-428" aria-hidden="true" tabindex="-1"></a>reactable(bill_df,</span>
<span id="cb50-429"><a href="#cb50-429" aria-hidden="true" tabindex="-1"></a>          theme = moke_rt(),</span>
<span id="cb50-430"><a href="#cb50-430" aria-hidden="true" tabindex="-1"></a>            columns = list(</span>
<span id="cb50-431"><a href="#cb50-431" aria-hidden="true" tabindex="-1"></a>              "constitutional_authority_statement_text" = colDef(show=F),</span>
<span id="cb50-432"><a href="#cb50-432" aria-hidden="true" tabindex="-1"></a>              "create_date" = colDef(format = colFormat(date = T), width = 100),</span>
<span id="cb50-433"><a href="#cb50-433" aria-hidden="true" tabindex="-1"></a>              "update_date" = colDef(format = colFormat(date = T), width = 100),</span>
<span id="cb50-434"><a href="#cb50-434" aria-hidden="true" tabindex="-1"></a>              "introduced_date" = colDef(format = colFormat(date = T), width = 120),</span>
<span id="cb50-435"><a href="#cb50-435" aria-hidden="true" tabindex="-1"></a>              "congress" = colDef(width = 90),</span>
<span id="cb50-436"><a href="#cb50-436" aria-hidden="true" tabindex="-1"></a>              "origin_chamber" = colDef(show=F),</span>
<span id="cb50-437"><a href="#cb50-437" aria-hidden="true" tabindex="-1"></a>              "version" = colDef(show=F, width = 80),</span>
<span id="cb50-438"><a href="#cb50-438" aria-hidden="true" tabindex="-1"></a>              "bill_number" = colDef(width = 105),</span>
<span id="cb50-439"><a href="#cb50-439" aria-hidden="true" tabindex="-1"></a>              "bill_type" = colDef(width = 85),</span>
<span id="cb50-440"><a href="#cb50-440" aria-hidden="true" tabindex="-1"></a>              "title" = colDef(minWidth = 180)</span>
<span id="cb50-441"><a href="#cb50-441" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb50-442"><a href="#cb50-442" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-443"><a href="#cb50-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-444"><a href="#cb50-444" aria-hidden="true" tabindex="-1"></a># Dealing with nested data</span>
<span id="cb50-445"><a href="#cb50-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-446"><a href="#cb50-446" aria-hidden="true" tabindex="-1"></a>In congressional XML data, the actions and votes on a bill are stored in containers. To collect this information and keep our dataset at the bill-level, we can transform each container into data frames using the same steps as before and then assign them as a list columns in our `bill_df` data frame.</span>
<span id="cb50-447"><a href="#cb50-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-448"><a href="#cb50-448" aria-hidden="true" tabindex="-1"></a>## Transforming nested data into list columns</span>
<span id="cb50-449"><a href="#cb50-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-450"><a href="#cb50-450" aria-hidden="true" tabindex="-1"></a>Actions are stored in a container node where each `&lt;<span class="kw">item</span>&gt;` represents a congressional action taken for a bill, such as being introduced, sent to a committee, debated on the floor, etc. Just as before, we use `as_list()` to convert the `{xml_nodeset}` to a list.</span>
<span id="cb50-451"><a href="#cb50-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-454"><a href="#cb50-454" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-455"><a href="#cb50-455" aria-hidden="true" tabindex="-1"></a>#| label: actions-list</span>
<span id="cb50-456"><a href="#cb50-456" aria-hidden="true" tabindex="-1"></a>#| code-fold: show</span>
<span id="cb50-457"><a href="#cb50-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-458"><a href="#cb50-458" aria-hidden="true" tabindex="-1"></a>actions_xml = xml_find_all(bill_node, "actions/item")</span>
<span id="cb50-459"><a href="#cb50-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-460"><a href="#cb50-460" aria-hidden="true" tabindex="-1"></a>actions_list = as_list(actions_xml)</span>
<span id="cb50-461"><a href="#cb50-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-462"><a href="#cb50-462" aria-hidden="true" tabindex="-1"></a># Look at first action</span>
<span id="cb50-463"><a href="#cb50-463" aria-hidden="true" tabindex="-1"></a>glimpse(actions_list[[1]], width = 50)</span>
<span id="cb50-464"><a href="#cb50-464" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-465"><a href="#cb50-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-466"><a href="#cb50-466" aria-hidden="true" tabindex="-1"></a>For an individual action, we have the date, a list of committees related to the action, some administrative information, the text and type of action. To deal with this, we can write a function (or set of functions) like the ones below to transform actions from a list to a data frame with their own nested elements.</span>
<span id="cb50-467"><a href="#cb50-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-470"><a href="#cb50-470" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-471"><a href="#cb50-471" aria-hidden="true" tabindex="-1"></a>#| label: actions-functions</span>
<span id="cb50-472"><a href="#cb50-472" aria-hidden="true" tabindex="-1"></a>#| code-fold: true</span>
<span id="cb50-473"><a href="#cb50-473" aria-hidden="true" tabindex="-1"></a>#| code-summary: "View Functions"</span>
<span id="cb50-474"><a href="#cb50-474" aria-hidden="true" tabindex="-1"></a># Helper function: flatten_dfc_rename</span>
<span id="cb50-475"><a href="#cb50-475" aria-hidden="true" tabindex="-1"></a># flatten a list to data frame and </span>
<span id="cb50-476"><a href="#cb50-476" aria-hidden="true" tabindex="-1"></a># rename the columns with a given prefix</span>
<span id="cb50-477"><a href="#cb50-477" aria-hidden="true" tabindex="-1"></a>flatten_dfc_rename = function(list_to_flatten, </span>
<span id="cb50-478"><a href="#cb50-478" aria-hidden="true" tabindex="-1"></a>                          name_prefix = "prefix"){</span>
<span id="cb50-479"><a href="#cb50-479" aria-hidden="true" tabindex="-1"></a>  rename_with(</span>
<span id="cb50-480"><a href="#cb50-480" aria-hidden="true" tabindex="-1"></a>    .data = flatten_dfc(list_to_flatten), </span>
<span id="cb50-481"><a href="#cb50-481" aria-hidden="true" tabindex="-1"></a>    .fn = ~str_c(name_prefix, "_", .),</span>
<span id="cb50-482"><a href="#cb50-482" aria-hidden="true" tabindex="-1"></a>    # Exclude columns which already start with the prefix</span>
<span id="cb50-483"><a href="#cb50-483" aria-hidden="true" tabindex="-1"></a>    .cols = -starts_with(name_prefix)</span>
<span id="cb50-484"><a href="#cb50-484" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-485"><a href="#cb50-485" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-486"><a href="#cb50-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-487"><a href="#cb50-487" aria-hidden="true" tabindex="-1"></a># Function: parse_action</span>
<span id="cb50-488"><a href="#cb50-488" aria-hidden="true" tabindex="-1"></a># Parse actions from list to data frame</span>
<span id="cb50-489"><a href="#cb50-489" aria-hidden="true" tabindex="-1"></a>parse_action = function(action){</span>
<span id="cb50-490"><a href="#cb50-490" aria-hidden="true" tabindex="-1"></a>  action %&gt;% </span>
<span id="cb50-491"><a href="#cb50-491" aria-hidden="true" tabindex="-1"></a>    # Flatten + rename sourceSystem elements</span>
<span id="cb50-492"><a href="#cb50-492" aria-hidden="true" tabindex="-1"></a>    map_at("sourceSystem", ~flatten_dfc_rename(.x, "source")) %&gt;% </span>
<span id="cb50-493"><a href="#cb50-493" aria-hidden="true" tabindex="-1"></a>    # Flatten + rename committees</span>
<span id="cb50-494"><a href="#cb50-494" aria-hidden="true" tabindex="-1"></a>    map_at("committees", function(committee){</span>
<span id="cb50-495"><a href="#cb50-495" aria-hidden="true" tabindex="-1"></a>      # using map_at and map_dfr to create a data frame row for each committee</span>
<span id="cb50-496"><a href="#cb50-496" aria-hidden="true" tabindex="-1"></a>      map_dfr(committee, ~flatten_dfc_rename(.x, "committee"))</span>
<span id="cb50-497"><a href="#cb50-497" aria-hidden="true" tabindex="-1"></a>    }) %&gt;% </span>
<span id="cb50-498"><a href="#cb50-498" aria-hidden="true" tabindex="-1"></a>    # Flatten object to data frame</span>
<span id="cb50-499"><a href="#cb50-499" aria-hidden="true" tabindex="-1"></a>    flatten_dfc_rename(., "action") %&gt;% </span>
<span id="cb50-500"><a href="#cb50-500" aria-hidden="true" tabindex="-1"></a>    # Lastly, clean the names</span>
<span id="cb50-501"><a href="#cb50-501" aria-hidden="true" tabindex="-1"></a>    janitor::clean_names()</span>
<span id="cb50-502"><a href="#cb50-502" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-503"><a href="#cb50-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-504"><a href="#cb50-504" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-505"><a href="#cb50-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-508"><a href="#cb50-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-509"><a href="#cb50-509" aria-hidden="true" tabindex="-1"></a>#| label: benchmark-parse-action</span>
<span id="cb50-510"><a href="#cb50-510" aria-hidden="true" tabindex="-1"></a>#| eval: false</span>
<span id="cb50-511"><a href="#cb50-511" aria-hidden="true" tabindex="-1"></a>#| include: false</span>
<span id="cb50-512"><a href="#cb50-512" aria-hidden="true" tabindex="-1"></a># Test modify_at vs map_at</span>
<span id="cb50-513"><a href="#cb50-513" aria-hidden="true" tabindex="-1"></a>parse_action2 = function(action){</span>
<span id="cb50-514"><a href="#cb50-514" aria-hidden="true" tabindex="-1"></a>  action %&gt;% </span>
<span id="cb50-515"><a href="#cb50-515" aria-hidden="true" tabindex="-1"></a>    # Flatten+rename  sourceSystem elements</span>
<span id="cb50-516"><a href="#cb50-516" aria-hidden="true" tabindex="-1"></a>    modify_at("sourceSystem", ~flatten_dfc_rename(.x, "source")) %&gt;% </span>
<span id="cb50-517"><a href="#cb50-517" aria-hidden="true" tabindex="-1"></a>    # Flatten+rename committees</span>
<span id="cb50-518"><a href="#cb50-518" aria-hidden="true" tabindex="-1"></a>    modify_at("committees", function(committee){</span>
<span id="cb50-519"><a href="#cb50-519" aria-hidden="true" tabindex="-1"></a>      map_dfr(committee, ~flatten_dfc_rename(.x, "committee"))</span>
<span id="cb50-520"><a href="#cb50-520" aria-hidden="true" tabindex="-1"></a>    }) %&gt;% </span>
<span id="cb50-521"><a href="#cb50-521" aria-hidden="true" tabindex="-1"></a>    # Flatten object to data frame</span>
<span id="cb50-522"><a href="#cb50-522" aria-hidden="true" tabindex="-1"></a>    flatten_dfc_rename(., "action") %&gt;% </span>
<span id="cb50-523"><a href="#cb50-523" aria-hidden="true" tabindex="-1"></a>    janitor::clean_names()</span>
<span id="cb50-524"><a href="#cb50-524" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-525"><a href="#cb50-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-526"><a href="#cb50-526" aria-hidden="true" tabindex="-1"></a># Parse the first action</span>
<span id="cb50-527"><a href="#cb50-527" aria-hidden="true" tabindex="-1"></a>parse_action2(actions_list[[1]])</span>
<span id="cb50-528"><a href="#cb50-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-529"><a href="#cb50-529" aria-hidden="true" tabindex="-1"></a># What about speed?</span>
<span id="cb50-530"><a href="#cb50-530" aria-hidden="true" tabindex="-1"></a>microbenchmark::microbenchmark(</span>
<span id="cb50-531"><a href="#cb50-531" aria-hidden="true" tabindex="-1"></a>  parse_action = parse_action(actions_list[[1]]),</span>
<span id="cb50-532"><a href="#cb50-532" aria-hidden="true" tabindex="-1"></a>  parse_action2 = parse_action2(actions_list[[1]]), times = 1000</span>
<span id="cb50-533"><a href="#cb50-533" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-534"><a href="#cb50-534" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-535"><a href="#cb50-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-536"><a href="#cb50-536" aria-hidden="true" tabindex="-1"></a>Using the `{purrr}` library's `map_dfr()`, we apply this function to each action and combine the results into **d**ata **f**rame **r**ows. Here's the output of this process:</span>
<span id="cb50-537"><a href="#cb50-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-540"><a href="#cb50-540" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-541"><a href="#cb50-541" aria-hidden="true" tabindex="-1"></a># Parse the first action</span>
<span id="cb50-542"><a href="#cb50-542" aria-hidden="true" tabindex="-1"></a>(actions_df = map_dfr(actions_list, parse_action)) %&gt;% </span>
<span id="cb50-543"><a href="#cb50-543" aria-hidden="true" tabindex="-1"></a>  glimpse()</span>
<span id="cb50-544"><a href="#cb50-544" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-545"><a href="#cb50-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-546"><a href="#cb50-546" aria-hidden="true" tabindex="-1"></a>When you plan to combine rows into a data frame or `unnest()` the data in the future, it is useful to be explicit about the expected data types of each column. This can be done using `type_convert()`. Because we are only adding a single row of data to `bill_df` we can encase the actions in a list and use dollar assignment. If you were adding multiple rows of data, you would need to make sure that you are adding a column of the same length as `bill_df`.</span>
<span id="cb50-547"><a href="#cb50-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-550"><a href="#cb50-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-551"><a href="#cb50-551" aria-hidden="true" tabindex="-1"></a>#| label: actions-dfr</span>
<span id="cb50-552"><a href="#cb50-552" aria-hidden="true" tabindex="-1"></a>#| code-fold: show</span>
<span id="cb50-553"><a href="#cb50-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-554"><a href="#cb50-554" aria-hidden="true" tabindex="-1"></a># Specify column data types</span>
<span id="cb50-555"><a href="#cb50-555" aria-hidden="true" tabindex="-1"></a>actions_col_types = cols(</span>
<span id="cb50-556"><a href="#cb50-556" aria-hidden="true" tabindex="-1"></a>  action_date = col_date(),</span>
<span id="cb50-557"><a href="#cb50-557" aria-hidden="true" tabindex="-1"></a>  action_time = col_time(),</span>
<span id="cb50-558"><a href="#cb50-558" aria-hidden="true" tabindex="-1"></a>  action_committee_systemCode = col_character(), </span>
<span id="cb50-559"><a href="#cb50-559" aria-hidden="true" tabindex="-1"></a>  action_committee_name = col_character(), </span>
<span id="cb50-560"><a href="#cb50-560" aria-hidden="true" tabindex="-1"></a>  action_source_code = col_character(),</span>
<span id="cb50-561"><a href="#cb50-561" aria-hidden="true" tabindex="-1"></a>  action_source_name = col_character(),</span>
<span id="cb50-562"><a href="#cb50-562" aria-hidden="true" tabindex="-1"></a>  action_text = col_character(), </span>
<span id="cb50-563"><a href="#cb50-563" aria-hidden="true" tabindex="-1"></a>  action_type = col_character(), </span>
<span id="cb50-564"><a href="#cb50-564" aria-hidden="true" tabindex="-1"></a>  action_code = col_character()</span>
<span id="cb50-565"><a href="#cb50-565" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-566"><a href="#cb50-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-567"><a href="#cb50-567" aria-hidden="true" tabindex="-1"></a># Convert column types</span>
<span id="cb50-568"><a href="#cb50-568" aria-hidden="true" tabindex="-1"></a>actions_df = type_convert(actions_df,</span>
<span id="cb50-569"><a href="#cb50-569" aria-hidden="true" tabindex="-1"></a>                          col_types = actions_col_types)</span>
<span id="cb50-570"><a href="#cb50-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-571"><a href="#cb50-571" aria-hidden="true" tabindex="-1"></a># Assign actions as data frame within a list</span>
<span id="cb50-572"><a href="#cb50-572" aria-hidden="true" tabindex="-1"></a>bill_df$actions = list(actions_df)</span>
<span id="cb50-573"><a href="#cb50-573" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-574"><a href="#cb50-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-577"><a href="#cb50-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-578"><a href="#cb50-578" aria-hidden="true" tabindex="-1"></a>#| eval: false</span>
<span id="cb50-579"><a href="#cb50-579" aria-hidden="true" tabindex="-1"></a>#| include: false</span>
<span id="cb50-580"><a href="#cb50-580" aria-hidden="true" tabindex="-1"></a>#| echo: false</span>
<span id="cb50-581"><a href="#cb50-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-582"><a href="#cb50-582" aria-hidden="true" tabindex="-1"></a>bill_actions = xml_find_all(actions_node, "item")</span>
<span id="cb50-583"><a href="#cb50-583" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-584"><a href="#cb50-584" aria-hidden="true" tabindex="-1"></a>bill_action_counts = as_list(xml_find_all(actions_node, "./*[not(self::item)]")) %&gt;%</span>
<span id="cb50-585"><a href="#cb50-585" aria-hidden="true" tabindex="-1"></a>  map_dfc(flatten_dfc) %&gt;% </span>
<span id="cb50-586"><a href="#cb50-586" aria-hidden="true" tabindex="-1"></a>  rename_with(.cols = everything(), ~str_c("actions_", .)) %&gt;% </span>
<span id="cb50-587"><a href="#cb50-587" aria-hidden="true" tabindex="-1"></a>  pivot_longer(everything(), names_to = "action", names_prefix = "actions_", values_to = "count")</span>
<span id="cb50-588"><a href="#cb50-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-589"><a href="#cb50-589" aria-hidden="true" tabindex="-1"></a># Coerce nodes to list</span>
<span id="cb50-590"><a href="#cb50-590" aria-hidden="true" tabindex="-1"></a>actions_df = as_list(bill_actions) %&gt;% </span>
<span id="cb50-591"><a href="#cb50-591" aria-hidden="true" tabindex="-1"></a>  map_dfr(parse_action) %&gt;% </span>
<span id="cb50-592"><a href="#cb50-592" aria-hidden="true" tabindex="-1"></a>  type_convert(col_types = col_specs$actions)</span>
<span id="cb50-593"><a href="#cb50-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-594"><a href="#cb50-594" aria-hidden="true" tabindex="-1"></a>bill_df$actions = list(actions_df)</span>
<span id="cb50-595"><a href="#cb50-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-596"><a href="#cb50-596" aria-hidden="true" tabindex="-1"></a>bill_df$action_counts = list(type_convert(bill_action_counts,</span>
<span id="cb50-597"><a href="#cb50-597" aria-hidden="true" tabindex="-1"></a>                                          col_types = cols(action = col_character(), count = col_integer())))</span>
<span id="cb50-598"><a href="#cb50-598" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-599"><a href="#cb50-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-600"><a href="#cb50-600" aria-hidden="true" tabindex="-1"></a>## When they put XML in your XML</span>
<span id="cb50-601"><a href="#cb50-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-602"><a href="#cb50-602" aria-hidden="true" tabindex="-1"></a>So we've dealt with cases with multiple child elements, but you can also have links to XML files within those child elements as you can see in the `&lt;<span class="kw">url</span>&gt;` element below.[^12]</span>
<span id="cb50-603"><a href="#cb50-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-604"><a href="#cb50-604" aria-hidden="true" tabindex="-1"></a>[^12]: ![They heard you like XML so they put XML in your XML](https://c.tenor.com/um2EhyMQyR8AAAAC/xzibit-meme.gif){width="267"}</span>
<span id="cb50-605"><a href="#cb50-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-608"><a href="#cb50-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-609"><a href="#cb50-609" aria-hidden="true" tabindex="-1"></a>#| label: vote-nodes-contents</span>
<span id="cb50-610"><a href="#cb50-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-611"><a href="#cb50-611" aria-hidden="true" tabindex="-1"></a># Find recordedVote nodes inside recordedVote container</span>
<span id="cb50-612"><a href="#cb50-612" aria-hidden="true" tabindex="-1"></a>bill_recorded_vote_nodes = xml_find_all(</span>
<span id="cb50-613"><a href="#cb50-613" aria-hidden="true" tabindex="-1"></a>  bill_node, </span>
<span id="cb50-614"><a href="#cb50-614" aria-hidden="true" tabindex="-1"></a>  "recordedVotes/recordedVote"</span>
<span id="cb50-615"><a href="#cb50-615" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-616"><a href="#cb50-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-617"><a href="#cb50-617" aria-hidden="true" tabindex="-1"></a># Look at the nodeset contents</span>
<span id="cb50-618"><a href="#cb50-618" aria-hidden="true" tabindex="-1"></a>xml_contents(bill_recorded_vote_nodes)</span>
<span id="cb50-619"><a href="#cb50-619" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-620"><a href="#cb50-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-621"><a href="#cb50-621" aria-hidden="true" tabindex="-1"></a>Before we dive one level deeper, to start building our vote-level data frame, we can convert the top-level nodes to a list and flatten it into columns.</span>
<span id="cb50-622"><a href="#cb50-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-625"><a href="#cb50-625" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-626"><a href="#cb50-626" aria-hidden="true" tabindex="-1"></a>#| label: vote-nodes-df</span>
<span id="cb50-627"><a href="#cb50-627" aria-hidden="true" tabindex="-1"></a># Coerce nodes to list</span>
<span id="cb50-628"><a href="#cb50-628" aria-hidden="true" tabindex="-1"></a>recorded_votes_list = as_list(bill_recorded_vote_nodes)</span>
<span id="cb50-629"><a href="#cb50-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-630"><a href="#cb50-630" aria-hidden="true" tabindex="-1"></a>(recorded_votes_df = map_dfr(recorded_votes_list, flatten_dfc)) %&gt;% </span>
<span id="cb50-631"><a href="#cb50-631" aria-hidden="true" tabindex="-1"></a>  glimpse()</span>
<span id="cb50-632"><a href="#cb50-632" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-633"><a href="#cb50-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-634"><a href="#cb50-634" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb50-635"><a href="#cb50-635" aria-hidden="true" tabindex="-1"></a>## Note</span>
<span id="cb50-636"><a href="#cb50-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-637"><a href="#cb50-637" aria-hidden="true" tabindex="-1"></a>We use `flatten_dfc()` to flatten each vote element into a data frame as columns and then `map_dfr()` rolls them all up as rows into a single data frame.</span>
<span id="cb50-638"><a href="#cb50-638" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb50-639"><a href="#cb50-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-640"><a href="#cb50-640" aria-hidden="true" tabindex="-1"></a>Now we want to get the vote roll XML file, so we'll need to use `read_xml()` . There are two main nodes - `&lt;<span class="kw">vote-metadata</span>&gt;` and `&lt;<span class="kw">vote-data</span>&gt;`. One node contains the aggregated vote information, while `&lt;<span class="kw">vote-data</span>&gt;` contains the legislator-level vote data. Let's parse the legislator-level data first. Here is the XML for a single legislator's vote:</span>
<span id="cb50-641"><a href="#cb50-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-644"><a href="#cb50-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-645"><a href="#cb50-645" aria-hidden="true" tabindex="-1"></a>#| label: vote-roll-xml</span>
<span id="cb50-646"><a href="#cb50-646" aria-hidden="true" tabindex="-1"></a>vote_roll_xml = read_xml(recorded_votes_df$url)</span>
<span id="cb50-647"><a href="#cb50-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-648"><a href="#cb50-648" aria-hidden="true" tabindex="-1"></a>vote_data = xml_find_all(vote_roll_xml, "vote-data")</span>
<span id="cb50-649"><a href="#cb50-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-650"><a href="#cb50-650" aria-hidden="true" tabindex="-1"></a>vote_legislators = vote_data %&gt;% </span>
<span id="cb50-651"><a href="#cb50-651" aria-hidden="true" tabindex="-1"></a>  xml_find_all("recorded-vote")</span>
<span id="cb50-652"><a href="#cb50-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-653"><a href="#cb50-653" aria-hidden="true" tabindex="-1"></a>(legislators_list = as_list(vote_legislators))[1] %&gt;% </span>
<span id="cb50-654"><a href="#cb50-654" aria-hidden="true" tabindex="-1"></a>  glimpse()</span>
<span id="cb50-655"><a href="#cb50-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-656"><a href="#cb50-656" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-657"><a href="#cb50-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-658"><a href="#cb50-658" aria-hidden="true" tabindex="-1"></a>With a similar combination of `as_list()` , `flatten_dfr()`, and `unnest()` we can flatten the XML into one row per legislator but we lose all the attributes.</span>
<span id="cb50-659"><a href="#cb50-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-662"><a href="#cb50-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-663"><a href="#cb50-663" aria-hidden="true" tabindex="-1"></a>#| label: vote-roll-data-flat</span>
<span id="cb50-664"><a href="#cb50-664" aria-hidden="true" tabindex="-1"></a>(vote_roll_flattened = vote_data %&gt;% </span>
<span id="cb50-665"><a href="#cb50-665" aria-hidden="true" tabindex="-1"></a>  as_list() %&gt;% </span>
<span id="cb50-666"><a href="#cb50-666" aria-hidden="true" tabindex="-1"></a>  flatten_dfr() %&gt;% </span>
<span id="cb50-667"><a href="#cb50-667" aria-hidden="true" tabindex="-1"></a>    unnest(everything()))</span>
<span id="cb50-668"><a href="#cb50-668" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-669"><a href="#cb50-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-670"><a href="#cb50-670" aria-hidden="true" tabindex="-1"></a>Instead we'll need to extract the attributes before we flatten the data. We want to extract the attributes only for legislator using `map()` to apply `map_at()` on each legislator element and extract the attributes from each while retaining the value in `vote`. It can often feel like you're getting lost in a list of lists, but with some experimentation you'll be able to find your way back to the surface.</span>
<span id="cb50-671"><a href="#cb50-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-674"><a href="#cb50-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-675"><a href="#cb50-675" aria-hidden="true" tabindex="-1"></a>#| label: vote-roll-leg-df</span>
<span id="cb50-676"><a href="#cb50-676" aria-hidden="true" tabindex="-1"></a>(legislator_vote_df = legislators_list %&gt;% </span>
<span id="cb50-677"><a href="#cb50-677" aria-hidden="true" tabindex="-1"></a>    # Modify one level deeper using map_at to target legislator elements</span>
<span id="cb50-678"><a href="#cb50-678" aria-hidden="true" tabindex="-1"></a>    map(map_at, "legislator", attributes) %&gt;% </span>
<span id="cb50-679"><a href="#cb50-679" aria-hidden="true" tabindex="-1"></a>    map_dfr(flatten_dfc))</span>
<span id="cb50-680"><a href="#cb50-680" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-681"><a href="#cb50-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-682"><a href="#cb50-682" aria-hidden="true" tabindex="-1"></a>Now we have a table of legislator voting data! But what about the `&lt;<span class="kw">vote-metadata</span>&gt;`? Everything other than the `&lt;<span class="kw">vote-totals</span>&gt;` element is singular so we can get that out of the way the same way as before:</span>
<span id="cb50-683"><a href="#cb50-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-686"><a href="#cb50-686" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-687"><a href="#cb50-687" aria-hidden="true" tabindex="-1"></a>#| label: vote-roll-metadata-xml</span>
<span id="cb50-688"><a href="#cb50-688" aria-hidden="true" tabindex="-1"></a>vote_metadata = xml_find_all(vote_roll_xml, "vote-metadata")</span>
<span id="cb50-689"><a href="#cb50-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-690"><a href="#cb50-690" aria-hidden="true" tabindex="-1"></a>vote_singular_nodes = xml_singular_nodes(vote_metadata)</span>
<span id="cb50-691"><a href="#cb50-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-692"><a href="#cb50-692" aria-hidden="true" tabindex="-1"></a>(vote_df = as_list(vote_singular_nodes) %&gt;% </span>
<span id="cb50-693"><a href="#cb50-693" aria-hidden="true" tabindex="-1"></a>  # as_list() doesn't retain element names so we set names ourselves</span>
<span id="cb50-694"><a href="#cb50-694" aria-hidden="true" tabindex="-1"></a>  setNames(xml_name(vote_singular_nodes)) %&gt;% </span>
<span id="cb50-695"><a href="#cb50-695" aria-hidden="true" tabindex="-1"></a>  flatten_dfc()) %&gt;% </span>
<span id="cb50-696"><a href="#cb50-696" aria-hidden="true" tabindex="-1"></a>  glimpse()</span>
<span id="cb50-697"><a href="#cb50-697" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-698"><a href="#cb50-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-699"><a href="#cb50-699" aria-hidden="true" tabindex="-1"></a>The `&lt;<span class="kw">vote-totals</span>&gt;` are a bit of a unique little element, with 3 different types of nodes. This is another opportunity for us to be choosy with our data. The first node is table headers, which we don't need because the elements are tagged anyway. From these, we really only need the `&lt;<span class="kw">totals-by-party</span>&gt;` nodes as long as the totals of which agree with `&lt;<span class="kw">totals-by-vote</span>&gt;` , which is worth checking.</span>
<span id="cb50-700"><a href="#cb50-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-703"><a href="#cb50-703" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-704"><a href="#cb50-704" aria-hidden="true" tabindex="-1"></a>#| label: vote-roll-metadata-totals-contents</span>
<span id="cb50-705"><a href="#cb50-705" aria-hidden="true" tabindex="-1"></a>#| message: false</span>
<span id="cb50-706"><a href="#cb50-706" aria-hidden="true" tabindex="-1"></a>#| layout-nrow: 1</span>
<span id="cb50-707"><a href="#cb50-707" aria-hidden="true" tabindex="-1"></a>(vote_totals = xml_find_all(vote_metadata, "vote-totals")) %&gt;% </span>
<span id="cb50-708"><a href="#cb50-708" aria-hidden="true" tabindex="-1"></a>  xml_contents()</span>
<span id="cb50-709"><a href="#cb50-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-710"><a href="#cb50-710" aria-hidden="true" tabindex="-1"></a>vote_totals_by_party = xml_find_all(vote_totals, "totals-by-party")</span>
<span id="cb50-711"><a href="#cb50-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-712"><a href="#cb50-712" aria-hidden="true" tabindex="-1"></a>party_vote_totals_df = as_list(vote_totals_by_party) %&gt;% </span>
<span id="cb50-713"><a href="#cb50-713" aria-hidden="true" tabindex="-1"></a>  map_dfr(flatten_dfc) %&gt;% </span>
<span id="cb50-714"><a href="#cb50-714" aria-hidden="true" tabindex="-1"></a>    type_convert()</span>
<span id="cb50-715"><a href="#cb50-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-716"><a href="#cb50-716" aria-hidden="true" tabindex="-1"></a>(totals_by_vote = xml_find_all(vote_totals, "totals-by-vote")) %&gt;% </span>
<span id="cb50-717"><a href="#cb50-717" aria-hidden="true" tabindex="-1"></a>  xml_contents()</span>
<span id="cb50-718"><a href="#cb50-718" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-719"><a href="#cb50-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-720"><a href="#cb50-720" aria-hidden="true" tabindex="-1"></a>Once we have our nodeset (which at last are all singular), we use the same listing, mapping, and flattening...or *lappening* as absolutely no one calls it.</span>
<span id="cb50-721"><a href="#cb50-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-724"><a href="#cb50-724" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-725"><a href="#cb50-725" aria-hidden="true" tabindex="-1"></a>#| eval: false</span>
<span id="cb50-726"><a href="#cb50-726" aria-hidden="true" tabindex="-1"></a>#| include: false</span>
<span id="cb50-727"><a href="#cb50-727" aria-hidden="true" tabindex="-1"></a># Check if totals match</span>
<span id="cb50-728"><a href="#cb50-728" aria-hidden="true" tabindex="-1"></a>as_list(totals_by_vote) %&gt;% </span>
<span id="cb50-729"><a href="#cb50-729" aria-hidden="true" tabindex="-1"></a>  map_dfr(flatten_dfc)</span>
<span id="cb50-730"><a href="#cb50-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-731"><a href="#cb50-731" aria-hidden="true" tabindex="-1"></a>summarise(party_vote_totals, </span>
<span id="cb50-732"><a href="#cb50-732" aria-hidden="true" tabindex="-1"></a>          across(.cols = -party, sum, na.rm=T))</span>
<span id="cb50-733"><a href="#cb50-733" aria-hidden="true" tabindex="-1"></a># They do!</span>
<span id="cb50-734"><a href="#cb50-734" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-735"><a href="#cb50-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-736"><a href="#cb50-736" aria-hidden="true" tabindex="-1"></a>Now that we have all of our vote data wrangled from the thorny grasp of XML, we can put it all together and nest it until we've gotten back to the bill-level i.e. the vote roll data frame goes in the votes data frame, which goes in the bill data frame.</span>
<span id="cb50-737"><a href="#cb50-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-740"><a href="#cb50-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-741"><a href="#cb50-741" aria-hidden="true" tabindex="-1"></a>#| label: vote-roll-build</span>
<span id="cb50-742"><a href="#cb50-742" aria-hidden="true" tabindex="-1"></a>vote_roll_df = vote_df %&gt;% </span>
<span id="cb50-743"><a href="#cb50-743" aria-hidden="true" tabindex="-1"></a>  mutate(legislator_votes = list(legislator_vote_df),</span>
<span id="cb50-744"><a href="#cb50-744" aria-hidden="true" tabindex="-1"></a>         party_votes = list(party_vote_totals_df)) %&gt;% </span>
<span id="cb50-745"><a href="#cb50-745" aria-hidden="true" tabindex="-1"></a>    janitor::clean_names()</span>
<span id="cb50-746"><a href="#cb50-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-747"><a href="#cb50-747" aria-hidden="true" tabindex="-1"></a>(recorded_votes_df = recorded_votes_df %&gt;% </span>
<span id="cb50-748"><a href="#cb50-748" aria-hidden="true" tabindex="-1"></a>  mutate(vote_roll = list(vote_roll_df))) %&gt;% </span>
<span id="cb50-749"><a href="#cb50-749" aria-hidden="true" tabindex="-1"></a>  glimpse()</span>
<span id="cb50-750"><a href="#cb50-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-751"><a href="#cb50-751" aria-hidden="true" tabindex="-1"></a>bill_df$votes = list(recorded_votes_df)</span>
<span id="cb50-752"><a href="#cb50-752" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-753"><a href="#cb50-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-754"><a href="#cb50-754" aria-hidden="true" tabindex="-1"></a>Now we have the bill-level characteristics with action and vote information nested in list columns. If we want to analyze the actions data, we simply have to `unnest()` it.</span>
<span id="cb50-755"><a href="#cb50-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-758"><a href="#cb50-758" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-759"><a href="#cb50-759" aria-hidden="true" tabindex="-1"></a>#| label: unnest-actions</span>
<span id="cb50-760"><a href="#cb50-760" aria-hidden="true" tabindex="-1"></a>unnest(bill_df, actions) %&gt;% </span>
<span id="cb50-761"><a href="#cb50-761" aria-hidden="true" tabindex="-1"></a>  glimpse()</span>
<span id="cb50-762"><a href="#cb50-762" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-763"><a href="#cb50-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-764"><a href="#cb50-764" aria-hidden="true" tabindex="-1"></a>I'll stop there for brevity's sake, but you can find the code for extracting the full XML file [here](https://github.com/MokeEire/my-reps/blob/master/R/parsing_functions.R)[^13].</span>
<span id="cb50-765"><a href="#cb50-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-766"><a href="#cb50-766" aria-hidden="true" tabindex="-1"></a>[^13]: Ctrl/Cmd+F: `extract_bill_status`</span>
<span id="cb50-767"><a href="#cb50-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-768"><a href="#cb50-768" aria-hidden="true" tabindex="-1"></a># TL;DR: Main Points</span>
<span id="cb50-769"><a href="#cb50-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-770"><a href="#cb50-770" aria-hidden="true" tabindex="-1"></a>Transforming XML into a tabular format can be tricky depending on the structure. Start by understanding how the data is organized, what you want it to look like, and what level of detail you are looking at.</span>
<span id="cb50-771"><a href="#cb50-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-772"><a href="#cb50-772" aria-hidden="true" tabindex="-1"></a>1.  **Explore the structure**</span>
<span id="cb50-773"><a href="#cb50-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-774"><a href="#cb50-774" aria-hidden="true" tabindex="-1"></a>&gt; Look through any available documentation, always. When you read in the XML file, functions like `xmlParse()`, `xml_structure()`, and `xml_contents()` will show you the structure you're dealing with.</span>
<span id="cb50-775"><a href="#cb50-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-776"><a href="#cb50-776" aria-hidden="true" tabindex="-1"></a>2.  **Define the output**</span>
<span id="cb50-777"><a href="#cb50-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-778"><a href="#cb50-778" aria-hidden="true" tabindex="-1"></a>&gt; Consider what you want the output to look like and think about how the data needs to be transformed to match this.</span>
<span id="cb50-779"><a href="#cb50-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-780"><a href="#cb50-780" aria-hidden="true" tabindex="-1"></a>3.  **Process a single element** (write a function if it gets too complicated)</span>
<span id="cb50-781"><a href="#cb50-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-782"><a href="#cb50-782" aria-hidden="true" tabindex="-1"></a>&gt; Get one element into the form you want. Writing functions can help you think through the data transformations being applied and make your code easier to read.</span>
<span id="cb50-783"><a href="#cb50-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-784"><a href="#cb50-784" aria-hidden="true" tabindex="-1"></a>4.  **Apply to all elements**</span>
<span id="cb50-785"><a href="#cb50-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-786"><a href="#cb50-786" aria-hidden="true" tabindex="-1"></a>&gt; Focus on processing the entire file (or the subset of the file you're interested in). You might want an XML file to return a single row, a single column, or a data frame of size $n\times k$. Once you have a single file returned in the format you want, you can combine the outputs of all the files in your dataset.</span>
<span id="cb50-787"><a href="#cb50-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-788"><a href="#cb50-788" aria-hidden="true" tabindex="-1"></a>Please reach out with any questions or feedback! All is welcome, and there may even be a reward for anyone who finds a mistake in the code.</span>
<span id="cb50-789"><a href="#cb50-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-792"><a href="#cb50-792" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-793"><a href="#cb50-793" aria-hidden="true" tabindex="-1"></a>#| eval: false</span>
<span id="cb50-794"><a href="#cb50-794" aria-hidden="true" tabindex="-1"></a>#| include: false</span>
<span id="cb50-795"><a href="#cb50-795" aria-hidden="true" tabindex="-1"></a>parse_vote_roll = function(vote, logger, bill_type, bill_num){</span>
<span id="cb50-796"><a href="#cb50-796" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-797"><a href="#cb50-797" aria-hidden="true" tabindex="-1"></a>  tryCatch(</span>
<span id="cb50-798"><a href="#cb50-798" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb50-799"><a href="#cb50-799" aria-hidden="true" tabindex="-1"></a>      vote_xml = read_xml(vote, options = "RECOVER")</span>
<span id="cb50-800"><a href="#cb50-800" aria-hidden="true" tabindex="-1"></a>      vote_data = xml_find_all(vote_xml, "vote-data")</span>
<span id="cb50-801"><a href="#cb50-801" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb50-802"><a href="#cb50-802" aria-hidden="true" tabindex="-1"></a>      vote_roll_children = xml_children(vote_roll_xml)</span>
<span id="cb50-803"><a href="#cb50-803" aria-hidden="true" tabindex="-1"></a>      vote_data = xml_find_all(vote_roll_xml, "vote-data")</span>
<span id="cb50-804"><a href="#cb50-804" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb50-805"><a href="#cb50-805" aria-hidden="true" tabindex="-1"></a>      # Vote data</span>
<span id="cb50-806"><a href="#cb50-806" aria-hidden="true" tabindex="-1"></a>      vote_legislators = vote_data %&gt;% </span>
<span id="cb50-807"><a href="#cb50-807" aria-hidden="true" tabindex="-1"></a>        xml_find_all("recorded-vote")</span>
<span id="cb50-808"><a href="#cb50-808" aria-hidden="true" tabindex="-1"></a>      legislators_list = as_list(vote_legislators)</span>
<span id="cb50-809"><a href="#cb50-809" aria-hidden="true" tabindex="-1"></a>      legislator_vote_df = legislators_list %&gt;% </span>
<span id="cb50-810"><a href="#cb50-810" aria-hidden="true" tabindex="-1"></a>        # Modify one level deeper using map_at to target legislator elements</span>
<span id="cb50-811"><a href="#cb50-811" aria-hidden="true" tabindex="-1"></a>        map(map_at, "legislator", attributes) %&gt;% </span>
<span id="cb50-812"><a href="#cb50-812" aria-hidden="true" tabindex="-1"></a>        map_dfr(flatten_dfc)</span>
<span id="cb50-813"><a href="#cb50-813" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb50-814"><a href="#cb50-814" aria-hidden="true" tabindex="-1"></a>      # Vote metadata</span>
<span id="cb50-815"><a href="#cb50-815" aria-hidden="true" tabindex="-1"></a>      vote_metadata = xml_find_all(vote_roll_xml, "vote-metadata")</span>
<span id="cb50-816"><a href="#cb50-816" aria-hidden="true" tabindex="-1"></a>      vote_singular_nodes = xml_singular_nodes(vote_metadata)</span>
<span id="cb50-817"><a href="#cb50-817" aria-hidden="true" tabindex="-1"></a>      (vote_df = as_list(vote_singular_nodes) %&gt;% </span>
<span id="cb50-818"><a href="#cb50-818" aria-hidden="true" tabindex="-1"></a>          # as_list() doesn't retain element names so we set names ourselves</span>
<span id="cb50-819"><a href="#cb50-819" aria-hidden="true" tabindex="-1"></a>          setNames(xml_name(vote_singular_nodes)) %&gt;% </span>
<span id="cb50-820"><a href="#cb50-820" aria-hidden="true" tabindex="-1"></a>          flatten_dfc())</span>
<span id="cb50-821"><a href="#cb50-821" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb50-822"><a href="#cb50-822" aria-hidden="true" tabindex="-1"></a>      # Vote totals</span>
<span id="cb50-823"><a href="#cb50-823" aria-hidden="true" tabindex="-1"></a>      vote_totals = xml_find_all(vote_metadata, "vote-totals")</span>
<span id="cb50-824"><a href="#cb50-824" aria-hidden="true" tabindex="-1"></a>      vote_totals_by_party = xml_find_all(vote_totals, "totals-by-party")</span>
<span id="cb50-825"><a href="#cb50-825" aria-hidden="true" tabindex="-1"></a>      party_vote_totals_df = vote_totals_by_party %&gt;% </span>
<span id="cb50-826"><a href="#cb50-826" aria-hidden="true" tabindex="-1"></a>        as_list() %&gt;% </span>
<span id="cb50-827"><a href="#cb50-827" aria-hidden="true" tabindex="-1"></a>        map_dfr(flatten_dfc) %&gt;% </span>
<span id="cb50-828"><a href="#cb50-828" aria-hidden="true" tabindex="-1"></a>        type_convert()</span>
<span id="cb50-829"><a href="#cb50-829" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb50-830"><a href="#cb50-830" aria-hidden="true" tabindex="-1"></a>      vote_roll_df = vote_df %&gt;% </span>
<span id="cb50-831"><a href="#cb50-831" aria-hidden="true" tabindex="-1"></a>        mutate(legislator_votes = list(legislator_vote_df),</span>
<span id="cb50-832"><a href="#cb50-832" aria-hidden="true" tabindex="-1"></a>               party_votes = list(party_vote_totals_df)) %&gt;% </span>
<span id="cb50-833"><a href="#cb50-833" aria-hidden="true" tabindex="-1"></a>        janitor::clean_names()</span>
<span id="cb50-834"><a href="#cb50-834" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb50-835"><a href="#cb50-835" aria-hidden="true" tabindex="-1"></a>      vote_list = as_list(vote_data)</span>
<span id="cb50-836"><a href="#cb50-836" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb50-837"><a href="#cb50-837" aria-hidden="true" tabindex="-1"></a>      flatten_dfr(vote_list) %&gt;% </span>
<span id="cb50-838"><a href="#cb50-838" aria-hidden="true" tabindex="-1"></a>        unnest(everything())</span>
<span id="cb50-839"><a href="#cb50-839" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb50-840"><a href="#cb50-840" aria-hidden="true" tabindex="-1"></a>    error=function(cond) {</span>
<span id="cb50-841"><a href="#cb50-841" aria-hidden="true" tabindex="-1"></a>      log_info(logger, </span>
<span id="cb50-842"><a href="#cb50-842" aria-hidden="true" tabindex="-1"></a>               bill_type = bill_type,</span>
<span id="cb50-843"><a href="#cb50-843" aria-hidden="true" tabindex="-1"></a>               bill_num = bill_num, </span>
<span id="cb50-844"><a href="#cb50-844" aria-hidden="true" tabindex="-1"></a>               "ERROR: Vote roll could not be parsed")</span>
<span id="cb50-845"><a href="#cb50-845" aria-hidden="true" tabindex="-1"></a>      # Choose a return value in case of error</span>
<span id="cb50-846"><a href="#cb50-846" aria-hidden="true" tabindex="-1"></a>      return(tibble())</span>
<span id="cb50-847"><a href="#cb50-847" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb50-848"><a href="#cb50-848" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-849"><a href="#cb50-849" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-850"><a href="#cb50-850" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-851"><a href="#cb50-851" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-852"><a href="#cb50-852" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb50-853"><a href="#cb50-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-854"><a href="#cb50-854" aria-hidden="true" tabindex="-1"></a># Other helpful articles</span>
<span id="cb50-855"><a href="#cb50-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-856"><a href="#cb50-856" aria-hidden="true" tabindex="-1"></a>Here are some of the helpful articles I came across in the course of writing this:</span>
<span id="cb50-857"><a href="#cb50-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-858"><a href="#cb50-858" aria-hidden="true" tabindex="-1"></a>-   [From XML to Excel for Data Analysis](https://towardsdatascience.com/from-xml-to-excel-for-data-analysis-ac0c0c765b7d "Introduction to Processing XML In Python")</span>
<span id="cb50-859"><a href="#cb50-859" aria-hidden="true" tabindex="-1"></a>-   [Reading XML files in R](https://medium.com/geekculture/reading-xml-files-in-r-3122c3a2a8d9)</span>
<span id="cb50-860"><a href="#cb50-860" aria-hidden="true" tabindex="-1"></a>-   [Converting nested XML to dataframe in R](https://urbandatapalette.com/post/2021-03-xml-dataframe-r/)</span>
<span id="cb50-861"><a href="#cb50-861" aria-hidden="true" tabindex="-1"></a>-   [Parse and process XML (and HTML) with xml2](https://www.rstudio.com/blog/xml2/)</span>
<span id="cb50-862"><a href="#cb50-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-863"><a href="#cb50-863" aria-hidden="true" tabindex="-1"></a># Session Info</span>
<span id="cb50-864"><a href="#cb50-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-865"><a href="#cb50-865" aria-hidden="true" tabindex="-1"></a>Version information about R, OS, and loaded packages.</span>
<span id="cb50-866"><a href="#cb50-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-869"><a href="#cb50-869" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-870"><a href="#cb50-870" aria-hidden="true" tabindex="-1"></a>#| label: session-info</span>
<span id="cb50-871"><a href="#cb50-871" aria-hidden="true" tabindex="-1"></a>#| echo: false</span>
<span id="cb50-872"><a href="#cb50-872" aria-hidden="true" tabindex="-1"></a>sessioninfo::session_info("loaded")</span>
<span id="cb50-873"><a href="#cb50-873" aria-hidden="true" tabindex="-1"></a>```</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, Mark Barrett</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/Mmm_JuicyFruit">
      <i class="bi bi-twitter" role="img" aria-label="twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MokeEire">
      <i class="bi bi-github" role="img" aria-label="github">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>