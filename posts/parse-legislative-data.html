<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.615">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2022-07-14">
<title>Mark Barrett - Parsing XML with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="../site_libs/core-js-2.5.3/shim.min.js"></script><script src="../site_libs/react-17.0.0/react.min.js"></script><script src="../site_libs/react-17.0.0/react-dom.min.js"></script><script src="../site_libs/reactwidget-1.0.0/react-tools.js"></script><script src="../site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="../site_libs/reactable-binding-0.3.0/reactable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="../styles.css">
</head>
<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Mark Barrett</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html">Blog</a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/Mmm_JuicyFruit"><i class="bi bi-twitter" role="img" aria-label="twitter">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MokeEire"><i class="bi bi-github" role="img" aria-label="github">
</i> 
 </a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Parsing XML with R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Untangling congressional legislative data</p>
  <div class="quarto-categories">
    <div class="quarto-category">data</div>
    <div class="quarto-category">governance</div>
    <div class="quarto-category">R</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 14, 2022</p>
    </div>
  </div>
    
  </div>
  

</header><div class="cell">

</div>
<p>If you work with data regularly, you have probably used data formats like Excel spreadsheets, text files, relational databases and if you’re reading this potentially XML too. XML, or (e)Xtensible Markup Language, is a storage format designed for flexibly transmitting data<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> which often leads to a bit of a hassle when trying to parse it for use in analytics. If you’re still reading, the good news is that this article should provide an understanding of XML and a set of steps for processing an XML file with R into a more analysis-friendly format.</p>
<div class="callout-tip callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
What you’ll learn:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Load and parse XML files in R using the <a href="http://www.omegahat.net/RSXML/">XML</a> and <a href="https://xml2.r-lib.org/">xml2</a> packages</p></li>
<li><p>Explore the structure of XML documents</p></li>
<li><p>List, map, and flatten your data into a tabular format</p></li>
</ul>
</div>
</div>
<p>I’ll be using the US government’s congressional bill data as an example. As always the first step of data analysis is to check if any documentation exists and thankfully <a href="https://www.govinfo.gov/">govinfo</a> has provided some <a href="https://github.com/usgpo/bill-status/blob/main/BILLSTATUS-XML_User_User-Guide.md">guidance</a> for how the data is stored.</p>
<p>To follow along, you can download the sample XML file <a href="https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml" title="HR-391: Global Health Security Act of 2021">here</a>. The sample bill (chosen only because it contains examples of important elements) is <a href="https://www.govinfo.gov/app/details/BILLS-117hr391rfs"><em>HR-391: Global Health Security Act of 2021</em></a> and the XML file contains information about its sponsors and cosponsors, votes on the bill, and the committees that considered it.</p>
<p>Here’s a sample of the XML:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (28)}
 [1] &lt;billNumber&gt;391&lt;/billNumber&gt;
 [2] &lt;createDate&gt;2021-01-22T08:12:10Z&lt;/createDate&gt;
 [3] &lt;updateDate&gt;2022-02-09T12:37:52Z&lt;/updateDate&gt;
 [4] &lt;originChamber&gt;House&lt;/originChamber&gt;
 [5] &lt;billType&gt;HR&lt;/billType&gt;
 [6] &lt;introducedDate&gt;2021-01-21&lt;/introducedDate&gt;
 [7] &lt;congress&gt;117&lt;/congress&gt;
 [8] &lt;constitutionalAuthorityStatementText&gt;&lt;![CDATA[&lt;pre&gt;[Congressional Recor ...
 [9] &lt;recordedVotes&gt;\n  &lt;recordedVote&gt;\n    &lt;rollNumber&gt;188&lt;/rollNumber&gt;\n    ...
[10] &lt;committees&gt;\n  &lt;billCommittees&gt;\n    &lt;item&gt;\n      &lt;systemCode&gt;ssfr00&lt;/ ...
[11] &lt;committeeReports/&gt;
[12] &lt;relatedBills/&gt;
[13] &lt;actions&gt;\n  &lt;item&gt;\n    &lt;actionDate&gt;2021-07-12&lt;/actionDate&gt;\n    &lt;commi ...
[14] &lt;sponsors&gt;\n  &lt;item&gt;\n    &lt;bioguideId&gt;C001078&lt;/bioguideId&gt;\n    &lt;fullNam ...
[15] &lt;cosponsors&gt;\n  &lt;item&gt;\n    &lt;bioguideId&gt;C000266&lt;/bioguideId&gt;\n    &lt;fullN ...
[16] &lt;cboCostEstimates&gt;\n  &lt;item&gt;\n    &lt;pubDate&gt;2021-05-11T15:11:11Z&lt;/pubDate ...
[17] &lt;laws/&gt;
[18] &lt;notes/&gt;
[19] &lt;policyArea&gt;\n  &lt;name&gt;International Affairs&lt;/name&gt;\n&lt;/policyArea&gt;
[20] &lt;subjects&gt;\n  &lt;billSubjects&gt;\n    &lt;legislativeSubjects&gt;\n      &lt;item&gt;\n  ...
...</code></pre>
</div>
</div>
<p>Above is an example of how votes recorded on the bill are stored. The <code>&lt;recordedVotes&gt;</code> container can have multiple <code>&lt;recordedVote&gt;</code> elements which describe a vote taken on the bill<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<section id="read-xml-data-with-r" class="level1"><h1>Read XML data with R</h1>
<p>We’ll load the <a href="http://www.omegahat.net/RSXML/">XML</a> and <a href="https://xml2.r-lib.org/">xml2</a> packages to read in our XML file. Between these two libraries there are numerous ways to load in and process XML data. I strongly suggest looking through the packages’ help files to find the right function for your task. I also load the <a href="https://tidyverse.tidyverse.org">tidyverse</a> package because it’s generally exceedingly useful.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.omegahat.net/RSXML/">XML</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://xml2.r-lib.org/">xml2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">bill_xml_file</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml</a></span><span class="op">(</span><span class="st">"https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml()</a></code> returns an <code>xml_document</code><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> object. With this, we can look at the bill’s top level nodes.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Look at the contents</span></span>
<span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="va">bill_xml_file</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (2)}
[1] &lt;bill&gt;\n  &lt;billNumber&gt;391&lt;/billNumber&gt;\n  &lt;createDate&gt;2021-01-22T08:12:10 ...
[2] &lt;dublinCore xmlns:dc="http://purl.org/dc/elements/1.1/"&gt;\n  &lt;dc:format&gt;te ...</code></pre>
</div>
</div>
<p>In this case it’s actually more useful to look at the <code>&lt;bill&gt;</code> element which is a child node of our XML document<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, which is what <code><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_child()</a></code> is for.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Return child nodes named bill</span></span>
<span><span class="op">(</span><span class="va">bill_xml</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_child</a></span><span class="op">(</span><span class="va">bill_xml_file</span>, <span class="st">"bill"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_node}
&lt;bill&gt;
 [1] &lt;billNumber&gt;391&lt;/billNumber&gt;
 [2] &lt;createDate&gt;2021-01-22T08:12:10Z&lt;/createDate&gt;
 [3] &lt;updateDate&gt;2022-02-09T12:37:52Z&lt;/updateDate&gt;
 [4] &lt;originChamber&gt;House&lt;/originChamber&gt;
 [5] &lt;billType&gt;HR&lt;/billType&gt;
 [6] &lt;introducedDate&gt;2021-01-21&lt;/introducedDate&gt;
 [7] &lt;congress&gt;117&lt;/congress&gt;
 [8] &lt;constitutionalAuthorityStatementText&gt;&lt;![CDATA[&lt;pre&gt;[Congressional Recor ...
 [9] &lt;recordedVotes&gt;\n  &lt;recordedVote&gt;\n    &lt;rollNumber&gt;188&lt;/rollNumber&gt;\n    ...
[10] &lt;committees&gt;\n  &lt;billCommittees&gt;\n    &lt;item&gt;\n      &lt;systemCode&gt;ssfr00&lt;/ ...
[11] &lt;committeeReports/&gt;
[12] &lt;relatedBills/&gt;
[13] &lt;actions&gt;\n  &lt;item&gt;\n    &lt;actionDate&gt;2021-07-12&lt;/actionDate&gt;\n    &lt;commi ...
[14] &lt;sponsors&gt;\n  &lt;item&gt;\n    &lt;bioguideId&gt;C001078&lt;/bioguideId&gt;\n    &lt;fullNam ...
[15] &lt;cosponsors&gt;\n  &lt;item&gt;\n    &lt;bioguideId&gt;C000266&lt;/bioguideId&gt;\n    &lt;fullN ...
[16] &lt;cboCostEstimates&gt;\n  &lt;item&gt;\n    &lt;pubDate&gt;2021-05-11T15:11:11Z&lt;/pubDate ...
[17] &lt;laws/&gt;
[18] &lt;notes/&gt;
[19] &lt;policyArea&gt;\n  &lt;name&gt;International Affairs&lt;/name&gt;\n&lt;/policyArea&gt;
[20] &lt;subjects&gt;\n  &lt;billSubjects&gt;\n    &lt;legislativeSubjects&gt;\n      &lt;item&gt;\n  ...
...</code></pre>
</div>
</div>
<p>Parsing this file to a dataframe will require a little thought because we have a number of nodes which have multiple data points within them. However it’s always a good idea to try the simplest approach first, which is the aptly named <code><a href="https://rdrr.io/pkg/XML/man/xmlToDataFrame.html">xmlToDataFrame()</a></code>.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First you need to use the xmlParse function</span></span>
<span><span class="va">bill_xml_parse</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/XML/man/xmlTreeParse.html">xmlParse</a></span><span class="op">(</span><span class="va">bill_xml_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You can wrap a variable assignment in ( ) to print it, </span></span>
<span><span class="co"># or in this case pass it to another function via the pipe %&gt;% </span></span>
<span><span class="op">(</span> <span class="va">bill_xml_df_attempt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/XML/man/xmlToDataFrame.html">xmlToDataFrame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/XML/man/getNodeSet.html">getNodeSet</a></span><span class="op">(</span><span class="va">bill_xml_parse</span>, <span class="st">"//bill"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># View the dataframe structure</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre class="code-block-h"><code>Rows: 1
Columns: 28
$ billNumber                           &lt;chr&gt; "391"
$ createDate                           &lt;chr&gt; "2021-01-22T08:12:10Z"
$ updateDate                           &lt;chr&gt; "2022-02-09T12:37:52Z"
$ originChamber                        &lt;chr&gt; "House"
$ billType                             &lt;chr&gt; "HR"
$ introducedDate                       &lt;chr&gt; "2021-01-21"
$ congress                             &lt;chr&gt; "117"
$ constitutionalAuthorityStatementText &lt;chr&gt; "&lt;pre&gt;[Congressional Record Volum…
$ recordedVotes                        &lt;chr&gt; "188https://clerk.house.gov/evs/2…
$ committees                           &lt;chr&gt; "ssfr00Foreign Relations Committe…
$ committeeReports                     &lt;chr&gt; ""
$ relatedBills                         &lt;chr&gt; ""
$ actions                              &lt;chr&gt; "2021-07-12ssfr00Foreign Relation…
$ sponsors                             &lt;chr&gt; "C001078Rep. Connolly, Gerald E. …
$ cosponsors                           &lt;chr&gt; "C000266Rep. Chabot, Steve [R-OH-…
$ cboCostEstimates                     &lt;chr&gt; "2021-05-11T15:11:11ZH.R. 391, Gl…
$ laws                                 &lt;chr&gt; ""
$ notes                                &lt;chr&gt; ""
$ policyArea                           &lt;chr&gt; "International Affairs"
$ subjects                             &lt;chr&gt; "Advisory bodiesAnimal and plant …
$ summaries                            &lt;chr&gt; "002021-01-21Introduced in House2…
$ title                                &lt;chr&gt; "Global Health Security Act of 20…
$ titles                               &lt;chr&gt; "Display TitleGlobal Health Secur…
$ amendments                           &lt;chr&gt; ""
$ textVersions                         &lt;chr&gt; "Referred in Senate2021-07-12T04:…
$ latestAction                         &lt;chr&gt; "2021-07-12Received in the Senate…
$ calendarNumbers                      &lt;chr&gt; ""
$ version                              &lt;chr&gt; "1.0.0"</code></pre>
</div>
</div>
<p>But notice that a number of fields like <code>actions</code>, <code>committees</code>, and <code>sponsors</code> have had their values concatenated. This approach works for simpler XML structures, but in this case we need to do a little bit more work to get the data into a tidy dataframe.</p>
<p>That brings us to one of the cardinal rules of data analysis:</p>
<div class="callout-tip callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Look at your data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Look at the structure and contents of your data and understand how it is organized. This is essential for coming up with a solution to consistently process the data.</p>
</div>
</div>
</section><section id="define-the-output" class="level1 page-columns page-full"><h1>Define the output</h1>
<p>As well as looking at your data, it’s also usually helpful to look to your intended output. This determines how to transform the data.</p>
<p><strong>Example:</strong> I want the congressional data to have one row per bill, with the nested characteristics stored in list columns. This will produce a comprehensive dataset which can easily be subset and transformed to various levels of observation as needed. The end result should look like this:</p>
<div class="cell page-columns page-full">
<div class="cell-output-display column-screen-inset-shaded">

<div id="htmlwidget-a7df110d18b26b50c4f8" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a7df110d18b26b50c4f8">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"bill_number":["391"],"create_date":["2021-01-22T08:12:10Z"],"update_date":["2022-02-09T12:37:52Z"],"origin_chamber":["House"],"bill_type":["HR"],"introduced_date":["2021-01-21T00:00:00Z"],"congress":["117"],"constitutional_authority_statement_text":["<pre>[Congressional Record Volume 167, Number 17 (Thursday, January 28, 2021)][House]From the Congressional Record Online through the Government Publishing Office [<a href=\"https://www.gpo.gov\">www.gpo.gov<\/a>]By Ms. SANCHEZ:H.J. Res. 22.Congress has the power to enact this legislation pursuantto the following:Article 1 Section 8ADDITIONAL SPONSORSUnder clause 7 of rule XII, sponsors were added to public bills andresolutions, as follows:H.R. 28: Mr. Chabot, Mr. Armstrong, Mrs. Fischbach, Mr.Lucas, Mr. Mast, and Mr. Womack.H.R. 40: Mr. Kahele, Ms. Roybal-Allard, Mr. Aguilar, Ms.Waters, Mr. Vela, Mr. Sires, and Mr. Huffman.H.R. 51: Mr. Mrvan and Ms. Davids of Kansas.H.R. 55: Ms. Ross, Mr. Lynch, Mr. Larsen of Washington, Mr.Thompson of California, Ms. Manning, Ms. Jayapal, Ms. Adams,Mr. Schneider, Mr. Veasey, and Ms. Wild.H.R. 77: Mr. Grothman.H.R. 78: Mr. Smith of New Jersey, Mr. Hice of Georgia, Mr.Bucshon, Mr. Burgess, and Mr. Norman.H.R. 97: Mrs. Hayes, Mr. Welch, Mr. Torres of New York, Mr.Cicilline, and Mr. Danny K. Davis of Illinois.H.R. 147: Mr. Ryan and Mr. Brown.H.R. 197: Mr. Brendan F. Boyle of Pennsylvania and Mr.Hastings.H.R. 217: Mr. Hice of Georgia.H.R. 235: Mr. Meeks and Mr. Torres of New York.H.R. 243: Mr. Armstrong.H.R. 255: Mr. Auchincloss, Mr. DeSaulnier, Mr. Schrader,and Ms. Chu.H.R. 256: Mr. Schrader and Ms. Chu.H.R. 262: Mr. Cicilline and Mr. Torres of New York.H.R. 265: Mr. Veasey.H.R. 275: Mr. Jacobs of New York, Ms. Herrera Beutler, Mr.McCaul, Mr. Joyce of Ohio, Mrs. Bice of Oklahoma, Mr.LaMalfa, Mrs. Steel, Mr. Hill, Mr. Garbarino, Mr. Pfluger,Mr. Gimenez, and Mrs. Cammack.H.R. 279: Mr. Neguse, Mr. Crow, and Mr. DeSaulnier.H.R. 289: Mr. Perry.H.R. 295: Mr. Cloud.H.R. 302: Mr. Costa.H.R. 304: Mr. Raskin, Mr. Lynch, Mr. Carson, Ms. Norton,and Mr. Kilmer.H.R. 305: Ms. Ross, Mr. Kind, and Mr. Michael F. Doyle ofPennsylvania.H.R. 322: Mr. Wilson of South Carolina.H.R. 326: Mr. Costa.H.R. 332: Mr. Stanton and Mrs. Wagner.H.R. 349: Ms. Williams of Georgia, Ms. Brownley, Ms. BluntRochester, and Mrs. Trahan.H.R. 359: Mr. Rodney Davis of Illinois.H.R. 369: Mrs. Hayes and Ms. Schrier.H.R. 377: Mr. Rice of South Carolina and Ms. Herrell.H.R. 378: Mr. Rice of South Carolina and Ms. Herrell.H.R. 384: Mr. Cohen, Ms. Mace, Mr. Huffman, Mr. Hastings,and Ms. Eshoo.H.R. 391: Mr. DeSaulnier, Mrs. Napolitano, Ms. Chu, Mr.Harder of California, Mr. Cohen, and Mrs. Fletcher.H.R. 392: Mr. Smith of Washington, Ms. Moore of Wisconsin,Mr. Sablan, and Mr. Sires.H.R. 398: Ms. Herrell.H.R. 407: Mr. Mast.H.R. 421: Ms. Plaskett, Mr. Rush, and Mr. Correa.H.R. 426: Mr. Hagedorn, Mr. Mooney, Mr. Green of Tennessee,Mr. Norman, and Mr. Davidson.H.R. 447: Mr. DeSaulnier, Mr. Courtney, Ms. Adams, Mrs.McBath, Mr. Kinzinger, Mr. Castro of Texas, Mr. Stivers, Mr.Morelle, Mr. Smith of Washington, Mr. Khanna, Mr. Sarbanes,Ms. Norton, Ms. Stevens, Mr. Grijalva, Ms. Blunt Rochester,Mr. Cardenas, Ms. Schakowsky, Ms. Jackson Lee, Mr.Krishnamoorthi, Mr. Danny K. Davis of Illinois, Mrs. Demings,Mr. Foster, Ms. Houlahan, Mr. Moulton, Mr. Kilmer, Ms. Meng,Mr. Gallego, Mr. Brown, Mr. Suozzi, Mr. Garamendi, Mr.Neguse, Ms. McCollum, Mr. Kildee, Mrs. Beatty, Mr. Carbajal,Ms. Craig, Mr. Trone, Ms. Waters, Mr. Casten, Mrs. Bustos,Mr. Langevin, Mr. Sires, Mr. Kahele, Mr. Ryan, Ms. Underwood,Mr. Stanton, Mr. Carson, Mr. David Scott of Georgia, Ms. Leeof California, Mrs. Dingell, Mrs. Axne, Mr. Horsford, and Mr.Lamb.H.R. 448: Mr. Jones.H.R. 449: Mrs. Miller of Illinois.H.R. 450: Mrs. Miller of Illinois.H.R. 452: Mr. Nunes and Mr. Joyce of Ohio.H.R. 465: Mr. Costa and Mr. Valadao.H.R. 471: Mr. Buck, Ms. Mace, Mr. Perry, Mr. Wright, Mr.Babin, Mr. Norman, and Mr. Gibbs.H.R. 472: Mr. Feenstra.H.R. 485: Mrs. Hayes, Mr. Castro of Texas, Ms. Wild, Mr.Takano, Mr. Morelle, Mrs. Trahan, Mr. Levin of Michigan, andMs. Adams.H.R. 488: Mr. Newhouse, Mr. Stewart,[...][Page H254]<\/pre>"],"title":["Global Health Security Act of 2021"],"version":["1.0.0"],"latest_action_action_date":["2021-07-12T00:00:00Z"],"latest_action_text":["Received in the Senate and Read twice and referred to the Committee on Foreign Relations."]},"columns":[{"accessor":"bill_number","name":"bill_number","type":"character","width":100},{"accessor":"create_date","name":"create_date","type":"Date","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":95},{"accessor":"update_date","name":"update_date","type":"Date","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":95},{"accessor":"origin_chamber","name":"origin_chamber","type":"character"},{"accessor":"bill_type","name":"bill_type","type":"character","width":80},{"accessor":"introduced_date","name":"introduced_date","type":"Date","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":130},{"accessor":"congress","name":"congress","type":"character","width":80},{"accessor":"constitutional_authority_statement_text","name":"constitutional_authority_statement_text","type":"character","show":false},{"accessor":"title","name":"title","type":"character","minWidth":180},{"accessor":"version","name":"version","type":"character","width":80},{"accessor":"latest_action_action_date","name":"action_date","type":"Date","format":{"cell":{"date":true},"aggregated":{"date":true}}},{"accessor":"latest_action_text","name":"action_text","type":"character"}],"columnGroups":[{"name":"Latest Action","columns":["latest_action_action_date","latest_action_text"]}],"resizable":true,"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"compact":true,"nowrap":true,"theme":{"color":"#474d4d","backgroundColor":"#FFFFFF","borderColor":"#dddddd","borderWidth":"1px","stripedColor":"#dddddd","highlightColor":"#f0f0f0","cellPadding":"8px 12px","tableStyle":{"fontSize":14,"borderBottom":"3px solid #222222","fontFamily":"Noto Sans, sans-serif","padding":"16px 8px"},"headerStyle":{"borderWidth":"3px","paddingTop":"12px","verticalAlign":"bottom","textAlign":"bottom","background":"#FFFFFF","textTransform":"uppercase","borderColor":"#474d4d","color":"#051414","&:hover":{"background":"#dddddd"},"&[aria-sort='ascending'], &[aria-sort='descending']":{"background":"#5b5e5f","color":"#FFFFFF"},"borderColor.1":"#333","fontSize":12,"fontFamily":"Heebo Light, sans-serif"},"groupHeaderStyle":{"&:not(:empty)":{"paddingBottom":"3px","verticalAlign":"bottom","textAlign":"bottom","backgroundColor":"#FFFFFF","textTransform":"uppercase","fontSize":12,"color":"#474d4d"}},"rowSelectedStyle":{"backgroundColor":"#dddddd"},"inputStyle":{"backgroundColor":"#FFFFFF","color":"#474d4d"},"searchInputStyle":{"textTransform":"uppercase","color":"#474d4d","fontSize":"14px"},"paginationStyle":{"textTransform":"uppercase","fontSize":"14px"},"pageButtonStyle":{"textTransform":"uppercase","fontSize":"14px"}},"dataKey":"23a857e5621ccc0294f624d6bc849871"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>With the following list columns (among others):</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Committees</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Votes</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Actions</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Sponsors</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Cosponsors</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [2 × 6] (S3: tbl_df/tbl/data.frame)
  ..$ committee_system_code  : chr [1:2] "ssfr00" "hsfa00"
  ..$ committee_name         : chr [1:2] "Foreign Relations Committee" "Foreign Affairs Committee"
  ..$ committee_chamber      : chr [1:2] "Senate" "House"
  ..$ committee_type         : chr [1:2] "Standing" "Standing"
  ..$ committee_activities   :List of 2
  ..$ subcommittee_activities:List of 2</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [1 × 9] (S3: tbl_df/tbl/data.frame)
  ..$ roll_number     : chr "188"
  ..$ url             : chr "https://clerk.house.gov/evs/2021/roll188.xml"
  ..$ full_action_name: chr "Final Passage Under Suspension of the Rules Results"
  ..$ chamber         : chr "House"
  ..$ congress        : chr "117"
  ..$ date            : chr "2021-06-28T23:46:02Z"
  ..$ session_number  : chr "1"
  ..$ vote_roll       :List of 1
  ..$ roll_found      : logi FALSE</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [14 × 9] (S3: tbl_df/tbl/data.frame)
  ..$ action_date                 : Date[1:14], format: "2021-07-12" "2021-06-28" ...
  ..$ action_committee_system_code: chr [1:14] "ssfr00" NA NA NA ...
  ..$ action_committee_name       : chr [1:14] "Foreign Relations Committee" NA NA NA ...
  ..$ action_source_code          : chr [1:14] "0" "2" "2" "9" ...
  ..$ action_source_name          : chr [1:14] "Senate" "House floor actions" "House floor actions" "Library of Congress" ...
  ..$ action_text                 : chr [1:14] "Received in the Senate and Read twice and referred to the Committee on Foreign Relations." "Motion to reconsider laid on the table Agreed to without objection." "On motion to suspend the rules and pass the bill, as amended Agreed to by the Yeas and Nays: (2/3 required): 30"| __truncated__ "Passed/agreed to in House: On motion to suspend the rules and pass the bill, as amended Agreed to by the Yeas a"| __truncated__ ...
  ..$ action_type                 : Ord.factor w/ 6 levels "IntroReferral"&lt;..: 1 3 3 3 3 3 3 3 3 2 ...
  ..$ action_time                 : 'hms' num [1:14] NA 19:46:03 19:46:02 19:46:02 ...
  .. ..- attr(*, "units")= chr "secs"
  ..$ action_code                 : chr [1:14] NA "H38310" "H37300" "8000" ...</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [1 × 11] (S3: tbl_df/tbl/data.frame)
  ..$ sponsor_bioguide_id            : chr "C001078"
  ..$ sponsor_full_name              : chr "Rep. Connolly, Gerald E. [D-VA-11]"
  ..$ sponsor_first_name             : chr "Gerald"
  ..$ sponsor_middle_name            : chr "E."
  ..$ sponsor_last_name              : chr "Connolly"
  ..$ sponsor_party                  : chr "D"
  ..$ sponsor_state                  : chr "VA"
  ..$ sponsor_identifiers_lis_id     : chr "1959"
  ..$ sponsor_identifiers_bioguide_id: chr "C001078"
  ..$ sponsor_identifiers_gpo_id     : chr "8202"
  ..$ sponsor_district               : chr "11"</code></pre>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [77 × 13] (S3: tbl_df/tbl/data.frame)
  ..$ cosponsor_bioguide_id            : chr [1:77] "C000266" "W000812" "B001287" "F000466" ...
  ..$ cosponsor_full_name              : chr [1:77] "Rep. Chabot, Steve [R-OH-1]" "Rep. Wagner, Ann [R-MO-2]" "Rep. Bera, Ami [D-CA-7]" "Rep. Fitzpatrick, Brian K. [R-PA-1]" ...
  ..$ cosponsor_first_name             : chr [1:77] "STEVE" "Ann" "Ami" "Brian" ...
  ..$ cosponsor_last_name              : chr [1:77] "CHABOT" "Wagner" "Bera" "Fitzpatrick" ...
  ..$ cosponsor_party                  : chr [1:77] "R" "R" "D" "R" ...
  ..$ cosponsor_state                  : chr [1:77] "OH" "MO" "CA" "PA" ...
  ..$ cosponsor_identifiers_lis_id     : num [1:77] 186 2137 2102 2345 1675 ...
  ..$ cosponsor_identifiers_bioguide_id: chr [1:77] "C000266" "W000812" "B001287" "F000466" ...
  ..$ cosponsor_identifiers_gpo_id     : num [1:77] 8091 NA NA NA 8206 ...
  ..$ cosponsor_district               : chr [1:77] "1" "2" "7" "1" ...
  ..$ cosponsor_sponsorship_date       : Date[1:77], format: "2021-01-21" "2021-01-21" ...
  ..$ cosponsor_is_original_cosponsor  : logi [1:77] TRUE TRUE TRUE TRUE TRUE TRUE ...
  ..$ cosponsor_middle_name            : chr [1:77] NA NA NA "K." ...</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>With this output in mind and an understanding of the current data structure, we can break the parsing process down into two categories - the simple, and the not-so-simple.</p>
</section><section id="parsing" class="level1 page-columns page-full"><h1>Parsing</h1>
<section id="parse-the-simple-elements" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="parse-the-simple-elements">Parse the simple elements</h2>
<p>The simple parts of the data to process are those which are already at the level of observation you want. In our case - at the bill level. These are typically the top-level nodes which only have one piece of data. To select only these nodes we can write a function like the one below:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to select singular child nodes from XML node</span></span>
<span><span class="va">xml_singular_nodes</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xml_node</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Return child nodes of current node</span></span>
<span>  <span class="va">child_nodes</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_children</a></span><span class="op">(</span><span class="va">xml_node</span><span class="op">)</span></span>
<span>  <span class="co"># Select child nodes with 0 children</span></span>
<span>  <span class="va">zero_length_child_nodes</span> <span class="op">=</span> <span class="va">child_nodes</span><span class="op">[</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_length</a></span><span class="op">(</span><span class="va">child_nodes</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Keep the nodes which are not empty strings</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">keep</a></span><span class="op">(</span><span class="va">zero_length_child_nodes</span>, <span class="op">~</span><span class="op">(</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="op">(</span><span class="va">singular_nodes</span> <span class="op">=</span> <span class="fu">xml_singular_nodes</span><span class="op">(</span><span class="va">bill_xml</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (10)}
 [1] &lt;billNumber&gt;391&lt;/billNumber&gt;
 [2] &lt;createDate&gt;2021-01-22T08:12:10Z&lt;/createDate&gt;
 [3] &lt;updateDate&gt;2022-02-09T12:37:52Z&lt;/updateDate&gt;
 [4] &lt;originChamber&gt;House&lt;/originChamber&gt;
 [5] &lt;billType&gt;HR&lt;/billType&gt;
 [6] &lt;introducedDate&gt;2021-01-21&lt;/introducedDate&gt;
 [7] &lt;congress&gt;117&lt;/congress&gt;
 [8] &lt;constitutionalAuthorityStatementText&gt;&lt;![CDATA[&lt;pre&gt;[Congressional Recor ...
 [9] &lt;title&gt;Global Health Security Act of 2021&lt;/title&gt;
[10] &lt;version&gt;1.0.0&lt;/version&gt;</code></pre>
</div>
</div>
<p>Now with a nifty combination of <code><a href="http://xml2.r-lib.org/reference/as_list.html">as_list()</a></code>, <code><a href="http://xml2.r-lib.org/reference/xml_name.html">xml_name()</a></code>, and <code><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc()</a></code> we can convert the singular nodes into a single row of data.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bill_df</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">singular_nodes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># as_list() doesn't retain element names so we set names ourselves</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_name.html">xml_name</a></span><span class="op">(</span><span class="va">singular_nodes</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Which gives us a single row of data:</p>
<div class="cell page-columns page-full">
<div class="cell-output-display column-page">

<div id="htmlwidget-57b28b6b855da9988ff0" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-57b28b6b855da9988ff0">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"billNumber":["391"],"createDate":["2021-01-22T08:12:10Z"],"updateDate":["2022-02-09T12:37:52Z"],"originChamber":["House"],"billType":["HR"],"introducedDate":["2021-01-21"],"congress":["117"],"constitutionalAuthorityStatementText":["<pre>[Congressional Record Volume 167, Number 17 (Thursday, January 28, 2021)][House]From the Congressional Record Online through the Government Publishing Office [<a href=\"https://www.gpo.gov\">www.gpo.gov<\/a>]By Ms. SANCHEZ:H.J. Res. 22.Congress has the power to enact this legislation pursuantto the following:Article 1 Section 8ADDITIONAL SPONSORSUnder clause 7 of rule XII, sponsors were added to public bills andresolutions, as follows:H.R. 28: Mr. Chabot, Mr. Armstrong, Mrs. Fischbach, Mr.Lucas, Mr. Mast, and Mr. Womack.H.R. 40: Mr. Kahele, Ms. Roybal-Allard, Mr. Aguilar, Ms.Waters, Mr. Vela, Mr. Sires, and Mr. Huffman.H.R. 51: Mr. Mrvan and Ms. Davids of Kansas.H.R. 55: Ms. Ross, Mr. Lynch, Mr. Larsen of Washington, Mr.Thompson of California, Ms. Manning, Ms. Jayapal, Ms. Adams,Mr. Schneider, Mr. Veasey, and Ms. Wild.H.R. 77: Mr. Grothman.H.R. 78: Mr. Smith of New Jersey, Mr. Hice of Georgia, Mr.Bucshon, Mr. Burgess, and Mr. Norman.H.R. 97: Mrs. Hayes, Mr. Welch, Mr. Torres of New York, Mr.Cicilline, and Mr. Danny K. Davis of Illinois.H.R. 147: Mr. Ryan and Mr. Brown.H.R. 197: Mr. Brendan F. Boyle of Pennsylvania and Mr.Hastings.H.R. 217: Mr. Hice of Georgia.H.R. 235: Mr. Meeks and Mr. Torres of New York.H.R. 243: Mr. Armstrong.H.R. 255: Mr. Auchincloss, Mr. DeSaulnier, Mr. Schrader,and Ms. Chu.H.R. 256: Mr. Schrader and Ms. Chu.H.R. 262: Mr. Cicilline and Mr. Torres of New York.H.R. 265: Mr. Veasey.H.R. 275: Mr. Jacobs of New York, Ms. Herrera Beutler, Mr.McCaul, Mr. Joyce of Ohio, Mrs. Bice of Oklahoma, Mr.LaMalfa, Mrs. Steel, Mr. Hill, Mr. Garbarino, Mr. Pfluger,Mr. Gimenez, and Mrs. Cammack.H.R. 279: Mr. Neguse, Mr. Crow, and Mr. DeSaulnier.H.R. 289: Mr. Perry.H.R. 295: Mr. Cloud.H.R. 302: Mr. Costa.H.R. 304: Mr. Raskin, Mr. Lynch, Mr. Carson, Ms. Norton,and Mr. Kilmer.H.R. 305: Ms. Ross, Mr. Kind, and Mr. Michael F. Doyle ofPennsylvania.H.R. 322: Mr. Wilson of South Carolina.H.R. 326: Mr. Costa.H.R. 332: Mr. Stanton and Mrs. Wagner.H.R. 349: Ms. Williams of Georgia, Ms. Brownley, Ms. BluntRochester, and Mrs. Trahan.H.R. 359: Mr. Rodney Davis of Illinois.H.R. 369: Mrs. Hayes and Ms. Schrier.H.R. 377: Mr. Rice of South Carolina and Ms. Herrell.H.R. 378: Mr. Rice of South Carolina and Ms. Herrell.H.R. 384: Mr. Cohen, Ms. Mace, Mr. Huffman, Mr. Hastings,and Ms. Eshoo.H.R. 391: Mr. DeSaulnier, Mrs. Napolitano, Ms. Chu, Mr.Harder of California, Mr. Cohen, and Mrs. Fletcher.H.R. 392: Mr. Smith of Washington, Ms. Moore of Wisconsin,Mr. Sablan, and Mr. Sires.H.R. 398: Ms. Herrell.H.R. 407: Mr. Mast.H.R. 421: Ms. Plaskett, Mr. Rush, and Mr. Correa.H.R. 426: Mr. Hagedorn, Mr. Mooney, Mr. Green of Tennessee,Mr. Norman, and Mr. Davidson.H.R. 447: Mr. DeSaulnier, Mr. Courtney, Ms. Adams, Mrs.McBath, Mr. Kinzinger, Mr. Castro of Texas, Mr. Stivers, Mr.Morelle, Mr. Smith of Washington, Mr. Khanna, Mr. Sarbanes,Ms. Norton, Ms. Stevens, Mr. Grijalva, Ms. Blunt Rochester,Mr. Cardenas, Ms. Schakowsky, Ms. Jackson Lee, Mr.Krishnamoorthi, Mr. Danny K. Davis of Illinois, Mrs. Demings,Mr. Foster, Ms. Houlahan, Mr. Moulton, Mr. Kilmer, Ms. Meng,Mr. Gallego, Mr. Brown, Mr. Suozzi, Mr. Garamendi, Mr.Neguse, Ms. McCollum, Mr. Kildee, Mrs. Beatty, Mr. Carbajal,Ms. Craig, Mr. Trone, Ms. Waters, Mr. Casten, Mrs. Bustos,Mr. Langevin, Mr. Sires, Mr. Kahele, Mr. Ryan, Ms. Underwood,Mr. Stanton, Mr. Carson, Mr. David Scott of Georgia, Ms. Leeof California, Mrs. Dingell, Mrs. Axne, Mr. Horsford, and Mr.Lamb.H.R. 448: Mr. Jones.H.R. 449: Mrs. Miller of Illinois.H.R. 450: Mrs. Miller of Illinois.H.R. 452: Mr. Nunes and Mr. Joyce of Ohio.H.R. 465: Mr. Costa and Mr. Valadao.H.R. 471: Mr. Buck, Ms. Mace, Mr. Perry, Mr. Wright, Mr.Babin, Mr. Norman, and Mr. Gibbs.H.R. 472: Mr. Feenstra.H.R. 485: Mrs. Hayes, Mr. Castro of Texas, Ms. Wild, Mr.Takano, Mr. Morelle, Mrs. Trahan, Mr. Levin of Michigan, andMs. Adams.H.R. 488: Mr. Newhouse, Mr. Stewart,[...][Page H254]<\/pre>"],"title":["Global Health Security Act of 2021"],"version":["1.0.0"]},"columns":[{"accessor":"billNumber","name":"billNumber","type":"character","width":100},{"accessor":"createDate","name":"createDate","type":"character","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":90},{"accessor":"updateDate","name":"updateDate","type":"character","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":90},{"accessor":"originChamber","name":"originChamber","type":"character"},{"accessor":"billType","name":"billType","type":"character","width":80},{"accessor":"introducedDate","name":"introducedDate","type":"character","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":120},{"accessor":"congress","name":"congress","type":"character","width":80},{"accessor":"constitutionalAuthorityStatementText","name":"constitutionalAuthorityStatementText","type":"character","show":false},{"accessor":"title","name":"title","type":"character","minWidth":180},{"accessor":"version","name":"version","type":"character","width":80}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"theme":{"color":"#474d4d","backgroundColor":"#FFFFFF","borderColor":"#dddddd","borderWidth":"1px","stripedColor":"#dddddd","highlightColor":"#f0f0f0","cellPadding":"8px 12px","tableStyle":{"fontSize":14,"borderBottom":"3px solid #222222","fontFamily":"Noto Sans, sans-serif","padding":"16px 8px"},"headerStyle":{"borderWidth":"3px","paddingTop":"12px","verticalAlign":"bottom","textAlign":"bottom","background":"#FFFFFF","textTransform":"uppercase","borderColor":"#474d4d","color":"#051414","&:hover":{"background":"#dddddd"},"&[aria-sort='ascending'], &[aria-sort='descending']":{"background":"#5b5e5f","color":"#FFFFFF"},"borderColor.1":"#333","fontSize":12,"fontFamily":"Heebo Light, sans-serif"},"groupHeaderStyle":{"&:not(:empty)":{"paddingBottom":"3px","verticalAlign":"bottom","textAlign":"bottom","backgroundColor":"#FFFFFF","textTransform":"uppercase","fontSize":12,"color":"#474d4d"}},"rowSelectedStyle":{"backgroundColor":"#dddddd"},"inputStyle":{"backgroundColor":"#FFFFFF","color":"#474d4d"},"searchInputStyle":{"textTransform":"uppercase","color":"#474d4d","fontSize":"14px"},"paginationStyle":{"textTransform":"uppercase","fontSize":"14px"},"pageButtonStyle":{"textTransform":"uppercase","fontSize":"14px"}},"dataKey":"46fb1e6a0900a989228635d52e4f6a44"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
What about empty elements?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that <code><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc()</a></code> drops list elements which are empty (possibly through <code><a href="https://purrr.tidyverse.org/reference/keep.html">compact()</a></code>?). This means our output varies based on each file’s contents. This is not an issue itself, but it is something to be wary of if you plan on combining multiple XML files.</p>
</div>
</div>
<p>Now we have the bill title, when it was introduced, what type of bill it is, and which congress introduced it. I also want to include the data for actions, sponsors, committees, and votes, but these need to processed individually.</p>
</section><section id="parse-the-not-so-simple-elements" class="level2"><h2 class="anchored" data-anchor-id="parse-the-not-so-simple-elements">Parse the not-so-simple elements</h2>
<p>This is where the majority of the legwork is so if you can comfortably ignore<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> some portion of the data, now’s a good time. There’s no point spending an hour trying to write a function for one particularly difficult bit of information only to realize you don’t need it anyway.</p>
<p>For brevity I will just go through actions and votes, but you can find the code for extracting the full XML file <a href="https://github.com/MokeEire/my-reps/blob/master/R/parsing_functions.R">here</a><a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<section id="actions-1" class="level3"><h3 class="anchored" data-anchor-id="actions-1">Actions</h3>
<p>What’s in the actions container?</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">actions_xml</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">bill_xml</span>, <span class="st">"actions/item"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (14)}
 [1] &lt;item&gt;\n  &lt;actionDate&gt;2021-07-12&lt;/actionDate&gt;\n  &lt;committees&gt;\n    &lt;item ...
 [2] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;19:46:03&lt;/a ...
 [3] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;19:46:02&lt;/a ...
 [4] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;19:46:02&lt;/a ...
 [5] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;19:24:39&lt;/a ...
 [6] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;15:20:02&lt;/a ...
 [7] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;15:05:31&lt;/a ...
 [8] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;15:05:26&lt;/a ...
 [9] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;15:05:13&lt;/a ...
[10] &lt;item&gt;\n  &lt;actionDate&gt;2021-03-25&lt;/actionDate&gt;\n  &lt;committees&gt;\n    &lt;item ...
[11] &lt;item&gt;\n  &lt;actionDate&gt;2021-03-25&lt;/actionDate&gt;\n  &lt;committees&gt;\n    &lt;item ...
[12] &lt;item&gt;\n  &lt;actionDate&gt;2021-01-21&lt;/actionDate&gt;\n  &lt;links/&gt;\n  &lt;text&gt;Refer ...
[13] &lt;item&gt;\n  &lt;actionDate&gt;2021-01-21&lt;/actionDate&gt;\n  &lt;links/&gt;\n  &lt;text&gt;Intro ...
[14] &lt;item&gt;\n  &lt;actionDate&gt;2021-01-21&lt;/actionDate&gt;\n  &lt;links/&gt;\n  &lt;text&gt;Intro ...</code></pre>
</div>
</div>
<p>So this bill has 14 actions recorded on it. We can use <code><a href="http://xml2.r-lib.org/reference/as_list.html">as_list()</a></code> to convert the XML to a list.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">actions_list</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">actions_xml</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">actions_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ actionDate  :List of 1
  ..$ : chr "2021-07-12"
 $ committees  :List of 1
  ..$ item:List of 2
  .. ..$ systemCode:List of 1
  .. ..$ name      :List of 1
 $ links       : list()
 $ sourceSystem:List of 2
  ..$ code:List of 1
  .. ..$ : chr "0"
  ..$ name:List of 1
  .. ..$ : chr "Senate"
 $ text        :List of 1
  ..$ : chr "Received in the Senate and Read twice and referred to the Committee on Foreign Relations."
 $ type        :List of 1
  ..$ : chr "IntroReferral"</code></pre>
</div>
</div>
<p>In the individual action container, we can see we have the type, text, and date of the action, a list of committees related to the action, and some elements which are singular and some which are not. To deal with this, we can write a function (or set of functions) like the ones below to process an action:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to flatten a list to dataframe columns and </span></span>
<span><span class="co"># rename the columns with a given prefix</span></span>
<span><span class="va">flatten_dfc_rename</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">list_to_flatten</span>, </span>
<span>                          <span class="va">name_prefix</span> <span class="op">=</span> <span class="st">"prefix"</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc</a></span><span class="op">(</span><span class="va">list_to_flatten</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">name_prefix</span>, <span class="st">"_"</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Parse actions from list to dataframe</span></span>
<span><span class="va">parse_action</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">action</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">action</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="co"># Flatten sourceSystem elements and rename them</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/modify.html">modify_at</a></span><span class="op">(</span><span class="st">"sourceSystem"</span>, <span class="op">~</span><span class="fu">flatten_dfc_rename</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"source"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/modify.html">modify_at</a></span><span class="op">(</span><span class="st">"committees"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">committee</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">committee</span>, <span class="op">~</span><span class="fu">flatten_dfc_rename</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"committee"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span>.fn <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"action_"</span>, <span class="va">.</span><span class="op">)</span>, .cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"action"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">parse_action</span><span class="op">(</span><span class="va">actions_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  action_date action_committee_system_code action_committee_na… action_source_c…
  &lt;chr&gt;       &lt;chr&gt;                        &lt;chr&gt;                &lt;chr&gt;           
1 2021-07-12  ssfr00                       Foreign Relations C… 0               
# … with 3 more variables: action_source_name &lt;chr&gt;, action_text &lt;chr&gt;,
#   action_type &lt;chr&gt;</code></pre>
</div>
</div>
<p>Using <a href="http://purrr.tidyverse.org">purrr</a>’s <code>map_*()</code> functions, we can apply this function over all of the items:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">actions_df</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">actions_list</span>, <span class="va">parse_action</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 14
Columns: 9
$ action_date                  &lt;chr&gt; "2021-07-12", "2021-06-28", "2021-06-28",…
$ action_committee_system_code &lt;chr&gt; "ssfr00", NA, NA, NA, NA, NA, NA, NA, NA,…
$ action_committee_name        &lt;chr&gt; "Foreign Relations Committee", NA, NA, NA…
$ action_source_code           &lt;chr&gt; "0", "2", "2", "9", "2", "2", "2", "2", "…
$ action_source_name           &lt;chr&gt; "Senate", "House floor actions", "House f…
$ action_text                  &lt;chr&gt; "Received in the Senate and Read twice an…
$ action_type                  &lt;chr&gt; "IntroReferral", "Floor", "Floor", "Floor…
$ action_time                  &lt;chr&gt; NA, "19:46:03", "19:46:02", "19:46:02", "…
$ action_code                  &lt;chr&gt; NA, "H38310", "H37300", "8000", "H30000",…</code></pre>
</div>
</div>
<p>Now if you’re processing a large amount of these data, you may want to be explicit about the data types expected in each column. This is vital when we want to <code><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest()</a></code> the actions data and combine many bills’ actions into an actions-level dataset. You can do this using <code><a href="https://readr.tidyverse.org/reference/type_convert.html">type_convert()</a></code> , notice the change in column types from the output above.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">actions_df</span> <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/type_convert.html">type_convert</a></span><span class="op">(</span><span class="va">actions_df</span>,</span>
<span>                          col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span></span>
<span>                            action_date <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_date</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                            action_time <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_time</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                            action_committee_systemCode <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                            action_committee_name <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                            action_source_code <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                            action_source_name <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                            action_text <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                            action_type <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                            action_code <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>                            <span class="op">)</span></span>
<span>                          <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 14
Columns: 9
$ action_date                  &lt;date&gt; 2021-07-12, 2021-06-28, 2021-06-28, 2021…
$ action_committee_system_code &lt;chr&gt; "ssfr00", NA, NA, NA, NA, NA, NA, NA, NA,…
$ action_committee_name        &lt;chr&gt; "Foreign Relations Committee", NA, NA, NA…
$ action_source_code           &lt;chr&gt; "0", "2", "2", "9", "2", "2", "2", "2", "…
$ action_source_name           &lt;chr&gt; "Senate", "House floor actions", "House f…
$ action_text                  &lt;chr&gt; "Received in the Senate and Read twice an…
$ action_type                  &lt;chr&gt; "IntroReferral", "Floor", "Floor", "Floor…
$ action_time                  &lt;time&gt;       NA, 19:46:03, 19:46:02, 19:46:02, …
$ action_code                  &lt;chr&gt; NA, "H38310", "H37300", "8000", "H30000",…</code></pre>
</div>
</div>
<p>To add these actions data as a list column to <code>bill_df</code> we can simply use dollar assignment.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bill_df</span><span class="op">$</span><span class="va">actions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">actions_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">bill_df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 11
$ billNumber                           &lt;chr&gt; "391"
$ createDate                           &lt;chr&gt; "2021-01-22T08:12:10Z"
$ updateDate                           &lt;chr&gt; "2022-02-09T12:37:52Z"
$ originChamber                        &lt;chr&gt; "House"
$ billType                             &lt;chr&gt; "HR"
$ introducedDate                       &lt;chr&gt; "2021-01-21"
$ congress                             &lt;chr&gt; "117"
$ constitutionalAuthorityStatementText &lt;chr&gt; "&lt;pre&gt;[Congressional Record Volum…
$ title                                &lt;chr&gt; "Global Health Security Act of 20…
$ version                              &lt;chr&gt; "1.0.0"
$ actions                              &lt;list&gt; [&lt;tbl_df[14 x 9]&gt;]</code></pre>
</div>
</div>
<p>The remaining sections will be following the same process for different elements, but it can be boiled down to these steps:</p>
<ol type="1">
<li><strong>Explore the structure</strong></li>
</ol>
<blockquote class="blockquote">
<p>Go through any available documentation, and when you read in the XML file you can use functions like <code><a href="https://rdrr.io/pkg/XML/man/xmlTreeParse.html">xmlParse()</a></code>, <code><a href="http://xml2.r-lib.org/reference/xml_structure.html">xml_structure()</a></code>, and <code><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents()</a></code> .</p>
</blockquote>
<ol start="2" type="1">
<li><strong>Define the output</strong></li>
</ol>
<blockquote class="blockquote">
<p>Consider what you want the output to look like and think about how it needs to be transformed to match this target.</p>
</blockquote>
<ol start="3" type="1">
<li>
<strong>Process a single element</strong> (write a function if it gets too complicated)</li>
</ol>
<blockquote class="blockquote">
<p>Get one element into the form you want. Writing functions can help you think through the data transformations being applied and make your code easier to read.</p>
</blockquote>
<ol start="4" type="1">
<li><strong>Apply to all elements</strong></li>
</ol>
<blockquote class="blockquote">
<p>Focus on processing of the entire file (or the subset of the file you’re interested in). You might want an XML file to return a single row, a single column, or a dataframe of size <span class="math inline">\(n\times k\)</span>. Once you have a single file returned in the format you want, you can combine the outputs of multiple files.</p>
</blockquote>
<div class="callout-caution callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Find the exceptions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Lastly, you will likely run into situations where a node which only seemed to contain a single piece of data has a different structure with multiple sub-elements for other files. This will happen, you’ll go back to the drawing board, design more flexibility in your functions, and understand how process either format.</p>
</div>
</div>
</section><section id="votes-1" class="level3"><h3 class="anchored" data-anchor-id="votes-1">Votes</h3>
<p>Votes are particularly interesting because it provides a more discrete measure of our representatives’ behaviour. Individual votes are stored in the <code>&lt;recordedVotes&gt;</code> container. We can access child elements in XML using a forward slash (this uses a language called XPATH).</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">bill_recorded_vote_nodes</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">bill_xml</span>, <span class="st">"recordedVotes/recordedVote"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (7)}
[1] &lt;rollNumber&gt;188&lt;/rollNumber&gt;
[2] &lt;url&gt;https://clerk.house.gov/evs/2021/roll188.xml&lt;/url&gt;
[3] &lt;fullActionName&gt;Final Passage Under Suspension of the Rules Results&lt;/full ...
[4] &lt;chamber&gt;House&lt;/chamber&gt;
[5] &lt;congress&gt;117&lt;/congress&gt;
[6] &lt;date&gt;2021-06-28T23:46:02Z&lt;/date&gt;
[7] &lt;sessionNumber&gt;1&lt;/sessionNumber&gt;</code></pre>
</div>
</div>
<p>You may have spotted why votes are interesting elements to parse because inside the <code>&lt;url&gt;</code> element we find <strong>another</strong> <strong>XML file</strong>!<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> Before we dive into that can of worms, I’ll convert the top-level nodes to a list and flatten it into columns. Note we use <code><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr()</a></code> with <code>votes_list</code> because there could be multiple vote objects.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Coerce nodes to list</span></span>
<span><span class="va">recorded_votes_list</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">bill_recorded_vote_nodes</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">recorded_votes_df</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">recorded_votes_list</span>, <span class="va">flatten_dfc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 7
$ rollNumber     &lt;chr&gt; "188"
$ url            &lt;chr&gt; "https://clerk.house.gov/evs/2021/roll188.xml"
$ fullActionName &lt;chr&gt; "Final Passage Under Suspension of the Rules Results"
$ chamber        &lt;chr&gt; "House"
$ congress       &lt;chr&gt; "117"
$ date           &lt;chr&gt; "2021-06-28T23:46:02Z"
$ sessionNumber  &lt;chr&gt; "1"</code></pre>
</div>
</div>
<p>Now we want to get the vote roll XML file, so we go back to <code><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml()</a></code> .</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_roll_xml</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml</a></span><span class="op">(</span><span class="va">recorded_votes_df</span><span class="op">$</span><span class="va">url</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_document}
&lt;rollcall-vote&gt;
[1] &lt;vote-metadata&gt;\n  &lt;majority&gt;D&lt;/majority&gt;\n  &lt;congress&gt;117&lt;/congress&gt;\n   ...
[2] &lt;vote-data&gt;\n  &lt;recorded-vote&gt;\n    &lt;legislator name-id="A000370" sort-fi ...</code></pre>
</div>
</div>
<p>There are two main nodes - <code>&lt;vote-metadata&gt;</code> and <code>&lt;vote-data&gt;</code>. How many elements does each node have and what do the structures for these look like?</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_roll_children</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_children</a></span><span class="op">(</span><span class="va">vote_roll_xml</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">xml_contents</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[[1]]
{xml_nodeset (13)}
 [1] &lt;majority&gt;D&lt;/majority&gt;
 [2] &lt;congress&gt;117&lt;/congress&gt;
 [3] &lt;session&gt;1st&lt;/session&gt;
 [4] &lt;chamber&gt;U.S. House of Representatives&lt;/chamber&gt;
 [5] &lt;rollcall-num&gt;188&lt;/rollcall-num&gt;
 [6] &lt;legis-num&gt;H R 391&lt;/legis-num&gt;
 [7] &lt;vote-question&gt;On Motion to Suspend the Rules and Pass, as Amended&lt;/vote ...
 [8] &lt;vote-type&gt;2/3 YEA-AND-NAY&lt;/vote-type&gt;
 [9] &lt;vote-result&gt;Passed&lt;/vote-result&gt;
[10] &lt;action-date&gt;28-Jun-2021&lt;/action-date&gt;
[11] &lt;action-time time-etz="19:42"&gt;7:42 PM&lt;/action-time&gt;
[12] &lt;vote-desc&gt;Global Health Security Act&lt;/vote-desc&gt;
[13] &lt;vote-totals&gt;\n  &lt;totals-by-party-header&gt;\n    &lt;party-header&gt;Party&lt;/part ...

[[2]]
{xml_nodeset (430)}
 [1] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000370" sort-field="Adams" unac ...
 [2] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000055" sort-field="Aderholt" u ...
 [3] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000371" sort-field="Aguilar" un ...
 [4] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000372" sort-field="Allen" unac ...
 [5] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000376" sort-field="Allred" una ...
 [6] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000369" sort-field="Amodei" una ...
 [7] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000377" sort-field="Armstrong"  ...
 [8] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000375" sort-field="Arrington"  ...
 [9] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000148" sort-field="Auchincloss ...
[10] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000378" sort-field="Axne" unacc ...
[11] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001291" sort-field="Babin" unac ...
[12] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001298" sort-field="Bacon" unac ...
[13] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001307" sort-field="Baird" unac ...
[14] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001306" sort-field="Balderson"  ...
[15] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001299" sort-field="Banks" unac ...
[16] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001282" sort-field="Barr" unacc ...
[17] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001300" sort-field="Barragan" u ...
[18] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001270" sort-field="Bass" unacc ...
[19] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001281" sort-field="Beatty" una ...
[20] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B000668" sort-field="Bentz" unac ...
...</code></pre>
</div>
</div>
<p>One node contains the aggregated vote information, while <code>&lt;vote-data&gt;</code> contains the legislator-level vote data. Let’s try to parse the legislator-level data first.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_data</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_roll_xml</span>, <span class="st">"vote-data"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (1)}
[1] &lt;vote-data&gt;\n  &lt;recorded-vote&gt;\n    &lt;legislator name-id="A000370" sort-fi ...</code></pre>
</div>
</div>
<p>Here is the XML for a single legislator’s vote:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_child</a></span><span class="op">(</span><span class="va">vote_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_node}
&lt;recorded-vote&gt;
[1] &lt;legislator name-id="A000370" sort-field="Adams" unaccented-name="Adams"  ...
[2] &lt;vote&gt;Yea&lt;/vote&gt;</code></pre>
</div>
</div>
<p>With a similar combination of <code><a href="http://xml2.r-lib.org/reference/as_list.html">as_list()</a></code> , <code><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfr()</a></code>, and <code><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest()</a></code> we can flatten the XML into one row per legislator</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_roll_flattened</span> <span class="op">=</span> <span class="va">vote_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfr</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 430 × 2
   legislator  vote 
   &lt;chr&gt;       &lt;chr&gt;
 1 Adams       Yea  
 2 Aderholt    Nay  
 3 Aguilar     Yea  
 4 Allen       Nay  
 5 Allred      Yea  
 6 Amodei      Yea  
 7 Armstrong   Yea  
 8 Arrington   Nay  
 9 Auchincloss Yea  
10 Axne        Yea  
# … with 420 more rows</code></pre>
</div>
</div>
<p>But we lose all the attributes! And <code>name-id</code> looked particularly useful. We’ll need to extract the attributes before we flatten the data. Let’s take another look at the legislators structure.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vote_legislators</span> <span class="op">=</span> <span class="va">vote_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"recorded-vote"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">legislators_list</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">vote_legislators</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ :List of 2
  ..$ legislator:List of 1
  .. ..$ : chr "Adams"
  .. ..- attr(*, "name-id")= chr "A000370"
  .. ..- attr(*, "sort-field")= chr "Adams"
  .. ..- attr(*, "unaccented-name")= chr "Adams"
  .. ..- attr(*, "party")= chr "D"
  .. ..- attr(*, "state")= chr "NC"
  .. ..- attr(*, "role")= chr "legislator"
  ..$ vote      :List of 1
  .. ..$ : chr "Yea"</code></pre>
</div>
</div>
<p>The legislator element has all the attributes, while the vote element only has a value. We want to extract the attributes only for legislator using <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> to apply <code><a href="https://purrr.tidyverse.org/reference/map_if.html">map_at()</a></code> on each legislator element and extract the attributes from each while retaining the value in <code>vote</code>. It can often feel like you’re getting lost in a list of lists, but with some experimentation you’ll be able to find your way back to the surface.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">legislator_vote_df</span> <span class="op">=</span> <span class="va">legislators_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="co"># Modify one level deeper using map_at to target legislator elements</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">map_at</span>, <span class="st">"legislator"</span>, <span class="va">attributes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">flatten_dfc</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 430 × 7
   `name-id` `sort-field` `unaccented-name` party state role       vote 
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;
 1 A000370   Adams        Adams             D     NC    legislator Yea  
 2 A000055   Aderholt     Aderholt          R     AL    legislator Nay  
 3 A000371   Aguilar      Aguilar           D     CA    legislator Yea  
 4 A000372   Allen        Allen             R     GA    legislator Nay  
 5 A000376   Allred       Allred            D     TX    legislator Yea  
 6 A000369   Amodei       Amodei            R     NV    legislator Yea  
 7 A000377   Armstrong    Armstrong         R     ND    legislator Yea  
 8 A000375   Arrington    Arrington         R     TX    legislator Nay  
 9 A000148   Auchincloss  Auchincloss       D     MA    legislator Yea  
10 A000378   Axne         Axne              D     IA    legislator Yea  
# … with 420 more rows</code></pre>
</div>
</div>
<p>Now we have a table of legislator voting data! But what about the <code>&lt;vote-metadata&gt;</code>?</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_metadata</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_roll_xml</span>, <span class="st">"vote-metadata"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (13)}
 [1] &lt;majority&gt;D&lt;/majority&gt;
 [2] &lt;congress&gt;117&lt;/congress&gt;
 [3] &lt;session&gt;1st&lt;/session&gt;
 [4] &lt;chamber&gt;U.S. House of Representatives&lt;/chamber&gt;
 [5] &lt;rollcall-num&gt;188&lt;/rollcall-num&gt;
 [6] &lt;legis-num&gt;H R 391&lt;/legis-num&gt;
 [7] &lt;vote-question&gt;On Motion to Suspend the Rules and Pass, as Amended&lt;/vote ...
 [8] &lt;vote-type&gt;2/3 YEA-AND-NAY&lt;/vote-type&gt;
 [9] &lt;vote-result&gt;Passed&lt;/vote-result&gt;
[10] &lt;action-date&gt;28-Jun-2021&lt;/action-date&gt;
[11] &lt;action-time time-etz="19:42"&gt;7:42 PM&lt;/action-time&gt;
[12] &lt;vote-desc&gt;Global Health Security Act&lt;/vote-desc&gt;
[13] &lt;vote-totals&gt;\n  &lt;totals-by-party-header&gt;\n    &lt;party-header&gt;Party&lt;/part ...</code></pre>
</div>
</div>
<p>Everything other than the <code>&lt;vote-totals&gt;</code> element is singular so we can get that out of the way the same way as before:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vote_singular_nodes</span> <span class="op">=</span> <span class="fu">xml_singular_nodes</span><span class="op">(</span><span class="va">vote_metadata</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">vote_df</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">vote_singular_nodes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># as_list() doesn't retain element names so we set names ourselves</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_name.html">xml_name</a></span><span class="op">(</span><span class="va">vote_singular_nodes</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 12
$ majority        &lt;chr&gt; "D"
$ congress        &lt;chr&gt; "117"
$ session         &lt;chr&gt; "1st"
$ chamber         &lt;chr&gt; "U.S. House of Representatives"
$ `rollcall-num`  &lt;chr&gt; "188"
$ `legis-num`     &lt;chr&gt; "H R 391"
$ `vote-question` &lt;chr&gt; "On Motion to Suspend the Rules and Pass, as Amended"
$ `vote-type`     &lt;chr&gt; "2/3 YEA-AND-NAY"
$ `vote-result`   &lt;chr&gt; "Passed"
$ `action-date`   &lt;chr&gt; "28-Jun-2021"
$ `action-time`   &lt;chr&gt; "7:42 PM"
$ `vote-desc`     &lt;chr&gt; "Global Health Security Act"</code></pre>
</div>
</div>
<p>The <code>&lt;vote-totals&gt;</code> are a bit of a unique little element, with 3 different types of nodes.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_totals</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_metadata</span>, <span class="st">"vote-totals"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (5)}
[1] &lt;totals-by-party-header&gt;\n  &lt;party-header&gt;Party&lt;/party-header&gt;\n  &lt;yea-he ...
[2] &lt;totals-by-party&gt;\n  &lt;party&gt;Republican&lt;/party&gt;\n  &lt;yea-total&gt;90&lt;/yea-tota ...
[3] &lt;totals-by-party&gt;\n  &lt;party&gt;Democratic&lt;/party&gt;\n  &lt;yea-total&gt;217&lt;/yea-tot ...
[4] &lt;totals-by-party&gt;\n  &lt;party&gt;Independent&lt;/party&gt;\n  &lt;yea-total&gt;0&lt;/yea-tota ...
[5] &lt;totals-by-vote&gt;\n  &lt;total-stub&gt;Totals&lt;/total-stub&gt;\n  &lt;yea-total&gt;307&lt;/ye ...</code></pre>
</div>
</div>
<p>This is another opportunity for us to be choosy with our data. The first node is table headers, which we don’t need because the elements are tagged anyway. From these, we really only need the <code>&lt;totals-by-party&gt;</code> nodes as long as the totals of which agree with <code>&lt;totals-by-vote&gt;</code> , which is worth checking.</p>
<div>
<details open=""><summary>Code</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_totals_by_party</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_totals</span>, <span class="st">"totals-by-party"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">totals_by_vote</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_totals</span>, <span class="st">"totals-by-vote"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>{xml_nodeset (3)}
[1] &lt;totals-by-party&gt;\n  &lt;party&gt;Republican&lt;/party&gt;\n  &lt;yea-total&gt;90&lt;/yea-tota ...
[2] &lt;totals-by-party&gt;\n  &lt;party&gt;Democratic&lt;/party&gt;\n  &lt;yea-total&gt;217&lt;/yea-tot ...
[3] &lt;totals-by-party&gt;\n  &lt;party&gt;Independent&lt;/party&gt;\n  &lt;yea-total&gt;0&lt;/yea-tota ...</code></pre>
</div>
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>{xml_nodeset (5)}
[1] &lt;total-stub&gt;Totals&lt;/total-stub&gt;
[2] &lt;yea-total&gt;307&lt;/yea-total&gt;
[3] &lt;nay-total&gt;112&lt;/nay-total&gt;
[4] &lt;present-total&gt;0&lt;/present-total&gt;
[5] &lt;not-voting-total&gt;11&lt;/not-voting-total&gt;</code></pre>
</div>
</div>
</div>
</div>
<p>Once we have our nodeset (which at last are all singular), we use same listing, mapping, and flattening…or <em>lappening</em> as absolutely no one calls it.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">party_vote_totals_df</span> <span class="op">=</span> <span class="va">vote_totals_by_party</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">flatten_dfc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://readr.tidyverse.org/reference/type_convert.html">type_convert</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  party       `yea-total` `nay-total` `present-total` `not-voting-total`
  &lt;chr&gt;             &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;              &lt;dbl&gt;
1 Republican           90         112               0                  9
2 Democratic          217           0               0                  2
3 Independent           0           0               0                  0</code></pre>
</div>
</div>
<p>Now that we have all of our vote data wrangled from the thorny grasp of XML, we can put it all together.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_roll_df</span> <span class="op">=</span> <span class="va">vote_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>legislator_votes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">legislator_vote_df</span><span class="op">)</span>,</span>
<span>         party_votes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">party_vote_totals_df</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 14
$ majority         &lt;chr&gt; "D"
$ congress         &lt;chr&gt; "117"
$ session          &lt;chr&gt; "1st"
$ chamber          &lt;chr&gt; "U.S. House of Representatives"
$ rollcall_num     &lt;chr&gt; "188"
$ legis_num        &lt;chr&gt; "H R 391"
$ vote_question    &lt;chr&gt; "On Motion to Suspend the Rules and Pass, as Amended"
$ vote_type        &lt;chr&gt; "2/3 YEA-AND-NAY"
$ vote_result      &lt;chr&gt; "Passed"
$ action_date      &lt;chr&gt; "28-Jun-2021"
$ action_time      &lt;chr&gt; "7:42 PM"
$ vote_desc        &lt;chr&gt; "Global Health Security Act"
$ legislator_votes &lt;list&gt; [&lt;tbl_df[430 x 7]&gt;]
$ party_votes      &lt;list&gt; [&lt;tbl_df[3 x 5]&gt;]</code></pre>
</div>
</div>
<p>And we continue to stack this Russian doll of data from the legislator-level to the vote-level…</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">recorded_votes_df</span> <span class="op">=</span> <span class="va">recorded_votes_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>vote_roll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">vote_roll_df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 8
$ rollNumber     &lt;chr&gt; "188"
$ url            &lt;chr&gt; "https://clerk.house.gov/evs/2021/roll188.xml"
$ fullActionName &lt;chr&gt; "Final Passage Under Suspension of the Rules Results"
$ chamber        &lt;chr&gt; "House"
$ congress       &lt;chr&gt; "117"
$ date           &lt;chr&gt; "2021-06-28T23:46:02Z"
$ sessionNumber  &lt;chr&gt; "1"
$ vote_roll      &lt;list&gt; [&lt;tbl_df[1 x 14]&gt;]</code></pre>
</div>
</div>
<p>…all the way until we’ve gotten back to the bill-level.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bill_df</span><span class="op">$</span><span class="va">votes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">recorded_votes_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">bill_df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 12
$ billNumber                           &lt;chr&gt; "391"
$ createDate                           &lt;chr&gt; "2021-01-22T08:12:10Z"
$ updateDate                           &lt;chr&gt; "2022-02-09T12:37:52Z"
$ originChamber                        &lt;chr&gt; "House"
$ billType                             &lt;chr&gt; "HR"
$ introducedDate                       &lt;chr&gt; "2021-01-21"
$ congress                             &lt;chr&gt; "117"
$ constitutionalAuthorityStatementText &lt;chr&gt; "&lt;pre&gt;[Congressional Record Volum…
$ title                                &lt;chr&gt; "Global Health Security Act of 20…
$ version                              &lt;chr&gt; "1.0.0"
$ actions                              &lt;list&gt; [&lt;tbl_df[14 x 9]&gt;]
$ votes                                &lt;list&gt; [&lt;tbl_df[1 x 8]&gt;]</code></pre>
</div>
</div>
</section></section></section><section id="other-helpful-articles" class="level1"><h1>Other helpful articles</h1>
<p>Here are some of the helpful articles I came across in the course of writing this:</p>
<ul>
<li><a href="https://towardsdatascience.com/from-xml-to-excel-for-data-analysis-ac0c0c765b7d" title="Introduction to Processing XML In Python">From XML to Excel for Data Analysis</a></li>
<li><a href="https://medium.com/geekculture/reading-xml-files-in-r-3122c3a2a8d9">Reading XML files in R</a></li>
</ul></section><section id="session-info" class="level1"><h1>Session Info</h1>
<p>Version information about R, OS, and loaded packages.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.2.1 (2022-06-23 ucrt)
 os       Windows 10 x64 (build 19043)
 system   x86_64, mingw32
 ui       RTerm
 language (EN)
 collate  English_United States.utf8
 ctype    English_United States.utf8
 tz       America/Los_Angeles
 date     2022-07-15
 pandoc   2.17.1.1 @ C:/Program Files/RStudio/bin/quarto/bin/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package     * version   date (UTC) lib source
 assertthat    0.2.1     2019-03-21 [1] CRAN (R 4.2.0)
 backports     1.4.1     2021-12-13 [1] CRAN (R 4.2.0)
 bit           4.0.4     2020-08-04 [1] CRAN (R 4.2.0)
 bit64         4.0.5     2020-08-30 [1] CRAN (R 4.2.0)
 bitops        1.0-7     2021-04-24 [1] CRAN (R 4.2.0)
 broom         1.0.0     2022-07-01 [1] CRAN (R 4.2.1)
 cellranger    1.1.0     2016-07-27 [1] CRAN (R 4.2.0)
 cli           3.3.0     2022-04-25 [1] CRAN (R 4.2.0)
 colorspace    2.0-3     2022-02-21 [1] CRAN (R 4.2.0)
 crayon        1.5.1     2022-03-26 [1] CRAN (R 4.2.0)
 curl          4.3.2     2021-06-23 [1] CRAN (R 4.2.0)
 DBI           1.1.3     2022-06-18 [1] CRAN (R 4.2.0)
 dbplyr        2.2.1     2022-06-27 [1] CRAN (R 4.2.1)
 digest        0.6.29    2021-12-01 [1] CRAN (R 4.2.0)
 dplyr       * 1.0.9     2022-04-28 [1] CRAN (R 4.2.0)
 ellipsis      0.3.2     2021-04-29 [1] CRAN (R 4.2.0)
 evaluate      0.15      2022-02-18 [1] CRAN (R 4.2.0)
 extrafont   * 0.18      2022-04-12 [1] CRAN (R 4.2.0)
 extrafontdb   1.0       2012-06-11 [1] CRAN (R 4.2.0)
 fansi         1.0.3     2022-03-24 [1] CRAN (R 4.2.0)
 fastmap       1.1.0     2021-01-25 [1] CRAN (R 4.2.0)
 forcats     * 0.5.1     2021-01-27 [1] CRAN (R 4.2.0)
 fs            1.5.2     2021-12-08 [1] CRAN (R 4.2.0)
 generics      0.1.2     2022-01-31 [1] CRAN (R 4.2.0)
 ggplot2     * 3.3.6     2022-05-03 [1] CRAN (R 4.2.0)
 glue          1.6.2     2022-02-24 [1] CRAN (R 4.2.0)
 gtable        0.3.0     2019-03-25 [1] CRAN (R 4.2.0)
 haven         2.5.0     2022-04-15 [1] CRAN (R 4.2.0)
 hms           1.1.1     2021-09-26 [1] CRAN (R 4.2.0)
 htmltools     0.5.2     2021-08-25 [1] CRAN (R 4.2.0)
 htmlwidgets   1.5.4     2021-09-08 [1] CRAN (R 4.2.0)
 httr          1.4.3     2022-05-04 [1] CRAN (R 4.2.0)
 janitor       2.1.0     2021-01-05 [1] CRAN (R 4.2.1)
 jsonlite    * 1.8.0     2022-02-22 [1] CRAN (R 4.2.0)
 knitr         1.39      2022-04-26 [1] CRAN (R 4.2.0)
 lifecycle     1.0.1     2021-09-24 [1] CRAN (R 4.2.0)
 log4r       * 0.4.2     2021-11-04 [1] CRAN (R 4.2.0)
 lubridate   * 1.8.0     2021-10-07 [1] CRAN (R 4.2.0)
 magrittr    * 2.0.3     2022-03-30 [1] CRAN (R 4.2.0)
 modelr        0.1.8     2020-05-19 [1] CRAN (R 4.2.0)
 mokeR       * 0.1.0     2022-07-15 [1] local
 munsell       0.5.0     2018-06-12 [1] CRAN (R 4.2.0)
 pillar        1.7.0     2022-02-01 [1] CRAN (R 4.2.0)
 pkgconfig     2.0.3     2019-09-22 [1] CRAN (R 4.2.0)
 purrr       * 0.3.4     2020-04-17 [1] CRAN (R 4.2.0)
 R6            2.5.1     2021-08-19 [1] CRAN (R 4.2.0)
 RCurl       * 1.98-1.7  2022-06-09 [1] CRAN (R 4.2.0)
 reactable   * 0.3.0     2022-05-26 [1] CRAN (R 4.2.0)
 reactR        0.4.4     2021-02-22 [1] CRAN (R 4.2.0)
 readr       * 2.1.2     2022-01-30 [1] CRAN (R 4.2.0)
 readxl        1.4.0     2022-03-28 [1] CRAN (R 4.2.0)
 reprex        2.0.1     2021-08-05 [1] CRAN (R 4.2.0)
 rjson       * 0.2.21    2022-01-09 [1] CRAN (R 4.2.0)
 rlang         1.0.2     2022-03-04 [1] CRAN (R 4.2.0)
 rmarkdown     2.14      2022-04-25 [1] CRAN (R 4.2.0)
 rstudioapi    0.13      2020-11-12 [1] CRAN (R 4.2.0)
 Rttf2pt1      1.3.8     2020-01-10 [1] CRAN (R 4.2.1)
 rvest         1.0.2     2021-10-16 [1] CRAN (R 4.2.0)
 scales        1.2.0     2022-04-13 [1] CRAN (R 4.2.0)
 sessioninfo   1.2.2     2021-12-06 [1] CRAN (R 4.2.0)
 snakecase     0.11.0    2019-05-25 [1] CRAN (R 4.2.1)
 stringi       1.7.6     2021-11-29 [1] CRAN (R 4.2.0)
 stringr     * 1.4.0     2019-02-10 [1] CRAN (R 4.2.0)
 tibble      * 3.1.7     2022-05-03 [1] CRAN (R 4.2.0)
 tidyjson    * 0.3.1     2020-05-31 [1] CRAN (R 4.2.0)
 tidyr       * 1.2.0     2022-02-01 [1] CRAN (R 4.2.0)
 tidyselect    1.1.2     2022-02-21 [1] CRAN (R 4.2.0)
 tidyverse   * 1.3.1     2021-04-15 [1] CRAN (R 4.2.0)
 tzdb          0.3.0     2022-03-28 [1] CRAN (R 4.2.0)
 utf8          1.2.2     2021-07-24 [1] CRAN (R 4.2.0)
 vctrs         0.4.1     2022-04-13 [1] CRAN (R 4.2.0)
 vroom         1.5.7     2021-11-30 [1] CRAN (R 4.2.0)
 withr         2.5.0     2022-03-03 [1] CRAN (R 4.2.0)
 xfun          0.31      2022-05-10 [1] CRAN (R 4.2.0)
 XML         * 3.99-0.10 2022-06-09 [1] CRAN (R 4.2.0)
 xml2        * 1.3.3     2021-11-30 [1] CRAN (R 4.2.0)
 yaml          2.3.5     2022-02-21 [1] CRAN (R 4.2.0)

 [1] C:/Users/Mark/AppData/Local/R/win-library/4.2
 [2] C:/Program Files/R/R-4.2.1/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>


<!-- -->

</section><div id="quarto-appendix" class="default"><section class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1" role="doc-endnote"><p><a href="https://en.wikipedia.org/wiki/XML">Wikipedia</a> for the curious. Don’t miss the drama about Microsoft’s “vociferous protests” as one of the co-editors started working with Netscape.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>We can (and later I do) go deeper here and extract the roll’s XML file to get individual representatives’ votes.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p><code>xml_document</code> is one of the “key classes” used in the <a href="https://xml2.r-lib.org/">xml2</a> library, the others being <code>xml_node</code> (a single node), and <code>xml_nodeset</code> (a set of nodes).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>I will confess I’m not quite sure why this is the case, nor do I particularly understand what <code>&lt;dublinCore&gt;</code> is (though prevailing theories suggest some kind of document schema or a new metal genre originating from my home of Dublin).<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p>But do yourself a favour and write it down somewhere - comment it in the code, tell your colleagues or collaborators, put it on a particularly strong post it, whatever works.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote"><p>Ctrl/Cmd+F: <code>extract_bill_status</code><a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7" role="doc-endnote">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://c.tenor.com/um2EhyMQyR8AAAAC/xzibit-meme.gif" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">They heard you like XML</figcaption><p></p>
</figure>
</div>
<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a>
</li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb65" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Parsing XML with R"</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Untangling congressional legislative data"</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2022-07-14"</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> </span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - data</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - governance</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - R</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extrafont)</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reactable)</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://github.com/MokeEire/my-reps/raw/master/R/parsing_functions.R"</span>)</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>bill_xml_link <span class="ot">=</span> <span class="st">"https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml"</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>bill_xml_file <span class="ot">=</span> <span class="fu">read_xml</span>(bill_xml_link)</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: df-print-fct</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>knit_print.data.frame <span class="ot">=</span> <span class="cf">function</span>(x, ...){</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">knit_print</span>(</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">reactable</span>(x,</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>              <span class="at">compact =</span> T, </span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>              <span class="at">resizable =</span> T,</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a>If you work with data regularly, you have probably used data formats like Excel spreadsheets, text files, relational databases and if you're reading this potentially XML too. XML, or (e)Xtensible Markup Language, is a storage format designed for flexibly transmitting data<span class="ot">[^1]</span> which often leads to a bit of a hassle when trying to parse it for use in analytics. If you're still reading, the good news is that this article should provide an understanding of XML and a set of steps for processing an XML file with R into a more analysis-friendly format.</span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span><span class="co">[</span><span class="ot">Wikipedia</span><span class="co">](https://en.wikipedia.org/wiki/XML)</span> for the curious. Don't miss the drama about Microsoft's "vociferous protests" as one of the co-editors started working with Netscape.</span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip appearance="simple"}</span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a><span class="fu">## What you'll learn:</span></span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Load and parse XML files in R using the <span class="in">`{XML}`</span> and <span class="in">`{xml2}`</span> packages</span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explore the structure of XML documents</span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>List, map, and flatten your data into a tabular format</span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-61"><a href="#cb65-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-62"><a href="#cb65-62" aria-hidden="true" tabindex="-1"></a>I'll be using the US government's congressional bill data as an example. As always the first step of data analysis is to check if any documentation exists and thankfully <span class="co">[</span><span class="ot">govinfo</span><span class="co">](https://www.govinfo.gov/)</span> has provided some <span class="co">[</span><span class="ot">guidance</span><span class="co">](https://github.com/usgpo/bill-status/blob/main/BILLSTATUS-XML_User_User-Guide.md)</span> for how the data is stored.</span>
<span id="cb65-63"><a href="#cb65-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-64"><a href="#cb65-64" aria-hidden="true" tabindex="-1"></a>To follow along, you can download the sample XML file <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml "HR-391: Global Health Security Act of 2021")</span>. The sample bill (chosen only because it contains examples of important elements) is <span class="co">[</span><span class="ot">*HR-391: Global Health Security Act of 2021*</span><span class="co">](https://www.govinfo.gov/app/details/BILLS-117hr391rfs)</span> and the XML file contains information about its sponsors and cosponsors, votes on the bill, and the committees that considered it.</span>
<span id="cb65-65"><a href="#cb65-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-66"><a href="#cb65-66" aria-hidden="true" tabindex="-1"></a>Here's a sample of the XML:</span>
<span id="cb65-67"><a href="#cb65-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-70"><a href="#cb65-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-71"><a href="#cb65-71" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xml-sample</span></span>
<span id="cb65-72"><a href="#cb65-72" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-overflow: scroll</span></span>
<span id="cb65-73"><a href="#cb65-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-74"><a href="#cb65-74" aria-hidden="true" tabindex="-1"></a><span class="co"># (example_node = xml_find_first(bill_xml_file, "//bill")) %&gt;% </span></span>
<span id="cb65-75"><a href="#cb65-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   xmlParse()</span></span>
<span id="cb65-76"><a href="#cb65-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-77"><a href="#cb65-77" aria-hidden="true" tabindex="-1"></a><span class="fu">xml_child</span>(bill_xml_file) <span class="sc">%&gt;%</span> </span>
<span id="cb65-78"><a href="#cb65-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_contents</span>()</span>
<span id="cb65-79"><a href="#cb65-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-80"><a href="#cb65-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-81"><a href="#cb65-81" aria-hidden="true" tabindex="-1"></a>Above is an example of how votes recorded on the bill are stored. The <span class="in">`&lt;recordedVotes&gt;`</span> container can have multiple <span class="in">`&lt;recordedVote&gt;`</span> elements which describe a vote taken on the bill<span class="ot">[^2]</span>.</span>
<span id="cb65-82"><a href="#cb65-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-83"><a href="#cb65-83" aria-hidden="true" tabindex="-1"></a><span class="ot">[^2]: </span>We can (and later I do) go deeper here and extract the roll's XML file to get individual representatives' votes.</span>
<span id="cb65-84"><a href="#cb65-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-85"><a href="#cb65-85" aria-hidden="true" tabindex="-1"></a><span class="fu"># Read XML data with R</span></span>
<span id="cb65-86"><a href="#cb65-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-87"><a href="#cb65-87" aria-hidden="true" tabindex="-1"></a>We'll load the <span class="in">`{XML}`</span> and <span class="in">`{xml2}`</span> packages to read in our XML file. Between these two libraries there are numerous ways to load in and process XML data. I strongly suggest looking through the packages' help files to find the right function for your task. I also load the <span class="in">`{tidyverse}`</span> package because it's generally exceedingly useful.</span>
<span id="cb65-88"><a href="#cb65-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-91"><a href="#cb65-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-92"><a href="#cb65-92" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: read-xml</span></span>
<span id="cb65-93"><a href="#cb65-93" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb65-94"><a href="#cb65-94" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb65-95"><a href="#cb65-95" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(XML)</span>
<span id="cb65-96"><a href="#cb65-96" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb65-97"><a href="#cb65-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-98"><a href="#cb65-98" aria-hidden="true" tabindex="-1"></a>bill_xml_file <span class="ot">=</span> <span class="fu">read_xml</span>(<span class="st">"https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml"</span>)</span>
<span id="cb65-99"><a href="#cb65-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-100"><a href="#cb65-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-101"><a href="#cb65-101" aria-hidden="true" tabindex="-1"></a><span class="in">`read_xml()`</span> returns an <span class="in">`xml_document`</span><span class="ot">[^3]</span> object. With this, we can look at the bill's top level nodes.</span>
<span id="cb65-102"><a href="#cb65-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-103"><a href="#cb65-103" aria-hidden="true" tabindex="-1"></a><span class="ot">[^3]: </span><span class="in">`xml_document`</span> is one of the "key classes" used in the <span class="in">`{xml2}`</span> library, the others being <span class="in">`xml_node`</span> (a single node), and <span class="in">`xml_nodeset`</span> (a set of nodes).</span>
<span id="cb65-104"><a href="#cb65-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-107"><a href="#cb65-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-108"><a href="#cb65-108" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xml-contents</span></span>
<span id="cb65-109"><a href="#cb65-109" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb65-110"><a href="#cb65-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the contents</span></span>
<span id="cb65-111"><a href="#cb65-111" aria-hidden="true" tabindex="-1"></a><span class="fu">xml_contents</span>(bill_xml_file)</span>
<span id="cb65-112"><a href="#cb65-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-113"><a href="#cb65-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-114"><a href="#cb65-114" aria-hidden="true" tabindex="-1"></a>In this case it's actually more useful to look at the <span class="in">`&lt;bill&gt;`</span> element which is a child node of our XML document<span class="ot">[^4]</span>, which is what <span class="in">`xml_child()`</span> is for.</span>
<span id="cb65-115"><a href="#cb65-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-116"><a href="#cb65-116" aria-hidden="true" tabindex="-1"></a><span class="ot">[^4]: </span>I will confess I'm not quite sure why this is the case, nor do I particularly understand what <span class="in">`&lt;dublinCore&gt;`</span> is (though prevailing theories suggest some kind of document schema or a new metal genre originating from my home of Dublin).</span>
<span id="cb65-117"><a href="#cb65-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-120"><a href="#cb65-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-121"><a href="#cb65-121" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb65-122"><a href="#cb65-122" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xml-bill-child</span></span>
<span id="cb65-123"><a href="#cb65-123" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-overflow: wrap</span></span>
<span id="cb65-124"><a href="#cb65-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Return child nodes named bill</span></span>
<span id="cb65-125"><a href="#cb65-125" aria-hidden="true" tabindex="-1"></a>(<span class="at">bill_xml =</span> <span class="fu">xml_child</span>(bill_xml_file, <span class="st">"bill"</span>))</span>
<span id="cb65-126"><a href="#cb65-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-127"><a href="#cb65-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-128"><a href="#cb65-128" aria-hidden="true" tabindex="-1"></a>Parsing this file to a dataframe will require a little thought because we have a number of nodes which have multiple data points within them. However it's always a good idea to try the simplest approach first, which is the aptly named <span class="in">`xmlToDataFrame()`</span>.</span>
<span id="cb65-129"><a href="#cb65-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-132"><a href="#cb65-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-133"><a href="#cb65-133" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xml-to-df</span></span>
<span id="cb65-134"><a href="#cb65-134" aria-hidden="true" tabindex="-1"></a><span class="co">#| class-output: code-block-h</span></span>
<span id="cb65-135"><a href="#cb65-135" aria-hidden="true" tabindex="-1"></a><span class="co"># First you need to use the xmlParse function</span></span>
<span id="cb65-136"><a href="#cb65-136" aria-hidden="true" tabindex="-1"></a>bill_xml_parse <span class="ot">=</span> <span class="fu">xmlParse</span>(bill_xml_file)</span>
<span id="cb65-137"><a href="#cb65-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-138"><a href="#cb65-138" aria-hidden="true" tabindex="-1"></a><span class="co"># You can wrap a variable assignment in ( ) to print it, </span></span>
<span id="cb65-139"><a href="#cb65-139" aria-hidden="true" tabindex="-1"></a><span class="co"># or in this case pass it to another function via the pipe %&gt;% </span></span>
<span id="cb65-140"><a href="#cb65-140" aria-hidden="true" tabindex="-1"></a>( <span class="at">bill_xml_df_attempt =</span> <span class="fu">xmlToDataFrame</span>(<span class="fu">getNodeSet</span>(bill_xml_parse, <span class="st">"//bill"</span>)) ) <span class="sc">%&gt;%</span> </span>
<span id="cb65-141"><a href="#cb65-141" aria-hidden="true" tabindex="-1"></a>  <span class="co"># View the dataframe structure</span></span>
<span id="cb65-142"><a href="#cb65-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb65-143"><a href="#cb65-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-144"><a href="#cb65-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-145"><a href="#cb65-145" aria-hidden="true" tabindex="-1"></a>But notice that a number of fields like <span class="in">`actions`</span>, <span class="in">`committees`</span>, and <span class="in">`sponsors`</span> have had their values concatenated. This approach works for simpler XML structures, but in this case we need to do a little bit more work to get the data into a tidy dataframe.</span>
<span id="cb65-146"><a href="#cb65-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-147"><a href="#cb65-147" aria-hidden="true" tabindex="-1"></a>That brings us to one of the cardinal rules of data analysis:</span>
<span id="cb65-148"><a href="#cb65-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-149"><a href="#cb65-149" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip appearance="simple"}</span>
<span id="cb65-150"><a href="#cb65-150" aria-hidden="true" tabindex="-1"></a><span class="fu">## Look at your data</span></span>
<span id="cb65-151"><a href="#cb65-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-152"><a href="#cb65-152" aria-hidden="true" tabindex="-1"></a>Look at the structure and contents of your data and understand how it is organized. This is essential for coming up with a solution to consistently process the data.</span>
<span id="cb65-153"><a href="#cb65-153" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-154"><a href="#cb65-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-155"><a href="#cb65-155" aria-hidden="true" tabindex="-1"></a><span class="fu"># Define the output</span></span>
<span id="cb65-156"><a href="#cb65-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-157"><a href="#cb65-157" aria-hidden="true" tabindex="-1"></a>As well as looking at your data, it's also usually helpful to look to your intended output. This determines how to transform the data.</span>
<span id="cb65-158"><a href="#cb65-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-159"><a href="#cb65-159" aria-hidden="true" tabindex="-1"></a>**Example:** I want the congressional data to have one row per bill, with the nested characteristics stored in list columns. This will produce a comprehensive dataset which can easily be subset and transformed to various levels of observation as needed. The end result should look like this:</span>
<span id="cb65-160"><a href="#cb65-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-163"><a href="#cb65-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-164"><a href="#cb65-164" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-bill</span></span>
<span id="cb65-165"><a href="#cb65-165" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-166"><a href="#cb65-166" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb65-167"><a href="#cb65-167" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: screen-inset-shaded</span></span>
<span id="cb65-168"><a href="#cb65-168" aria-hidden="true" tabindex="-1"></a>example_bill_df <span class="ot">=</span> <span class="fu">extract_bill_status</span>(bill_xml_link, <span class="at">log_types =</span> <span class="cn">NULL</span>)</span>
<span id="cb65-169"><a href="#cb65-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-170"><a href="#cb65-170" aria-hidden="true" tabindex="-1"></a>example_bill_df <span class="sc">%&gt;%</span> <span class="co"># glimpse() # here to check the data</span></span>
<span id="cb65-171"><a href="#cb65-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb65-172"><a href="#cb65-172" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>bill_id, <span class="sc">-</span><span class="fu">where</span>(is_list) <span class="co"># remove list columns?</span></span>
<span id="cb65-173"><a href="#cb65-173" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb65-174"><a href="#cb65-174" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb65-175"><a href="#cb65-175" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">moke_rt</span>(),</span>
<span id="cb65-176"><a href="#cb65-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">compact =</span> T,</span>
<span id="cb65-177"><a href="#cb65-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">resizable =</span> T,</span>
<span id="cb65-178"><a href="#cb65-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">wrap =</span> F,</span>
<span id="cb65-179"><a href="#cb65-179" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb65-180"><a href="#cb65-180" aria-hidden="true" tabindex="-1"></a>      <span class="st">"latest_action_action_date"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">name =</span> <span class="st">"action_date"</span>, </span>
<span id="cb65-181"><a href="#cb65-181" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T)),</span>
<span id="cb65-182"><a href="#cb65-182" aria-hidden="true" tabindex="-1"></a>     <span class="st">"latest_action_text"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">name =</span> <span class="st">"action_text"</span>),</span>
<span id="cb65-183"><a href="#cb65-183" aria-hidden="true" tabindex="-1"></a>       <span class="st">"constitutional_authority_statement_text"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">show=</span>F),</span>
<span id="cb65-184"><a href="#cb65-184" aria-hidden="true" tabindex="-1"></a>      <span class="st">"create_date"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T), <span class="at">width =</span> <span class="dv">95</span>),</span>
<span id="cb65-185"><a href="#cb65-185" aria-hidden="true" tabindex="-1"></a>      <span class="st">"update_date"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T), <span class="at">width =</span> <span class="dv">95</span>),</span>
<span id="cb65-186"><a href="#cb65-186" aria-hidden="true" tabindex="-1"></a>      <span class="st">"introduced_date"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T), <span class="at">width =</span> <span class="dv">130</span>),</span>
<span id="cb65-187"><a href="#cb65-187" aria-hidden="true" tabindex="-1"></a>      <span class="st">"congress"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">80</span>),</span>
<span id="cb65-188"><a href="#cb65-188" aria-hidden="true" tabindex="-1"></a>      <span class="st">"version"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">80</span>),</span>
<span id="cb65-189"><a href="#cb65-189" aria-hidden="true" tabindex="-1"></a>      <span class="st">"bill_number"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">100</span>),</span>
<span id="cb65-190"><a href="#cb65-190" aria-hidden="true" tabindex="-1"></a>      <span class="st">"bill_type"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">80</span>),</span>
<span id="cb65-191"><a href="#cb65-191" aria-hidden="true" tabindex="-1"></a>      <span class="st">"title"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">minWidth =</span> <span class="dv">180</span>)</span>
<span id="cb65-192"><a href="#cb65-192" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb65-193"><a href="#cb65-193" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnGroups =</span> <span class="fu">list</span>(</span>
<span id="cb65-194"><a href="#cb65-194" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colGroup</span>(<span class="at">name =</span> <span class="st">"Latest Action"</span>,</span>
<span id="cb65-195"><a href="#cb65-195" aria-hidden="true" tabindex="-1"></a>                            <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"latest_action_action_date"</span>,</span>
<span id="cb65-196"><a href="#cb65-196" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"latest_action_text"</span>))</span>
<span id="cb65-197"><a href="#cb65-197" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-198"><a href="#cb65-198" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-199"><a href="#cb65-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-200"><a href="#cb65-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-201"><a href="#cb65-201" aria-hidden="true" tabindex="-1"></a>With the following list columns (among others):</span>
<span id="cb65-202"><a href="#cb65-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-203"><a href="#cb65-203" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb65-204"><a href="#cb65-204" aria-hidden="true" tabindex="-1"></a><span class="fu">## Committees</span></span>
<span id="cb65-205"><a href="#cb65-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-208"><a href="#cb65-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-209"><a href="#cb65-209" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: glimpse-committees</span></span>
<span id="cb65-210"><a href="#cb65-210" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-211"><a href="#cb65-211" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(example_bill_df[[<span class="st">"committees"</span>]])</span>
<span id="cb65-212"><a href="#cb65-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-213"><a href="#cb65-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-214"><a href="#cb65-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-215"><a href="#cb65-215" aria-hidden="true" tabindex="-1"></a><span class="fu">## Votes</span></span>
<span id="cb65-216"><a href="#cb65-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-219"><a href="#cb65-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-220"><a href="#cb65-220" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: glimpse-votes</span></span>
<span id="cb65-221"><a href="#cb65-221" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-222"><a href="#cb65-222" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(example_bill_df[[<span class="st">"votes"</span>]])</span>
<span id="cb65-223"><a href="#cb65-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-224"><a href="#cb65-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-225"><a href="#cb65-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-226"><a href="#cb65-226" aria-hidden="true" tabindex="-1"></a><span class="fu">## Actions</span></span>
<span id="cb65-227"><a href="#cb65-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-230"><a href="#cb65-230" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-231"><a href="#cb65-231" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: glimpse-actio</span></span>
<span id="cb65-232"><a href="#cb65-232" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-233"><a href="#cb65-233" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(example_bill_df[[<span class="st">"actions"</span>]])</span>
<span id="cb65-234"><a href="#cb65-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-235"><a href="#cb65-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-236"><a href="#cb65-236" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sponsors</span></span>
<span id="cb65-237"><a href="#cb65-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-240"><a href="#cb65-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-241"><a href="#cb65-241" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: glimpse-sponsors</span></span>
<span id="cb65-242"><a href="#cb65-242" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-243"><a href="#cb65-243" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(example_bill_df[[<span class="st">"sponsors"</span>]])</span>
<span id="cb65-244"><a href="#cb65-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-245"><a href="#cb65-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-246"><a href="#cb65-246" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cosponsors</span></span>
<span id="cb65-247"><a href="#cb65-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-250"><a href="#cb65-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-251"><a href="#cb65-251" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: glimpse-cosponsors</span></span>
<span id="cb65-252"><a href="#cb65-252" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-253"><a href="#cb65-253" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(example_bill_df[[<span class="st">"cosponsors"</span>]])</span>
<span id="cb65-254"><a href="#cb65-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-255"><a href="#cb65-255" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-256"><a href="#cb65-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-257"><a href="#cb65-257" aria-hidden="true" tabindex="-1"></a>With this output in mind and an understanding of the current data structure, we can break the parsing process down into two categories - the simple, and the not-so-simple.</span>
<span id="cb65-258"><a href="#cb65-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-259"><a href="#cb65-259" aria-hidden="true" tabindex="-1"></a><span class="fu"># Parsing</span></span>
<span id="cb65-260"><a href="#cb65-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-261"><a href="#cb65-261" aria-hidden="true" tabindex="-1"></a><span class="fu">## Parse the simple elements</span></span>
<span id="cb65-262"><a href="#cb65-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-263"><a href="#cb65-263" aria-hidden="true" tabindex="-1"></a>The simple parts of the data to process are those which are already at the level of observation you want. In our case - at the bill level. These are typically the top-level nodes which only have one piece of data. To select only these nodes we can write a function like the one below:</span>
<span id="cb65-264"><a href="#cb65-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-267"><a href="#cb65-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-268"><a href="#cb65-268" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: singular-nodes</span></span>
<span id="cb65-269"><a href="#cb65-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb65-270"><a href="#cb65-270" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to select singular child nodes from XML node</span></span>
<span id="cb65-271"><a href="#cb65-271" aria-hidden="true" tabindex="-1"></a>xml_singular_nodes <span class="ot">=</span> <span class="cf">function</span>(xml_node){</span>
<span id="cb65-272"><a href="#cb65-272" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return child nodes of current node</span></span>
<span id="cb65-273"><a href="#cb65-273" aria-hidden="true" tabindex="-1"></a>  child_nodes <span class="ot">=</span> <span class="fu">xml_children</span>(xml_node)</span>
<span id="cb65-274"><a href="#cb65-274" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select child nodes with 0 children</span></span>
<span id="cb65-275"><a href="#cb65-275" aria-hidden="true" tabindex="-1"></a>  zero_length_child_nodes <span class="ot">=</span> child_nodes[<span class="fu">xml_length</span>(child_nodes) <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb65-276"><a href="#cb65-276" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-277"><a href="#cb65-277" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep the nodes which are not empty strings</span></span>
<span id="cb65-278"><a href="#cb65-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(zero_length_child_nodes, <span class="sc">~</span>(<span class="fu">xml_text</span>(.) <span class="sc">!=</span> <span class="st">""</span>))</span>
<span id="cb65-279"><a href="#cb65-279" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-280"><a href="#cb65-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-281"><a href="#cb65-281" aria-hidden="true" tabindex="-1"></a>(<span class="at">singular_nodes =</span> <span class="fu">xml_singular_nodes</span>(bill_xml))</span>
<span id="cb65-282"><a href="#cb65-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-283"><a href="#cb65-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-284"><a href="#cb65-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-285"><a href="#cb65-285" aria-hidden="true" tabindex="-1"></a>Now with a nifty combination of <span class="in">`as_list()`</span>, <span class="in">`xml_name()`</span>, and <span class="in">`flatten_dfc()`</span> we can convert the singular nodes into a single row of data.</span>
<span id="cb65-286"><a href="#cb65-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-289"><a href="#cb65-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-290"><a href="#cb65-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: singular-nodes-df</span></span>
<span id="cb65-291"><a href="#cb65-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb65-292"><a href="#cb65-292" aria-hidden="true" tabindex="-1"></a>bill_df <span class="ot">=</span> <span class="fu">as_list</span>(singular_nodes) <span class="sc">%&gt;%</span> </span>
<span id="cb65-293"><a href="#cb65-293" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as_list() doesn't retain element names so we set names ourselves</span></span>
<span id="cb65-294"><a href="#cb65-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">xml_name</span>(singular_nodes)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-295"><a href="#cb65-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flatten_dfc</span>()</span>
<span id="cb65-296"><a href="#cb65-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-297"><a href="#cb65-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-298"><a href="#cb65-298" aria-hidden="true" tabindex="-1"></a>Which gives us a single row of data:</span>
<span id="cb65-299"><a href="#cb65-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-302"><a href="#cb65-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-303"><a href="#cb65-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: singular-nodes-rt</span></span>
<span id="cb65-304"><a href="#cb65-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb65-305"><a href="#cb65-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-306"><a href="#cb65-306" aria-hidden="true" tabindex="-1"></a><span class="fu">reactable</span>(bill_df,</span>
<span id="cb65-307"><a href="#cb65-307" aria-hidden="true" tabindex="-1"></a>          <span class="at">theme =</span> <span class="fu">moke_rt</span>(),</span>
<span id="cb65-308"><a href="#cb65-308" aria-hidden="true" tabindex="-1"></a>            <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb65-309"><a href="#cb65-309" aria-hidden="true" tabindex="-1"></a>              <span class="st">"constitutionalAuthorityStatementText"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">show=</span>F),</span>
<span id="cb65-310"><a href="#cb65-310" aria-hidden="true" tabindex="-1"></a>              <span class="st">"createDate"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T), <span class="at">width =</span> <span class="dv">90</span>),</span>
<span id="cb65-311"><a href="#cb65-311" aria-hidden="true" tabindex="-1"></a>              <span class="st">"updateDate"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T), <span class="at">width =</span> <span class="dv">90</span>),</span>
<span id="cb65-312"><a href="#cb65-312" aria-hidden="true" tabindex="-1"></a>              <span class="st">"introducedDate"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T), <span class="at">width =</span> <span class="dv">120</span>),</span>
<span id="cb65-313"><a href="#cb65-313" aria-hidden="true" tabindex="-1"></a>              <span class="st">"congress"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">80</span>),</span>
<span id="cb65-314"><a href="#cb65-314" aria-hidden="true" tabindex="-1"></a>              <span class="st">"version"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">80</span>),</span>
<span id="cb65-315"><a href="#cb65-315" aria-hidden="true" tabindex="-1"></a>              <span class="st">"billNumber"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">100</span>),</span>
<span id="cb65-316"><a href="#cb65-316" aria-hidden="true" tabindex="-1"></a>              <span class="st">"billType"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">80</span>),</span>
<span id="cb65-317"><a href="#cb65-317" aria-hidden="true" tabindex="-1"></a>              <span class="st">"title"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">minWidth =</span> <span class="dv">180</span>)</span>
<span id="cb65-318"><a href="#cb65-318" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb65-319"><a href="#cb65-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-320"><a href="#cb65-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-321"><a href="#cb65-321" aria-hidden="true" tabindex="-1"></a>::: callout-caution</span>
<span id="cb65-322"><a href="#cb65-322" aria-hidden="true" tabindex="-1"></a><span class="fu">## What about empty elements?</span></span>
<span id="cb65-323"><a href="#cb65-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-324"><a href="#cb65-324" aria-hidden="true" tabindex="-1"></a>Note that <span class="in">`flatten_dfc()`</span> drops list elements which are empty (possibly through <span class="in">`compact()`</span>?). This means our output varies based on each file's contents. This is not an issue itself, but it is something to be wary of if you plan on combining multiple XML files.</span>
<span id="cb65-325"><a href="#cb65-325" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-326"><a href="#cb65-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-327"><a href="#cb65-327" aria-hidden="true" tabindex="-1"></a>Now we have the bill title, when it was introduced, what type of bill it is, and which congress introduced it. I also want to include the data for actions, sponsors, committees, and votes, but these need to processed individually.</span>
<span id="cb65-328"><a href="#cb65-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-329"><a href="#cb65-329" aria-hidden="true" tabindex="-1"></a><span class="fu">## Parse the not-so-simple elements</span></span>
<span id="cb65-330"><a href="#cb65-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-331"><a href="#cb65-331" aria-hidden="true" tabindex="-1"></a>This is where the majority of the legwork is so if you can comfortably ignore<span class="ot">[^5]</span> some portion of the data, now's a good time. There's no point spending an hour trying to write a function for one particularly difficult bit of information only to realize you don't need it anyway.</span>
<span id="cb65-332"><a href="#cb65-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-333"><a href="#cb65-333" aria-hidden="true" tabindex="-1"></a><span class="ot">[^5]: </span>But do yourself a favour and write it down somewhere - comment it in the code, tell your colleagues or collaborators, put it on a particularly strong post it, whatever works.</span>
<span id="cb65-334"><a href="#cb65-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-335"><a href="#cb65-335" aria-hidden="true" tabindex="-1"></a>For brevity I will just go through actions and votes, but you can find the code for extracting the full XML file <span class="co">[</span><span class="ot">here</span><span class="co">](https://github.com/MokeEire/my-reps/blob/master/R/parsing_functions.R)</span><span class="ot">[^6]</span>.</span>
<span id="cb65-336"><a href="#cb65-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-337"><a href="#cb65-337" aria-hidden="true" tabindex="-1"></a><span class="ot">[^6]: </span>Ctrl/Cmd+F: <span class="in">`extract_bill_status`</span></span>
<span id="cb65-338"><a href="#cb65-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-339"><a href="#cb65-339" aria-hidden="true" tabindex="-1"></a><span class="fu">### Actions</span></span>
<span id="cb65-340"><a href="#cb65-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-341"><a href="#cb65-341" aria-hidden="true" tabindex="-1"></a>What's in the actions container?</span>
<span id="cb65-342"><a href="#cb65-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-345"><a href="#cb65-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-346"><a href="#cb65-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: actions-xml</span></span>
<span id="cb65-347"><a href="#cb65-347" aria-hidden="true" tabindex="-1"></a>(<span class="at">actions_xml =</span> <span class="fu">xml_find_all</span>(bill_xml, <span class="st">"actions/item"</span>))</span>
<span id="cb65-348"><a href="#cb65-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-349"><a href="#cb65-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-350"><a href="#cb65-350" aria-hidden="true" tabindex="-1"></a>So this bill has 14 actions recorded on it. We can use <span class="in">`as_list()`</span> to convert the XML to a list.</span>
<span id="cb65-351"><a href="#cb65-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-354"><a href="#cb65-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-355"><a href="#cb65-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: actions-list</span></span>
<span id="cb65-356"><a href="#cb65-356" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb65-357"><a href="#cb65-357" aria-hidden="true" tabindex="-1"></a>actions_list <span class="ot">=</span> <span class="fu">as_list</span>(actions_xml)</span>
<span id="cb65-358"><a href="#cb65-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-359"><a href="#cb65-359" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(actions_list[[<span class="dv">1</span>]])</span>
<span id="cb65-360"><a href="#cb65-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-361"><a href="#cb65-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-362"><a href="#cb65-362" aria-hidden="true" tabindex="-1"></a>In the individual action container, we can see we have the type, text, and date of the action, a list of committees related to the action, and some elements which are singular and some which are not. To deal with this, we can write a function (or set of functions) like the ones below to process an action:</span>
<span id="cb65-363"><a href="#cb65-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-366"><a href="#cb65-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-367"><a href="#cb65-367" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: actions-functions</span></span>
<span id="cb65-368"><a href="#cb65-368" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb65-369"><a href="#cb65-369" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to flatten a list to dataframe columns and </span></span>
<span id="cb65-370"><a href="#cb65-370" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns with a given prefix</span></span>
<span id="cb65-371"><a href="#cb65-371" aria-hidden="true" tabindex="-1"></a>flatten_dfc_rename <span class="ot">=</span> <span class="cf">function</span>(list_to_flatten, </span>
<span id="cb65-372"><a href="#cb65-372" aria-hidden="true" tabindex="-1"></a>                          <span class="at">name_prefix =</span> <span class="st">"prefix"</span>){</span>
<span id="cb65-373"><a href="#cb65-373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="fu">flatten_dfc</span>(list_to_flatten), <span class="sc">~</span><span class="fu">str_c</span>(name_prefix, <span class="st">"_"</span>, .))</span>
<span id="cb65-374"><a href="#cb65-374" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-375"><a href="#cb65-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-376"><a href="#cb65-376" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse actions from list to dataframe</span></span>
<span id="cb65-377"><a href="#cb65-377" aria-hidden="true" tabindex="-1"></a>parse_action <span class="ot">=</span> <span class="cf">function</span>(action){</span>
<span id="cb65-378"><a href="#cb65-378" aria-hidden="true" tabindex="-1"></a>  action <span class="sc">%&gt;%</span> </span>
<span id="cb65-379"><a href="#cb65-379" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flatten sourceSystem elements and rename them</span></span>
<span id="cb65-380"><a href="#cb65-380" aria-hidden="true" tabindex="-1"></a>    <span class="fu">modify_at</span>(<span class="st">"sourceSystem"</span>, <span class="sc">~</span><span class="fu">flatten_dfc_rename</span>(.x, <span class="st">"source"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-381"><a href="#cb65-381" aria-hidden="true" tabindex="-1"></a>    <span class="fu">modify_at</span>(<span class="st">"committees"</span>, <span class="cf">function</span>(committee){</span>
<span id="cb65-382"><a href="#cb65-382" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map_dfr</span>(committee, <span class="sc">~</span><span class="fu">flatten_dfc_rename</span>(.x, <span class="st">"committee"</span>))</span>
<span id="cb65-383"><a href="#cb65-383" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span> </span>
<span id="cb65-384"><a href="#cb65-384" aria-hidden="true" tabindex="-1"></a>    <span class="fu">flatten_dfc</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-385"><a href="#cb65-385" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_with</span>(<span class="at">.fn =</span> <span class="sc">~</span><span class="fu">str_c</span>(<span class="st">"action_"</span>, .), <span class="at">.cols =</span> <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"action"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-386"><a href="#cb65-386" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb65-387"><a href="#cb65-387" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-388"><a href="#cb65-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-389"><a href="#cb65-389" aria-hidden="true" tabindex="-1"></a><span class="fu">parse_action</span>(actions_list[[<span class="dv">1</span>]])</span>
<span id="cb65-390"><a href="#cb65-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-391"><a href="#cb65-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-392"><a href="#cb65-392" aria-hidden="true" tabindex="-1"></a>Using <span class="in">`{purrr}`</span>'s <span class="in">`map_*()`</span> functions, we can apply this function over all of the items:</span>
<span id="cb65-393"><a href="#cb65-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-396"><a href="#cb65-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-397"><a href="#cb65-397" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: actions-dfr</span></span>
<span id="cb65-398"><a href="#cb65-398" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb65-399"><a href="#cb65-399" aria-hidden="true" tabindex="-1"></a>(<span class="at">actions_df =</span> <span class="fu">map_dfr</span>(actions_list, parse_action)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-400"><a href="#cb65-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb65-401"><a href="#cb65-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-402"><a href="#cb65-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-403"><a href="#cb65-403" aria-hidden="true" tabindex="-1"></a>Now if you're processing a large amount of these data, you may want to be explicit about the data types expected in each column. This is vital when we want to <span class="in">`unnest()`</span> the actions data and combine many bills' actions into an actions-level dataset. You can do this using <span class="in">`type_convert()`</span> , notice the change in column types from the output above.</span>
<span id="cb65-404"><a href="#cb65-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-407"><a href="#cb65-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-408"><a href="#cb65-408" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: actions-type-conv</span></span>
<span id="cb65-409"><a href="#cb65-409" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb65-410"><a href="#cb65-410" aria-hidden="true" tabindex="-1"></a>(<span class="at">actions_df =</span> <span class="fu">type_convert</span>(actions_df,</span>
<span id="cb65-411"><a href="#cb65-411" aria-hidden="true" tabindex="-1"></a>                          <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb65-412"><a href="#cb65-412" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_date =</span> <span class="fu">col_date</span>(), </span>
<span id="cb65-413"><a href="#cb65-413" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_time =</span> <span class="fu">col_time</span>(),</span>
<span id="cb65-414"><a href="#cb65-414" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_committee_systemCode =</span> <span class="fu">col_character</span>(), </span>
<span id="cb65-415"><a href="#cb65-415" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_committee_name =</span> <span class="fu">col_character</span>(), </span>
<span id="cb65-416"><a href="#cb65-416" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_source_code =</span> <span class="fu">col_character</span>(),</span>
<span id="cb65-417"><a href="#cb65-417" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_source_name =</span> <span class="fu">col_character</span>(),</span>
<span id="cb65-418"><a href="#cb65-418" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_text =</span> <span class="fu">col_character</span>(), </span>
<span id="cb65-419"><a href="#cb65-419" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_type =</span> <span class="fu">col_character</span>(), </span>
<span id="cb65-420"><a href="#cb65-420" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_code =</span> <span class="fu">col_character</span>()</span>
<span id="cb65-421"><a href="#cb65-421" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb65-422"><a href="#cb65-422" aria-hidden="true" tabindex="-1"></a>                          )) <span class="sc">%&gt;%</span> </span>
<span id="cb65-423"><a href="#cb65-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb65-424"><a href="#cb65-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-425"><a href="#cb65-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-426"><a href="#cb65-426" aria-hidden="true" tabindex="-1"></a>To add these actions data as a list column to <span class="in">`bill_df`</span> we can simply use dollar assignment.</span>
<span id="cb65-427"><a href="#cb65-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-430"><a href="#cb65-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-431"><a href="#cb65-431" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: add-actions</span></span>
<span id="cb65-432"><a href="#cb65-432" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb65-433"><a href="#cb65-433" aria-hidden="true" tabindex="-1"></a>bill_df<span class="sc">$</span>actions <span class="ot">=</span> <span class="fu">list</span>(actions_df)</span>
<span id="cb65-434"><a href="#cb65-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-435"><a href="#cb65-435" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(bill_df)</span>
<span id="cb65-436"><a href="#cb65-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-437"><a href="#cb65-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-438"><a href="#cb65-438" aria-hidden="true" tabindex="-1"></a>The remaining sections will be following the same process for different elements, but it can be boiled down to these steps:</span>
<span id="cb65-439"><a href="#cb65-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-440"><a href="#cb65-440" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Explore the structure**</span>
<span id="cb65-441"><a href="#cb65-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-442"><a href="#cb65-442" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Go through any available documentation, and when you read in the XML file you can use functions like </span><span class="in">`xmlParse()`</span><span class="at">, </span><span class="in">`xml_structure()`</span><span class="at">, and </span><span class="in">`xml_contents()`</span><span class="at"> .</span></span>
<span id="cb65-443"><a href="#cb65-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-444"><a href="#cb65-444" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Define the output**</span>
<span id="cb65-445"><a href="#cb65-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-446"><a href="#cb65-446" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Consider what you want the output to look like and think about how it needs to be transformed to match this target.</span></span>
<span id="cb65-447"><a href="#cb65-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-448"><a href="#cb65-448" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Process a single element** (write a function if it gets too complicated)</span>
<span id="cb65-449"><a href="#cb65-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-450"><a href="#cb65-450" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Get one element into the form you want. Writing functions can help you think through the data transformations being applied and make your code easier to read.</span></span>
<span id="cb65-451"><a href="#cb65-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-452"><a href="#cb65-452" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Apply to all elements**</span>
<span id="cb65-453"><a href="#cb65-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-454"><a href="#cb65-454" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Focus on processing of the entire file (or the subset of the file you're interested in). You might want an XML file to return a single row, a single column, or a dataframe of size $n\times k$. Once you have a single file returned in the format you want, you can combine the outputs of multiple files.</span></span>
<span id="cb65-455"><a href="#cb65-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-456"><a href="#cb65-456" aria-hidden="true" tabindex="-1"></a>::: {.callout-caution appearance="simple"}</span>
<span id="cb65-457"><a href="#cb65-457" aria-hidden="true" tabindex="-1"></a><span class="fu">## Find the exceptions</span></span>
<span id="cb65-458"><a href="#cb65-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-459"><a href="#cb65-459" aria-hidden="true" tabindex="-1"></a>Lastly, you will likely run into situations where a node which only seemed to contain a single piece of data has a different structure with multiple sub-elements for other files. This will happen, you'll go back to the drawing board, design more flexibility in your functions, and understand how process either format.</span>
<span id="cb65-460"><a href="#cb65-460" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-461"><a href="#cb65-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-464"><a href="#cb65-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-465"><a href="#cb65-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb65-466"><a href="#cb65-466" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb65-467"><a href="#cb65-467" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-468"><a href="#cb65-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-469"><a href="#cb65-469" aria-hidden="true" tabindex="-1"></a>bill_actions <span class="ot">=</span> <span class="fu">xml_find_all</span>(actions_node, <span class="st">"item"</span>)</span>
<span id="cb65-470"><a href="#cb65-470" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-471"><a href="#cb65-471" aria-hidden="true" tabindex="-1"></a>bill_action_counts <span class="ot">=</span> <span class="fu">as_list</span>(<span class="fu">xml_find_all</span>(actions_node, <span class="st">"./*[not(self::item)]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-472"><a href="#cb65-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfc</span>(flatten_dfc) <span class="sc">%&gt;%</span> </span>
<span id="cb65-473"><a href="#cb65-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">str_c</span>(<span class="st">"actions_"</span>, .)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-474"><a href="#cb65-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"action"</span>, <span class="at">names_prefix =</span> <span class="st">"actions_"</span>, <span class="at">values_to =</span> <span class="st">"count"</span>)</span>
<span id="cb65-475"><a href="#cb65-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-476"><a href="#cb65-476" aria-hidden="true" tabindex="-1"></a><span class="co"># Coerce nodes to list</span></span>
<span id="cb65-477"><a href="#cb65-477" aria-hidden="true" tabindex="-1"></a>actions_df <span class="ot">=</span> <span class="fu">as_list</span>(bill_actions) <span class="sc">%&gt;%</span> </span>
<span id="cb65-478"><a href="#cb65-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(parse_action) <span class="sc">%&gt;%</span> </span>
<span id="cb65-479"><a href="#cb65-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">type_convert</span>(<span class="at">col_types =</span> col_specs<span class="sc">$</span>actions)</span>
<span id="cb65-480"><a href="#cb65-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-481"><a href="#cb65-481" aria-hidden="true" tabindex="-1"></a>bill_df<span class="sc">$</span>actions <span class="ot">=</span> <span class="fu">list</span>(actions_df)</span>
<span id="cb65-482"><a href="#cb65-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-483"><a href="#cb65-483" aria-hidden="true" tabindex="-1"></a>bill_df<span class="sc">$</span>action_counts <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">type_convert</span>(bill_action_counts,</span>
<span id="cb65-484"><a href="#cb65-484" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">action =</span> <span class="fu">col_character</span>(), <span class="at">count =</span> <span class="fu">col_integer</span>())))</span>
<span id="cb65-485"><a href="#cb65-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-486"><a href="#cb65-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-487"><a href="#cb65-487" aria-hidden="true" tabindex="-1"></a><span class="fu">### Votes</span></span>
<span id="cb65-488"><a href="#cb65-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-489"><a href="#cb65-489" aria-hidden="true" tabindex="-1"></a>Votes are particularly interesting because it provides a more discrete measure of our representatives' behaviour. Individual votes are stored in the <span class="in">`&lt;recordedVotes&gt;`</span> container. We can access child elements in XML using a forward slash (this uses a language called XPATH).</span>
<span id="cb65-490"><a href="#cb65-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-493"><a href="#cb65-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-494"><a href="#cb65-494" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-nodes-contents</span></span>
<span id="cb65-495"><a href="#cb65-495" aria-hidden="true" tabindex="-1"></a>(<span class="at">bill_recorded_vote_nodes =</span> <span class="fu">xml_find_all</span>(bill_xml, <span class="st">"recordedVotes/recordedVote"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-496"><a href="#cb65-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_contents</span>()</span>
<span id="cb65-497"><a href="#cb65-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-498"><a href="#cb65-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-499"><a href="#cb65-499" aria-hidden="true" tabindex="-1"></a>You may have spotted why votes are interesting elements to parse because inside the <span class="in">`&lt;url&gt;`</span> element we find **another** **XML file**!<span class="ot">[^7]</span> Before we dive into that can of worms, I'll convert the top-level nodes to a list and flatten it into columns. Note we use <span class="in">`map_dfr()`</span> with <span class="in">`votes_list`</span> because there could be multiple vote objects.</span>
<span id="cb65-500"><a href="#cb65-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-501"><a href="#cb65-501" aria-hidden="true" tabindex="-1"></a><span class="ot">[^7]: </span><span class="al">![They heard you like XML](https://c.tenor.com/um2EhyMQyR8AAAAC/xzibit-meme.gif)</span></span>
<span id="cb65-502"><a href="#cb65-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-505"><a href="#cb65-505" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-506"><a href="#cb65-506" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-nodes-df</span></span>
<span id="cb65-507"><a href="#cb65-507" aria-hidden="true" tabindex="-1"></a><span class="co"># Coerce nodes to list</span></span>
<span id="cb65-508"><a href="#cb65-508" aria-hidden="true" tabindex="-1"></a>recorded_votes_list <span class="ot">=</span> <span class="fu">as_list</span>(bill_recorded_vote_nodes)</span>
<span id="cb65-509"><a href="#cb65-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-510"><a href="#cb65-510" aria-hidden="true" tabindex="-1"></a>(<span class="at">recorded_votes_df =</span> <span class="fu">map_dfr</span>(recorded_votes_list, flatten_dfc)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-511"><a href="#cb65-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb65-512"><a href="#cb65-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-513"><a href="#cb65-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-514"><a href="#cb65-514" aria-hidden="true" tabindex="-1"></a>Now we want to get the vote roll XML file, so we go back to <span class="in">`read_xml()`</span> .</span>
<span id="cb65-515"><a href="#cb65-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-518"><a href="#cb65-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-519"><a href="#cb65-519" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-xml</span></span>
<span id="cb65-520"><a href="#cb65-520" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_roll_xml =</span> <span class="fu">read_xml</span>(recorded_votes_df<span class="sc">$</span>url))</span>
<span id="cb65-521"><a href="#cb65-521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-522"><a href="#cb65-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-523"><a href="#cb65-523" aria-hidden="true" tabindex="-1"></a>There are two main nodes - <span class="in">`&lt;vote-metadata&gt;`</span> and <span class="in">`&lt;vote-data&gt;`</span>. How many elements does each node have and what do the structures for these look like?</span>
<span id="cb65-524"><a href="#cb65-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-527"><a href="#cb65-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-528"><a href="#cb65-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-children</span></span>
<span id="cb65-529"><a href="#cb65-529" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_roll_children =</span> <span class="fu">xml_children</span>(vote_roll_xml)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-530"><a href="#cb65-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(xml_contents)</span>
<span id="cb65-531"><a href="#cb65-531" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-532"><a href="#cb65-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-533"><a href="#cb65-533" aria-hidden="true" tabindex="-1"></a>One node contains the aggregated vote information, while <span class="in">`&lt;vote-data&gt;`</span> contains the legislator-level vote data. Let's try to parse the legislator-level data first.</span>
<span id="cb65-534"><a href="#cb65-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-537"><a href="#cb65-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-538"><a href="#cb65-538" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-data</span></span>
<span id="cb65-539"><a href="#cb65-539" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_data =</span> <span class="fu">xml_find_all</span>(vote_roll_xml, <span class="st">"vote-data"</span>))</span>
<span id="cb65-540"><a href="#cb65-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-541"><a href="#cb65-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-542"><a href="#cb65-542" aria-hidden="true" tabindex="-1"></a>Here is the XML for a single legislator's vote:</span>
<span id="cb65-543"><a href="#cb65-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-546"><a href="#cb65-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-547"><a href="#cb65-547" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-data-single</span></span>
<span id="cb65-548"><a href="#cb65-548" aria-hidden="true" tabindex="-1"></a><span class="fu">xml_child</span>(vote_data)</span>
<span id="cb65-549"><a href="#cb65-549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-550"><a href="#cb65-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-551"><a href="#cb65-551" aria-hidden="true" tabindex="-1"></a>With a similar combination of <span class="in">`as_list()`</span> , <span class="in">`flatten_dfr()`</span>, and <span class="in">`unnest()`</span> we can flatten the XML into one row per legislator</span>
<span id="cb65-552"><a href="#cb65-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-555"><a href="#cb65-555" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-556"><a href="#cb65-556" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-data-flat</span></span>
<span id="cb65-557"><a href="#cb65-557" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_roll_flattened =</span> vote_data <span class="sc">%&gt;%</span> </span>
<span id="cb65-558"><a href="#cb65-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-559"><a href="#cb65-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flatten_dfr</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-560"><a href="#cb65-560" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(<span class="fu">everything</span>()))</span>
<span id="cb65-561"><a href="#cb65-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-562"><a href="#cb65-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-563"><a href="#cb65-563" aria-hidden="true" tabindex="-1"></a>But we lose all the attributes! And <span class="in">`name-id`</span> looked particularly useful. We'll need to extract the attributes before we flatten the data. Let's take another look at the legislators structure.</span>
<span id="cb65-564"><a href="#cb65-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-567"><a href="#cb65-567" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-568"><a href="#cb65-568" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-leg-list</span></span>
<span id="cb65-569"><a href="#cb65-569" aria-hidden="true" tabindex="-1"></a>vote_legislators <span class="ot">=</span> vote_data <span class="sc">%&gt;%</span> </span>
<span id="cb65-570"><a href="#cb65-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_find_all</span>(<span class="st">"recorded-vote"</span>)</span>
<span id="cb65-571"><a href="#cb65-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-572"><a href="#cb65-572" aria-hidden="true" tabindex="-1"></a>(<span class="at">legislators_list =</span> <span class="fu">as_list</span>(vote_legislators))[<span class="dv">1</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb65-573"><a href="#cb65-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb65-574"><a href="#cb65-574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-575"><a href="#cb65-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-576"><a href="#cb65-576" aria-hidden="true" tabindex="-1"></a>The legislator element has all the attributes, while the vote element only has a value. We want to extract the attributes only for legislator using <span class="in">`map()`</span> to apply <span class="in">`map_at()`</span> on each legislator element and extract the attributes from each while retaining the value in <span class="in">`vote`</span>. It can often feel like you're getting lost in a list of lists, but with some experimentation you'll be able to find your way back to the surface.</span>
<span id="cb65-577"><a href="#cb65-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-580"><a href="#cb65-580" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-581"><a href="#cb65-581" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-leg-df</span></span>
<span id="cb65-582"><a href="#cb65-582" aria-hidden="true" tabindex="-1"></a>(<span class="at">legislator_vote_df =</span> legislators_list <span class="sc">%&gt;%</span> </span>
<span id="cb65-583"><a href="#cb65-583" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Modify one level deeper using map_at to target legislator elements</span></span>
<span id="cb65-584"><a href="#cb65-584" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(map_at, <span class="st">"legislator"</span>, attributes) <span class="sc">%&gt;%</span> </span>
<span id="cb65-585"><a href="#cb65-585" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(flatten_dfc))</span>
<span id="cb65-586"><a href="#cb65-586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-587"><a href="#cb65-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-588"><a href="#cb65-588" aria-hidden="true" tabindex="-1"></a>Now we have a table of legislator voting data! But what about the <span class="in">`&lt;vote-metadata&gt;`</span>?</span>
<span id="cb65-589"><a href="#cb65-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-592"><a href="#cb65-592" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-593"><a href="#cb65-593" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-metadata-xml</span></span>
<span id="cb65-594"><a href="#cb65-594" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_metadata =</span> <span class="fu">xml_find_all</span>(vote_roll_xml, <span class="st">"vote-metadata"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-595"><a href="#cb65-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_contents</span>()</span>
<span id="cb65-596"><a href="#cb65-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-597"><a href="#cb65-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-598"><a href="#cb65-598" aria-hidden="true" tabindex="-1"></a>Everything other than the <span class="in">`&lt;vote-totals&gt;`</span> element is singular so we can get that out of the way the same way as before:</span>
<span id="cb65-599"><a href="#cb65-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-602"><a href="#cb65-602" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-603"><a href="#cb65-603" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-metadata-singular</span></span>
<span id="cb65-604"><a href="#cb65-604" aria-hidden="true" tabindex="-1"></a>vote_singular_nodes <span class="ot">=</span> <span class="fu">xml_singular_nodes</span>(vote_metadata)</span>
<span id="cb65-605"><a href="#cb65-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-606"><a href="#cb65-606" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_df =</span> <span class="fu">as_list</span>(vote_singular_nodes) <span class="sc">%&gt;%</span> </span>
<span id="cb65-607"><a href="#cb65-607" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as_list() doesn't retain element names so we set names ourselves</span></span>
<span id="cb65-608"><a href="#cb65-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">xml_name</span>(vote_singular_nodes)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-609"><a href="#cb65-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flatten_dfc</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb65-610"><a href="#cb65-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb65-611"><a href="#cb65-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-612"><a href="#cb65-612" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-613"><a href="#cb65-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-614"><a href="#cb65-614" aria-hidden="true" tabindex="-1"></a>The <span class="in">`&lt;vote-totals&gt;`</span> are a bit of a unique little element, with 3 different types of nodes.</span>
<span id="cb65-615"><a href="#cb65-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-618"><a href="#cb65-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-619"><a href="#cb65-619" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-metadata-totals-contents</span></span>
<span id="cb65-620"><a href="#cb65-620" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_totals =</span> <span class="fu">xml_find_all</span>(vote_metadata, <span class="st">"vote-totals"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-621"><a href="#cb65-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_contents</span>()</span>
<span id="cb65-622"><a href="#cb65-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-623"><a href="#cb65-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-624"><a href="#cb65-624" aria-hidden="true" tabindex="-1"></a>This is another opportunity for us to be choosy with our data. The first node is table headers, which we don't need because the elements are tagged anyway. From these, we really only need the <span class="in">`&lt;totals-by-party&gt;`</span> nodes as long as the totals of which agree with <span class="in">`&lt;totals-by-vote&gt;`</span> , which is worth checking.</span>
<span id="cb65-625"><a href="#cb65-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-628"><a href="#cb65-628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-629"><a href="#cb65-629" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-metadata-totals-both</span></span>
<span id="cb65-630"><a href="#cb65-630" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 1</span></span>
<span id="cb65-631"><a href="#cb65-631" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_totals_by_party =</span> <span class="fu">xml_find_all</span>(vote_totals, <span class="st">"totals-by-party"</span>))</span>
<span id="cb65-632"><a href="#cb65-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-633"><a href="#cb65-633" aria-hidden="true" tabindex="-1"></a>(<span class="at">totals_by_vote =</span> <span class="fu">xml_find_all</span>(vote_totals, <span class="st">"totals-by-vote"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-634"><a href="#cb65-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_contents</span>()</span>
<span id="cb65-635"><a href="#cb65-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-636"><a href="#cb65-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-637"><a href="#cb65-637" aria-hidden="true" tabindex="-1"></a>Once we have our nodeset (which at last are all singular), we use same listing, mapping, and flattening...or *lappening* as absolutely no one calls it.</span>
<span id="cb65-638"><a href="#cb65-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-641"><a href="#cb65-641" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-642"><a href="#cb65-642" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-metadata-totals-party</span></span>
<span id="cb65-643"><a href="#cb65-643" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb65-644"><a href="#cb65-644" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb65-645"><a href="#cb65-645" aria-hidden="true" tabindex="-1"></a>(<span class="at">party_vote_totals_df =</span> vote_totals_by_party <span class="sc">%&gt;%</span> </span>
<span id="cb65-646"><a href="#cb65-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-647"><a href="#cb65-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(flatten_dfc) <span class="sc">%&gt;%</span> </span>
<span id="cb65-648"><a href="#cb65-648" aria-hidden="true" tabindex="-1"></a>    <span class="fu">type_convert</span>())</span>
<span id="cb65-649"><a href="#cb65-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-650"><a href="#cb65-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-653"><a href="#cb65-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-654"><a href="#cb65-654" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb65-655"><a href="#cb65-655" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb65-656"><a href="#cb65-656" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if totals match</span></span>
<span id="cb65-657"><a href="#cb65-657" aria-hidden="true" tabindex="-1"></a><span class="fu">as_list</span>(totals_by_vote) <span class="sc">%&gt;%</span> </span>
<span id="cb65-658"><a href="#cb65-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(flatten_dfc)</span>
<span id="cb65-659"><a href="#cb65-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-660"><a href="#cb65-660" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(party_vote_totals, </span>
<span id="cb65-661"><a href="#cb65-661" aria-hidden="true" tabindex="-1"></a>          <span class="fu">across</span>(<span class="at">.cols =</span> <span class="sc">-</span>party, sum, <span class="at">na.rm=</span>T))</span>
<span id="cb65-662"><a href="#cb65-662" aria-hidden="true" tabindex="-1"></a><span class="co"># They do!</span></span>
<span id="cb65-663"><a href="#cb65-663" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-664"><a href="#cb65-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-665"><a href="#cb65-665" aria-hidden="true" tabindex="-1"></a>Now that we have all of our vote data wrangled from the thorny grasp of XML, we can put it all together.</span>
<span id="cb65-666"><a href="#cb65-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-669"><a href="#cb65-669" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-670"><a href="#cb65-670" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-build</span></span>
<span id="cb65-671"><a href="#cb65-671" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_roll_df =</span> vote_df <span class="sc">%&gt;%</span> </span>
<span id="cb65-672"><a href="#cb65-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">legislator_votes =</span> <span class="fu">list</span>(legislator_vote_df),</span>
<span id="cb65-673"><a href="#cb65-673" aria-hidden="true" tabindex="-1"></a>         <span class="at">party_votes =</span> <span class="fu">list</span>(party_vote_totals_df)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-674"><a href="#cb65-674" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb65-675"><a href="#cb65-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb65-676"><a href="#cb65-676" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-677"><a href="#cb65-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-678"><a href="#cb65-678" aria-hidden="true" tabindex="-1"></a>And we continue to stack this Russian doll of data from the legislator-level to the vote-level...</span>
<span id="cb65-679"><a href="#cb65-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-682"><a href="#cb65-682" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-683"><a href="#cb65-683" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-build</span></span>
<span id="cb65-684"><a href="#cb65-684" aria-hidden="true" tabindex="-1"></a>(<span class="at">recorded_votes_df =</span> recorded_votes_df <span class="sc">%&gt;%</span> </span>
<span id="cb65-685"><a href="#cb65-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vote_roll =</span> <span class="fu">list</span>(vote_roll_df))) <span class="sc">%&gt;%</span> </span>
<span id="cb65-686"><a href="#cb65-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb65-687"><a href="#cb65-687" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-688"><a href="#cb65-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-689"><a href="#cb65-689" aria-hidden="true" tabindex="-1"></a>...all the way until we've gotten back to the bill-level.</span>
<span id="cb65-690"><a href="#cb65-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-693"><a href="#cb65-693" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-694"><a href="#cb65-694" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: add-bills</span></span>
<span id="cb65-695"><a href="#cb65-695" aria-hidden="true" tabindex="-1"></a>bill_df<span class="sc">$</span>votes <span class="ot">=</span> <span class="fu">list</span>(recorded_votes_df)</span>
<span id="cb65-696"><a href="#cb65-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-697"><a href="#cb65-697" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(bill_df)</span>
<span id="cb65-698"><a href="#cb65-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-699"><a href="#cb65-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-702"><a href="#cb65-702" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-703"><a href="#cb65-703" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb65-704"><a href="#cb65-704" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb65-705"><a href="#cb65-705" aria-hidden="true" tabindex="-1"></a>parse_vote_roll <span class="ot">=</span> <span class="cf">function</span>(vote, logger, bill_type, bill_num){</span>
<span id="cb65-706"><a href="#cb65-706" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-707"><a href="#cb65-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb65-708"><a href="#cb65-708" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb65-709"><a href="#cb65-709" aria-hidden="true" tabindex="-1"></a>      vote_xml <span class="ot">=</span> <span class="fu">read_xml</span>(vote, <span class="at">options =</span> <span class="st">"RECOVER"</span>)</span>
<span id="cb65-710"><a href="#cb65-710" aria-hidden="true" tabindex="-1"></a>      vote_data <span class="ot">=</span> <span class="fu">xml_find_all</span>(vote_xml, <span class="st">"vote-data"</span>)</span>
<span id="cb65-711"><a href="#cb65-711" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb65-712"><a href="#cb65-712" aria-hidden="true" tabindex="-1"></a>      vote_roll_children <span class="ot">=</span> <span class="fu">xml_children</span>(vote_roll_xml)</span>
<span id="cb65-713"><a href="#cb65-713" aria-hidden="true" tabindex="-1"></a>      vote_data <span class="ot">=</span> <span class="fu">xml_find_all</span>(vote_roll_xml, <span class="st">"vote-data"</span>)</span>
<span id="cb65-714"><a href="#cb65-714" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb65-715"><a href="#cb65-715" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Vote data</span></span>
<span id="cb65-716"><a href="#cb65-716" aria-hidden="true" tabindex="-1"></a>      vote_legislators <span class="ot">=</span> vote_data <span class="sc">%&gt;%</span> </span>
<span id="cb65-717"><a href="#cb65-717" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xml_find_all</span>(<span class="st">"recorded-vote"</span>)</span>
<span id="cb65-718"><a href="#cb65-718" aria-hidden="true" tabindex="-1"></a>      legislators_list <span class="ot">=</span> <span class="fu">as_list</span>(vote_legislators)</span>
<span id="cb65-719"><a href="#cb65-719" aria-hidden="true" tabindex="-1"></a>      legislator_vote_df <span class="ot">=</span> legislators_list <span class="sc">%&gt;%</span> </span>
<span id="cb65-720"><a href="#cb65-720" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Modify one level deeper using map_at to target legislator elements</span></span>
<span id="cb65-721"><a href="#cb65-721" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(map_at, <span class="st">"legislator"</span>, attributes) <span class="sc">%&gt;%</span> </span>
<span id="cb65-722"><a href="#cb65-722" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map_dfr</span>(flatten_dfc)</span>
<span id="cb65-723"><a href="#cb65-723" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb65-724"><a href="#cb65-724" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Vote metadata</span></span>
<span id="cb65-725"><a href="#cb65-725" aria-hidden="true" tabindex="-1"></a>      vote_metadata <span class="ot">=</span> <span class="fu">xml_find_all</span>(vote_roll_xml, <span class="st">"vote-metadata"</span>)</span>
<span id="cb65-726"><a href="#cb65-726" aria-hidden="true" tabindex="-1"></a>      vote_singular_nodes <span class="ot">=</span> <span class="fu">xml_singular_nodes</span>(vote_metadata)</span>
<span id="cb65-727"><a href="#cb65-727" aria-hidden="true" tabindex="-1"></a>      (<span class="at">vote_df =</span> <span class="fu">as_list</span>(vote_singular_nodes) <span class="sc">%&gt;%</span> </span>
<span id="cb65-728"><a href="#cb65-728" aria-hidden="true" tabindex="-1"></a>          <span class="co"># as_list() doesn't retain element names so we set names ourselves</span></span>
<span id="cb65-729"><a href="#cb65-729" aria-hidden="true" tabindex="-1"></a>          <span class="fu">setNames</span>(<span class="fu">xml_name</span>(vote_singular_nodes)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-730"><a href="#cb65-730" aria-hidden="true" tabindex="-1"></a>          <span class="fu">flatten_dfc</span>())</span>
<span id="cb65-731"><a href="#cb65-731" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb65-732"><a href="#cb65-732" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Vote totals</span></span>
<span id="cb65-733"><a href="#cb65-733" aria-hidden="true" tabindex="-1"></a>      vote_totals <span class="ot">=</span> <span class="fu">xml_find_all</span>(vote_metadata, <span class="st">"vote-totals"</span>)</span>
<span id="cb65-734"><a href="#cb65-734" aria-hidden="true" tabindex="-1"></a>      vote_totals_by_party <span class="ot">=</span> <span class="fu">xml_find_all</span>(vote_totals, <span class="st">"totals-by-party"</span>)</span>
<span id="cb65-735"><a href="#cb65-735" aria-hidden="true" tabindex="-1"></a>      party_vote_totals_df <span class="ot">=</span> vote_totals_by_party <span class="sc">%&gt;%</span> </span>
<span id="cb65-736"><a href="#cb65-736" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-737"><a href="#cb65-737" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map_dfr</span>(flatten_dfc) <span class="sc">%&gt;%</span> </span>
<span id="cb65-738"><a href="#cb65-738" aria-hidden="true" tabindex="-1"></a>        <span class="fu">type_convert</span>()</span>
<span id="cb65-739"><a href="#cb65-739" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb65-740"><a href="#cb65-740" aria-hidden="true" tabindex="-1"></a>      vote_roll_df <span class="ot">=</span> vote_df <span class="sc">%&gt;%</span> </span>
<span id="cb65-741"><a href="#cb65-741" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">legislator_votes =</span> <span class="fu">list</span>(legislator_vote_df),</span>
<span id="cb65-742"><a href="#cb65-742" aria-hidden="true" tabindex="-1"></a>               <span class="at">party_votes =</span> <span class="fu">list</span>(party_vote_totals_df)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-743"><a href="#cb65-743" aria-hidden="true" tabindex="-1"></a>        janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb65-744"><a href="#cb65-744" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb65-745"><a href="#cb65-745" aria-hidden="true" tabindex="-1"></a>      vote_list <span class="ot">=</span> <span class="fu">as_list</span>(vote_data)</span>
<span id="cb65-746"><a href="#cb65-746" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb65-747"><a href="#cb65-747" aria-hidden="true" tabindex="-1"></a>      <span class="fu">flatten_dfr</span>(vote_list) <span class="sc">%&gt;%</span> </span>
<span id="cb65-748"><a href="#cb65-748" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unnest</span>(<span class="fu">everything</span>())</span>
<span id="cb65-749"><a href="#cb65-749" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb65-750"><a href="#cb65-750" aria-hidden="true" tabindex="-1"></a>    <span class="at">error=</span><span class="cf">function</span>(cond) {</span>
<span id="cb65-751"><a href="#cb65-751" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log_info</span>(logger, </span>
<span id="cb65-752"><a href="#cb65-752" aria-hidden="true" tabindex="-1"></a>               <span class="at">bill_type =</span> bill_type,</span>
<span id="cb65-753"><a href="#cb65-753" aria-hidden="true" tabindex="-1"></a>               <span class="at">bill_num =</span> bill_num, </span>
<span id="cb65-754"><a href="#cb65-754" aria-hidden="true" tabindex="-1"></a>               <span class="st">"ERROR: Vote roll could not be parsed"</span>)</span>
<span id="cb65-755"><a href="#cb65-755" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Choose a return value in case of error</span></span>
<span id="cb65-756"><a href="#cb65-756" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">tibble</span>())</span>
<span id="cb65-757"><a href="#cb65-757" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb65-758"><a href="#cb65-758" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-759"><a href="#cb65-759" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-760"><a href="#cb65-760" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-761"><a href="#cb65-761" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-762"><a href="#cb65-762" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-763"><a href="#cb65-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-764"><a href="#cb65-764" aria-hidden="true" tabindex="-1"></a><span class="fu"># Other helpful articles</span></span>
<span id="cb65-765"><a href="#cb65-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-766"><a href="#cb65-766" aria-hidden="true" tabindex="-1"></a>Here are some of the helpful articles I came across in the course of writing this:</span>
<span id="cb65-767"><a href="#cb65-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-768"><a href="#cb65-768" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">From XML to Excel for Data Analysis</span><span class="co">](https://towardsdatascience.com/from-xml-to-excel-for-data-analysis-ac0c0c765b7d "Introduction to Processing XML In Python")</span></span>
<span id="cb65-769"><a href="#cb65-769" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Reading XML files in R</span><span class="co">](https://medium.com/geekculture/reading-xml-files-in-r-3122c3a2a8d9)</span></span>
<span id="cb65-770"><a href="#cb65-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-771"><a href="#cb65-771" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session Info</span></span>
<span id="cb65-772"><a href="#cb65-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-773"><a href="#cb65-773" aria-hidden="true" tabindex="-1"></a>Version information about R, OS, and loaded packages.</span>
<span id="cb65-774"><a href="#cb65-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-777"><a href="#cb65-777" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-778"><a href="#cb65-778" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: session-info</span></span>
<span id="cb65-779"><a href="#cb65-779" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-780"><a href="#cb65-780" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>(<span class="st">"loaded"</span>)</span>
<span id="cb65-781"><a href="#cb65-781" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>