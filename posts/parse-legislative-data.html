<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.615">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2022-07-14">
<title>Mark Barrett - Parsing XML with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><script src="../site_libs/core-js-2.5.3/shim.min.js"></script><script src="../site_libs/react-17.0.0/react.min.js"></script><script src="../site_libs/react-17.0.0/react-dom.min.js"></script><script src="../site_libs/reactwidget-1.0.0/react-tools.js"></script><script src="../site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="../site_libs/reactable-binding-0.3.0/reactable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="../styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Mark Barrett</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html">Blog</a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/Mmm_JuicyFruit"><i class="bi bi-twitter" role="img" aria-label="twitter">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MokeEire"><i class="bi bi-github" role="img" aria-label="github">
</i> 
 </a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#what-is-xml" id="toc-what-is-xml" class="nav-link active" data-scroll-target="#what-is-xml">What is XML?</a></li>
  <li><a href="#read-xml-data-with-r" id="toc-read-xml-data-with-r" class="nav-link" data-scroll-target="#read-xml-data-with-r">Read XML data with R</a></li>
  <li><a href="#define-the-output" id="toc-define-the-output" class="nav-link" data-scroll-target="#define-the-output">Define the output</a></li>
  <li>
<a href="#parsing" id="toc-parsing" class="nav-link" data-scroll-target="#parsing">Parsing</a>
  <ul class="collapse">
<li>
<a href="#the-simple-elements" id="toc-the-simple-elements" class="nav-link" data-scroll-target="#the-simple-elements">The simple elements</a>
  <ul class="collapse">
<li><a href="#xml---list" id="toc-xml---list" class="nav-link" data-scroll-target="#xml---list">XML -&gt; List</a></li>
  <li><a href="#list---dataframe" id="toc-list---dataframe" class="nav-link" data-scroll-target="#list---dataframe">List -&gt; Dataframe</a></li>
  </ul>
</li>
  <li>
<a href="#the-not-so-simple-elements" id="toc-the-not-so-simple-elements" class="nav-link" data-scroll-target="#the-not-so-simple-elements">The not-so-simple elements</a>
  <ul class="collapse">
<li><a href="#actions-1" id="toc-actions-1" class="nav-link" data-scroll-target="#actions-1">Actions</a></li>
  <li><a href="#votes-1" id="toc-votes-1" class="nav-link" data-scroll-target="#votes-1">Votes</a></li>
  </ul>
</li>
  </ul>
</li>
  <li><a href="#other-helpful-articles" id="toc-other-helpful-articles" class="nav-link" data-scroll-target="#other-helpful-articles">Other helpful articles</a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session Info</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Parsing XML with R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Untangling congressional legislative data</p>
  <div class="quarto-categories">
    <div class="quarto-category">data</div>
    <div class="quarto-category">governance</div>
    <div class="quarto-category">R</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 14, 2022</p>
    </div>
  </div>
    
  </div>
  

</header><div class="cell">

</div>
<p>Data comes in many forms. You’ve probably used data formats like Excel spreadsheets, text files, databases and if you’re reading this maybe even (e)Xtensible Markup Language, or XML. XML is a storage format designed for flexibly transmitting data<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> but this flexibility often leads to a bit of a hassle when trying to parse it for use in analytics. This article takes a look at this tricky, but valuable data type, how to use it, and a set of steps for processing XML with R.</p>
<div class="callout-tip callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
What you’ll learn:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Load and parse XML files in R using the <a href="http://www.omegahat.net/RSXML/">XML</a> and <a href="https://xml2.r-lib.org/">xml2</a> packages</p></li>
<li><p>Explore the structure of XML documents</p></li>
<li><p>List, map, and flatten your data into a tabular format</p></li>
</ul>
</div>
</div>
<p>The impetus for this post was the US government’s congressional data. The US Government Publishing Office collects and provides records of all the bills that pass through congress, including the committees which consider the bill, the legislators who sponsor, or co-sponsor the bill, and any action taken on the bill while it is in congress e.g.&nbsp;votes and debates. I’m curious to see what kind of insights we can glean about the legislative structures and context of decision-making that determines the laws that are passed (or not). More to come on this in the future.</p>
<p>As always, the first step of data analysis is to check if any documentation exists and thankfully <a href="https://www.govinfo.gov/">govinfo</a> has provided some <a href="https://github.com/usgpo/bill-status/blob/main/BILLSTATUS-XML_User_User-Guide.md">guidance</a> on how to interpret the data and where its limitations are.</p>
<p>To follow along, you can download the sample XML file <a href="https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml" title="HR-391: Global Health Security Act of 2021">here</a>. The sample bill (chosen because its contents are instructional for data cleaning) is <a href="https://www.govinfo.gov/app/details/BILLS-117hr391rfs"><em>HR-391: Global Health Security Act of 2021</em></a><em>.</em></p>
<section id="what-is-xml" class="level1"><h1>What is XML?</h1>
<p>It is a format designed to work with any “arbitrary” structure. For example, an action taken on a bill in our data looks like this:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">example_node</span> <span class="op">=</span> <span class="fu">xml_find_first</span><span class="op">(</span><span class="va">bill_xml_file</span>, <span class="st">"bill/actions/item"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">xmlParse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;?xml version="1.0"?&gt;
&lt;item&gt;
  &lt;actionDate&gt;2021-07-12&lt;/actionDate&gt;
  &lt;committees&gt;
    &lt;item&gt;
      &lt;systemCode&gt;ssfr00&lt;/systemCode&gt;
      &lt;name&gt;Foreign Relations Committee&lt;/name&gt;
    &lt;/item&gt;
  &lt;/committees&gt;
  &lt;links/&gt;
  &lt;sourceSystem&gt;
    &lt;code&gt;0&lt;/code&gt;
    &lt;name&gt;Senate&lt;/name&gt;
  &lt;/sourceSystem&gt;
  &lt;text&gt;Received in the Senate and Read twice and referred to the Committee on Foreign Relations.&lt;/text&gt;
  &lt;type&gt;IntroReferral&lt;/type&gt;
&lt;/item&gt;
 </code></pre>
</div>
</div>
<p>Where this action <code>&lt;item&gt;</code> node is one of many actions taken on a <code>&lt;bill&gt;</code> node (its <em>parent</em> node), while an <code>&lt;item&gt;</code> may also contain multiple committee <code>&lt;item&gt;</code> nodes (its <em>children</em>). To have a table at this level of detail could end up being hundreds of rows per bill, making this flexible structure in XML more helpful.</p>
</section><section id="read-xml-data-with-r" class="level1"><h1>Read XML data with R</h1>
<p>Here are the tools we’ll be using. Between <a href="http://www.omegahat.net/RSXML/">XML</a> and <a href="https://xml2.r-lib.org/">xml2</a> there are numerous ways to load in and process XML data. I generally prefer <a href="https://xml2.r-lib.org/">xml2</a> but I suggest looking through the packages’ documentation to find the right function for your task. <a href="http://purrr.tidyverse.org">purrr</a> helps us parse and flatten the data into tabular form once we’ve converted it to a list.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.omegahat.net/RSXML/">XML</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://xml2.r-lib.org/">xml2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">bill_xml</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml</a></span><span class="op">(</span><span class="st">"https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Read in the file with <code><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml()</a></code> , which returns an <code>xml_document</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> object.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Look at the xml_document's contents</span></span>
<span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="va">bill_xml</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (2)}
[1] &lt;bill&gt;\n  &lt;billNumber&gt;391&lt;/billNumber&gt;\n  &lt;createDate&gt;2021-01-22T08:12:10 ...
[2] &lt;dublinCore xmlns:dc="http://purl.org/dc/elements/1.1/"&gt;\n  &lt;dc:format&gt;te ...</code></pre>
</div>
</div>
<p>The <code>&lt;dublinCore&gt;</code> element is a document metadata identifier<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> and while very useful in its own right, it isn’t relevant for our purposes. In this case it’s actually more useful to look at the <code>&lt;bill&gt;</code> child node using <code><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_child()</a></code>.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Return child nodes named bill</span></span>
<span><span class="op">(</span><span class="va">bill_node</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_child</a></span><span class="op">(</span><span class="va">bill_xml</span>, <span class="st">"bill"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_node}
&lt;bill&gt;
 [1] &lt;billNumber&gt;391&lt;/billNumber&gt;
 [2] &lt;createDate&gt;2021-01-22T08:12:10Z&lt;/createDate&gt;
 [3] &lt;updateDate&gt;2022-02-09T12:37:52Z&lt;/updateDate&gt;
 [4] &lt;originChamber&gt;House&lt;/originChamber&gt;
 [5] &lt;billType&gt;HR&lt;/billType&gt;
 [6] &lt;introducedDate&gt;2021-01-21&lt;/introducedDate&gt;
 [7] &lt;congress&gt;117&lt;/congress&gt;
 [8] &lt;constitutionalAuthorityStatementText&gt;&lt;![CDATA[&lt;pre&gt;[Congressional Recor ...
 [9] &lt;recordedVotes&gt;\n  &lt;recordedVote&gt;\n    &lt;rollNumber&gt;188&lt;/rollNumber&gt;\n    ...
[10] &lt;committees&gt;\n  &lt;billCommittees&gt;\n    &lt;item&gt;\n      &lt;systemCode&gt;ssfr00&lt;/ ...
[11] &lt;committeeReports/&gt;
[12] &lt;relatedBills/&gt;
[13] &lt;actions&gt;\n  &lt;item&gt;\n    &lt;actionDate&gt;2021-07-12&lt;/actionDate&gt;\n    &lt;commi ...
[14] &lt;sponsors&gt;\n  &lt;item&gt;\n    &lt;bioguideId&gt;C001078&lt;/bioguideId&gt;\n    &lt;fullNam ...
[15] &lt;cosponsors&gt;\n  &lt;item&gt;\n    &lt;bioguideId&gt;C000266&lt;/bioguideId&gt;\n    &lt;fullN ...
[16] &lt;cboCostEstimates&gt;\n  &lt;item&gt;\n    &lt;pubDate&gt;2021-05-11T15:11:11Z&lt;/pubDate ...
[17] &lt;laws/&gt;
[18] &lt;notes/&gt;
[19] &lt;policyArea&gt;\n  &lt;name&gt;International Affairs&lt;/name&gt;\n&lt;/policyArea&gt;
[20] &lt;subjects&gt;\n  &lt;billSubjects&gt;\n    &lt;legislativeSubjects&gt;\n      &lt;item&gt;\n  ...
...</code></pre>
</div>
</div>
<p>To convert this data from XML to a dataframe we need to deal with the nodes which have nested data. This requires a little thought about what data is relevant to your question and what <a href="https://en.wikipedia.org/wiki/Unit_of_observation">level of observation</a> you want to use.</p>
<p>It is also usually a good idea to try the most direct approach first, which is the aptly named <code><a href="https://rdrr.io/pkg/XML/man/xmlToDataFrame.html">xmlToDataFrame()</a></code>. When you’re working with both the <a href="http://www.omegahat.net/RSXML/">XML</a> and <a href="https://xml2.r-lib.org/">xml2</a> libraries, it is important to note that their functions often rely on different object types. In the case of <code><a href="https://rdrr.io/pkg/XML/man/xmlToDataFrame.html">xmlToDataFrame()</a></code>, it does not take <code>{xml_document}</code> or <code>{xml_node}</code> objects. If you try to use them, you’ll see an error like this:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/XML/man/xmlToDataFrame.html">xmlToDataFrame</a></span><span class="op">(</span><span class="va">bill_xml</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>Error in (function (classes, fdef, mtable) : unable to find an inherited method for function 'xmlToDataFrame' for signature '"xml_document", "missing", "missing", "missing", "missing"'</code></pre>
</div>
</div>
<p>Instead you’ll need to use <code><a href="https://rdrr.io/pkg/XML/man/xmlTreeParse.html">xmlParse()</a></code> which creates an XMLInternalDocument/XMLAbstractDocument object. Because we have the document metadata node which we don’t want to parse, we need to use <code>getNodeSet(., [path =] "//bill")</code> to find only nodes under <code>&lt;bill&gt;</code>.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First you need to use the xmlParse function</span></span>
<span><span class="va">bill_xml_parse</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/XML/man/xmlTreeParse.html">xmlParse</a></span><span class="op">(</span><span class="va">bill_xml</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You can wrap a variable assignment in ( ) to print it, </span></span>
<span><span class="co"># or in this case pass it to another function via the pipe %&gt;% </span></span>
<span><span class="op">(</span> <span class="va">bill_xml_df_attempt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/XML/man/xmlToDataFrame.html">xmlToDataFrame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/XML/man/getNodeSet.html">getNodeSet</a></span><span class="op">(</span><span class="va">bill_xml_parse</span>, <span class="st">"//bill"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># View the dataframe structure</span></span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre class="code-block-h"><code>Rows: 1
Columns: 28
$ billNumber                           &lt;chr&gt; "391"
$ createDate                           &lt;chr&gt; "2021-01-22T08:12:10Z"
$ updateDate                           &lt;chr&gt; "2022-02-09T12:37:52Z"
$ originChamber                        &lt;chr&gt; "House"
$ billType                             &lt;chr&gt; "HR"
$ introducedDate                       &lt;chr&gt; "2021-01-21"
$ congress                             &lt;chr&gt; "117"
$ constitutionalAuthorityStatementText &lt;chr&gt; "&lt;pre&gt;[Congressional Record Volum…
$ recordedVotes                        &lt;chr&gt; "188https://clerk.house.gov/evs/2…
$ committees                           &lt;chr&gt; "ssfr00Foreign Relations Committe…
$ committeeReports                     &lt;chr&gt; ""
$ relatedBills                         &lt;chr&gt; ""
$ actions                              &lt;chr&gt; "2021-07-12ssfr00Foreign Relation…
$ sponsors                             &lt;chr&gt; "C001078Rep. Connolly, Gerald E. …
$ cosponsors                           &lt;chr&gt; "C000266Rep. Chabot, Steve [R-OH-…
$ cboCostEstimates                     &lt;chr&gt; "2021-05-11T15:11:11ZH.R. 391, Gl…
$ laws                                 &lt;chr&gt; ""
$ notes                                &lt;chr&gt; ""
$ policyArea                           &lt;chr&gt; "International Affairs"
$ subjects                             &lt;chr&gt; "Advisory bodiesAnimal and plant …
$ summaries                            &lt;chr&gt; "002021-01-21Introduced in House2…
$ title                                &lt;chr&gt; "Global Health Security Act of 20…
$ titles                               &lt;chr&gt; "Display TitleGlobal Health Secur…
$ amendments                           &lt;chr&gt; ""
$ textVersions                         &lt;chr&gt; "Referred in Senate2021-07-12T04:…
$ latestAction                         &lt;chr&gt; "2021-07-12Received in the Senate…
$ calendarNumbers                      &lt;chr&gt; ""
$ version                              &lt;chr&gt; "1.0.0"</code></pre>
</div>
</div>
<p>But notice that a number of fields like <code>committees</code>, <code>actions</code>, and <code>sponsors</code> have had their values combined into a single column. With nested data, you may need to do a little bit more work to get the data into a <a href="https://vita.had.co.nz/papers/tidy-data.html">tidy data</a> frame, but this approach can work for simpler XML structures. The importance of understanding the structure of your data brings us to one of the cardinal rules of data analysis:</p>
<div class="callout-tip callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Look at your data
</div>
</div>
<div class="callout-body-container callout-body">
<p>In fact, you could even say <em>stare</em> at it. Understanding the structure and contents of your data is essential for designing a solution to consistently process the data.</p>
</div>
</div>
</section><section id="define-the-output" class="level1 page-columns page-full"><h1>Define the output</h1>
<p>As well as looking at your data, it’s also usually helpful to look to your intended output. This determines how to transform the data.</p>
<p><strong>Example:</strong> I want the congressional data to have one row per bill, with the nested characteristics stored in list columns. This will produce a comprehensive dataset which can easily be subset and transformed to various levels of observation as needed. The end result should look like this:</p>
<div class="cell page-columns page-full">
<div class="cell-output-display column-screen-inset-shaded">

<div id="htmlwidget-033269f426d9c8077215" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-033269f426d9c8077215">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"bill_number":["391"],"create_date":["2021-01-22T08:12:10Z"],"update_date":["2022-02-09T12:37:52Z"],"origin_chamber":["House"],"bill_type":["HR"],"introduced_date":["2021-01-21T00:00:00Z"],"congress":["117"],"constitutional_authority_statement_text":["<pre>[Congressional Record Volume 167, Number 17 (Thursday, January 28, 2021)][House]From the Congressional Record Online through the Government Publishing Office [<a href=\"https://www.gpo.gov\">www.gpo.gov<\/a>]By Ms. SANCHEZ:H.J. Res. 22.Congress has the power to enact this legislation pursuantto the following:Article 1 Section 8ADDITIONAL SPONSORSUnder clause 7 of rule XII, sponsors were added to public bills andresolutions, as follows:H.R. 28: Mr. Chabot, Mr. Armstrong, Mrs. Fischbach, Mr.Lucas, Mr. Mast, and Mr. Womack.H.R. 40: Mr. Kahele, Ms. Roybal-Allard, Mr. Aguilar, Ms.Waters, Mr. Vela, Mr. Sires, and Mr. Huffman.H.R. 51: Mr. Mrvan and Ms. Davids of Kansas.H.R. 55: Ms. Ross, Mr. Lynch, Mr. Larsen of Washington, Mr.Thompson of California, Ms. Manning, Ms. Jayapal, Ms. Adams,Mr. Schneider, Mr. Veasey, and Ms. Wild.H.R. 77: Mr. Grothman.H.R. 78: Mr. Smith of New Jersey, Mr. Hice of Georgia, Mr.Bucshon, Mr. Burgess, and Mr. Norman.H.R. 97: Mrs. Hayes, Mr. Welch, Mr. Torres of New York, Mr.Cicilline, and Mr. Danny K. Davis of Illinois.H.R. 147: Mr. Ryan and Mr. Brown.H.R. 197: Mr. Brendan F. Boyle of Pennsylvania and Mr.Hastings.H.R. 217: Mr. Hice of Georgia.H.R. 235: Mr. Meeks and Mr. Torres of New York.H.R. 243: Mr. Armstrong.H.R. 255: Mr. Auchincloss, Mr. DeSaulnier, Mr. Schrader,and Ms. Chu.H.R. 256: Mr. Schrader and Ms. Chu.H.R. 262: Mr. Cicilline and Mr. Torres of New York.H.R. 265: Mr. Veasey.H.R. 275: Mr. Jacobs of New York, Ms. Herrera Beutler, Mr.McCaul, Mr. Joyce of Ohio, Mrs. Bice of Oklahoma, Mr.LaMalfa, Mrs. Steel, Mr. Hill, Mr. Garbarino, Mr. Pfluger,Mr. Gimenez, and Mrs. Cammack.H.R. 279: Mr. Neguse, Mr. Crow, and Mr. DeSaulnier.H.R. 289: Mr. Perry.H.R. 295: Mr. Cloud.H.R. 302: Mr. Costa.H.R. 304: Mr. Raskin, Mr. Lynch, Mr. Carson, Ms. Norton,and Mr. Kilmer.H.R. 305: Ms. Ross, Mr. Kind, and Mr. Michael F. Doyle ofPennsylvania.H.R. 322: Mr. Wilson of South Carolina.H.R. 326: Mr. Costa.H.R. 332: Mr. Stanton and Mrs. Wagner.H.R. 349: Ms. Williams of Georgia, Ms. Brownley, Ms. BluntRochester, and Mrs. Trahan.H.R. 359: Mr. Rodney Davis of Illinois.H.R. 369: Mrs. Hayes and Ms. Schrier.H.R. 377: Mr. Rice of South Carolina and Ms. Herrell.H.R. 378: Mr. Rice of South Carolina and Ms. Herrell.H.R. 384: Mr. Cohen, Ms. Mace, Mr. Huffman, Mr. Hastings,and Ms. Eshoo.H.R. 391: Mr. DeSaulnier, Mrs. Napolitano, Ms. Chu, Mr.Harder of California, Mr. Cohen, and Mrs. Fletcher.H.R. 392: Mr. Smith of Washington, Ms. Moore of Wisconsin,Mr. Sablan, and Mr. Sires.H.R. 398: Ms. Herrell.H.R. 407: Mr. Mast.H.R. 421: Ms. Plaskett, Mr. Rush, and Mr. Correa.H.R. 426: Mr. Hagedorn, Mr. Mooney, Mr. Green of Tennessee,Mr. Norman, and Mr. Davidson.H.R. 447: Mr. DeSaulnier, Mr. Courtney, Ms. Adams, Mrs.McBath, Mr. Kinzinger, Mr. Castro of Texas, Mr. Stivers, Mr.Morelle, Mr. Smith of Washington, Mr. Khanna, Mr. Sarbanes,Ms. Norton, Ms. Stevens, Mr. Grijalva, Ms. Blunt Rochester,Mr. Cardenas, Ms. Schakowsky, Ms. Jackson Lee, Mr.Krishnamoorthi, Mr. Danny K. Davis of Illinois, Mrs. Demings,Mr. Foster, Ms. Houlahan, Mr. Moulton, Mr. Kilmer, Ms. Meng,Mr. Gallego, Mr. Brown, Mr. Suozzi, Mr. Garamendi, Mr.Neguse, Ms. McCollum, Mr. Kildee, Mrs. Beatty, Mr. Carbajal,Ms. Craig, Mr. Trone, Ms. Waters, Mr. Casten, Mrs. Bustos,Mr. Langevin, Mr. Sires, Mr. Kahele, Mr. Ryan, Ms. Underwood,Mr. Stanton, Mr. Carson, Mr. David Scott of Georgia, Ms. Leeof California, Mrs. Dingell, Mrs. Axne, Mr. Horsford, and Mr.Lamb.H.R. 448: Mr. Jones.H.R. 449: Mrs. Miller of Illinois.H.R. 450: Mrs. Miller of Illinois.H.R. 452: Mr. Nunes and Mr. Joyce of Ohio.H.R. 465: Mr. Costa and Mr. Valadao.H.R. 471: Mr. Buck, Ms. Mace, Mr. Perry, Mr. Wright, Mr.Babin, Mr. Norman, and Mr. Gibbs.H.R. 472: Mr. Feenstra.H.R. 485: Mrs. Hayes, Mr. Castro of Texas, Ms. Wild, Mr.Takano, Mr. Morelle, Mrs. Trahan, Mr. Levin of Michigan, andMs. Adams.H.R. 488: Mr. Newhouse, Mr. Stewart,[...][Page H254]<\/pre>"],"title":["Global Health Security Act of 2021"],"version":["1.0.0"],"latest_action_action_date":["2021-07-12T00:00:00Z"],"latest_action_text":["Received in the Senate and Read twice and referred to the Committee on Foreign Relations."]},"columns":[{"accessor":"bill_number","name":"bill_number","type":"character","width":100},{"accessor":"create_date","name":"create_date","type":"Date","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":100},{"accessor":"update_date","name":"update_date","type":"Date","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":100},{"accessor":"origin_chamber","name":"origin_chamber","type":"character","show":false},{"accessor":"bill_type","name":"bill_type","type":"character","width":80},{"accessor":"introduced_date","name":"introduced_date","type":"Date","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":135},{"accessor":"congress","name":"congress","type":"character","width":80},{"accessor":"constitutional_authority_statement_text","name":"constitutional_authority_statement_text","type":"character","show":false},{"accessor":"title","name":"title","type":"character","minWidth":180},{"accessor":"version","name":"version","type":"character","show":false,"width":80},{"accessor":"latest_action_action_date","name":"action_date","type":"Date","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":115},{"accessor":"latest_action_text","name":"action_text","type":"character","minWidth":180,"maxWidth":240}],"columnGroups":[{"name":"Latest Action","columns":["latest_action_action_date","latest_action_text"]}],"resizable":true,"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"compact":true,"nowrap":true,"theme":{"color":"#474d4d","backgroundColor":"#FFFFFF","borderColor":"#dddddd","borderWidth":"1px","stripedColor":"#dddddd","highlightColor":"#f0f0f0","cellPadding":"8px 12px","style":{"padding":"16px 8px"},"tableStyle":{"fontSize":14,"borderBottom":"3px solid #222222","fontFamily":"Noto Sans, sans-serif"},"headerStyle":{"borderWidth":"3px","paddingTop":"12px","verticalAlign":"bottom","textAlign":"bottom","background":"#FFFFFF","textTransform":"uppercase","borderColor":"#474d4d","color":"#051414","&:hover":{"background":"#dddddd"},"&[aria-sort='ascending'], &[aria-sort='descending']":{"background":"#5b5e5f","color":"#FFFFFF"},"borderColor.1":"#333","fontSize":12,"fontFamily":"Heebo Light, sans-serif"},"groupHeaderStyle":{"&:not(:empty)":{"paddingBottom":"3px","verticalAlign":"bottom","textAlign":"bottom","backgroundColor":"#FFFFFF","textTransform":"uppercase","fontSize":12,"color":"#474d4d"}},"rowSelectedStyle":{"backgroundColor":"#dddddd"},"inputStyle":{"backgroundColor":"#FFFFFF","color":"#474d4d"},"searchInputStyle":{"textTransform":"uppercase","color":"#474d4d","fontSize":"14px"},"paginationStyle":{"textTransform":"uppercase","fontSize":"14px"},"pageButtonStyle":{"textTransform":"uppercase","fontSize":"14px"}},"dataKey":"4b76f59ceb6630e1b6464cd70c3bfbb4"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>With the following list columns (among others):</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Committees</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Votes</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Actions</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Sponsors</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [2 × 6] (S3: tbl_df/tbl/data.frame)
  ..$ committee_system_code  : chr [1:2] "ssfr00" "hsfa00"
  ..$ committee_name         : chr [1:2] "Foreign Relations Committee" "Foreign Affairs Committee"
  ..$ committee_chamber      : chr [1:2] "Senate" "House"
  ..$ committee_type         : chr [1:2] "Standing" "Standing"
  ..$ committee_activities   :List of 2
  ..$ subcommittee_activities:List of 2</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [1 × 9] (S3: tbl_df/tbl/data.frame)
  ..$ roll_number     : chr "188"
  ..$ url             : chr "https://clerk.house.gov/evs/2021/roll188.xml"
  ..$ full_action_name: chr "Final Passage Under Suspension of the Rules Results"
  ..$ chamber         : chr "House"
  ..$ congress        : chr "117"
  ..$ date            : chr "2021-06-28T23:46:02Z"
  ..$ session_number  : chr "1"
  ..$ vote_roll       :List of 1
  ..$ roll_found      : logi FALSE</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [14 × 9] (S3: tbl_df/tbl/data.frame)
  ..$ action_date                 : Date[1:14], format: "2021-07-12" "2021-06-28" ...
  ..$ action_committee_system_code: chr [1:14] "ssfr00" NA NA NA ...
  ..$ action_committee_name       : chr [1:14] "Foreign Relations Committee" NA NA NA ...
  ..$ action_source_code          : chr [1:14] "0" "2" "2" "9" ...
  ..$ action_source_name          : chr [1:14] "Senate" "House floor actions" "House floor actions" "Library of Congress" ...
  ..$ action_text                 : chr [1:14] "Received in the Senate and Read twice and referred to the Committee on Foreign Relations." "Motion to reconsider laid on the table Agreed to without objection." "On motion to suspend the rules and pass the bill, as amended Agreed to by the Yeas and Nays: (2/3 required): 30"| __truncated__ "Passed/agreed to in House: On motion to suspend the rules and pass the bill, as amended Agreed to by the Yeas a"| __truncated__ ...
  ..$ action_type                 : Ord.factor w/ 6 levels "IntroReferral"&lt;..: 1 3 3 3 3 3 3 3 3 2 ...
  ..$ action_time                 : 'hms' num [1:14] NA 19:46:03 19:46:02 19:46:02 ...
  .. ..- attr(*, "units")= chr "secs"
  ..$ action_code                 : chr [1:14] NA "H38310" "H37300" "8000" ...</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ : tibble [1 × 11] (S3: tbl_df/tbl/data.frame)
  ..$ sponsor_bioguide_id            : chr "C001078"
  ..$ sponsor_full_name              : chr "Rep. Connolly, Gerald E. [D-VA-11]"
  ..$ sponsor_first_name             : chr "Gerald"
  ..$ sponsor_middle_name            : chr "E."
  ..$ sponsor_last_name              : chr "Connolly"
  ..$ sponsor_party                  : chr "D"
  ..$ sponsor_state                  : chr "VA"
  ..$ sponsor_identifiers_lis_id     : chr "1959"
  ..$ sponsor_identifiers_bioguide_id: chr "C001078"
  ..$ sponsor_identifiers_gpo_id     : chr "8202"
  ..$ sponsor_district               : chr "11"</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="parsing" class="level1 page-columns page-full"><h1>Parsing</h1>
<p>With this output in mind and an understanding of the current data structure, we can break the parsing process down into two categories - the simple, and the not-so-simple.</p>
<p>In general, the process is two steps:</p>
<ol type="1">
<li>Convert XML to a list with <code><a href="http://xml2.r-lib.org/reference/as_list.html">as_list()</a></code>
</li>
<li>Flatten the list to a data frame using a combination of functions from <a href="http://purrr.tidyverse.org">purrr</a>
<ol type="a">
<li><p><code><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc()</a></code>/<code><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfr()</a></code> to flatten a list into a data frame by column or row respectively</p></li>
<li><p><code><a href="https://purrr.tidyverse.org/reference/map.html">map_dfc()</a></code>/<code><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr()</a></code> to apply a function to each element of a list and combine the results as columns or rows in a data frame respectively</p></li>
</ol>
</li>
</ol>
<section id="the-simple-elements" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="the-simple-elements">The simple elements</h2>
<p>The simple parts of the data to process are those which are already at the level of observation you want. In our case - at the bill level. These are typically the top-level nodes which only have one piece of data. To select only these nodes we want to select the bill’s child nodes which have no further children and are not empty. We can write a function in R like the one below, or use <a href="https://www.w3schools.com/xml/xml_parser.asp">XPath</a> (or XML Path Language) to identify the nodes we want directly. In the process of writing this, I discovered that using XPath made this ~5x faster but I include the R function because XPath can be tricky and it may be useful to some.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to select singular child nodes from XML node</span></span>
<span><span class="va">xml_singular_nodes</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xml_node</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Return child nodes of current node</span></span>
<span>  <span class="va">child_nodes</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_children</a></span><span class="op">(</span><span class="va">xml_node</span><span class="op">)</span></span>
<span>  <span class="co"># Select child nodes with 0 children</span></span>
<span>  <span class="va">zero_length_child_nodes</span> <span class="op">=</span> <span class="va">child_nodes</span><span class="op">[</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_length</a></span><span class="op">(</span><span class="va">child_nodes</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Keep the nodes which are not empty strings</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">keep</a></span><span class="op">(</span><span class="va">zero_length_child_nodes</span>, <span class="op">~</span><span class="op">(</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Using XPath:</span></span>
<span><span class="va">singular_nodes1</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">bill_xml</span>, </span>
<span>                                <span class="st">"//bill/*[count(./*) = 0 and not(string-length(.) = 0)]"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using R function:</span></span>
<span><span class="va">singular_nodes2</span> <span class="op">=</span> <span class="fu">xml_singular_nodes</span><span class="op">(</span><span class="va">bill_node</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check they are the same</span></span>
<span><span class="co"># all.equal(singular_nodes1, singular_nodes2)</span></span>
<span></span>
<span><span class="co"># Use the first one </span></span>
<span><span class="va">singular_nodes</span> <span class="op">=</span> <span class="va">singular_nodes1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">

</div>
<section id="xml---list" class="level3"><h3 class="anchored" data-anchor-id="xml---list">XML -&gt; List</h3>
<p>The first step is to convert the XML to a list using <code><a href="http://xml2.r-lib.org/reference/as_list.html">as_list()</a></code>.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">singular_list</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">singular_nodes</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>List of 10
 $ :List of 1
  ..$ : chr "391"
 $ :List of 1
  ..$ : chr "2021-01-22T08:12:10Z"
 $ :List of 1
  ..$ : chr "2022-02-09T12:37:52Z"
 $ :List of 1
  ..$ : chr "House"
 $ :List of 1
  ..$ : chr "HR"
 $ :List of 1
  ..$ : chr "2021-01-21"
 $ :List of 1
  ..$ : chr "117"
 $ :List of 1
  ..$ : chr "&lt;pre&gt;[Congressional Record Volume 167, Number 17 (Thursday, January 28, 2021)][House]From the Congressional Rec"| __truncated__
 $ :List of 1
  ..$ : chr "Global Health Security Act of 2021"
 $ :List of 1
  ..$ : chr "1.0.0"</code></pre>
</div>
</div>
<p>Note that we didn’t retain the element names so we need to assign them ourselves.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">singular_list_named</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">singular_list</span>, <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_name.html">xml_name</a></span><span class="op">(</span><span class="va">singular_nodes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>List of 10
 $ billNumber                          :List of 1
  ..$ : chr "391"
 $ createDate                          :List of 1
  ..$ : chr "2021-01-22T08:12:10Z"
 $ updateDate                          :List of 1
  ..$ : chr "2022-02-09T12:37:52Z"
 $ originChamber                       :List of 1
  ..$ : chr "House"
 $ billType                            :List of 1
  ..$ : chr "HR"
 $ introducedDate                      :List of 1
  ..$ : chr "2021-01-21"
 $ congress                            :List of 1
  ..$ : chr "117"
 $ constitutionalAuthorityStatementText:List of 1
  ..$ : chr "&lt;pre&gt;[Congressional Record Volume 167, Number 17 (Thursday, January 28, 2021)][House]From the Congressional Rec"| __truncated__
 $ title                               :List of 1
  ..$ : chr "Global Health Security Act of 2021"
 $ version                             :List of 1
  ..$ : chr "1.0.0"</code></pre>
</div>
</div>
</section><section id="list---dataframe" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="list---dataframe">List -&gt; Dataframe</h3>
<p>Lastly, we want to flatten this list into a dataframe using purrr’s <code><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc()</a></code> which flattens each list element into a <strong>d</strong>ata<strong>f</strong>rame <strong>c</strong>olumn.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">bill_df</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc</a></span><span class="op">(</span><span class="va">singular_list_named</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 10
$ billNumber                           &lt;chr&gt; "391"
$ createDate                           &lt;chr&gt; "2021-01-22T08:12:10Z"
$ updateDate                           &lt;chr&gt; "2022-02-09T12:37:52Z"
$ originChamber                        &lt;chr&gt; "House"
$ billType                             &lt;chr&gt; "HR"
$ introducedDate                       &lt;chr&gt; "2021-01-21"
$ congress                             &lt;chr&gt; "117"
$ constitutionalAuthorityStatementText &lt;chr&gt; "&lt;pre&gt;[Congressional Record Volum…
$ title                                &lt;chr&gt; "Global Health Security Act of 20…
$ version                              &lt;chr&gt; "1.0.0"</code></pre>
</div>
</div>
<p>Or in table form:</p>
<div class="cell page-columns page-full">
<div class="cell-output-display column-page">

<div id="htmlwidget-c2b90deb66599bd144cc" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c2b90deb66599bd144cc">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"billNumber":["391"],"createDate":["2021-01-22T08:12:10Z"],"updateDate":["2022-02-09T12:37:52Z"],"originChamber":["House"],"billType":["HR"],"introducedDate":["2021-01-21"],"congress":["117"],"constitutionalAuthorityStatementText":["<pre>[Congressional Record Volume 167, Number 17 (Thursday, January 28, 2021)][House]From the Congressional Record Online through the Government Publishing Office [<a href=\"https://www.gpo.gov\">www.gpo.gov<\/a>]By Ms. SANCHEZ:H.J. Res. 22.Congress has the power to enact this legislation pursuantto the following:Article 1 Section 8ADDITIONAL SPONSORSUnder clause 7 of rule XII, sponsors were added to public bills andresolutions, as follows:H.R. 28: Mr. Chabot, Mr. Armstrong, Mrs. Fischbach, Mr.Lucas, Mr. Mast, and Mr. Womack.H.R. 40: Mr. Kahele, Ms. Roybal-Allard, Mr. Aguilar, Ms.Waters, Mr. Vela, Mr. Sires, and Mr. Huffman.H.R. 51: Mr. Mrvan and Ms. Davids of Kansas.H.R. 55: Ms. Ross, Mr. Lynch, Mr. Larsen of Washington, Mr.Thompson of California, Ms. Manning, Ms. Jayapal, Ms. Adams,Mr. Schneider, Mr. Veasey, and Ms. Wild.H.R. 77: Mr. Grothman.H.R. 78: Mr. Smith of New Jersey, Mr. Hice of Georgia, Mr.Bucshon, Mr. Burgess, and Mr. Norman.H.R. 97: Mrs. Hayes, Mr. Welch, Mr. Torres of New York, Mr.Cicilline, and Mr. Danny K. Davis of Illinois.H.R. 147: Mr. Ryan and Mr. Brown.H.R. 197: Mr. Brendan F. Boyle of Pennsylvania and Mr.Hastings.H.R. 217: Mr. Hice of Georgia.H.R. 235: Mr. Meeks and Mr. Torres of New York.H.R. 243: Mr. Armstrong.H.R. 255: Mr. Auchincloss, Mr. DeSaulnier, Mr. Schrader,and Ms. Chu.H.R. 256: Mr. Schrader and Ms. Chu.H.R. 262: Mr. Cicilline and Mr. Torres of New York.H.R. 265: Mr. Veasey.H.R. 275: Mr. Jacobs of New York, Ms. Herrera Beutler, Mr.McCaul, Mr. Joyce of Ohio, Mrs. Bice of Oklahoma, Mr.LaMalfa, Mrs. Steel, Mr. Hill, Mr. Garbarino, Mr. Pfluger,Mr. Gimenez, and Mrs. Cammack.H.R. 279: Mr. Neguse, Mr. Crow, and Mr. DeSaulnier.H.R. 289: Mr. Perry.H.R. 295: Mr. Cloud.H.R. 302: Mr. Costa.H.R. 304: Mr. Raskin, Mr. Lynch, Mr. Carson, Ms. Norton,and Mr. Kilmer.H.R. 305: Ms. Ross, Mr. Kind, and Mr. Michael F. Doyle ofPennsylvania.H.R. 322: Mr. Wilson of South Carolina.H.R. 326: Mr. Costa.H.R. 332: Mr. Stanton and Mrs. Wagner.H.R. 349: Ms. Williams of Georgia, Ms. Brownley, Ms. BluntRochester, and Mrs. Trahan.H.R. 359: Mr. Rodney Davis of Illinois.H.R. 369: Mrs. Hayes and Ms. Schrier.H.R. 377: Mr. Rice of South Carolina and Ms. Herrell.H.R. 378: Mr. Rice of South Carolina and Ms. Herrell.H.R. 384: Mr. Cohen, Ms. Mace, Mr. Huffman, Mr. Hastings,and Ms. Eshoo.H.R. 391: Mr. DeSaulnier, Mrs. Napolitano, Ms. Chu, Mr.Harder of California, Mr. Cohen, and Mrs. Fletcher.H.R. 392: Mr. Smith of Washington, Ms. Moore of Wisconsin,Mr. Sablan, and Mr. Sires.H.R. 398: Ms. Herrell.H.R. 407: Mr. Mast.H.R. 421: Ms. Plaskett, Mr. Rush, and Mr. Correa.H.R. 426: Mr. Hagedorn, Mr. Mooney, Mr. Green of Tennessee,Mr. Norman, and Mr. Davidson.H.R. 447: Mr. DeSaulnier, Mr. Courtney, Ms. Adams, Mrs.McBath, Mr. Kinzinger, Mr. Castro of Texas, Mr. Stivers, Mr.Morelle, Mr. Smith of Washington, Mr. Khanna, Mr. Sarbanes,Ms. Norton, Ms. Stevens, Mr. Grijalva, Ms. Blunt Rochester,Mr. Cardenas, Ms. Schakowsky, Ms. Jackson Lee, Mr.Krishnamoorthi, Mr. Danny K. Davis of Illinois, Mrs. Demings,Mr. Foster, Ms. Houlahan, Mr. Moulton, Mr. Kilmer, Ms. Meng,Mr. Gallego, Mr. Brown, Mr. Suozzi, Mr. Garamendi, Mr.Neguse, Ms. McCollum, Mr. Kildee, Mrs. Beatty, Mr. Carbajal,Ms. Craig, Mr. Trone, Ms. Waters, Mr. Casten, Mrs. Bustos,Mr. Langevin, Mr. Sires, Mr. Kahele, Mr. Ryan, Ms. Underwood,Mr. Stanton, Mr. Carson, Mr. David Scott of Georgia, Ms. Leeof California, Mrs. Dingell, Mrs. Axne, Mr. Horsford, and Mr.Lamb.H.R. 448: Mr. Jones.H.R. 449: Mrs. Miller of Illinois.H.R. 450: Mrs. Miller of Illinois.H.R. 452: Mr. Nunes and Mr. Joyce of Ohio.H.R. 465: Mr. Costa and Mr. Valadao.H.R. 471: Mr. Buck, Ms. Mace, Mr. Perry, Mr. Wright, Mr.Babin, Mr. Norman, and Mr. Gibbs.H.R. 472: Mr. Feenstra.H.R. 485: Mrs. Hayes, Mr. Castro of Texas, Ms. Wild, Mr.Takano, Mr. Morelle, Mrs. Trahan, Mr. Levin of Michigan, andMs. Adams.H.R. 488: Mr. Newhouse, Mr. Stewart,[...][Page H254]<\/pre>"],"title":["Global Health Security Act of 2021"],"version":["1.0.0"]},"columns":[{"accessor":"billNumber","name":"billNumber","type":"character","width":105},{"accessor":"createDate","name":"createDate","type":"character","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":100},{"accessor":"updateDate","name":"updateDate","type":"character","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":100},{"accessor":"originChamber","name":"originChamber","type":"character","show":false},{"accessor":"billType","name":"billType","type":"character","width":85},{"accessor":"introducedDate","name":"introducedDate","type":"character","format":{"cell":{"date":true},"aggregated":{"date":true}},"width":120},{"accessor":"congress","name":"congress","type":"character","width":90},{"accessor":"constitutionalAuthorityStatementText","name":"constitutionalAuthorityStatementText","type":"character","show":false},{"accessor":"title","name":"title","type":"character","minWidth":180},{"accessor":"version","name":"version","type":"character","show":false,"width":80}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"theme":{"color":"#474d4d","backgroundColor":"#FFFFFF","borderColor":"#dddddd","borderWidth":"1px","stripedColor":"#dddddd","highlightColor":"#f0f0f0","cellPadding":"8px 12px","style":{"padding":"16px 8px"},"tableStyle":{"fontSize":14,"borderBottom":"3px solid #222222","fontFamily":"Noto Sans, sans-serif"},"headerStyle":{"borderWidth":"3px","paddingTop":"12px","verticalAlign":"bottom","textAlign":"bottom","background":"#FFFFFF","textTransform":"uppercase","borderColor":"#474d4d","color":"#051414","&:hover":{"background":"#dddddd"},"&[aria-sort='ascending'], &[aria-sort='descending']":{"background":"#5b5e5f","color":"#FFFFFF"},"borderColor.1":"#333","fontSize":12,"fontFamily":"Heebo Light, sans-serif"},"groupHeaderStyle":{"&:not(:empty)":{"paddingBottom":"3px","verticalAlign":"bottom","textAlign":"bottom","backgroundColor":"#FFFFFF","textTransform":"uppercase","fontSize":12,"color":"#474d4d"}},"rowSelectedStyle":{"backgroundColor":"#dddddd"},"inputStyle":{"backgroundColor":"#FFFFFF","color":"#474d4d"},"searchInputStyle":{"textTransform":"uppercase","color":"#474d4d","fontSize":"14px"},"paginationStyle":{"textTransform":"uppercase","fontSize":"14px"},"pageButtonStyle":{"textTransform":"uppercase","fontSize":"14px"}},"dataKey":"2a124a35ba7bcd958c473a8f8914c0f7"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>This includes the bill title, when it was introduced, what type of bill it is, and which congress introduced it. To combine the data for actions, sponsors, committees, and votes, we need to process them individually.</p>
</section></section><section id="the-not-so-simple-elements" class="level2"><h2 class="anchored" data-anchor-id="the-not-so-simple-elements">The not-so-simple elements</h2>
<p>This is where the majority of the legwork is so if you can comfortably filter out some data<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, now’s a good time. There’s no point spending an hour trying to process one particularly difficult bit of information only to realize it isn’t useful to you anyway.</p>
<p>For brevity I’ll go through how to process the actions and votes elements, but you can find the code for extracting the full XML file <a href="https://github.com/MokeEire/my-reps/blob/master/R/parsing_functions.R">here</a><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.</p>
<section id="actions-1" class="level3"><h3 class="anchored" data-anchor-id="actions-1">Actions</h3>
<p>What’s in the actions container?</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">actions_xml</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">bill_node</span>, <span class="st">"actions/item"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (14)}
 [1] &lt;item&gt;\n  &lt;actionDate&gt;2021-07-12&lt;/actionDate&gt;\n  &lt;committees&gt;\n    &lt;item ...
 [2] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;19:46:03&lt;/a ...
 [3] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;19:46:02&lt;/a ...
 [4] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;19:46:02&lt;/a ...
 [5] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;19:24:39&lt;/a ...
 [6] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;15:20:02&lt;/a ...
 [7] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;15:05:31&lt;/a ...
 [8] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;15:05:26&lt;/a ...
 [9] &lt;item&gt;\n  &lt;actionDate&gt;2021-06-28&lt;/actionDate&gt;\n  &lt;actionTime&gt;15:05:13&lt;/a ...
[10] &lt;item&gt;\n  &lt;actionDate&gt;2021-03-25&lt;/actionDate&gt;\n  &lt;committees&gt;\n    &lt;item ...
[11] &lt;item&gt;\n  &lt;actionDate&gt;2021-03-25&lt;/actionDate&gt;\n  &lt;committees&gt;\n    &lt;item ...
[12] &lt;item&gt;\n  &lt;actionDate&gt;2021-01-21&lt;/actionDate&gt;\n  &lt;links/&gt;\n  &lt;text&gt;Refer ...
[13] &lt;item&gt;\n  &lt;actionDate&gt;2021-01-21&lt;/actionDate&gt;\n  &lt;links/&gt;\n  &lt;text&gt;Intro ...
[14] &lt;item&gt;\n  &lt;actionDate&gt;2021-01-21&lt;/actionDate&gt;\n  &lt;links/&gt;\n  &lt;text&gt;Intro ...</code></pre>
</div>
</div>
<p>And what does a single action element look like?</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="va">actions_xml</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (6)}
[1] &lt;actionDate&gt;2021-07-12&lt;/actionDate&gt;
[2] &lt;committees&gt;\n  &lt;item&gt;\n    &lt;systemCode&gt;ssfr00&lt;/systemCode&gt;\n    &lt;name&gt;Fo ...
[3] &lt;links/&gt;
[4] &lt;sourceSystem&gt;\n  &lt;code&gt;0&lt;/code&gt;\n  &lt;name&gt;Senate&lt;/name&gt;\n&lt;/sourceSystem&gt;
[5] &lt;text&gt;Received in the Senate and Read twice and referred to the Committee ...
[6] &lt;type&gt;IntroReferral&lt;/type&gt;</code></pre>
</div>
</div>
<p>So this bill has 14 actions recorded on it. We can use <code><a href="http://xml2.r-lib.org/reference/as_list.html">as_list()</a></code> to convert the <code>{xml_nodeset}</code> to a list.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">actions_list</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">actions_xml</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at the first action</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">actions_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ actionDate  :List of 1
  ..$ : chr "2021-07-12"
 $ committees  :List of 1
  ..$ item:List of 2
  .. ..$ systemCode:List of 1
  .. ..$ name      :List of 1
 $ links       : list()
 $ sourceSystem:List of 2
  ..$ code:List of 1
  .. ..$ : chr "0"
  ..$ name:List of 1
  .. ..$ : chr "Senate"
 $ text        :List of 1
  ..$ : chr "Received in the Senate and Read twice and referred to the Committee on Foreign Relations."
 $ type        :List of 1
  ..$ : chr "IntroReferral"</code></pre>
</div>
</div>
<p>In the individual action container, we can see we have the type, text, and date of the action, a list of committees related to the action, and some elements which are singular and some which are not. To deal with this, we can write a function (or set of functions) like the ones below to process an action:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Helper function: flatten_dfc_rename</span></span>
<span><span class="co"># flatten a list to dataframe and </span></span>
<span><span class="co"># rename the columns with a given prefix</span></span>
<span><span class="va">flatten_dfc_rename</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">list_to_flatten</span>, </span>
<span>                          <span class="va">name_prefix</span> <span class="op">=</span> <span class="st">"prefix"</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">rename_with</span><span class="op">(</span></span>
<span>    .data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc</a></span><span class="op">(</span><span class="va">list_to_flatten</span><span class="op">)</span>, </span>
<span>    .fn <span class="op">=</span> <span class="op">~</span><span class="fu">str_c</span><span class="op">(</span><span class="va">name_prefix</span>, <span class="st">"_"</span>, <span class="va">.</span><span class="op">)</span>,</span>
<span>    <span class="co"># Exclude columns which already start with the prefix</span></span>
<span>    .cols <span class="op">=</span> <span class="op">-</span><span class="fu">starts_with</span><span class="op">(</span><span class="va">name_prefix</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function: parse_action</span></span>
<span><span class="co"># Parse actions from list to dataframe</span></span>
<span><span class="va">parse_action</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">action</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">action</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="co"># Flatten+rename  sourceSystem elements</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_if.html">map_at</a></span><span class="op">(</span><span class="st">"sourceSystem"</span>, <span class="op">~</span><span class="fu">flatten_dfc_rename</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"source"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="co"># Flatten+rename committees</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_if.html">map_at</a></span><span class="op">(</span><span class="st">"committees"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">committee</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">committee</span>, <span class="op">~</span><span class="fu">flatten_dfc_rename</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"committee"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="co"># Flatten object to dataframe</span></span>
<span>    <span class="fu">flatten_dfc_rename</span><span class="op">(</span><span class="va">.</span>, <span class="st">"action"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Parse the first action</span></span>
<span><span class="fu">parse_action</span><span class="op">(</span><span class="va">actions_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 7
$ action_date                  &lt;chr&gt; "2021-07-12"
$ action_committee_system_code &lt;chr&gt; "ssfr00"
$ action_committee_name        &lt;chr&gt; "Foreign Relations Committee"
$ action_source_code           &lt;chr&gt; "0"
$ action_source_name           &lt;chr&gt; "Senate"
$ action_text                  &lt;chr&gt; "Received in the Senate and Read twice an…
$ action_type                  &lt;chr&gt; "IntroReferral"</code></pre>
</div>
</div>
<p>Using the <a href="http://purrr.tidyverse.org">purrr</a> library’s <code><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr()</a></code>, we can apply this function to each action and combine the results as rows in a dataframe.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">actions_df</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">actions_list</span>, <span class="va">parse_action</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 14
Columns: 9
$ action_date                  &lt;chr&gt; "2021-07-12", "2021-06-28", "2021-06-28",…
$ action_committee_system_code &lt;chr&gt; "ssfr00", NA, NA, NA, NA, NA, NA, NA, NA,…
$ action_committee_name        &lt;chr&gt; "Foreign Relations Committee", NA, NA, NA…
$ action_source_code           &lt;chr&gt; "0", "2", "2", "9", "2", "2", "2", "2", "…
$ action_source_name           &lt;chr&gt; "Senate", "House floor actions", "House f…
$ action_text                  &lt;chr&gt; "Received in the Senate and Read twice an…
$ action_type                  &lt;chr&gt; "IntroReferral", "Floor", "Floor", "Floor…
$ action_time                  &lt;chr&gt; NA, "19:46:03", "19:46:02", "19:46:02", "…
$ action_code                  &lt;chr&gt; NA, "H38310", "H37300", "8000", "H30000",…</code></pre>
</div>
</div>
<p>Now if you’re processing a large amount of these data, you may want to be explicit about the data types expected in each column. This is vital when we want to <code>unnest()</code> the actions data and combine many bills’ actions into an actions-level dataset. You can do this using <code>type_convert()</code> , notice the change in column types from the output above.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">actions_df</span> <span class="op">=</span> <span class="fu">type_convert</span><span class="op">(</span><span class="va">actions_df</span>,</span>
<span>                          col_types <span class="op">=</span> <span class="fu">cols</span><span class="op">(</span></span>
<span>                            action_date <span class="op">=</span> <span class="fu">col_date</span><span class="op">(</span><span class="op">)</span>, </span>
<span>                            action_time <span class="op">=</span> <span class="fu">col_time</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                            action_committee_systemCode <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>, </span>
<span>                            action_committee_name <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>, </span>
<span>                            action_source_code <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                            action_source_name <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                            action_text <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>, </span>
<span>                            action_type <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>, </span>
<span>                            action_code <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span></span>
<span>                            <span class="op">)</span></span>
<span>                          <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 14
Columns: 9
$ action_date                  &lt;date&gt; 2021-07-12, 2021-06-28, 2021-06-28, 2021…
$ action_committee_system_code &lt;chr&gt; "ssfr00", NA, NA, NA, NA, NA, NA, NA, NA,…
$ action_committee_name        &lt;chr&gt; "Foreign Relations Committee", NA, NA, NA…
$ action_source_code           &lt;chr&gt; "0", "2", "2", "9", "2", "2", "2", "2", "…
$ action_source_name           &lt;chr&gt; "Senate", "House floor actions", "House f…
$ action_text                  &lt;chr&gt; "Received in the Senate and Read twice an…
$ action_type                  &lt;chr&gt; "IntroReferral", "Floor", "Floor", "Floor…
$ action_time                  &lt;time&gt;       NA, 19:46:03, 19:46:02, 19:46:02, …
$ action_code                  &lt;chr&gt; NA, "H38310", "H37300", "8000", "H30000",…</code></pre>
</div>
</div>
<p>To add these actions data as a list column to <code>bill_df</code> we can simply use dollar assignment.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bill_df</span><span class="op">$</span><span class="va">actions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">actions_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">bill_df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 11
$ billNumber                           &lt;chr&gt; "391"
$ createDate                           &lt;chr&gt; "2021-01-22T08:12:10Z"
$ updateDate                           &lt;chr&gt; "2022-02-09T12:37:52Z"
$ originChamber                        &lt;chr&gt; "House"
$ billType                             &lt;chr&gt; "HR"
$ introducedDate                       &lt;chr&gt; "2021-01-21"
$ congress                             &lt;chr&gt; "117"
$ constitutionalAuthorityStatementText &lt;chr&gt; "&lt;pre&gt;[Congressional Record Volum…
$ title                                &lt;chr&gt; "Global Health Security Act of 20…
$ version                              &lt;chr&gt; "1.0.0"
$ actions                              &lt;list&gt; [&lt;tbl_df[14 x 9]&gt;]</code></pre>
</div>
</div>
<p>The remaining sections will be following the same process for different elements, but it can be boiled down to these steps:</p>
<ol type="1">
<li><strong>Explore the structure</strong></li>
</ol>
<blockquote class="blockquote">
<p>Go through any available documentation, and when you read in the XML file you can use functions like <code><a href="https://rdrr.io/pkg/XML/man/xmlTreeParse.html">xmlParse()</a></code>, <code><a href="http://xml2.r-lib.org/reference/xml_structure.html">xml_structure()</a></code>, and <code><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents()</a></code> .</p>
</blockquote>
<ol start="2" type="1">
<li><strong>Define the output</strong></li>
</ol>
<blockquote class="blockquote">
<p>Consider what you want the output to look like and think about how it needs to be transformed to match this target.</p>
</blockquote>
<ol start="3" type="1">
<li>
<strong>Process a single element</strong> (write a function if it gets too complicated)</li>
</ol>
<blockquote class="blockquote">
<p>Get one element into the form you want. Writing functions can help you think through the data transformations being applied and make your code easier to read.</p>
</blockquote>
<ol start="4" type="1">
<li><strong>Apply to all elements</strong></li>
</ol>
<blockquote class="blockquote">
<p>Focus on processing of the entire file (or the subset of the file you’re interested in). You might want an XML file to return a single row, a single column, or a dataframe of size <span class="math inline">\(n\times k\)</span>. Once you have a single file returned in the format you want, you can combine the outputs of multiple files.</p>
</blockquote>
<div class="callout-caution callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Find the exceptions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Lastly, you will likely run into situations where a node which only seemed to contain a single piece of data has a different structure with multiple sub-elements for other files. This will happen, you’ll go back to the drawing board, design more flexibility in your functions, and understand how process either format.</p>
</div>
</div>
</section><section id="votes-1" class="level3"><h3 class="anchored" data-anchor-id="votes-1">Votes</h3>
<p>Votes are particularly interesting because it provides a more discrete measure of our representatives’ behaviour. Individual votes are stored in the <code>&lt;recordedVotes&gt;</code> container. We can access child elements in XML using a forward slash (this uses a language called XPATH).</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">bill_recorded_vote_nodes</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">bill_node</span>, <span class="st">"recordedVotes/recordedVote"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (7)}
[1] &lt;rollNumber&gt;188&lt;/rollNumber&gt;
[2] &lt;url&gt;https://clerk.house.gov/evs/2021/roll188.xml&lt;/url&gt;
[3] &lt;fullActionName&gt;Final Passage Under Suspension of the Rules Results&lt;/full ...
[4] &lt;chamber&gt;House&lt;/chamber&gt;
[5] &lt;congress&gt;117&lt;/congress&gt;
[6] &lt;date&gt;2021-06-28T23:46:02Z&lt;/date&gt;
[7] &lt;sessionNumber&gt;1&lt;/sessionNumber&gt;</code></pre>
</div>
</div>
<p>You may have spotted why votes are interesting elements to parse because inside the <code>&lt;url&gt;</code> element we find <strong>another</strong> <strong>XML file</strong>!<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> Before we dive into that can of worms, I’ll convert the top-level nodes to a list and flatten it into columns. Note we use <code><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr()</a></code> with <code>votes_list</code> because there could be multiple vote objects.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Coerce nodes to list</span></span>
<span><span class="va">recorded_votes_list</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">bill_recorded_vote_nodes</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">recorded_votes_df</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">recorded_votes_list</span>, <span class="va">flatten_dfc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 7
$ rollNumber     &lt;chr&gt; "188"
$ url            &lt;chr&gt; "https://clerk.house.gov/evs/2021/roll188.xml"
$ fullActionName &lt;chr&gt; "Final Passage Under Suspension of the Rules Results"
$ chamber        &lt;chr&gt; "House"
$ congress       &lt;chr&gt; "117"
$ date           &lt;chr&gt; "2021-06-28T23:46:02Z"
$ sessionNumber  &lt;chr&gt; "1"</code></pre>
</div>
</div>
<p>Now we want to get the vote roll XML file, so we go back to <code><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml()</a></code> .</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_roll_xml</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml</a></span><span class="op">(</span><span class="va">recorded_votes_df</span><span class="op">$</span><span class="va">url</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_document}
&lt;rollcall-vote&gt;
[1] &lt;vote-metadata&gt;\n  &lt;majority&gt;D&lt;/majority&gt;\n  &lt;congress&gt;117&lt;/congress&gt;\n   ...
[2] &lt;vote-data&gt;\n  &lt;recorded-vote&gt;\n    &lt;legislator name-id="A000370" sort-fi ...</code></pre>
</div>
</div>
<p>There are two main nodes - <code>&lt;vote-metadata&gt;</code> and <code>&lt;vote-data&gt;</code>. How many elements does each node have and what do the structures for these look like?</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_roll_children</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_children</a></span><span class="op">(</span><span class="va">vote_roll_xml</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">xml_contents</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[[1]]
{xml_nodeset (13)}
 [1] &lt;majority&gt;D&lt;/majority&gt;
 [2] &lt;congress&gt;117&lt;/congress&gt;
 [3] &lt;session&gt;1st&lt;/session&gt;
 [4] &lt;chamber&gt;U.S. House of Representatives&lt;/chamber&gt;
 [5] &lt;rollcall-num&gt;188&lt;/rollcall-num&gt;
 [6] &lt;legis-num&gt;H R 391&lt;/legis-num&gt;
 [7] &lt;vote-question&gt;On Motion to Suspend the Rules and Pass, as Amended&lt;/vote ...
 [8] &lt;vote-type&gt;2/3 YEA-AND-NAY&lt;/vote-type&gt;
 [9] &lt;vote-result&gt;Passed&lt;/vote-result&gt;
[10] &lt;action-date&gt;28-Jun-2021&lt;/action-date&gt;
[11] &lt;action-time time-etz="19:42"&gt;7:42 PM&lt;/action-time&gt;
[12] &lt;vote-desc&gt;Global Health Security Act&lt;/vote-desc&gt;
[13] &lt;vote-totals&gt;\n  &lt;totals-by-party-header&gt;\n    &lt;party-header&gt;Party&lt;/part ...

[[2]]
{xml_nodeset (430)}
 [1] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000370" sort-field="Adams" unac ...
 [2] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000055" sort-field="Aderholt" u ...
 [3] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000371" sort-field="Aguilar" un ...
 [4] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000372" sort-field="Allen" unac ...
 [5] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000376" sort-field="Allred" una ...
 [6] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000369" sort-field="Amodei" una ...
 [7] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000377" sort-field="Armstrong"  ...
 [8] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000375" sort-field="Arrington"  ...
 [9] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000148" sort-field="Auchincloss ...
[10] &lt;recorded-vote&gt;\n  &lt;legislator name-id="A000378" sort-field="Axne" unacc ...
[11] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001291" sort-field="Babin" unac ...
[12] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001298" sort-field="Bacon" unac ...
[13] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001307" sort-field="Baird" unac ...
[14] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001306" sort-field="Balderson"  ...
[15] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001299" sort-field="Banks" unac ...
[16] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001282" sort-field="Barr" unacc ...
[17] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001300" sort-field="Barragan" u ...
[18] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001270" sort-field="Bass" unacc ...
[19] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B001281" sort-field="Beatty" una ...
[20] &lt;recorded-vote&gt;\n  &lt;legislator name-id="B000668" sort-field="Bentz" unac ...
...</code></pre>
</div>
</div>
<p>One node contains the aggregated vote information, while <code>&lt;vote-data&gt;</code> contains the legislator-level vote data. Let’s try to parse the legislator-level data first.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_data</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_roll_xml</span>, <span class="st">"vote-data"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (1)}
[1] &lt;vote-data&gt;\n  &lt;recorded-vote&gt;\n    &lt;legislator name-id="A000370" sort-fi ...</code></pre>
</div>
</div>
<p>Here is the XML for a single legislator’s vote:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_child</a></span><span class="op">(</span><span class="va">vote_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_node}
&lt;recorded-vote&gt;
[1] &lt;legislator name-id="A000370" sort-field="Adams" unaccented-name="Adams"  ...
[2] &lt;vote&gt;Yea&lt;/vote&gt;</code></pre>
</div>
</div>
<p>With a similar combination of <code><a href="http://xml2.r-lib.org/reference/as_list.html">as_list()</a></code> , <code><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfr()</a></code>, and <code>unnest()</code> we can flatten the XML into one row per legislator</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_roll_flattened</span> <span class="op">=</span> <span class="va">vote_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfr</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">unnest</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 430 × 2
   legislator  vote 
   &lt;chr&gt;       &lt;chr&gt;
 1 Adams       Yea  
 2 Aderholt    Nay  
 3 Aguilar     Yea  
 4 Allen       Nay  
 5 Allred      Yea  
 6 Amodei      Yea  
 7 Armstrong   Yea  
 8 Arrington   Nay  
 9 Auchincloss Yea  
10 Axne        Yea  
# … with 420 more rows</code></pre>
</div>
</div>
<p>But we lose all the attributes! And <code>name-id</code> looked particularly useful. We’ll need to extract the attributes before we flatten the data. Let’s take another look at the legislators structure.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vote_legislators</span> <span class="op">=</span> <span class="va">vote_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"recorded-vote"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">legislators_list</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">vote_legislators</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ :List of 2
  ..$ legislator:List of 1
  .. ..$ : chr "Adams"
  .. ..- attr(*, "name-id")= chr "A000370"
  .. ..- attr(*, "sort-field")= chr "Adams"
  .. ..- attr(*, "unaccented-name")= chr "Adams"
  .. ..- attr(*, "party")= chr "D"
  .. ..- attr(*, "state")= chr "NC"
  .. ..- attr(*, "role")= chr "legislator"
  ..$ vote      :List of 1
  .. ..$ : chr "Yea"</code></pre>
</div>
</div>
<p>The legislator element has all the attributes, while the vote element only has a value. We want to extract the attributes only for legislator using <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> to apply <code><a href="https://purrr.tidyverse.org/reference/map_if.html">map_at()</a></code> on each legislator element and extract the attributes from each while retaining the value in <code>vote</code>. It can often feel like you’re getting lost in a list of lists, but with some experimentation you’ll be able to find your way back to the surface.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">legislator_vote_df</span> <span class="op">=</span> <span class="va">legislators_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="co"># Modify one level deeper using map_at to target legislator elements</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">map_at</span>, <span class="st">"legislator"</span>, <span class="va">attributes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">flatten_dfc</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 430 × 7
   `name-id` `sort-field` `unaccented-name` party state role       vote 
   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;
 1 A000370   Adams        Adams             D     NC    legislator Yea  
 2 A000055   Aderholt     Aderholt          R     AL    legislator Nay  
 3 A000371   Aguilar      Aguilar           D     CA    legislator Yea  
 4 A000372   Allen        Allen             R     GA    legislator Nay  
 5 A000376   Allred       Allred            D     TX    legislator Yea  
 6 A000369   Amodei       Amodei            R     NV    legislator Yea  
 7 A000377   Armstrong    Armstrong         R     ND    legislator Yea  
 8 A000375   Arrington    Arrington         R     TX    legislator Nay  
 9 A000148   Auchincloss  Auchincloss       D     MA    legislator Yea  
10 A000378   Axne         Axne              D     IA    legislator Yea  
# … with 420 more rows</code></pre>
</div>
</div>
<p>Now we have a table of legislator voting data! But what about the <code>&lt;vote-metadata&gt;</code>?</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_metadata</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_roll_xml</span>, <span class="st">"vote-metadata"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (13)}
 [1] &lt;majority&gt;D&lt;/majority&gt;
 [2] &lt;congress&gt;117&lt;/congress&gt;
 [3] &lt;session&gt;1st&lt;/session&gt;
 [4] &lt;chamber&gt;U.S. House of Representatives&lt;/chamber&gt;
 [5] &lt;rollcall-num&gt;188&lt;/rollcall-num&gt;
 [6] &lt;legis-num&gt;H R 391&lt;/legis-num&gt;
 [7] &lt;vote-question&gt;On Motion to Suspend the Rules and Pass, as Amended&lt;/vote ...
 [8] &lt;vote-type&gt;2/3 YEA-AND-NAY&lt;/vote-type&gt;
 [9] &lt;vote-result&gt;Passed&lt;/vote-result&gt;
[10] &lt;action-date&gt;28-Jun-2021&lt;/action-date&gt;
[11] &lt;action-time time-etz="19:42"&gt;7:42 PM&lt;/action-time&gt;
[12] &lt;vote-desc&gt;Global Health Security Act&lt;/vote-desc&gt;
[13] &lt;vote-totals&gt;\n  &lt;totals-by-party-header&gt;\n    &lt;party-header&gt;Party&lt;/part ...</code></pre>
</div>
</div>
<p>Everything other than the <code>&lt;vote-totals&gt;</code> element is singular so we can get that out of the way the same way as before:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vote_singular_nodes</span> <span class="op">=</span> <span class="fu">xml_singular_nodes</span><span class="op">(</span><span class="va">vote_metadata</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">vote_df</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">vote_singular_nodes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># as_list() doesn't retain element names so we set names ourselves</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_name.html">xml_name</a></span><span class="op">(</span><span class="va">vote_singular_nodes</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/flatten.html">flatten_dfc</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 12
$ majority        &lt;chr&gt; "D"
$ congress        &lt;chr&gt; "117"
$ session         &lt;chr&gt; "1st"
$ chamber         &lt;chr&gt; "U.S. House of Representatives"
$ `rollcall-num`  &lt;chr&gt; "188"
$ `legis-num`     &lt;chr&gt; "H R 391"
$ `vote-question` &lt;chr&gt; "On Motion to Suspend the Rules and Pass, as Amended"
$ `vote-type`     &lt;chr&gt; "2/3 YEA-AND-NAY"
$ `vote-result`   &lt;chr&gt; "Passed"
$ `action-date`   &lt;chr&gt; "28-Jun-2021"
$ `action-time`   &lt;chr&gt; "7:42 PM"
$ `vote-desc`     &lt;chr&gt; "Global Health Security Act"</code></pre>
</div>
</div>
<p>The <code>&lt;vote-totals&gt;</code> are a bit of a unique little element, with 3 different types of nodes.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_totals</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_metadata</span>, <span class="st">"vote-totals"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (5)}
[1] &lt;totals-by-party-header&gt;\n  &lt;party-header&gt;Party&lt;/party-header&gt;\n  &lt;yea-he ...
[2] &lt;totals-by-party&gt;\n  &lt;party&gt;Republican&lt;/party&gt;\n  &lt;yea-total&gt;90&lt;/yea-tota ...
[3] &lt;totals-by-party&gt;\n  &lt;party&gt;Democratic&lt;/party&gt;\n  &lt;yea-total&gt;217&lt;/yea-tot ...
[4] &lt;totals-by-party&gt;\n  &lt;party&gt;Independent&lt;/party&gt;\n  &lt;yea-total&gt;0&lt;/yea-tota ...
[5] &lt;totals-by-vote&gt;\n  &lt;total-stub&gt;Totals&lt;/total-stub&gt;\n  &lt;yea-total&gt;307&lt;/ye ...</code></pre>
</div>
</div>
<p>This is another opportunity for us to be choosy with our data. The first node is table headers, which we don’t need because the elements are tagged anyway. From these, we really only need the <code>&lt;totals-by-party&gt;</code> nodes as long as the totals of which agree with <code>&lt;totals-by-vote&gt;</code> , which is worth checking.</p>
<div>
<details open=""><summary>Code</summary><div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_totals_by_party</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_totals</span>, <span class="st">"totals-by-party"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">totals_by_vote</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">vote_totals</span>, <span class="st">"totals-by-vote"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_contents</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>{xml_nodeset (3)}
[1] &lt;totals-by-party&gt;\n  &lt;party&gt;Republican&lt;/party&gt;\n  &lt;yea-total&gt;90&lt;/yea-tota ...
[2] &lt;totals-by-party&gt;\n  &lt;party&gt;Democratic&lt;/party&gt;\n  &lt;yea-total&gt;217&lt;/yea-tot ...
[3] &lt;totals-by-party&gt;\n  &lt;party&gt;Independent&lt;/party&gt;\n  &lt;yea-total&gt;0&lt;/yea-tota ...</code></pre>
</div>
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>{xml_nodeset (5)}
[1] &lt;total-stub&gt;Totals&lt;/total-stub&gt;
[2] &lt;yea-total&gt;307&lt;/yea-total&gt;
[3] &lt;nay-total&gt;112&lt;/nay-total&gt;
[4] &lt;present-total&gt;0&lt;/present-total&gt;
[5] &lt;not-voting-total&gt;11&lt;/not-voting-total&gt;</code></pre>
</div>
</div>
</div>
</div>
<p>Once we have our nodeset (which at last are all singular), we use same listing, mapping, and flattening…or <em>lappening</em> as absolutely no one calls it.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">party_vote_totals_df</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/as_list.html">as_list</a></span><span class="op">(</span><span class="va">vote_totals_by_party</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">flatten_dfc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">type_convert</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  party       `yea-total` `nay-total` `present-total` `not-voting-total`
  &lt;chr&gt;             &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;              &lt;dbl&gt;
1 Republican           90         112               0                  9
2 Democratic          217           0               0                  2
3 Independent           0           0               0                  0</code></pre>
</div>
</div>
<p>Now that we have all of our vote data wrangled from the thorny grasp of XML, we can put it all together.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">vote_roll_df</span> <span class="op">=</span> <span class="va">vote_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>legislator_votes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">legislator_vote_df</span><span class="op">)</span>,</span>
<span>         party_votes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">party_vote_totals_df</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 14
$ majority         &lt;chr&gt; "D"
$ congress         &lt;chr&gt; "117"
$ session          &lt;chr&gt; "1st"
$ chamber          &lt;chr&gt; "U.S. House of Representatives"
$ rollcall_num     &lt;chr&gt; "188"
$ legis_num        &lt;chr&gt; "H R 391"
$ vote_question    &lt;chr&gt; "On Motion to Suspend the Rules and Pass, as Amended"
$ vote_type        &lt;chr&gt; "2/3 YEA-AND-NAY"
$ vote_result      &lt;chr&gt; "Passed"
$ action_date      &lt;chr&gt; "28-Jun-2021"
$ action_time      &lt;chr&gt; "7:42 PM"
$ vote_desc        &lt;chr&gt; "Global Health Security Act"
$ legislator_votes &lt;list&gt; [&lt;tbl_df[430 x 7]&gt;]
$ party_votes      &lt;list&gt; [&lt;tbl_df[3 x 5]&gt;]</code></pre>
</div>
</div>
<p>And we continue to stack this Russian doll of data from the legislator-level to the vote-level…</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">recorded_votes_df</span> <span class="op">=</span> <span class="va">recorded_votes_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>vote_roll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">vote_roll_df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 8
$ rollNumber     &lt;chr&gt; "188"
$ url            &lt;chr&gt; "https://clerk.house.gov/evs/2021/roll188.xml"
$ fullActionName &lt;chr&gt; "Final Passage Under Suspension of the Rules Results"
$ chamber        &lt;chr&gt; "House"
$ congress       &lt;chr&gt; "117"
$ date           &lt;chr&gt; "2021-06-28T23:46:02Z"
$ sessionNumber  &lt;chr&gt; "1"
$ vote_roll      &lt;list&gt; [&lt;tbl_df[1 x 14]&gt;]</code></pre>
</div>
</div>
<p>…all the way until we’ve gotten back to the bill-level.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bill_df</span><span class="op">$</span><span class="va">votes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">recorded_votes_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">bill_df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 12
$ billNumber                           &lt;chr&gt; "391"
$ createDate                           &lt;chr&gt; "2021-01-22T08:12:10Z"
$ updateDate                           &lt;chr&gt; "2022-02-09T12:37:52Z"
$ originChamber                        &lt;chr&gt; "House"
$ billType                             &lt;chr&gt; "HR"
$ introducedDate                       &lt;chr&gt; "2021-01-21"
$ congress                             &lt;chr&gt; "117"
$ constitutionalAuthorityStatementText &lt;chr&gt; "&lt;pre&gt;[Congressional Record Volum…
$ title                                &lt;chr&gt; "Global Health Security Act of 20…
$ version                              &lt;chr&gt; "1.0.0"
$ actions                              &lt;list&gt; [&lt;tbl_df[14 x 9]&gt;]
$ votes                                &lt;list&gt; [&lt;tbl_df[1 x 8]&gt;]</code></pre>
</div>
</div>
</section></section></section><section id="other-helpful-articles" class="level1"><h1>Other helpful articles</h1>
<p>Here are some of the helpful articles I came across in the course of writing this:</p>
<ul>
<li><a href="https://towardsdatascience.com/from-xml-to-excel-for-data-analysis-ac0c0c765b7d" title="Introduction to Processing XML In Python">From XML to Excel for Data Analysis</a></li>
<li><a href="https://medium.com/geekculture/reading-xml-files-in-r-3122c3a2a8d9">Reading XML files in R</a></li>
</ul></section><section id="session-info" class="level1"><h1>Session Info</h1>
<p>Version information about R, OS, and loaded packages.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.2.1 (2022-06-23 ucrt)
 os       Windows 10 x64 (build 19043)
 system   x86_64, mingw32
 ui       RTerm
 language (EN)
 collate  English_United States.utf8
 ctype    English_United States.utf8
 tz       America/Los_Angeles
 date     2022-07-19
 pandoc   2.17.1.1 @ C:/Program Files/RStudio/bin/quarto/bin/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package     * version   date (UTC) lib source
 assertthat    0.2.1     2019-03-21 [1] CRAN (R 4.2.0)
 backports     1.4.1     2021-12-13 [1] CRAN (R 4.2.0)
 bit           4.0.4     2020-08-04 [1] CRAN (R 4.2.0)
 bit64         4.0.5     2020-08-30 [1] CRAN (R 4.2.0)
 bitops        1.0-7     2021-04-24 [1] CRAN (R 4.2.0)
 broom         1.0.0     2022-07-01 [1] CRAN (R 4.2.1)
 cellranger    1.1.0     2016-07-27 [1] CRAN (R 4.2.0)
 cli           3.3.0     2022-04-25 [1] CRAN (R 4.2.0)
 colorspace    2.0-3     2022-02-21 [1] CRAN (R 4.2.0)
 crayon        1.5.1     2022-03-26 [1] CRAN (R 4.2.0)
 curl          4.3.2     2021-06-23 [1] CRAN (R 4.2.0)
 DBI           1.1.3     2022-06-18 [1] CRAN (R 4.2.0)
 dbplyr        2.2.1     2022-06-27 [1] CRAN (R 4.2.1)
 digest        0.6.29    2021-12-01 [1] CRAN (R 4.2.0)
 dplyr       * 1.0.9     2022-04-28 [1] CRAN (R 4.2.0)
 ellipsis      0.3.2     2021-04-29 [1] CRAN (R 4.2.0)
 evaluate      0.15      2022-02-18 [1] CRAN (R 4.2.0)
 extrafont   * 0.18      2022-04-12 [1] CRAN (R 4.2.0)
 extrafontdb   1.0       2012-06-11 [1] CRAN (R 4.2.0)
 fansi         1.0.3     2022-03-24 [1] CRAN (R 4.2.0)
 fastmap       1.1.0     2021-01-25 [1] CRAN (R 4.2.0)
 forcats     * 0.5.1     2021-01-27 [1] CRAN (R 4.2.0)
 fs            1.5.2     2021-12-08 [1] CRAN (R 4.2.0)
 generics      0.1.2     2022-01-31 [1] CRAN (R 4.2.0)
 ggplot2     * 3.3.6     2022-05-03 [1] CRAN (R 4.2.0)
 glue          1.6.2     2022-02-24 [1] CRAN (R 4.2.0)
 gtable        0.3.0     2019-03-25 [1] CRAN (R 4.2.0)
 haven         2.5.0     2022-04-15 [1] CRAN (R 4.2.0)
 hms           1.1.1     2021-09-26 [1] CRAN (R 4.2.0)
 htmltools     0.5.2     2021-08-25 [1] CRAN (R 4.2.0)
 htmlwidgets   1.5.4     2021-09-08 [1] CRAN (R 4.2.0)
 httr          1.4.3     2022-05-04 [1] CRAN (R 4.2.0)
 janitor       2.1.0     2021-01-05 [1] CRAN (R 4.2.1)
 jsonlite    * 1.8.0     2022-02-22 [1] CRAN (R 4.2.0)
 knitr         1.39      2022-04-26 [1] CRAN (R 4.2.0)
 lifecycle     1.0.1     2021-09-24 [1] CRAN (R 4.2.0)
 log4r       * 0.4.2     2021-11-04 [1] CRAN (R 4.2.0)
 lubridate   * 1.8.0     2021-10-07 [1] CRAN (R 4.2.0)
 magrittr    * 2.0.3     2022-03-30 [1] CRAN (R 4.2.0)
 modelr        0.1.8     2020-05-19 [1] CRAN (R 4.2.0)
 mokeR       * 0.1.0     2022-07-16 [1] local
 munsell       0.5.0     2018-06-12 [1] CRAN (R 4.2.0)
 pillar        1.7.0     2022-02-01 [1] CRAN (R 4.2.0)
 pkgconfig     2.0.3     2019-09-22 [1] CRAN (R 4.2.0)
 purrr       * 0.3.4     2020-04-17 [1] CRAN (R 4.2.0)
 R6            2.5.1     2021-08-19 [1] CRAN (R 4.2.0)
 RCurl       * 1.98-1.7  2022-06-09 [1] CRAN (R 4.2.0)
 reactable   * 0.3.0     2022-05-26 [1] CRAN (R 4.2.0)
 reactR        0.4.4     2021-02-22 [1] CRAN (R 4.2.0)
 readr       * 2.1.2     2022-01-30 [1] CRAN (R 4.2.0)
 readxl        1.4.0     2022-03-28 [1] CRAN (R 4.2.0)
 reprex        2.0.1     2021-08-05 [1] CRAN (R 4.2.0)
 rjson       * 0.2.21    2022-01-09 [1] CRAN (R 4.2.0)
 rlang         1.0.4     2022-07-12 [1] CRAN (R 4.2.1)
 rmarkdown     2.14      2022-04-25 [1] CRAN (R 4.2.0)
 rstudioapi    0.13      2020-11-12 [1] CRAN (R 4.2.0)
 Rttf2pt1      1.3.8     2020-01-10 [1] CRAN (R 4.2.1)
 rvest         1.0.2     2021-10-16 [1] CRAN (R 4.2.0)
 scales        1.2.0     2022-04-13 [1] CRAN (R 4.2.0)
 sessioninfo   1.2.2     2021-12-06 [1] CRAN (R 4.2.0)
 snakecase     0.11.0    2019-05-25 [1] CRAN (R 4.2.1)
 stringi       1.7.6     2021-11-29 [1] CRAN (R 4.2.0)
 stringr     * 1.4.0     2019-02-10 [1] CRAN (R 4.2.0)
 tibble      * 3.1.7     2022-05-03 [1] CRAN (R 4.2.0)
 tidyjson    * 0.3.1     2020-05-31 [1] CRAN (R 4.2.0)
 tidyr       * 1.2.0     2022-02-01 [1] CRAN (R 4.2.0)
 tidyselect    1.1.2     2022-02-21 [1] CRAN (R 4.2.0)
 tidyverse   * 1.3.1     2021-04-15 [1] CRAN (R 4.2.0)
 tzdb          0.3.0     2022-03-28 [1] CRAN (R 4.2.0)
 utf8          1.2.2     2021-07-24 [1] CRAN (R 4.2.0)
 vctrs         0.4.1     2022-04-13 [1] CRAN (R 4.2.0)
 vroom         1.5.7     2021-11-30 [1] CRAN (R 4.2.0)
 withr         2.5.0     2022-03-03 [1] CRAN (R 4.2.0)
 xfun          0.31      2022-05-10 [1] CRAN (R 4.2.0)
 XML         * 3.99-0.10 2022-06-09 [1] CRAN (R 4.2.0)
 xml2        * 1.3.3     2021-11-30 [1] CRAN (R 4.2.0)
 yaml          2.3.5     2022-02-21 [1] CRAN (R 4.2.0)

 [1] C:/Users/Mark/AppData/Local/R/win-library/4.2
 [2] C:/Program Files/R/R-4.2.1/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>


<!-- -->

</section><div id="quarto-appendix" class="default"><section class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1" role="doc-endnote"><p><a href="https://en.wikipedia.org/wiki/XML">Wikipedia</a> for the curious. Don’t miss the drama about Microsoft’s “vociferous protests” as one of the co-editors started working with Netscape.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p><code>xml_document</code> is one of the “key classes” used in the <a href="https://xml2.r-lib.org/">xml2</a> library, the others being <code>xml_node</code> (a single node), and <code>xml_nodeset</code> (a set of nodes).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>And sadly not an Irish metal music genre.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>But do yourself a favour and write it down somewhere - comment it in the code, tell your colleagues or collaborators, put it on a particularly strong post it, whatever works.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p>Ctrl/Cmd+F: <code>extract_bill_status</code><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://c.tenor.com/um2EhyMQyR8AAAAC/xzibit-meme.gif" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">They heard you like XML</figcaption><p></p>
</figure>
</div>
<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a>
</li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb73" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Parsing XML with R"</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Untangling congressional legislative data"</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2022-07-14"</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> </span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - data</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - governance</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - R</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="co">    comments:</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="co">      hypothesis: true</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extrafont)</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reactable)</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://github.com/MokeEire/my-reps/raw/master/R/parsing_functions.R"</span>)</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>bill_xml_link <span class="ot">=</span> <span class="st">"https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml"</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>bill_xml_file <span class="ot">=</span> <span class="fu">read_xml</span>(bill_xml_link)</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: df-print-fct</span></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a>knit_print.data.frame <span class="ot">=</span> <span class="cf">function</span>(x, ...){</span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">knit_print</span>(</span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">reactable</span>(x,</span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a>              <span class="at">compact =</span> T, </span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a>              <span class="at">resizable =</span> T,</span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a>Data comes in many forms. You've probably used data formats like Excel spreadsheets, text files, databases and if you're reading this maybe even (e)Xtensible Markup Language, or XML. XML is a storage format designed for flexibly transmitting data<span class="ot">[^1]</span> but this flexibility often leads to a bit of a hassle when trying to parse it for use in analytics. This article takes a look at this tricky, but valuable data type, how to use it, and a set of steps for processing XML with R.</span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span><span class="co">[</span><span class="ot">Wikipedia</span><span class="co">](https://en.wikipedia.org/wiki/XML)</span> for the curious. Don't miss the drama about Microsoft's "vociferous protests" as one of the co-editors started working with Netscape.</span>
<span id="cb73-54"><a href="#cb73-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-55"><a href="#cb73-55" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip appearance="simple"}</span>
<span id="cb73-56"><a href="#cb73-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## What you'll learn:</span></span>
<span id="cb73-57"><a href="#cb73-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-58"><a href="#cb73-58" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Load and parse XML files in R using the <span class="in">`{XML}`</span> and <span class="in">`{xml2}`</span> packages</span>
<span id="cb73-59"><a href="#cb73-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-60"><a href="#cb73-60" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explore the structure of XML documents</span>
<span id="cb73-61"><a href="#cb73-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-62"><a href="#cb73-62" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>List, map, and flatten your data into a tabular format</span>
<span id="cb73-63"><a href="#cb73-63" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-64"><a href="#cb73-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-65"><a href="#cb73-65" aria-hidden="true" tabindex="-1"></a>The impetus for this post was the US government's congressional data. The US Government Publishing Office collects and provides records of all the bills that pass through congress, including the committees which consider the bill, the legislators who sponsor, or co-sponsor the bill, and any action taken on the bill while it is in congress e.g. votes and debates. I'm curious to see what kind of insights we can glean about the legislative structures and context of decision-making that determines the laws that are passed (or not). More to come on this in the future.</span>
<span id="cb73-66"><a href="#cb73-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-67"><a href="#cb73-67" aria-hidden="true" tabindex="-1"></a>As always, the first step of data analysis is to check if any documentation exists and thankfully <span class="co">[</span><span class="ot">govinfo</span><span class="co">](https://www.govinfo.gov/)</span> has provided some <span class="co">[</span><span class="ot">guidance</span><span class="co">](https://github.com/usgpo/bill-status/blob/main/BILLSTATUS-XML_User_User-Guide.md)</span> on how to interpret the data and where its limitations are.</span>
<span id="cb73-68"><a href="#cb73-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-69"><a href="#cb73-69" aria-hidden="true" tabindex="-1"></a>To follow along, you can download the sample XML file <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml "HR-391: Global Health Security Act of 2021")</span>. The sample bill (chosen because its contents are instructional for data cleaning) is <span class="co">[</span><span class="ot">*HR-391: Global Health Security Act of 2021*</span><span class="co">](https://www.govinfo.gov/app/details/BILLS-117hr391rfs)</span>*.*</span>
<span id="cb73-70"><a href="#cb73-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-71"><a href="#cb73-71" aria-hidden="true" tabindex="-1"></a><span class="fu"># What is XML?</span></span>
<span id="cb73-72"><a href="#cb73-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-73"><a href="#cb73-73" aria-hidden="true" tabindex="-1"></a>It is a format designed to work with any "arbitrary" structure. For example, an action taken on a bill in our data looks like this:</span>
<span id="cb73-74"><a href="#cb73-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-77"><a href="#cb73-77" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-78"><a href="#cb73-78" aria-hidden="true" tabindex="-1"></a>(<span class="at">example_node =</span> <span class="fu">xml_find_first</span>(bill_xml_file, <span class="st">"bill/actions/item"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-79"><a href="#cb73-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xmlParse</span>()</span>
<span id="cb73-80"><a href="#cb73-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-81"><a href="#cb73-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-82"><a href="#cb73-82" aria-hidden="true" tabindex="-1"></a>Where this action <span class="in">`&lt;item&gt;`</span> node is one of many actions taken on a <span class="in">`&lt;bill&gt;`</span> node (its *parent* node), while an `&lt;item&gt;` may also contain multiple committee `&lt;item&gt;` nodes (its *children*). To have a table at this level of detail could end up being hundreds of rows per bill, making this flexible structure in XML more helpful.</span>
<span id="cb73-83"><a href="#cb73-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-84"><a href="#cb73-84" aria-hidden="true" tabindex="-1"></a><span class="fu"># Read XML data with R</span></span>
<span id="cb73-85"><a href="#cb73-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-86"><a href="#cb73-86" aria-hidden="true" tabindex="-1"></a>Here are the tools we'll be using. Between <span class="in">`{XML}`</span> and <span class="in">`{xml2}`</span> there are numerous ways to load in and process XML data. I generally prefer <span class="in">`{xml2}`</span> but I suggest looking through the packages' documentation to find the right function for your task. <span class="in">`{purrr}`</span> helps us parse and flatten the data into tabular form once we've converted it to a list.</span>
<span id="cb73-87"><a href="#cb73-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-90"><a href="#cb73-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-91"><a href="#cb73-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: read-xml</span></span>
<span id="cb73-92"><a href="#cb73-92" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb73-93"><a href="#cb73-93" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(XML)</span>
<span id="cb73-94"><a href="#cb73-94" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb73-95"><a href="#cb73-95" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb73-96"><a href="#cb73-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-97"><a href="#cb73-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-98"><a href="#cb73-98" aria-hidden="true" tabindex="-1"></a>bill_xml <span class="ot">=</span> <span class="fu">read_xml</span>(<span class="st">"https://www.govinfo.gov/bulkdata/BILLSTATUS/117/hr/BILLSTATUS-117hr391.xml"</span>)</span>
<span id="cb73-99"><a href="#cb73-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-100"><a href="#cb73-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-101"><a href="#cb73-101" aria-hidden="true" tabindex="-1"></a>Read in the file with <span class="in">`read_xml()`</span> , which returns an <span class="in">`xml_document`</span><span class="ot">[^2]</span> object.</span>
<span id="cb73-102"><a href="#cb73-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-103"><a href="#cb73-103" aria-hidden="true" tabindex="-1"></a><span class="ot">[^2]: </span><span class="in">`xml_document`</span> is one of the "key classes" used in the <span class="in">`{xml2}`</span> library, the others being <span class="in">`xml_node`</span> (a single node), and <span class="in">`xml_nodeset`</span> (a set of nodes).</span>
<span id="cb73-104"><a href="#cb73-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-107"><a href="#cb73-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-108"><a href="#cb73-108" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xml-contents</span></span>
<span id="cb73-109"><a href="#cb73-109" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb73-110"><a href="#cb73-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the xml_document's contents</span></span>
<span id="cb73-111"><a href="#cb73-111" aria-hidden="true" tabindex="-1"></a><span class="fu">xml_contents</span>(bill_xml)</span>
<span id="cb73-112"><a href="#cb73-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-113"><a href="#cb73-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-114"><a href="#cb73-114" aria-hidden="true" tabindex="-1"></a>The <span class="in">`&lt;dublinCore&gt;`</span> element is a document metadata identifier<span class="ot">[^3]</span> and while very useful in its own right, it isn't relevant for our purposes. In this case it's actually more useful to look at the <span class="in">`&lt;bill&gt;`</span> child node using <span class="in">`xml_child()`</span>.</span>
<span id="cb73-115"><a href="#cb73-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-116"><a href="#cb73-116" aria-hidden="true" tabindex="-1"></a><span class="ot">[^3]: </span>And sadly not an Irish metal music genre.</span>
<span id="cb73-117"><a href="#cb73-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-120"><a href="#cb73-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-121"><a href="#cb73-121" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb73-122"><a href="#cb73-122" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xml-bill-child</span></span>
<span id="cb73-123"><a href="#cb73-123" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-overflow: wrap</span></span>
<span id="cb73-124"><a href="#cb73-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Return child nodes named bill</span></span>
<span id="cb73-125"><a href="#cb73-125" aria-hidden="true" tabindex="-1"></a>(<span class="at">bill_node =</span> <span class="fu">xml_child</span>(bill_xml, <span class="st">"bill"</span>))</span>
<span id="cb73-126"><a href="#cb73-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-127"><a href="#cb73-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-128"><a href="#cb73-128" aria-hidden="true" tabindex="-1"></a>To convert this data from XML to a dataframe we need to deal with the nodes which have nested data. This requires a little thought about what data is relevant to your question and what <span class="co">[</span><span class="ot">level of observation</span><span class="co">](https://en.wikipedia.org/wiki/Unit_of_observation)</span> you want to use.</span>
<span id="cb73-129"><a href="#cb73-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-130"><a href="#cb73-130" aria-hidden="true" tabindex="-1"></a>It is also usually a good idea to try the most direct approach first, which is the aptly named <span class="in">`xmlToDataFrame()`</span>. When you're working with both the <span class="in">`{XML}`</span> and <span class="in">`{xml2}`</span> libraries, it is important to note that their functions often rely on different object types. In the case of <span class="in">`xmlToDataFrame()`</span>, it does not take <span class="in">`{xml_document}`</span> or <span class="in">`{xml_node}`</span> objects. If you try to use them, you'll see an error like this:</span>
<span id="cb73-131"><a href="#cb73-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-134"><a href="#cb73-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-135"><a href="#cb73-135" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xml-df-error</span></span>
<span id="cb73-136"><a href="#cb73-136" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb73-137"><a href="#cb73-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-138"><a href="#cb73-138" aria-hidden="true" tabindex="-1"></a><span class="fu">xmlToDataFrame</span>(bill_xml)</span>
<span id="cb73-139"><a href="#cb73-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-140"><a href="#cb73-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-141"><a href="#cb73-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-142"><a href="#cb73-142" aria-hidden="true" tabindex="-1"></a>Instead you'll need to use <span class="in">`xmlParse()`</span> which creates an <span class="in">`r str_c(class(xmlParse(bill_xml)), collapse = "/")`</span> object. Because we have the document metadata node which we don't want to parse, we need to use <span class="in">`getNodeSet(., [path =] "//bill")`</span> to find only nodes under <span class="in">`&lt;bill&gt;`</span>.</span>
<span id="cb73-143"><a href="#cb73-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-146"><a href="#cb73-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-147"><a href="#cb73-147" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: xml-to-df</span></span>
<span id="cb73-148"><a href="#cb73-148" aria-hidden="true" tabindex="-1"></a><span class="co">#| class-output: code-block-h</span></span>
<span id="cb73-149"><a href="#cb73-149" aria-hidden="true" tabindex="-1"></a><span class="co"># First you need to use the xmlParse function</span></span>
<span id="cb73-150"><a href="#cb73-150" aria-hidden="true" tabindex="-1"></a>bill_xml_parse <span class="ot">=</span> <span class="fu">xmlParse</span>(bill_xml)</span>
<span id="cb73-151"><a href="#cb73-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-152"><a href="#cb73-152" aria-hidden="true" tabindex="-1"></a><span class="co"># You can wrap a variable assignment in ( ) to print it, </span></span>
<span id="cb73-153"><a href="#cb73-153" aria-hidden="true" tabindex="-1"></a><span class="co"># or in this case pass it to another function via the pipe %&gt;% </span></span>
<span id="cb73-154"><a href="#cb73-154" aria-hidden="true" tabindex="-1"></a>( <span class="at">bill_xml_df_attempt =</span> <span class="fu">xmlToDataFrame</span>(<span class="fu">getNodeSet</span>(bill_xml_parse, <span class="st">"//bill"</span>)) ) <span class="sc">%&gt;%</span> </span>
<span id="cb73-155"><a href="#cb73-155" aria-hidden="true" tabindex="-1"></a>  <span class="co"># View the dataframe structure</span></span>
<span id="cb73-156"><a href="#cb73-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb73-157"><a href="#cb73-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-158"><a href="#cb73-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-159"><a href="#cb73-159" aria-hidden="true" tabindex="-1"></a>But notice that a number of fields like <span class="in">`committees`</span>, <span class="in">`actions`</span>, and <span class="in">`sponsors`</span> have had their values combined into a single column. With nested data, you may need to do a little bit more work to get the data into a <span class="co">[</span><span class="ot">tidy data</span><span class="co">](https://vita.had.co.nz/papers/tidy-data.html)</span> frame, but this approach can work for simpler XML structures. The importance of understanding the structure of your data brings us to one of the cardinal rules of data analysis:</span>
<span id="cb73-160"><a href="#cb73-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-161"><a href="#cb73-161" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip appearance="simple"}</span>
<span id="cb73-162"><a href="#cb73-162" aria-hidden="true" tabindex="-1"></a><span class="fu">## Look at your data</span></span>
<span id="cb73-163"><a href="#cb73-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-164"><a href="#cb73-164" aria-hidden="true" tabindex="-1"></a>In fact, you could even say *stare* at it. Understanding the structure and contents of your data is essential for designing a solution to consistently process the data.</span>
<span id="cb73-165"><a href="#cb73-165" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-166"><a href="#cb73-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-167"><a href="#cb73-167" aria-hidden="true" tabindex="-1"></a><span class="fu"># Define the output</span></span>
<span id="cb73-168"><a href="#cb73-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-169"><a href="#cb73-169" aria-hidden="true" tabindex="-1"></a>As well as looking at your data, it's also usually helpful to look to your intended output. This determines how to transform the data.</span>
<span id="cb73-170"><a href="#cb73-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-171"><a href="#cb73-171" aria-hidden="true" tabindex="-1"></a>**Example:** I want the congressional data to have one row per bill, with the nested characteristics stored in list columns. This will produce a comprehensive dataset which can easily be subset and transformed to various levels of observation as needed. The end result should look like this:</span>
<span id="cb73-172"><a href="#cb73-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-175"><a href="#cb73-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-176"><a href="#cb73-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-bill</span></span>
<span id="cb73-177"><a href="#cb73-177" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb73-178"><a href="#cb73-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb73-179"><a href="#cb73-179" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: screen-inset-shaded</span></span>
<span id="cb73-180"><a href="#cb73-180" aria-hidden="true" tabindex="-1"></a>example_bill_df <span class="ot">=</span> <span class="fu">extract_bill_status</span>(bill_xml_link, <span class="at">log_types =</span> <span class="cn">NULL</span>)</span>
<span id="cb73-181"><a href="#cb73-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-182"><a href="#cb73-182" aria-hidden="true" tabindex="-1"></a>example_bill_df <span class="sc">%&gt;%</span> <span class="co"># glimpse() # here to check the data</span></span>
<span id="cb73-183"><a href="#cb73-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb73-184"><a href="#cb73-184" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>bill_id, <span class="sc">-</span><span class="fu">where</span>(is_list) <span class="co"># remove list columns?</span></span>
<span id="cb73-185"><a href="#cb73-185" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb73-186"><a href="#cb73-186" aria-hidden="true" tabindex="-1"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb73-187"><a href="#cb73-187" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">moke_rt</span>(),</span>
<span id="cb73-188"><a href="#cb73-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">compact =</span> T,</span>
<span id="cb73-189"><a href="#cb73-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">resizable =</span> T,</span>
<span id="cb73-190"><a href="#cb73-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">wrap =</span> F,</span>
<span id="cb73-191"><a href="#cb73-191" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb73-192"><a href="#cb73-192" aria-hidden="true" tabindex="-1"></a>      <span class="st">"latest_action_action_date"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">name =</span> <span class="st">"action_date"</span>, </span>
<span id="cb73-193"><a href="#cb73-193" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">width =</span> <span class="dv">115</span>,</span>
<span id="cb73-194"><a href="#cb73-194" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T)),</span>
<span id="cb73-195"><a href="#cb73-195" aria-hidden="true" tabindex="-1"></a>     <span class="st">"latest_action_text"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">name =</span> <span class="st">"action_text"</span>,</span>
<span id="cb73-196"><a href="#cb73-196" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">minWidth =</span> <span class="dv">180</span>,</span>
<span id="cb73-197"><a href="#cb73-197" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">maxWidth =</span> <span class="dv">240</span>),</span>
<span id="cb73-198"><a href="#cb73-198" aria-hidden="true" tabindex="-1"></a>       <span class="st">"constitutional_authority_statement_text"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">show=</span>F),</span>
<span id="cb73-199"><a href="#cb73-199" aria-hidden="true" tabindex="-1"></a>      <span class="st">"create_date"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T), <span class="at">width =</span> <span class="dv">100</span>),</span>
<span id="cb73-200"><a href="#cb73-200" aria-hidden="true" tabindex="-1"></a>      <span class="st">"update_date"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T), <span class="at">width =</span> <span class="dv">100</span>),</span>
<span id="cb73-201"><a href="#cb73-201" aria-hidden="true" tabindex="-1"></a>      <span class="st">"introduced_date"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T), <span class="at">width =</span> <span class="dv">135</span>),</span>
<span id="cb73-202"><a href="#cb73-202" aria-hidden="true" tabindex="-1"></a>      <span class="st">"congress"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">80</span>),</span>
<span id="cb73-203"><a href="#cb73-203" aria-hidden="true" tabindex="-1"></a>     <span class="st">"origin_chamber"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">show=</span>F),</span>
<span id="cb73-204"><a href="#cb73-204" aria-hidden="true" tabindex="-1"></a>      <span class="st">"version"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">show =</span> F, <span class="at">width =</span> <span class="dv">80</span>),</span>
<span id="cb73-205"><a href="#cb73-205" aria-hidden="true" tabindex="-1"></a>      <span class="st">"bill_number"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">100</span>),</span>
<span id="cb73-206"><a href="#cb73-206" aria-hidden="true" tabindex="-1"></a>      <span class="st">"bill_type"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">80</span>),</span>
<span id="cb73-207"><a href="#cb73-207" aria-hidden="true" tabindex="-1"></a>      <span class="st">"title"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">minWidth =</span> <span class="dv">180</span>)</span>
<span id="cb73-208"><a href="#cb73-208" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb73-209"><a href="#cb73-209" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnGroups =</span> <span class="fu">list</span>(</span>
<span id="cb73-210"><a href="#cb73-210" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colGroup</span>(<span class="at">name =</span> <span class="st">"Latest Action"</span>,</span>
<span id="cb73-211"><a href="#cb73-211" aria-hidden="true" tabindex="-1"></a>                            <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"latest_action_action_date"</span>,</span>
<span id="cb73-212"><a href="#cb73-212" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"latest_action_text"</span>))</span>
<span id="cb73-213"><a href="#cb73-213" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-214"><a href="#cb73-214" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-215"><a href="#cb73-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-216"><a href="#cb73-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-217"><a href="#cb73-217" aria-hidden="true" tabindex="-1"></a>With the following list columns (among others):</span>
<span id="cb73-218"><a href="#cb73-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-219"><a href="#cb73-219" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb73-220"><a href="#cb73-220" aria-hidden="true" tabindex="-1"></a><span class="fu">## Committees</span></span>
<span id="cb73-221"><a href="#cb73-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-224"><a href="#cb73-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-225"><a href="#cb73-225" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: glimpse-committees</span></span>
<span id="cb73-226"><a href="#cb73-226" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb73-227"><a href="#cb73-227" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(example_bill_df[[<span class="st">"committees"</span>]])</span>
<span id="cb73-228"><a href="#cb73-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-229"><a href="#cb73-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-230"><a href="#cb73-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-231"><a href="#cb73-231" aria-hidden="true" tabindex="-1"></a><span class="fu">## Votes</span></span>
<span id="cb73-232"><a href="#cb73-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-235"><a href="#cb73-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-236"><a href="#cb73-236" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: glimpse-votes</span></span>
<span id="cb73-237"><a href="#cb73-237" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb73-238"><a href="#cb73-238" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(example_bill_df[[<span class="st">"votes"</span>]])</span>
<span id="cb73-239"><a href="#cb73-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-240"><a href="#cb73-240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-241"><a href="#cb73-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-242"><a href="#cb73-242" aria-hidden="true" tabindex="-1"></a><span class="fu">## Actions</span></span>
<span id="cb73-243"><a href="#cb73-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-246"><a href="#cb73-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-247"><a href="#cb73-247" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: glimpse-actio</span></span>
<span id="cb73-248"><a href="#cb73-248" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb73-249"><a href="#cb73-249" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(example_bill_df[[<span class="st">"actions"</span>]])</span>
<span id="cb73-250"><a href="#cb73-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-251"><a href="#cb73-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-252"><a href="#cb73-252" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sponsors</span></span>
<span id="cb73-253"><a href="#cb73-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-256"><a href="#cb73-256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-257"><a href="#cb73-257" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: glimpse-sponsors</span></span>
<span id="cb73-258"><a href="#cb73-258" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb73-259"><a href="#cb73-259" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(example_bill_df[[<span class="st">"sponsors"</span>]])</span>
<span id="cb73-260"><a href="#cb73-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-261"><a href="#cb73-261" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-262"><a href="#cb73-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-263"><a href="#cb73-263" aria-hidden="true" tabindex="-1"></a><span class="fu"># Parsing</span></span>
<span id="cb73-264"><a href="#cb73-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-265"><a href="#cb73-265" aria-hidden="true" tabindex="-1"></a>With this output in mind and an understanding of the current data structure, we can break the parsing process down into two categories - the simple, and the not-so-simple.</span>
<span id="cb73-266"><a href="#cb73-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-267"><a href="#cb73-267" aria-hidden="true" tabindex="-1"></a>In general, the process is two steps:</span>
<span id="cb73-268"><a href="#cb73-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-269"><a href="#cb73-269" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Convert XML to a list with <span class="in">`as_list()`</span></span>
<span id="cb73-270"><a href="#cb73-270" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Flatten the list to a data frame using a combination of functions from <span class="in">`{purrr}`</span></span>
<span id="cb73-271"><a href="#cb73-271" aria-hidden="true" tabindex="-1"></a>    a.  <span class="in">`flatten_dfc()`</span>/<span class="in">`flatten_dfr()`</span> to flatten a list into a data frame by column or row respectively</span>
<span id="cb73-272"><a href="#cb73-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-273"><a href="#cb73-273" aria-hidden="true" tabindex="-1"></a>    b.  <span class="in">`map_dfc()`</span>/<span class="in">`map_dfr()`</span> to apply a function to each element of a list and combine the results as columns or rows in a data frame respectively</span>
<span id="cb73-274"><a href="#cb73-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-275"><a href="#cb73-275" aria-hidden="true" tabindex="-1"></a><span class="fu">## The simple elements</span></span>
<span id="cb73-276"><a href="#cb73-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-277"><a href="#cb73-277" aria-hidden="true" tabindex="-1"></a>The simple parts of the data to process are those which are already at the level of observation you want. In our case - at the bill level. These are typically the top-level nodes which only have one piece of data. To select only these nodes we want to select the bill's child nodes which have no further children and are not empty. We can write a function in R like the one below, or use <span class="co">[</span><span class="ot">XPath</span><span class="co">](https://www.w3schools.com/xml/xml_parser.asp)</span> (or XML Path Language) to identify the nodes we want directly. In the process of writing this, I discovered that using XPath made this \~5x faster but I include the R function because XPath can be tricky and it may be useful to some.</span>
<span id="cb73-278"><a href="#cb73-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-281"><a href="#cb73-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-282"><a href="#cb73-282" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: singular-nodes</span></span>
<span id="cb73-283"><a href="#cb73-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb73-284"><a href="#cb73-284" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to select singular child nodes from XML node</span></span>
<span id="cb73-285"><a href="#cb73-285" aria-hidden="true" tabindex="-1"></a>xml_singular_nodes <span class="ot">=</span> <span class="cf">function</span>(xml_node){</span>
<span id="cb73-286"><a href="#cb73-286" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return child nodes of current node</span></span>
<span id="cb73-287"><a href="#cb73-287" aria-hidden="true" tabindex="-1"></a>  child_nodes <span class="ot">=</span> <span class="fu">xml_children</span>(xml_node)</span>
<span id="cb73-288"><a href="#cb73-288" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select child nodes with 0 children</span></span>
<span id="cb73-289"><a href="#cb73-289" aria-hidden="true" tabindex="-1"></a>  zero_length_child_nodes <span class="ot">=</span> child_nodes[<span class="fu">xml_length</span>(child_nodes) <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb73-290"><a href="#cb73-290" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-291"><a href="#cb73-291" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep the nodes which are not empty strings</span></span>
<span id="cb73-292"><a href="#cb73-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(zero_length_child_nodes, <span class="sc">~</span>(<span class="fu">xml_text</span>(.) <span class="sc">!=</span> <span class="st">""</span>))</span>
<span id="cb73-293"><a href="#cb73-293" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-294"><a href="#cb73-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-295"><a href="#cb73-295" aria-hidden="true" tabindex="-1"></a><span class="co"># Using XPath:</span></span>
<span id="cb73-296"><a href="#cb73-296" aria-hidden="true" tabindex="-1"></a>singular_nodes1 <span class="ot">=</span> <span class="fu">xml_find_all</span>(bill_xml, </span>
<span id="cb73-297"><a href="#cb73-297" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"//bill/*[count(./*) = 0 and not(string-length(.) = 0)]"</span>)</span>
<span id="cb73-298"><a href="#cb73-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-299"><a href="#cb73-299" aria-hidden="true" tabindex="-1"></a><span class="co"># Using R function:</span></span>
<span id="cb73-300"><a href="#cb73-300" aria-hidden="true" tabindex="-1"></a>singular_nodes2 <span class="ot">=</span> <span class="fu">xml_singular_nodes</span>(bill_node)</span>
<span id="cb73-301"><a href="#cb73-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-302"><a href="#cb73-302" aria-hidden="true" tabindex="-1"></a><span class="co"># Check they are the same</span></span>
<span id="cb73-303"><a href="#cb73-303" aria-hidden="true" tabindex="-1"></a><span class="co"># all.equal(singular_nodes1, singular_nodes2)</span></span>
<span id="cb73-304"><a href="#cb73-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-305"><a href="#cb73-305" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the first one </span></span>
<span id="cb73-306"><a href="#cb73-306" aria-hidden="true" tabindex="-1"></a>singular_nodes <span class="ot">=</span> singular_nodes1</span>
<span id="cb73-307"><a href="#cb73-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-308"><a href="#cb73-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-309"><a href="#cb73-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-312"><a href="#cb73-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-313"><a href="#cb73-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: bench-node-selection</span></span>
<span id="cb73-314"><a href="#cb73-314" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb73-315"><a href="#cb73-315" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb73-316"><a href="#cb73-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-317"><a href="#cb73-317" aria-hidden="true" tabindex="-1"></a><span class="co"># benchmark the two different ways of selecting nodes</span></span>
<span id="cb73-318"><a href="#cb73-318" aria-hidden="true" tabindex="-1"></a>microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb73-319"><a href="#cb73-319" aria-hidden="true" tabindex="-1"></a>  <span class="at">xml_singular_nodes =</span> <span class="fu">xml_singular_nodes</span>(bill_node),</span>
<span id="cb73-320"><a href="#cb73-320" aria-hidden="true" tabindex="-1"></a>  <span class="at">xml_find_all =</span> <span class="fu">xml_find_all</span>(bill_xml, <span class="st">"//bill/*[count(./*) = 0 and not(string-length(.) = 0)]"</span>)</span>
<span id="cb73-321"><a href="#cb73-321" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-322"><a href="#cb73-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-323"><a href="#cb73-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-324"><a href="#cb73-324" aria-hidden="true" tabindex="-1"></a><span class="fu">### XML -\&gt; List</span></span>
<span id="cb73-325"><a href="#cb73-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-326"><a href="#cb73-326" aria-hidden="true" tabindex="-1"></a>The first step is to convert the XML to a list using <span class="in">`as_list()`</span>.</span>
<span id="cb73-327"><a href="#cb73-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-330"><a href="#cb73-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-331"><a href="#cb73-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: singular-nodes-list</span></span>
<span id="cb73-332"><a href="#cb73-332" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb73-333"><a href="#cb73-333" aria-hidden="true" tabindex="-1"></a>(<span class="at">singular_list =</span> <span class="fu">as_list</span>(singular_nodes)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-334"><a href="#cb73-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb73-335"><a href="#cb73-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-336"><a href="#cb73-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-337"><a href="#cb73-337" aria-hidden="true" tabindex="-1"></a>Note that we didn't retain the element names so we need to assign them ourselves.</span>
<span id="cb73-338"><a href="#cb73-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-341"><a href="#cb73-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-342"><a href="#cb73-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: singular-nodes-list-named</span></span>
<span id="cb73-343"><a href="#cb73-343" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb73-344"><a href="#cb73-344" aria-hidden="true" tabindex="-1"></a>(<span class="at">singular_list_named =</span> <span class="fu">setNames</span>(singular_list, <span class="fu">xml_name</span>(singular_nodes))) <span class="sc">%&gt;%</span> </span>
<span id="cb73-345"><a href="#cb73-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb73-346"><a href="#cb73-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-347"><a href="#cb73-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-348"><a href="#cb73-348" aria-hidden="true" tabindex="-1"></a><span class="fu">### List -\&gt; Dataframe</span></span>
<span id="cb73-349"><a href="#cb73-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-350"><a href="#cb73-350" aria-hidden="true" tabindex="-1"></a>Lastly, we want to flatten this list into a dataframe using purrr's <span class="in">`flatten_dfc()`</span> which flattens each list element into a **d**ata**f**rame **c**olumn.</span>
<span id="cb73-351"><a href="#cb73-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-354"><a href="#cb73-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-355"><a href="#cb73-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: singular-nodes-list-flattened</span></span>
<span id="cb73-356"><a href="#cb73-356" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb73-357"><a href="#cb73-357" aria-hidden="true" tabindex="-1"></a>(<span class="at">bill_df =</span> <span class="fu">flatten_dfc</span>(singular_list_named)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-358"><a href="#cb73-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb73-359"><a href="#cb73-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-360"><a href="#cb73-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-361"><a href="#cb73-361" aria-hidden="true" tabindex="-1"></a>Or in table form:</span>
<span id="cb73-362"><a href="#cb73-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-365"><a href="#cb73-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-366"><a href="#cb73-366" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: singular-nodes-rt</span></span>
<span id="cb73-367"><a href="#cb73-367" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb73-368"><a href="#cb73-368" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb73-369"><a href="#cb73-369" aria-hidden="true" tabindex="-1"></a><span class="fu">reactable</span>(bill_df,</span>
<span id="cb73-370"><a href="#cb73-370" aria-hidden="true" tabindex="-1"></a>          <span class="at">theme =</span> <span class="fu">moke_rt</span>(),</span>
<span id="cb73-371"><a href="#cb73-371" aria-hidden="true" tabindex="-1"></a>            <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb73-372"><a href="#cb73-372" aria-hidden="true" tabindex="-1"></a>              <span class="st">"constitutionalAuthorityStatementText"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">show=</span>F),</span>
<span id="cb73-373"><a href="#cb73-373" aria-hidden="true" tabindex="-1"></a>              <span class="st">"createDate"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T), <span class="at">width =</span> <span class="dv">100</span>),</span>
<span id="cb73-374"><a href="#cb73-374" aria-hidden="true" tabindex="-1"></a>              <span class="st">"updateDate"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T), <span class="at">width =</span> <span class="dv">100</span>),</span>
<span id="cb73-375"><a href="#cb73-375" aria-hidden="true" tabindex="-1"></a>              <span class="st">"introducedDate"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">date =</span> T), <span class="at">width =</span> <span class="dv">120</span>),</span>
<span id="cb73-376"><a href="#cb73-376" aria-hidden="true" tabindex="-1"></a>              <span class="st">"congress"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">90</span>),</span>
<span id="cb73-377"><a href="#cb73-377" aria-hidden="true" tabindex="-1"></a>              <span class="st">"originChamber"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">show=</span>F),</span>
<span id="cb73-378"><a href="#cb73-378" aria-hidden="true" tabindex="-1"></a>              <span class="st">"version"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">show=</span>F, <span class="at">width =</span> <span class="dv">80</span>),</span>
<span id="cb73-379"><a href="#cb73-379" aria-hidden="true" tabindex="-1"></a>              <span class="st">"billNumber"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">105</span>),</span>
<span id="cb73-380"><a href="#cb73-380" aria-hidden="true" tabindex="-1"></a>              <span class="st">"billType"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">width =</span> <span class="dv">85</span>),</span>
<span id="cb73-381"><a href="#cb73-381" aria-hidden="true" tabindex="-1"></a>              <span class="st">"title"</span> <span class="ot">=</span> <span class="fu">colDef</span>(<span class="at">minWidth =</span> <span class="dv">180</span>)</span>
<span id="cb73-382"><a href="#cb73-382" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb73-383"><a href="#cb73-383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-384"><a href="#cb73-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-385"><a href="#cb73-385" aria-hidden="true" tabindex="-1"></a>This includes the bill title, when it was introduced, what type of bill it is, and which congress introduced it. To combine the data for actions, sponsors, committees, and votes, we need to process them individually.</span>
<span id="cb73-386"><a href="#cb73-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-387"><a href="#cb73-387" aria-hidden="true" tabindex="-1"></a><span class="fu">## The not-so-simple elements</span></span>
<span id="cb73-388"><a href="#cb73-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-389"><a href="#cb73-389" aria-hidden="true" tabindex="-1"></a>This is where the majority of the legwork is so if you can comfortably filter out some data<span class="ot">[^4]</span>, now's a good time. There's no point spending an hour trying to process one particularly difficult bit of information only to realize it isn't useful to you anyway.</span>
<span id="cb73-390"><a href="#cb73-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-391"><a href="#cb73-391" aria-hidden="true" tabindex="-1"></a><span class="ot">[^4]: </span>But do yourself a favour and write it down somewhere - comment it in the code, tell your colleagues or collaborators, put it on a particularly strong post it, whatever works.</span>
<span id="cb73-392"><a href="#cb73-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-393"><a href="#cb73-393" aria-hidden="true" tabindex="-1"></a>For brevity I'll go through how to process the actions and votes elements, but you can find the code for extracting the full XML file <span class="co">[</span><span class="ot">here</span><span class="co">](https://github.com/MokeEire/my-reps/blob/master/R/parsing_functions.R)</span><span class="ot">[^5]</span>.</span>
<span id="cb73-394"><a href="#cb73-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-395"><a href="#cb73-395" aria-hidden="true" tabindex="-1"></a><span class="ot">[^5]: </span>Ctrl/Cmd+F: <span class="in">`extract_bill_status`</span></span>
<span id="cb73-396"><a href="#cb73-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-397"><a href="#cb73-397" aria-hidden="true" tabindex="-1"></a><span class="fu">### Actions</span></span>
<span id="cb73-398"><a href="#cb73-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-399"><a href="#cb73-399" aria-hidden="true" tabindex="-1"></a>What's in the actions container?</span>
<span id="cb73-400"><a href="#cb73-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-403"><a href="#cb73-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-404"><a href="#cb73-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: actions-xml</span></span>
<span id="cb73-405"><a href="#cb73-405" aria-hidden="true" tabindex="-1"></a>(<span class="at">actions_xml =</span> <span class="fu">xml_find_all</span>(bill_node, <span class="st">"actions/item"</span>))</span>
<span id="cb73-406"><a href="#cb73-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-407"><a href="#cb73-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-408"><a href="#cb73-408" aria-hidden="true" tabindex="-1"></a>And what does a single action element look like?</span>
<span id="cb73-409"><a href="#cb73-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-412"><a href="#cb73-412" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-413"><a href="#cb73-413" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: action-xml-item</span></span>
<span id="cb73-414"><a href="#cb73-414" aria-hidden="true" tabindex="-1"></a><span class="fu">xml_contents</span>(actions_xml[<span class="dv">1</span>])</span>
<span id="cb73-415"><a href="#cb73-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-416"><a href="#cb73-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-417"><a href="#cb73-417" aria-hidden="true" tabindex="-1"></a>So this bill has 14 actions recorded on it. We can use <span class="in">`as_list()`</span> to convert the <span class="in">`{xml_nodeset}`</span> to a list.</span>
<span id="cb73-418"><a href="#cb73-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-421"><a href="#cb73-421" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-422"><a href="#cb73-422" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: actions-list</span></span>
<span id="cb73-423"><a href="#cb73-423" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb73-424"><a href="#cb73-424" aria-hidden="true" tabindex="-1"></a>actions_list <span class="ot">=</span> <span class="fu">as_list</span>(actions_xml)</span>
<span id="cb73-425"><a href="#cb73-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-426"><a href="#cb73-426" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the first action</span></span>
<span id="cb73-427"><a href="#cb73-427" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(actions_list[[<span class="dv">1</span>]])</span>
<span id="cb73-428"><a href="#cb73-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-429"><a href="#cb73-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-430"><a href="#cb73-430" aria-hidden="true" tabindex="-1"></a>In the individual action container, we can see we have the type, text, and date of the action, a list of committees related to the action, and some elements which are singular and some which are not. To deal with this, we can write a function (or set of functions) like the ones below to process an action:</span>
<span id="cb73-431"><a href="#cb73-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-434"><a href="#cb73-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-435"><a href="#cb73-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: actions-functions</span></span>
<span id="cb73-436"><a href="#cb73-436" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb73-437"><a href="#cb73-437" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function: flatten_dfc_rename</span></span>
<span id="cb73-438"><a href="#cb73-438" aria-hidden="true" tabindex="-1"></a><span class="co"># flatten a list to dataframe and </span></span>
<span id="cb73-439"><a href="#cb73-439" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns with a given prefix</span></span>
<span id="cb73-440"><a href="#cb73-440" aria-hidden="true" tabindex="-1"></a>flatten_dfc_rename <span class="ot">=</span> <span class="cf">function</span>(list_to_flatten, </span>
<span id="cb73-441"><a href="#cb73-441" aria-hidden="true" tabindex="-1"></a>                          <span class="at">name_prefix =</span> <span class="st">"prefix"</span>){</span>
<span id="cb73-442"><a href="#cb73-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(</span>
<span id="cb73-443"><a href="#cb73-443" aria-hidden="true" tabindex="-1"></a>    <span class="at">.data =</span> <span class="fu">flatten_dfc</span>(list_to_flatten), </span>
<span id="cb73-444"><a href="#cb73-444" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fn =</span> <span class="sc">~</span><span class="fu">str_c</span>(name_prefix, <span class="st">"_"</span>, .),</span>
<span id="cb73-445"><a href="#cb73-445" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exclude columns which already start with the prefix</span></span>
<span id="cb73-446"><a href="#cb73-446" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="sc">-</span><span class="fu">starts_with</span>(name_prefix)</span>
<span id="cb73-447"><a href="#cb73-447" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-448"><a href="#cb73-448" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-449"><a href="#cb73-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-450"><a href="#cb73-450" aria-hidden="true" tabindex="-1"></a><span class="co"># Function: parse_action</span></span>
<span id="cb73-451"><a href="#cb73-451" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse actions from list to dataframe</span></span>
<span id="cb73-452"><a href="#cb73-452" aria-hidden="true" tabindex="-1"></a>parse_action <span class="ot">=</span> <span class="cf">function</span>(action){</span>
<span id="cb73-453"><a href="#cb73-453" aria-hidden="true" tabindex="-1"></a>  action <span class="sc">%&gt;%</span> </span>
<span id="cb73-454"><a href="#cb73-454" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flatten+rename  sourceSystem elements</span></span>
<span id="cb73-455"><a href="#cb73-455" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_at</span>(<span class="st">"sourceSystem"</span>, <span class="sc">~</span><span class="fu">flatten_dfc_rename</span>(.x, <span class="st">"source"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-456"><a href="#cb73-456" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flatten+rename committees</span></span>
<span id="cb73-457"><a href="#cb73-457" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_at</span>(<span class="st">"committees"</span>, <span class="cf">function</span>(committee){</span>
<span id="cb73-458"><a href="#cb73-458" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map_dfr</span>(committee, <span class="sc">~</span><span class="fu">flatten_dfc_rename</span>(.x, <span class="st">"committee"</span>))</span>
<span id="cb73-459"><a href="#cb73-459" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span> </span>
<span id="cb73-460"><a href="#cb73-460" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flatten object to dataframe</span></span>
<span id="cb73-461"><a href="#cb73-461" aria-hidden="true" tabindex="-1"></a>    <span class="fu">flatten_dfc_rename</span>(., <span class="st">"action"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb73-462"><a href="#cb73-462" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb73-463"><a href="#cb73-463" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-464"><a href="#cb73-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-465"><a href="#cb73-465" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the first action</span></span>
<span id="cb73-466"><a href="#cb73-466" aria-hidden="true" tabindex="-1"></a><span class="fu">parse_action</span>(actions_list[[<span class="dv">1</span>]]) <span class="sc">%&gt;%</span> </span>
<span id="cb73-467"><a href="#cb73-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb73-468"><a href="#cb73-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-469"><a href="#cb73-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-472"><a href="#cb73-472" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-473"><a href="#cb73-473" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: benchmark-parse-action</span></span>
<span id="cb73-474"><a href="#cb73-474" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb73-475"><a href="#cb73-475" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-476"><a href="#cb73-476" aria-hidden="true" tabindex="-1"></a><span class="co"># Test modify_at vs map_at</span></span>
<span id="cb73-477"><a href="#cb73-477" aria-hidden="true" tabindex="-1"></a>parse_action2 <span class="ot">=</span> <span class="cf">function</span>(action){</span>
<span id="cb73-478"><a href="#cb73-478" aria-hidden="true" tabindex="-1"></a>  action <span class="sc">%&gt;%</span> </span>
<span id="cb73-479"><a href="#cb73-479" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flatten+rename  sourceSystem elements</span></span>
<span id="cb73-480"><a href="#cb73-480" aria-hidden="true" tabindex="-1"></a>    <span class="fu">modify_at</span>(<span class="st">"sourceSystem"</span>, <span class="sc">~</span><span class="fu">flatten_dfc_rename</span>(.x, <span class="st">"source"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-481"><a href="#cb73-481" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flatten+rename committees</span></span>
<span id="cb73-482"><a href="#cb73-482" aria-hidden="true" tabindex="-1"></a>    <span class="fu">modify_at</span>(<span class="st">"committees"</span>, <span class="cf">function</span>(committee){</span>
<span id="cb73-483"><a href="#cb73-483" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map_dfr</span>(committee, <span class="sc">~</span><span class="fu">flatten_dfc_rename</span>(.x, <span class="st">"committee"</span>))</span>
<span id="cb73-484"><a href="#cb73-484" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span> </span>
<span id="cb73-485"><a href="#cb73-485" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flatten object to dataframe</span></span>
<span id="cb73-486"><a href="#cb73-486" aria-hidden="true" tabindex="-1"></a>    <span class="fu">flatten_dfc_rename</span>(., <span class="st">"action"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb73-487"><a href="#cb73-487" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb73-488"><a href="#cb73-488" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-489"><a href="#cb73-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-490"><a href="#cb73-490" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the first action</span></span>
<span id="cb73-491"><a href="#cb73-491" aria-hidden="true" tabindex="-1"></a><span class="fu">parse_action2</span>(actions_list[[<span class="dv">1</span>]])</span>
<span id="cb73-492"><a href="#cb73-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-493"><a href="#cb73-493" aria-hidden="true" tabindex="-1"></a><span class="co"># What about speed?</span></span>
<span id="cb73-494"><a href="#cb73-494" aria-hidden="true" tabindex="-1"></a>microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb73-495"><a href="#cb73-495" aria-hidden="true" tabindex="-1"></a>  <span class="at">parse_action =</span> <span class="fu">parse_action</span>(actions_list[[<span class="dv">1</span>]]),</span>
<span id="cb73-496"><a href="#cb73-496" aria-hidden="true" tabindex="-1"></a>  <span class="at">parse_action2 =</span> <span class="fu">parse_action2</span>(actions_list[[<span class="dv">1</span>]]), <span class="at">times =</span> <span class="dv">1000</span></span>
<span id="cb73-497"><a href="#cb73-497" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-498"><a href="#cb73-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-499"><a href="#cb73-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-500"><a href="#cb73-500" aria-hidden="true" tabindex="-1"></a>Using the <span class="in">`{purrr}`</span> library's <span class="in">`map_dfr()`</span>, we can apply this function to each action and combine the results as rows in a dataframe.</span>
<span id="cb73-501"><a href="#cb73-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-504"><a href="#cb73-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-505"><a href="#cb73-505" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: actions-dfr</span></span>
<span id="cb73-506"><a href="#cb73-506" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb73-507"><a href="#cb73-507" aria-hidden="true" tabindex="-1"></a>(<span class="at">actions_df =</span> <span class="fu">map_dfr</span>(actions_list, parse_action)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-508"><a href="#cb73-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb73-509"><a href="#cb73-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-510"><a href="#cb73-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-511"><a href="#cb73-511" aria-hidden="true" tabindex="-1"></a>Now if you're processing a large amount of these data, you may want to be explicit about the data types expected in each column. This is vital when we want to <span class="in">`unnest()`</span> the actions data and combine many bills' actions into an actions-level dataset. You can do this using <span class="in">`type_convert()`</span> , notice the change in column types from the output above.</span>
<span id="cb73-512"><a href="#cb73-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-515"><a href="#cb73-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-516"><a href="#cb73-516" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: actions-type-conv</span></span>
<span id="cb73-517"><a href="#cb73-517" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb73-518"><a href="#cb73-518" aria-hidden="true" tabindex="-1"></a>(<span class="at">actions_df =</span> <span class="fu">type_convert</span>(actions_df,</span>
<span id="cb73-519"><a href="#cb73-519" aria-hidden="true" tabindex="-1"></a>                          <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb73-520"><a href="#cb73-520" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_date =</span> <span class="fu">col_date</span>(), </span>
<span id="cb73-521"><a href="#cb73-521" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_time =</span> <span class="fu">col_time</span>(),</span>
<span id="cb73-522"><a href="#cb73-522" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_committee_systemCode =</span> <span class="fu">col_character</span>(), </span>
<span id="cb73-523"><a href="#cb73-523" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_committee_name =</span> <span class="fu">col_character</span>(), </span>
<span id="cb73-524"><a href="#cb73-524" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_source_code =</span> <span class="fu">col_character</span>(),</span>
<span id="cb73-525"><a href="#cb73-525" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_source_name =</span> <span class="fu">col_character</span>(),</span>
<span id="cb73-526"><a href="#cb73-526" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_text =</span> <span class="fu">col_character</span>(), </span>
<span id="cb73-527"><a href="#cb73-527" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_type =</span> <span class="fu">col_character</span>(), </span>
<span id="cb73-528"><a href="#cb73-528" aria-hidden="true" tabindex="-1"></a>                            <span class="at">action_code =</span> <span class="fu">col_character</span>()</span>
<span id="cb73-529"><a href="#cb73-529" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb73-530"><a href="#cb73-530" aria-hidden="true" tabindex="-1"></a>                          )) <span class="sc">%&gt;%</span> </span>
<span id="cb73-531"><a href="#cb73-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb73-532"><a href="#cb73-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-533"><a href="#cb73-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-534"><a href="#cb73-534" aria-hidden="true" tabindex="-1"></a>To add these actions data as a list column to <span class="in">`bill_df`</span> we can simply use dollar assignment.</span>
<span id="cb73-535"><a href="#cb73-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-538"><a href="#cb73-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-539"><a href="#cb73-539" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: add-actions</span></span>
<span id="cb73-540"><a href="#cb73-540" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb73-541"><a href="#cb73-541" aria-hidden="true" tabindex="-1"></a>bill_df<span class="sc">$</span>actions <span class="ot">=</span> <span class="fu">list</span>(actions_df)</span>
<span id="cb73-542"><a href="#cb73-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-543"><a href="#cb73-543" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(bill_df)</span>
<span id="cb73-544"><a href="#cb73-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-545"><a href="#cb73-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-546"><a href="#cb73-546" aria-hidden="true" tabindex="-1"></a>The remaining sections will be following the same process for different elements, but it can be boiled down to these steps:</span>
<span id="cb73-547"><a href="#cb73-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-548"><a href="#cb73-548" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Explore the structure**</span>
<span id="cb73-549"><a href="#cb73-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-550"><a href="#cb73-550" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Go through any available documentation, and when you read in the XML file you can use functions like </span><span class="in">`xmlParse()`</span><span class="at">, </span><span class="in">`xml_structure()`</span><span class="at">, and </span><span class="in">`xml_contents()`</span><span class="at"> .</span></span>
<span id="cb73-551"><a href="#cb73-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-552"><a href="#cb73-552" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Define the output**</span>
<span id="cb73-553"><a href="#cb73-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-554"><a href="#cb73-554" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Consider what you want the output to look like and think about how it needs to be transformed to match this target.</span></span>
<span id="cb73-555"><a href="#cb73-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-556"><a href="#cb73-556" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Process a single element** (write a function if it gets too complicated)</span>
<span id="cb73-557"><a href="#cb73-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-558"><a href="#cb73-558" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Get one element into the form you want. Writing functions can help you think through the data transformations being applied and make your code easier to read.</span></span>
<span id="cb73-559"><a href="#cb73-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-560"><a href="#cb73-560" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Apply to all elements**</span>
<span id="cb73-561"><a href="#cb73-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-562"><a href="#cb73-562" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Focus on processing of the entire file (or the subset of the file you're interested in). You might want an XML file to return a single row, a single column, or a dataframe of size $n\times k$. Once you have a single file returned in the format you want, you can combine the outputs of multiple files.</span></span>
<span id="cb73-563"><a href="#cb73-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-564"><a href="#cb73-564" aria-hidden="true" tabindex="-1"></a>::: {.callout-caution appearance="simple"}</span>
<span id="cb73-565"><a href="#cb73-565" aria-hidden="true" tabindex="-1"></a><span class="fu">## Find the exceptions</span></span>
<span id="cb73-566"><a href="#cb73-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-567"><a href="#cb73-567" aria-hidden="true" tabindex="-1"></a>Lastly, you will likely run into situations where a node which only seemed to contain a single piece of data has a different structure with multiple sub-elements for other files. This will happen, you'll go back to the drawing board, design more flexibility in your functions, and understand how process either format.</span>
<span id="cb73-568"><a href="#cb73-568" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb73-569"><a href="#cb73-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-572"><a href="#cb73-572" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-573"><a href="#cb73-573" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb73-574"><a href="#cb73-574" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-575"><a href="#cb73-575" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb73-576"><a href="#cb73-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-577"><a href="#cb73-577" aria-hidden="true" tabindex="-1"></a>bill_actions <span class="ot">=</span> <span class="fu">xml_find_all</span>(actions_node, <span class="st">"item"</span>)</span>
<span id="cb73-578"><a href="#cb73-578" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-579"><a href="#cb73-579" aria-hidden="true" tabindex="-1"></a>bill_action_counts <span class="ot">=</span> <span class="fu">as_list</span>(<span class="fu">xml_find_all</span>(actions_node, <span class="st">"./*[not(self::item)]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-580"><a href="#cb73-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfc</span>(flatten_dfc) <span class="sc">%&gt;%</span> </span>
<span id="cb73-581"><a href="#cb73-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">str_c</span>(<span class="st">"actions_"</span>, .)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-582"><a href="#cb73-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"action"</span>, <span class="at">names_prefix =</span> <span class="st">"actions_"</span>, <span class="at">values_to =</span> <span class="st">"count"</span>)</span>
<span id="cb73-583"><a href="#cb73-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-584"><a href="#cb73-584" aria-hidden="true" tabindex="-1"></a><span class="co"># Coerce nodes to list</span></span>
<span id="cb73-585"><a href="#cb73-585" aria-hidden="true" tabindex="-1"></a>actions_df <span class="ot">=</span> <span class="fu">as_list</span>(bill_actions) <span class="sc">%&gt;%</span> </span>
<span id="cb73-586"><a href="#cb73-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(parse_action) <span class="sc">%&gt;%</span> </span>
<span id="cb73-587"><a href="#cb73-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">type_convert</span>(<span class="at">col_types =</span> col_specs<span class="sc">$</span>actions)</span>
<span id="cb73-588"><a href="#cb73-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-589"><a href="#cb73-589" aria-hidden="true" tabindex="-1"></a>bill_df<span class="sc">$</span>actions <span class="ot">=</span> <span class="fu">list</span>(actions_df)</span>
<span id="cb73-590"><a href="#cb73-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-591"><a href="#cb73-591" aria-hidden="true" tabindex="-1"></a>bill_df<span class="sc">$</span>action_counts <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">type_convert</span>(bill_action_counts,</span>
<span id="cb73-592"><a href="#cb73-592" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">action =</span> <span class="fu">col_character</span>(), <span class="at">count =</span> <span class="fu">col_integer</span>())))</span>
<span id="cb73-593"><a href="#cb73-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-594"><a href="#cb73-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-595"><a href="#cb73-595" aria-hidden="true" tabindex="-1"></a><span class="fu">### Votes</span></span>
<span id="cb73-596"><a href="#cb73-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-597"><a href="#cb73-597" aria-hidden="true" tabindex="-1"></a>Votes are particularly interesting because it provides a more discrete measure of our representatives' behaviour. Individual votes are stored in the <span class="in">`&lt;recordedVotes&gt;`</span> container. We can access child elements in XML using a forward slash (this uses a language called XPATH).</span>
<span id="cb73-598"><a href="#cb73-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-601"><a href="#cb73-601" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-602"><a href="#cb73-602" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-nodes-contents</span></span>
<span id="cb73-603"><a href="#cb73-603" aria-hidden="true" tabindex="-1"></a>(<span class="at">bill_recorded_vote_nodes =</span> <span class="fu">xml_find_all</span>(bill_node, <span class="st">"recordedVotes/recordedVote"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-604"><a href="#cb73-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_contents</span>()</span>
<span id="cb73-605"><a href="#cb73-605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-606"><a href="#cb73-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-607"><a href="#cb73-607" aria-hidden="true" tabindex="-1"></a>You may have spotted why votes are interesting elements to parse because inside the <span class="in">`&lt;url&gt;`</span> element we find **another** **XML file**!<span class="ot">[^6]</span> Before we dive into that can of worms, I'll convert the top-level nodes to a list and flatten it into columns. Note we use <span class="in">`map_dfr()`</span> with <span class="in">`votes_list`</span> because there could be multiple vote objects.</span>
<span id="cb73-608"><a href="#cb73-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-609"><a href="#cb73-609" aria-hidden="true" tabindex="-1"></a><span class="ot">[^6]: </span><span class="al">![They heard you like XML](https://c.tenor.com/um2EhyMQyR8AAAAC/xzibit-meme.gif)</span></span>
<span id="cb73-610"><a href="#cb73-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-613"><a href="#cb73-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-614"><a href="#cb73-614" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-nodes-df</span></span>
<span id="cb73-615"><a href="#cb73-615" aria-hidden="true" tabindex="-1"></a><span class="co"># Coerce nodes to list</span></span>
<span id="cb73-616"><a href="#cb73-616" aria-hidden="true" tabindex="-1"></a>recorded_votes_list <span class="ot">=</span> <span class="fu">as_list</span>(bill_recorded_vote_nodes)</span>
<span id="cb73-617"><a href="#cb73-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-618"><a href="#cb73-618" aria-hidden="true" tabindex="-1"></a>(<span class="at">recorded_votes_df =</span> <span class="fu">map_dfr</span>(recorded_votes_list, flatten_dfc)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-619"><a href="#cb73-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb73-620"><a href="#cb73-620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-621"><a href="#cb73-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-622"><a href="#cb73-622" aria-hidden="true" tabindex="-1"></a>Now we want to get the vote roll XML file, so we go back to <span class="in">`read_xml()`</span> .</span>
<span id="cb73-623"><a href="#cb73-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-626"><a href="#cb73-626" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-627"><a href="#cb73-627" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-xml</span></span>
<span id="cb73-628"><a href="#cb73-628" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_roll_xml =</span> <span class="fu">read_xml</span>(recorded_votes_df<span class="sc">$</span>url))</span>
<span id="cb73-629"><a href="#cb73-629" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-630"><a href="#cb73-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-631"><a href="#cb73-631" aria-hidden="true" tabindex="-1"></a>There are two main nodes - <span class="in">`&lt;vote-metadata&gt;`</span> and <span class="in">`&lt;vote-data&gt;`</span>. How many elements does each node have and what do the structures for these look like?</span>
<span id="cb73-632"><a href="#cb73-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-635"><a href="#cb73-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-636"><a href="#cb73-636" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-children</span></span>
<span id="cb73-637"><a href="#cb73-637" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_roll_children =</span> <span class="fu">xml_children</span>(vote_roll_xml)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-638"><a href="#cb73-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(xml_contents)</span>
<span id="cb73-639"><a href="#cb73-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-640"><a href="#cb73-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-641"><a href="#cb73-641" aria-hidden="true" tabindex="-1"></a>One node contains the aggregated vote information, while <span class="in">`&lt;vote-data&gt;`</span> contains the legislator-level vote data. Let's try to parse the legislator-level data first.</span>
<span id="cb73-642"><a href="#cb73-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-645"><a href="#cb73-645" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-646"><a href="#cb73-646" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-data</span></span>
<span id="cb73-647"><a href="#cb73-647" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_data =</span> <span class="fu">xml_find_all</span>(vote_roll_xml, <span class="st">"vote-data"</span>))</span>
<span id="cb73-648"><a href="#cb73-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-649"><a href="#cb73-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-650"><a href="#cb73-650" aria-hidden="true" tabindex="-1"></a>Here is the XML for a single legislator's vote:</span>
<span id="cb73-651"><a href="#cb73-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-654"><a href="#cb73-654" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-655"><a href="#cb73-655" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-data-single</span></span>
<span id="cb73-656"><a href="#cb73-656" aria-hidden="true" tabindex="-1"></a><span class="fu">xml_child</span>(vote_data)</span>
<span id="cb73-657"><a href="#cb73-657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-658"><a href="#cb73-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-659"><a href="#cb73-659" aria-hidden="true" tabindex="-1"></a>With a similar combination of <span class="in">`as_list()`</span> , <span class="in">`flatten_dfr()`</span>, and <span class="in">`unnest()`</span> we can flatten the XML into one row per legislator</span>
<span id="cb73-660"><a href="#cb73-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-663"><a href="#cb73-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-664"><a href="#cb73-664" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-data-flat</span></span>
<span id="cb73-665"><a href="#cb73-665" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_roll_flattened =</span> vote_data <span class="sc">%&gt;%</span> </span>
<span id="cb73-666"><a href="#cb73-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb73-667"><a href="#cb73-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flatten_dfr</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb73-668"><a href="#cb73-668" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(<span class="fu">everything</span>()))</span>
<span id="cb73-669"><a href="#cb73-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-670"><a href="#cb73-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-671"><a href="#cb73-671" aria-hidden="true" tabindex="-1"></a>But we lose all the attributes! And <span class="in">`name-id`</span> looked particularly useful. We'll need to extract the attributes before we flatten the data. Let's take another look at the legislators structure.</span>
<span id="cb73-672"><a href="#cb73-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-675"><a href="#cb73-675" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-676"><a href="#cb73-676" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-leg-list</span></span>
<span id="cb73-677"><a href="#cb73-677" aria-hidden="true" tabindex="-1"></a>vote_legislators <span class="ot">=</span> vote_data <span class="sc">%&gt;%</span> </span>
<span id="cb73-678"><a href="#cb73-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_find_all</span>(<span class="st">"recorded-vote"</span>)</span>
<span id="cb73-679"><a href="#cb73-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-680"><a href="#cb73-680" aria-hidden="true" tabindex="-1"></a>(<span class="at">legislators_list =</span> <span class="fu">as_list</span>(vote_legislators))[<span class="dv">1</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb73-681"><a href="#cb73-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb73-682"><a href="#cb73-682" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-683"><a href="#cb73-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-684"><a href="#cb73-684" aria-hidden="true" tabindex="-1"></a>The legislator element has all the attributes, while the vote element only has a value. We want to extract the attributes only for legislator using <span class="in">`map()`</span> to apply <span class="in">`map_at()`</span> on each legislator element and extract the attributes from each while retaining the value in <span class="in">`vote`</span>. It can often feel like you're getting lost in a list of lists, but with some experimentation you'll be able to find your way back to the surface.</span>
<span id="cb73-685"><a href="#cb73-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-688"><a href="#cb73-688" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-689"><a href="#cb73-689" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-leg-df</span></span>
<span id="cb73-690"><a href="#cb73-690" aria-hidden="true" tabindex="-1"></a>(<span class="at">legislator_vote_df =</span> legislators_list <span class="sc">%&gt;%</span> </span>
<span id="cb73-691"><a href="#cb73-691" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Modify one level deeper using map_at to target legislator elements</span></span>
<span id="cb73-692"><a href="#cb73-692" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(map_at, <span class="st">"legislator"</span>, attributes) <span class="sc">%&gt;%</span> </span>
<span id="cb73-693"><a href="#cb73-693" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(flatten_dfc))</span>
<span id="cb73-694"><a href="#cb73-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-695"><a href="#cb73-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-696"><a href="#cb73-696" aria-hidden="true" tabindex="-1"></a>Now we have a table of legislator voting data! But what about the <span class="in">`&lt;vote-metadata&gt;`</span>?</span>
<span id="cb73-697"><a href="#cb73-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-700"><a href="#cb73-700" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-701"><a href="#cb73-701" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-metadata-xml</span></span>
<span id="cb73-702"><a href="#cb73-702" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_metadata =</span> <span class="fu">xml_find_all</span>(vote_roll_xml, <span class="st">"vote-metadata"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-703"><a href="#cb73-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_contents</span>()</span>
<span id="cb73-704"><a href="#cb73-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-705"><a href="#cb73-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-706"><a href="#cb73-706" aria-hidden="true" tabindex="-1"></a>Everything other than the <span class="in">`&lt;vote-totals&gt;`</span> element is singular so we can get that out of the way the same way as before:</span>
<span id="cb73-707"><a href="#cb73-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-710"><a href="#cb73-710" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-711"><a href="#cb73-711" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-metadata-singular</span></span>
<span id="cb73-712"><a href="#cb73-712" aria-hidden="true" tabindex="-1"></a>vote_singular_nodes <span class="ot">=</span> <span class="fu">xml_singular_nodes</span>(vote_metadata)</span>
<span id="cb73-713"><a href="#cb73-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-714"><a href="#cb73-714" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_df =</span> <span class="fu">as_list</span>(vote_singular_nodes) <span class="sc">%&gt;%</span> </span>
<span id="cb73-715"><a href="#cb73-715" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as_list() doesn't retain element names so we set names ourselves</span></span>
<span id="cb73-716"><a href="#cb73-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">xml_name</span>(vote_singular_nodes)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-717"><a href="#cb73-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flatten_dfc</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb73-718"><a href="#cb73-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb73-719"><a href="#cb73-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-720"><a href="#cb73-720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-721"><a href="#cb73-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-722"><a href="#cb73-722" aria-hidden="true" tabindex="-1"></a>The <span class="in">`&lt;vote-totals&gt;`</span> are a bit of a unique little element, with 3 different types of nodes.</span>
<span id="cb73-723"><a href="#cb73-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-726"><a href="#cb73-726" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-727"><a href="#cb73-727" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-metadata-totals-contents</span></span>
<span id="cb73-728"><a href="#cb73-728" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_totals =</span> <span class="fu">xml_find_all</span>(vote_metadata, <span class="st">"vote-totals"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-729"><a href="#cb73-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_contents</span>()</span>
<span id="cb73-730"><a href="#cb73-730" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-731"><a href="#cb73-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-732"><a href="#cb73-732" aria-hidden="true" tabindex="-1"></a>This is another opportunity for us to be choosy with our data. The first node is table headers, which we don't need because the elements are tagged anyway. From these, we really only need the <span class="in">`&lt;totals-by-party&gt;`</span> nodes as long as the totals of which agree with <span class="in">`&lt;totals-by-vote&gt;`</span> , which is worth checking.</span>
<span id="cb73-733"><a href="#cb73-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-736"><a href="#cb73-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-737"><a href="#cb73-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-metadata-totals-both</span></span>
<span id="cb73-738"><a href="#cb73-738" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 1</span></span>
<span id="cb73-739"><a href="#cb73-739" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_totals_by_party =</span> <span class="fu">xml_find_all</span>(vote_totals, <span class="st">"totals-by-party"</span>))</span>
<span id="cb73-740"><a href="#cb73-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-741"><a href="#cb73-741" aria-hidden="true" tabindex="-1"></a>(<span class="at">totals_by_vote =</span> <span class="fu">xml_find_all</span>(vote_totals, <span class="st">"totals-by-vote"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-742"><a href="#cb73-742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_contents</span>()</span>
<span id="cb73-743"><a href="#cb73-743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-744"><a href="#cb73-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-745"><a href="#cb73-745" aria-hidden="true" tabindex="-1"></a>Once we have our nodeset (which at last are all singular), we use same listing, mapping, and flattening...or *lappening* as absolutely no one calls it.</span>
<span id="cb73-746"><a href="#cb73-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-749"><a href="#cb73-749" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-750"><a href="#cb73-750" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-metadata-totals-party</span></span>
<span id="cb73-751"><a href="#cb73-751" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb73-752"><a href="#cb73-752" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb73-753"><a href="#cb73-753" aria-hidden="true" tabindex="-1"></a>(<span class="at">party_vote_totals_df =</span> <span class="fu">as_list</span>(vote_totals_by_party) <span class="sc">%&gt;%</span> </span>
<span id="cb73-754"><a href="#cb73-754" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(flatten_dfc) <span class="sc">%&gt;%</span> </span>
<span id="cb73-755"><a href="#cb73-755" aria-hidden="true" tabindex="-1"></a>    <span class="fu">type_convert</span>())</span>
<span id="cb73-756"><a href="#cb73-756" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-757"><a href="#cb73-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-760"><a href="#cb73-760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-761"><a href="#cb73-761" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb73-762"><a href="#cb73-762" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-763"><a href="#cb73-763" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if totals match</span></span>
<span id="cb73-764"><a href="#cb73-764" aria-hidden="true" tabindex="-1"></a><span class="fu">as_list</span>(totals_by_vote) <span class="sc">%&gt;%</span> </span>
<span id="cb73-765"><a href="#cb73-765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(flatten_dfc)</span>
<span id="cb73-766"><a href="#cb73-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-767"><a href="#cb73-767" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(party_vote_totals, </span>
<span id="cb73-768"><a href="#cb73-768" aria-hidden="true" tabindex="-1"></a>          <span class="fu">across</span>(<span class="at">.cols =</span> <span class="sc">-</span>party, sum, <span class="at">na.rm=</span>T))</span>
<span id="cb73-769"><a href="#cb73-769" aria-hidden="true" tabindex="-1"></a><span class="co"># They do!</span></span>
<span id="cb73-770"><a href="#cb73-770" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-771"><a href="#cb73-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-772"><a href="#cb73-772" aria-hidden="true" tabindex="-1"></a>Now that we have all of our vote data wrangled from the thorny grasp of XML, we can put it all together.</span>
<span id="cb73-773"><a href="#cb73-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-776"><a href="#cb73-776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-777"><a href="#cb73-777" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-roll-build</span></span>
<span id="cb73-778"><a href="#cb73-778" aria-hidden="true" tabindex="-1"></a>(<span class="at">vote_roll_df =</span> vote_df <span class="sc">%&gt;%</span> </span>
<span id="cb73-779"><a href="#cb73-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">legislator_votes =</span> <span class="fu">list</span>(legislator_vote_df),</span>
<span id="cb73-780"><a href="#cb73-780" aria-hidden="true" tabindex="-1"></a>         <span class="at">party_votes =</span> <span class="fu">list</span>(party_vote_totals_df)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-781"><a href="#cb73-781" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb73-782"><a href="#cb73-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb73-783"><a href="#cb73-783" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-784"><a href="#cb73-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-785"><a href="#cb73-785" aria-hidden="true" tabindex="-1"></a>And we continue to stack this Russian doll of data from the legislator-level to the vote-level...</span>
<span id="cb73-786"><a href="#cb73-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-789"><a href="#cb73-789" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-790"><a href="#cb73-790" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vote-build</span></span>
<span id="cb73-791"><a href="#cb73-791" aria-hidden="true" tabindex="-1"></a>(<span class="at">recorded_votes_df =</span> recorded_votes_df <span class="sc">%&gt;%</span> </span>
<span id="cb73-792"><a href="#cb73-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vote_roll =</span> <span class="fu">list</span>(vote_roll_df))) <span class="sc">%&gt;%</span> </span>
<span id="cb73-793"><a href="#cb73-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb73-794"><a href="#cb73-794" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-795"><a href="#cb73-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-796"><a href="#cb73-796" aria-hidden="true" tabindex="-1"></a>...all the way until we've gotten back to the bill-level.</span>
<span id="cb73-797"><a href="#cb73-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-800"><a href="#cb73-800" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-801"><a href="#cb73-801" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: add-bills</span></span>
<span id="cb73-802"><a href="#cb73-802" aria-hidden="true" tabindex="-1"></a>bill_df<span class="sc">$</span>votes <span class="ot">=</span> <span class="fu">list</span>(recorded_votes_df)</span>
<span id="cb73-803"><a href="#cb73-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-804"><a href="#cb73-804" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(bill_df)</span>
<span id="cb73-805"><a href="#cb73-805" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-806"><a href="#cb73-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-809"><a href="#cb73-809" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-810"><a href="#cb73-810" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb73-811"><a href="#cb73-811" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb73-812"><a href="#cb73-812" aria-hidden="true" tabindex="-1"></a>parse_vote_roll <span class="ot">=</span> <span class="cf">function</span>(vote, logger, bill_type, bill_num){</span>
<span id="cb73-813"><a href="#cb73-813" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-814"><a href="#cb73-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb73-815"><a href="#cb73-815" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb73-816"><a href="#cb73-816" aria-hidden="true" tabindex="-1"></a>      vote_xml <span class="ot">=</span> <span class="fu">read_xml</span>(vote, <span class="at">options =</span> <span class="st">"RECOVER"</span>)</span>
<span id="cb73-817"><a href="#cb73-817" aria-hidden="true" tabindex="-1"></a>      vote_data <span class="ot">=</span> <span class="fu">xml_find_all</span>(vote_xml, <span class="st">"vote-data"</span>)</span>
<span id="cb73-818"><a href="#cb73-818" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb73-819"><a href="#cb73-819" aria-hidden="true" tabindex="-1"></a>      vote_roll_children <span class="ot">=</span> <span class="fu">xml_children</span>(vote_roll_xml)</span>
<span id="cb73-820"><a href="#cb73-820" aria-hidden="true" tabindex="-1"></a>      vote_data <span class="ot">=</span> <span class="fu">xml_find_all</span>(vote_roll_xml, <span class="st">"vote-data"</span>)</span>
<span id="cb73-821"><a href="#cb73-821" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb73-822"><a href="#cb73-822" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Vote data</span></span>
<span id="cb73-823"><a href="#cb73-823" aria-hidden="true" tabindex="-1"></a>      vote_legislators <span class="ot">=</span> vote_data <span class="sc">%&gt;%</span> </span>
<span id="cb73-824"><a href="#cb73-824" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xml_find_all</span>(<span class="st">"recorded-vote"</span>)</span>
<span id="cb73-825"><a href="#cb73-825" aria-hidden="true" tabindex="-1"></a>      legislators_list <span class="ot">=</span> <span class="fu">as_list</span>(vote_legislators)</span>
<span id="cb73-826"><a href="#cb73-826" aria-hidden="true" tabindex="-1"></a>      legislator_vote_df <span class="ot">=</span> legislators_list <span class="sc">%&gt;%</span> </span>
<span id="cb73-827"><a href="#cb73-827" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Modify one level deeper using map_at to target legislator elements</span></span>
<span id="cb73-828"><a href="#cb73-828" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(map_at, <span class="st">"legislator"</span>, attributes) <span class="sc">%&gt;%</span> </span>
<span id="cb73-829"><a href="#cb73-829" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map_dfr</span>(flatten_dfc)</span>
<span id="cb73-830"><a href="#cb73-830" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb73-831"><a href="#cb73-831" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Vote metadata</span></span>
<span id="cb73-832"><a href="#cb73-832" aria-hidden="true" tabindex="-1"></a>      vote_metadata <span class="ot">=</span> <span class="fu">xml_find_all</span>(vote_roll_xml, <span class="st">"vote-metadata"</span>)</span>
<span id="cb73-833"><a href="#cb73-833" aria-hidden="true" tabindex="-1"></a>      vote_singular_nodes <span class="ot">=</span> <span class="fu">xml_singular_nodes</span>(vote_metadata)</span>
<span id="cb73-834"><a href="#cb73-834" aria-hidden="true" tabindex="-1"></a>      (<span class="at">vote_df =</span> <span class="fu">as_list</span>(vote_singular_nodes) <span class="sc">%&gt;%</span> </span>
<span id="cb73-835"><a href="#cb73-835" aria-hidden="true" tabindex="-1"></a>          <span class="co"># as_list() doesn't retain element names so we set names ourselves</span></span>
<span id="cb73-836"><a href="#cb73-836" aria-hidden="true" tabindex="-1"></a>          <span class="fu">setNames</span>(<span class="fu">xml_name</span>(vote_singular_nodes)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-837"><a href="#cb73-837" aria-hidden="true" tabindex="-1"></a>          <span class="fu">flatten_dfc</span>())</span>
<span id="cb73-838"><a href="#cb73-838" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb73-839"><a href="#cb73-839" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Vote totals</span></span>
<span id="cb73-840"><a href="#cb73-840" aria-hidden="true" tabindex="-1"></a>      vote_totals <span class="ot">=</span> <span class="fu">xml_find_all</span>(vote_metadata, <span class="st">"vote-totals"</span>)</span>
<span id="cb73-841"><a href="#cb73-841" aria-hidden="true" tabindex="-1"></a>      vote_totals_by_party <span class="ot">=</span> <span class="fu">xml_find_all</span>(vote_totals, <span class="st">"totals-by-party"</span>)</span>
<span id="cb73-842"><a href="#cb73-842" aria-hidden="true" tabindex="-1"></a>      party_vote_totals_df <span class="ot">=</span> vote_totals_by_party <span class="sc">%&gt;%</span> </span>
<span id="cb73-843"><a href="#cb73-843" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb73-844"><a href="#cb73-844" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map_dfr</span>(flatten_dfc) <span class="sc">%&gt;%</span> </span>
<span id="cb73-845"><a href="#cb73-845" aria-hidden="true" tabindex="-1"></a>        <span class="fu">type_convert</span>()</span>
<span id="cb73-846"><a href="#cb73-846" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb73-847"><a href="#cb73-847" aria-hidden="true" tabindex="-1"></a>      vote_roll_df <span class="ot">=</span> vote_df <span class="sc">%&gt;%</span> </span>
<span id="cb73-848"><a href="#cb73-848" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">legislator_votes =</span> <span class="fu">list</span>(legislator_vote_df),</span>
<span id="cb73-849"><a href="#cb73-849" aria-hidden="true" tabindex="-1"></a>               <span class="at">party_votes =</span> <span class="fu">list</span>(party_vote_totals_df)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-850"><a href="#cb73-850" aria-hidden="true" tabindex="-1"></a>        janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb73-851"><a href="#cb73-851" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb73-852"><a href="#cb73-852" aria-hidden="true" tabindex="-1"></a>      vote_list <span class="ot">=</span> <span class="fu">as_list</span>(vote_data)</span>
<span id="cb73-853"><a href="#cb73-853" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb73-854"><a href="#cb73-854" aria-hidden="true" tabindex="-1"></a>      <span class="fu">flatten_dfr</span>(vote_list) <span class="sc">%&gt;%</span> </span>
<span id="cb73-855"><a href="#cb73-855" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unnest</span>(<span class="fu">everything</span>())</span>
<span id="cb73-856"><a href="#cb73-856" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb73-857"><a href="#cb73-857" aria-hidden="true" tabindex="-1"></a>    <span class="at">error=</span><span class="cf">function</span>(cond) {</span>
<span id="cb73-858"><a href="#cb73-858" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log_info</span>(logger, </span>
<span id="cb73-859"><a href="#cb73-859" aria-hidden="true" tabindex="-1"></a>               <span class="at">bill_type =</span> bill_type,</span>
<span id="cb73-860"><a href="#cb73-860" aria-hidden="true" tabindex="-1"></a>               <span class="at">bill_num =</span> bill_num, </span>
<span id="cb73-861"><a href="#cb73-861" aria-hidden="true" tabindex="-1"></a>               <span class="st">"ERROR: Vote roll could not be parsed"</span>)</span>
<span id="cb73-862"><a href="#cb73-862" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Choose a return value in case of error</span></span>
<span id="cb73-863"><a href="#cb73-863" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">tibble</span>())</span>
<span id="cb73-864"><a href="#cb73-864" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb73-865"><a href="#cb73-865" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-866"><a href="#cb73-866" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-867"><a href="#cb73-867" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-868"><a href="#cb73-868" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-869"><a href="#cb73-869" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-870"><a href="#cb73-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-871"><a href="#cb73-871" aria-hidden="true" tabindex="-1"></a><span class="fu"># Other helpful articles</span></span>
<span id="cb73-872"><a href="#cb73-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-873"><a href="#cb73-873" aria-hidden="true" tabindex="-1"></a>Here are some of the helpful articles I came across in the course of writing this:</span>
<span id="cb73-874"><a href="#cb73-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-875"><a href="#cb73-875" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">From XML to Excel for Data Analysis</span><span class="co">](https://towardsdatascience.com/from-xml-to-excel-for-data-analysis-ac0c0c765b7d "Introduction to Processing XML In Python")</span></span>
<span id="cb73-876"><a href="#cb73-876" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Reading XML files in R</span><span class="co">](https://medium.com/geekculture/reading-xml-files-in-r-3122c3a2a8d9)</span></span>
<span id="cb73-877"><a href="#cb73-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-878"><a href="#cb73-878" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session Info</span></span>
<span id="cb73-879"><a href="#cb73-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-880"><a href="#cb73-880" aria-hidden="true" tabindex="-1"></a>Version information about R, OS, and loaded packages.</span>
<span id="cb73-881"><a href="#cb73-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-884"><a href="#cb73-884" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-885"><a href="#cb73-885" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: session-info</span></span>
<span id="cb73-886"><a href="#cb73-886" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb73-887"><a href="#cb73-887" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>(<span class="st">"loaded"</span>)</span>
<span id="cb73-888"><a href="#cb73-888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>